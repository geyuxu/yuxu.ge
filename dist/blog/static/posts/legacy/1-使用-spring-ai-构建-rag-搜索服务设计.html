<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä½¿ç”¨ Spring AI æ„å»º RAG æœç´¢æœåŠ¡è®¾è®¡ | Yuxu Ge</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1/themes/prism-tomorrow.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    <style>
        :root {
            --black: #111;
            --dark-grey: #444;
            --off-white: #f4f4f4;
            --vermilion: #C41E3A;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            font-size: 16px;
            scroll-behavior: smooth;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            line-height: 1.6;
            color: var(--black);
            background-color: var(--off-white);
        }

        a {
            color: var(--vermilion);
            text-decoration: none;
        }

        a:hover {
            opacity: 0.75;
        }

        .layout {
            min-height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            position: fixed;
            top: 0;
            left: 0;
            width: 320px;
            height: 100vh;
            background: var(--black);
            color: var(--off-white);
            padding: 3rem 2rem;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .sidebar-top {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
        }

        .avatar {
            display: block;
            width: 120px;
            height: 120px;
            border-radius: 50%;
            border: 3px solid var(--vermilion);
            margin-bottom: 1.5rem;
            overflow: hidden;
            transition: transform 0.2s ease;
        }

        .avatar:hover {
            opacity: 1;
            transform: scale(1.05);
        }

        .avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .name-block {
            margin-bottom: 0.5rem;
        }

        h1 {
            font-size: 1.8rem;
            font-weight: 700;
            letter-spacing: 1px;
            color: var(--off-white);
        }

        .title-role {
            font-size: 0.9rem;
            color: #888;
            margin-top: 0.25rem;
            font-weight: 400;
        }

        .contact-block {
            margin-top: 2.5rem;
            width: 100%;
        }

        .social-links {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.75rem;
        }

        .social-links a {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            width: 160px;
            color: var(--off-white);
            opacity: 0.7;
            padding: 0.5rem 0.75rem;
            border-radius: 4px;
            font-size: 0.9rem;
            transition: all 0.2s;
        }

        .social-links a:hover {
            color: var(--vermilion);
            opacity: 1;
            background: rgba(255, 255, 255, 0.05);
        }

        .social-links svg {
            width: 20px;
            height: 20px;
            flex-shrink: 0;
        }

        .social-links .orcid-link {
            font-size: 0.68rem;
            gap: 0.5rem;
            white-space: nowrap;
        }

        .sidebar-footer {
            text-align: center;
            font-size: 0.75rem;
            color: #555;
        }

        /* Content */
        .content {
            margin-left: 320px;
            padding: 3rem 4rem;
            max-width: calc(100vw - 320px - 8rem);
        }

        .back-link {
            display: inline-block;
            font-size: 0.85rem;
            margin-bottom: 2rem;
            color: var(--dark-grey);
        }

        .back-link:hover {
            color: var(--vermilion);
        }

        /* Article */
        article h1 {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 1.5rem;
            line-height: 1.3;
            color: var(--black);
        }

        article h2 {
            font-size: 1.4rem;
            font-weight: 600;
            margin: 2rem 0 1rem;
            color: var(--black);
        }

        article h3 {
            font-size: 1.1rem;
            font-weight: 600;
            margin: 1.5rem 0 0.75rem;
            color: var(--black);
        }

        article p {
            margin-bottom: 1rem;
            color: var(--dark-grey);
        }

        article ul,
        article ol {
            margin: 1rem 0 1rem 1.5rem;
            color: var(--dark-grey);
        }

        article li {
            margin-bottom: 0.5rem;
        }

        article strong {
            color: var(--black);
        }

        article code {
            font-family: "SF Mono", Monaco, monospace;
            font-size: 0.9em;
            background: #e8e8e8;
            padding: 0.15em 0.4em;
            border-radius: 3px;
        }

        article pre {
            margin: 1rem 0;
            border-radius: 6px;
            overflow-x: auto;
            background: #2d2d2d;
            padding: 1rem;
        }

        article pre code {
            background: none;
            padding: 0;
            font-size: 0.75em;
            white-space: pre !important;
            counter-reset: line;
            display: block;
            color: #ccc;
        }

        article pre code .line {
            counter-increment: line;
        }

        article pre code .line::before {
            content: counter(line);
            display: inline-block;
            width: 2.5em;
            margin-right: 1em;
            text-align: right;
            color: #666;
            user-select: none;
        }

        .code-toolbar {
            display: flex;
            justify-content: flex-start;
            padding: 0.35rem 0.5rem;
            background: #3a3a3a;
            border-radius: 6px 6px 0 0;
        }

        .code-toolbar+pre {
            margin-top: 0;
            border-radius: 0 0 6px 6px;
        }

        .copy-btn {
            padding: 0.2rem 0.5rem;
            font-size: 0.7rem;
            background: #555;
            color: #fff;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .copy-btn:hover,
        .copy-btn:active {
            background: #777;
        }

        .copy-btn.copied {
            background: #2a2;
        }

        article blockquote {
            border-left: 3px solid var(--vermilion);
            padding-left: 1rem;
            margin: 1rem 0;
            color: #666;
            font-style: italic;
        }

        article hr {
            border: none;
            border-top: 1px solid #ddd;
            margin: 2rem 0;
        }

        article table {
            width: 100%;
            border-collapse: collapse;
            margin: 1rem 0;
            font-size: 0.9rem;
        }

        article th,
        article td {
            border: 1px solid #ddd;
            padding: 0.5rem 0.75rem;
            text-align: left;
        }

        article th {
            background: #e8e8e8;
            font-weight: 600;
        }

        article img {
            max-width: 100%;
            height: auto;
            display: block;
            margin: 1.5rem 0;
            border-radius: 6px;
        }

        .loading {
            text-align: center;
            padding: 3rem;
            color: #888;
        }

        .error {
            color: var(--vermilion);
        }

        /* Language Selector */
        .lang-selector {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
            padding: 0.75rem 1rem;
            background: #fff;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            font-size: 0.85rem;
        }

        .lang-selector-label {
            color: #666;
            display: flex;
            align-items: center;
            gap: 0.35rem;
        }

        .lang-selector-label svg {
            width: 16px;
            height: 16px;
        }

        .lang-select {
            padding: 0.4rem 0.75rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            background: white;
            font-size: 0.85rem;
            cursor: pointer;
            min-width: 140px;
        }

        .lang-select:focus {
            outline: none;
            border-color: var(--vermilion);
        }

        .lang-status {
            font-size: 0.8rem;
            color: #888;
            margin-left: auto;
        }

        .lang-status.translating {
            color: var(--vermilion);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .lang-status.translating::before {
            content: '';
            width: 14px;
            height: 14px;
            border: 2px solid #f0f0f0;
            border-top-color: var(--vermilion);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .lang-status.cached {
            color: #4CAF50;
        }

        .lang-original-btn {
            padding: 0.35rem 0.6rem;
            font-size: 0.75rem;
            background: #f0f0f0;
            border: 1px solid #ddd;
            border-radius: 4px;
            cursor: pointer;
            color: #666;
            transition: all 0.2s;
        }

        .lang-original-btn:hover {
            background: #e0e0e0;
            color: #333;
        }

        @media (max-width: 600px) {
            .lang-selector {
                flex-wrap: wrap;
            }
            .lang-status {
                width: 100%;
                margin-left: 0;
                margin-top: 0.5rem;
            }
        }

        /* KaTeX math styles */
        .katex-display {
            overflow-x: auto;
            overflow-y: hidden;
            padding: 0.5rem 0;
        }

        .katex {
            font-size: 1.1em;
        }

        /* Jupyter Notebook Styles */
        .notebook-container {
            margin-top: 1rem;
        }

        .notebook-download {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            margin-bottom: 1.5rem;
            background: var(--black);
            color: var(--off-white);
            border-radius: 4px;
            font-size: 0.85rem;
            transition: opacity 0.2s;
        }

        .notebook-download:hover {
            opacity: 0.8;
            color: var(--off-white);
        }

        .notebook-download svg {
            width: 16px;
            height: 16px;
        }

        .nb-cell {
            margin-bottom: 1.5rem;
        }

        .nb-cell-code .nb-source {
            background: #2d2d2d;
            border-radius: 6px;
            overflow-x: auto;
        }

        .nb-cell-code .nb-source pre {
            margin: 0;
            padding: 1rem;
            color: #ccc;
            font-family: "SF Mono", Monaco, monospace;
            font-size: 0.85em;
        }

        .nb-cell-code .nb-source code {
            background: none;
            padding: 0;
        }

        .nb-output {
            background: #fff;
            border: 1px solid #ddd;
            border-radius: 6px;
            padding: 0.75rem;
            margin-top: 0.5rem;
        }

        .nb-output pre {
            margin: 0;
            padding: 0;
            background: transparent;
            white-space: pre-wrap;
            word-wrap: break-word;
            font-family: "SF Mono", Monaco, monospace;
            font-size: 0.85em;
            color: #222;
        }

        .nb-output img {
            max-width: 100%;
            height: auto;
            display: block;
            margin: 0.5rem 0;
        }

        .nb-output table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9rem;
        }

        .nb-output th,
        .nb-output td {
            border: 1px solid #ddd;
            padding: 0.5rem;
            text-align: left;
        }

        .nb-output th {
            background: #e8e8e8;
            font-weight: 600;
        }

        .nb-cell-markdown {
            padding: 0;
        }

        .nb-cell-markdown h1:first-child {
            margin-top: 0;
        }

        /* Document Download Button */
        .doc-download {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            margin-bottom: 1.5rem;
            background: var(--black);
            color: var(--off-white);
            border-radius: 4px;
            font-size: 0.85rem;
            transition: opacity 0.2s;
        }

        .doc-download:hover {
            opacity: 0.8;
            color: var(--off-white);
        }

        .doc-download svg {
            width: 16px;
            height: 16px;
        }

        /* PDF Viewer */
        .pdf-container {
            margin-top: 1rem;
        }

        .pdf-viewer {
            width: 100%;
            height: 80vh;
            border: 1px solid #ddd;
            border-radius: 6px;
            background: #f5f5f5;
        }

        /* Text File Display */
        .text-container {
            margin-top: 1rem;
        }

        .text-content {
            background: #fff;
            border: 1px solid #ddd;
            border-radius: 6px;
            padding: 1.5rem;
            font-family: "SF Mono", Monaco, monospace;
            font-size: 0.9em;
            line-height: 1.6;
            white-space: pre-wrap;
            word-wrap: break-word;
            color: var(--dark-grey);
            max-height: 80vh;
            overflow-y: auto;
        }

        /* Word Document Display */
        .word-container {
            margin-top: 1rem;
        }

        .word-content {
            background: #fff;
            border: 1px solid #ddd;
            border-radius: 6px;
            padding: 2rem;
            line-height: 1.8;
            color: var(--dark-grey);
        }

        .word-content p {
            margin-bottom: 1rem;
        }

        .word-content h1,
        .word-content h2,
        .word-content h3 {
            color: var(--black);
            margin: 1.5rem 0 1rem;
        }

        .word-content table {
            width: 100%;
            border-collapse: collapse;
            margin: 1rem 0;
        }

        .word-content th,
        .word-content td {
            border: 1px solid #ddd;
            padding: 0.5rem;
        }

        .word-content img {
            max-width: 100%;
            height: auto;
        }

        /* Excel Display */
        .excel-container {
            margin-top: 1rem;
        }

        .excel-tabs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }

        .excel-tab {
            padding: 0.5rem 1rem;
            background: #e8e8e8;
            border: none;
            border-radius: 4px 4px 0 0;
            cursor: pointer;
            font-size: 0.85rem;
        }

        .excel-tab.active {
            background: #4CAF50;
            color: white;
        }

        .excel-content {
            background: #fff;
            border: 1px solid #ddd;
            border-radius: 6px;
            overflow-x: auto;
            max-height: 70vh;
            overflow-y: auto;
        }

        .excel-content table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.85rem;
        }

        .excel-content th,
        .excel-content td {
            border: 1px solid #ddd;
            padding: 0.4rem 0.6rem;
            text-align: left;
            white-space: nowrap;
        }

        .excel-content th {
            background: #f5f5f5;
            font-weight: 600;
            position: sticky;
            top: 0;
        }

        .excel-content tr:nth-child(even) {
            background: #fafafa;
        }

        /* PowerPoint Display */
        .ppt-container {
            margin-top: 1rem;
        }

        .ppt-viewer {
            width: 100%;
            height: 80vh;
            border: 1px solid #ddd;
            border-radius: 6px;
            background: #f5f5f5;
        }

        /* CSV Display (uses excel styles) */
        .csv-container {
            margin-top: 1rem;
        }

        /* Responsive */
        @media (max-width: 900px) {
            .sidebar {
                position: relative;
                width: 100%;
                height: auto;
                padding: 2rem 1.5rem 1rem;
            }

            .social-links {
                flex-direction: row;
                flex-wrap: wrap;
                justify-content: center;
            }

            .social-links a,
            .social-links .orcid-link {
                width: auto;
                padding: 0.5rem;
                font-size: 0;
                gap: 0;
            }

            .social-links svg {
                width: 24px;
                height: 24px;
            }

            .social-links .hide-mobile {
                display: none;
            }

            .sidebar-footer {
                margin-top: 1rem;
            }

            .content {
                margin-left: 0;
                padding: 2rem 1rem;
            }
        }

        @media (max-width: 480px) {
            .sidebar {
                padding: 1.5rem 1rem 1rem;
            }

            .avatar {
                width: 80px;
                height: 80px;
            }

            h1 {
                font-size: 1.4rem;
            }

            article h1 {
                font-size: 1.5rem;
            }
        }
    </style>
</head>

<body>

    <div class="layout">
        <aside class="sidebar" id="sidebar-content"></aside>
        <script src="/components/sidebar.js?v=20260128"></script>

        <main class="content">
            <a href="/blog/" class="back-link">â† Back to Blog</a>

            <!-- Language Selector -->
            <div class="lang-selector" id="lang-selector" style="display: none;">
                <span class="lang-selector-label">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5h12M9 3v2m1.048 9.5A18.022 18.022 0 016.412 9m6.088 9h7M11 21l5-10 5 10M12.751 5C11.783 10.77 8.07 15.61 3 18.129" />
                    </svg>
                    Language
                </span>
                <select class="lang-select" id="lang-select">
                    <option value="en">ğŸ‡ºğŸ‡¸ English</option>
                    <option value="zh">ğŸ‡¨ğŸ‡³ ä¸­æ–‡</option>
                    <option value="ja">ğŸ‡¯ğŸ‡µ æ—¥æœ¬èª</option>
                    <option value="ko">ğŸ‡°ğŸ‡· í•œêµ­ì–´</option>
                    <option value="es">ğŸ‡ªğŸ‡¸ EspaÃ±ol</option>
                    <option value="fr">ğŸ‡«ğŸ‡· FranÃ§ais</option>
                    <option value="de">ğŸ‡©ğŸ‡ª Deutsch</option>
                    <option value="pt">ğŸ‡µğŸ‡¹ PortuguÃªs</option>
                    <option value="ru">ğŸ‡·ğŸ‡º Ğ ÑƒÑÑĞºĞ¸Ğ¹</option>
                    <option value="ar">ğŸ‡¸ğŸ‡¦ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option>
                </select>
                <button class="lang-original-btn" id="lang-original-btn" style="display: none;">Show Original</button>
                <span class="lang-status" id="lang-status"></span>
            </div>

            <article>
<hr>
<h2>date: 2025-04-29
tags: [ai]
legacy: true</h2>
<h1>ä½¿ç”¨ Spring AI æ„å»º RAG æœç´¢æœåŠ¡è®¾è®¡</h1>
<p>ç³»ç»Ÿæ•´ä½“æ¶æ„é‡‡ç”¨åˆ†å±‚æ¨¡å—åŒ–è®¾è®¡ï¼Œæ ¸å¿ƒåŒ…æ‹¬ä»¥ä¸‹éƒ¨åˆ†ï¼š</p>
<ul>
<li>æ–‡æ¡£å‘é‡å­˜å‚¨ï¼ˆVector Storeï¼‰ï¼šä½¿ç”¨ Qdrant ä½œä¸ºå‘é‡æ•°æ®åº“å­˜å‚¨æ–‡æ¡£çš„è¯­ä¹‰å‘é‡è¡¨ç¤ºï¼Œç”¨äºè¯­ä¹‰ç›¸ä¼¼åº¦æ£€ç´¢ã€‚Spring AI æä¾›äº†æŠ½è±¡çš„ VectorStore æ¥å£æ¥å°è£…å‘é‡æ•°æ®åº“æ“ä½œ ã€‚é€šè¿‡å¼•å…¥ Spring AI çš„ Qdrant é›†æˆæ¨¡å—ï¼Œå¯ä»¥å°† Qdrant ç”¨ä½œ VectorStoreï¼Œåœ¨åº”ç”¨ä¸­æ‰§è¡Œé«˜æ•ˆçš„ç›¸ä¼¼åº¦æŸ¥è¯¢ã€‚ </li>
<li>å…¨æ–‡æ£€ç´¢å¼•æ“ï¼šä½¿ç”¨ Elasticsearch å­˜å‚¨æ–‡æ¡£çš„åŸå§‹æ–‡æœ¬æˆ–å…³é”®è¯ç´¢å¼•ï¼Œç”¨äºåŸºäºå…³é”®è¯çš„å¸ƒå°”/å…¨æ–‡æ£€ç´¢ã€‚Elasticsearch æä¾›å€’æ’ç´¢å¼•èƒ½å¤Ÿæœ‰æ•ˆåŒ¹é…ç”¨æˆ·æŸ¥è¯¢ä¸­çš„å…³é”®è¯ã€‚</li>
<li>æ··åˆæ£€ç´¢å™¨ï¼ˆHybrid Retrieverï¼‰ï¼šRAGæœåŠ¡çš„æ£€ç´¢å±‚ç»„ä»¶ï¼Œè´Ÿè´£å°†å…³é”®è¯æ£€ç´¢ä¸å‘é‡è¯­ä¹‰æ£€ç´¢ç»“æœç»“åˆã€‚æŸ¥è¯¢æ—¶åŒæ—¶å¯¹ESæ‰§è¡Œå…³é”®è¯åŒ¹é…æ£€ç´¢ï¼Œå¯¹Qdrantæ‰§è¡Œå‘é‡ç›¸ä¼¼åº¦æ£€ç´¢ï¼Œè·å–ä¸¤æ–¹é¢çš„æ–‡æ¡£åˆ—è¡¨ï¼Œå¹¶è¿›è¡Œç»“æœèåˆã€‚é€šè¿‡æ··åˆæ£€ç´¢ï¼Œæ—¢èƒ½åˆ©ç”¨å…³é”®è¯ç²¾ç¡®åŒ¹é…ï¼Œåˆèƒ½åˆ©ç”¨å‘é‡æ£€ç´¢æ•è·è¯­ä¹‰ç›¸å…³å†…å®¹ï¼Œæå‡å¬å›ç‡å’Œå‡†ç¡®æ€§ã€‚Spring AI æä¾›äº† DocumentRetriever æ¥å£è¡¨ç¤ºæŠ½è±¡çš„æ–‡æ¡£æ£€ç´¢å™¨ï¼Œä»¥åŠå‘é‡æ£€ç´¢å®ç° VectorStoreDocumentRetriever  ï¼›æœ¬æ–¹æ¡ˆå¯è‡ªå®šä¹‰å®ç°ä¸€ä¸ªHybridRetrieverï¼Œå†…éƒ¨ç»„åˆè°ƒç”¨ ES å’Œ Qdrant çš„æ£€ç´¢æ¥å£ï¼Œç„¶åç”¨ æ–‡æ¡£åˆå¹¶å™¨å°†ç»“æœåˆå¹¶ï¼ˆå¯ç®€å•å»é‡æ‹¼æ¥ï¼Œæˆ–æŒ‰åˆ†æ•°èåˆï¼‰ã€‚ä¾‹å¦‚ï¼Œå¯ä½¿ç”¨ Spring AI çš„ ConcatenationDocumentJoiner å°†å¤šæ•°æ®æºçš„ç»“æœé›†åˆå¹¶ä¸ºä¸€ä¸ªæ–‡æ¡£åˆ—è¡¨ ã€‚</li>
<li>RAGæœåŠ¡å±‚ï¼šå°è£…æ•´ä¸ªâ€œæ£€ç´¢-ç”Ÿæˆâ€æµç¨‹çš„æ ¸å¿ƒæœåŠ¡ï¼ˆå¯ç§°ä¸º RagServiceï¼‰ã€‚å®ƒè´Ÿè´£æ¥æ”¶ç”¨æˆ·æŸ¥è¯¢ï¼Œè°ƒç”¨Hybrid Retrieveræ£€ç´¢ç›¸å…³æ–‡æ¡£ï¼Œå°†æ£€ç´¢åˆ°çš„æ–‡æ¡£ä½œä¸ºä¸Šä¸‹æ–‡æäº¤ç»™LLMï¼Œå¹¶è¿”å›ç”Ÿæˆçš„ç­”æ¡ˆã€‚RAGæœåŠ¡é€šè¿‡ Spring AI æä¾›çš„ ChatClient ä¸åº•å±‚LLMæ¨¡å‹äº¤äº’ ã€‚ChatClientæŠ½è±¡å‡ºä¸AIæ¨¡å‹äº¤äº’çš„é€šç”¨æ¥å£ï¼Œæ”¯æŒåŒæ­¥æˆ–æµå¼åœ°å‘é€æç¤ºå¹¶è·å¾—å›å¤ ã€‚å€ŸåŠ©Spring AIçš„æ¨¡å—åŒ–è®¾è®¡ï¼Œå¯ä»¥æ–¹ä¾¿åœ°æ›´æ¢åº•å±‚ä½¿ç”¨çš„LLMæˆ–å‘é‡åº“ï¼Œè€Œæ— éœ€å¤§æ”¹ä¸šåŠ¡ä»£ç  ã€‚</li>
<li>LLMæ¨ç†å±‚ï¼šå¤§è¯­è¨€æ¨¡å‹ç”¨äºæ ¹æ®ç”¨æˆ·æŸ¥è¯¢å’Œæ£€ç´¢åˆ°çš„æ–‡æ¡£ä¸Šä¸‹æ–‡ç”Ÿæˆå›ç­”ã€‚é€šè¿‡Spring AIçš„ChatModelä¸ChatClientæŠ½è±¡ï¼Œæˆ‘ä»¬å¯ä»¥æ— ç¼åˆ‡æ¢ä¸åŒçš„æ¨¡å‹å’Œæä¾›å•†ã€‚ä¾‹å¦‚ï¼Œå½“ä½¿ç”¨OpenAIæ—¶ï¼Œå¯é…ç½®ChatClientè°ƒç”¨OpenAIçš„GPTæ¨¡å‹ï¼›å½“ä½¿ç”¨æœ¬åœ°æ¨¡å‹æ—¶ï¼Œåˆ©ç”¨Ollamaæä¾›æœ¬åœ°LLMæ¨ç†æœåŠ¡ã€‚ChatClientå±è”½äº†åº•å±‚å·®å¼‚ï¼Œä»¥ç»Ÿä¸€çš„APIå‘é€Promptå¹¶è·å–æ¨¡å‹å“åº” ã€‚</li>
<li>åµŒå…¥æ¨¡å‹ï¼šå°†æ–‡æœ¬è½¬æ¢ä¸ºå‘é‡è¡¨ç¤ºçš„åµŒå…¥æ¨¡å‹ç»„ä»¶ã€‚ç³»ç»Ÿæ”¯æŒä¸¤ç§æ–¹æ¡ˆï¼š<ol>
<li>æœ¬åœ° HuggingFace æ¨¡å‹ï¼šé€šè¿‡Spring AIçš„Transformers ONNXæ”¯æŒï¼ŒåŠ è½½æœ¬åœ°é¢„è®­ç»ƒçš„Transformeræ¨¡å‹ï¼ˆä¾‹å¦‚all-MiniLM-L6-v2ï¼‰ä»¥ç”Ÿæˆæ–‡æœ¬åµŒå…¥ ã€‚æ­¤æ–¹å¼ä¿è¯æ•°æ®ä¸å‡ºæœ¬åœ°ï¼Œå“åº”é€Ÿåº¦å¿«ä¸”æ— éœ€è°ƒç”¨å¤–éƒ¨APIã€‚</li>
<li>OpenAI Embedding APIï¼šåˆ©ç”¨OpenAIçš„embeddingæ¥å£ï¼ˆå¦‚text-embedding-ada-002ï¼‰è·å–æ–‡æœ¬çš„å‘é‡è¡¨ç¤ºï¼Œéœ€è¦ç½‘ç»œè°ƒç”¨å’ŒAPIå¯†é’¥ã€‚Spring AI æä¾›äº†å¼€ç®±å³ç”¨çš„ OpenAiEmbeddingModel å®ç°ï¼Œæˆ‘ä»¬åªéœ€æä¾› OpenAI API key å³å¯ä½¿ç”¨ ã€‚</li>
</ol>
</li>
</ul>
<p>ä¸Šè¿°ç»„ä»¶é€šè¿‡Spring Bootè¿›è¡Œé…ç½®å’Œç»„ç»‡ï¼Œæœ€ç»ˆä»¥RESTful APIå½¢å¼æä¾›æœåŠ¡ï¼ŒåŒ…æ‹¬æ–‡æ¡£å…¥åº“æ¥å£å’Œé—®ç­”æŸ¥è¯¢æ¥å£ã€‚ä¸‹å›¾å±•ç¤ºäº†ç³»ç»Ÿå„ç»„ä»¶çš„äº¤äº’å…³ç³»ï¼š</p>
<p>(æ¶æ„è¯´æ˜ï¼šç”¨æˆ·é€šè¿‡Controllerå‘å‡ºè¯·æ±‚ï¼ŒRAG Serviceè°ƒç”¨Hybrid Retrieveråˆ†åˆ«ä¸ESå’ŒQdrantäº¤äº’æ£€ç´¢æ–‡æ¡£ï¼›åµŒå…¥æ¨¡å‹ç”¨äºå‘é‡ç”Ÿæˆä¾›Qdrantå­˜å‚¨ä¸æ£€ç´¢ï¼›ChatClientå°è£…LLMæ¨¡å‹è°ƒç”¨ï¼ˆæœ¬åœ°æˆ–äº‘ï¼‰ï¼›æœ€ç»ˆå°†æ£€ç´¢åˆ°çš„ç›¸å…³æ–‡æ¡£ä½œä¸ºæç¤ºä¸Šä¸‹æ–‡ï¼Œäº¤ç”±LLMç”Ÿæˆç­”æ¡ˆå¹¶è¿”å›ç»™ç”¨æˆ·ã€‚)</p>
<h2>æ ¸å¿ƒæ¨¡å—è®¾è®¡</h2>
<h3>å‘é‡å­˜å‚¨ä¸æ··åˆæ£€ç´¢æ¨¡å—</h3>
<p>Qdrant å‘é‡å­˜å‚¨é…ç½®ï¼šç³»ç»Ÿä½¿ç”¨Qdrantæ¥æŒä¹…åŒ–æ–‡æ¡£å‘é‡åŠå…ƒæ•°æ®ã€‚é€šè¿‡å¼•å…¥ä¾èµ– spring-ai-qdrant-storeï¼ŒSpring AIèƒ½å¤Ÿè‡ªåŠ¨é…ç½®Qdrantç›¸å…³çš„Bean  ã€‚æˆ‘ä»¬éœ€è¦æä¾›Qdrantå®¢æˆ·ç«¯ä»¥åŠVectorStore Beanï¼Œä¾‹å¦‚ï¼š</p>
<blockquote><code>@Bean</code><br>
<code>public QdrantClient qdrantClient() {</code><br>
<code>    // æ„å»ºè¿æ¥åˆ° Qdrant çš„ gRPC å®¢æˆ·ç«¯</code><br>
<code>    QdrantGrpcClient.Builder grpcClientBuilder = </code><br>
<code>        QdrantGrpcClient.newBuilder(&quot;qdrant-host&quot;, 6334, false);</code><br>
<code>    grpcClientBuilder.withApiKey(&quot;&lt;QDRANT_API_KEY&gt;&quot;);</code><br>
<code>    return new QdrantClient(grpcClientBuilder.build());</code><br>
<code>}</code><br>
<code># ... (8 more lines)</code></blockquote>
<p><em>Full code available in the <a href="https://github.com/geyuxu">GitHub repository</a>.</em></p><p>ä¸Šè¿°é…ç½®åˆ›å»ºäº†VectorStoreæ¥å£çš„Qdrantå®ç°ï¼Œç”¨äºå­˜å‚¨å‘é‡åŠæ‰§è¡Œç›¸ä¼¼åº¦æœç´¢ã€‚  å…¶ä¸­æ³¨å…¥çš„ EmbeddingModel ç”¨äºåœ¨å­˜å‚¨æ–‡æ¡£æ—¶ç”Ÿæˆå…¶å‘é‡è¡¨ç¤ºã€‚æ³¨æ„ï¼šå¯ä»¥æå‰åœ¨Qdrantä¸­åˆ›å»ºé›†åˆå¹¶æŒ‡å®šå‘é‡ç»´åº¦å’Œç›¸ä¼¼åº¦åº¦é‡æ–¹å¼ï¼Œæˆ–é€šè¿‡ initializeSchema(true) ç”±ç¨‹åºè‡ªåŠ¨åˆ›å»º(é»˜è®¤ä½¿ç”¨ Cosine è·ç¦»ï¼Œç»´åº¦å–å†³äºæ‰€ç”¨åµŒå…¥æ¨¡å‹)  ã€‚ç¡®ä¿Qdrantå®ä¾‹å·²å¯åŠ¨å¹¶å¯è®¿é—®ï¼Œæ¯”å¦‚é€šè¿‡Dockerå¯åŠ¨ Qdrant å®¹å™¨ã€‚</p>
<p>Elasticsearch å…¨æ–‡æ£€ç´¢é…ç½®ï¼šElasticsearchç”¨äºå­˜å‚¨æ–‡æ¡£æ–‡æœ¬ç´¢å¼•ï¼Œå®ç°å…³é”®è¯åŒ¹é…æ£€ç´¢ã€‚å¯é‡‡ç”¨Spring Data Elasticsearchæˆ–Rest APIè¿›è¡Œé›†æˆã€‚é…ç½®ä¸Šï¼Œéœ€è¦æä¾›ESçš„åœ°å€ï¼ˆä¾‹å¦‚localhost:9200ï¼‰ã€ç´¢å¼•åç§°ï¼ˆå¦‚documentsï¼‰ä»¥åŠç´¢å¼•mappingï¼ˆåŒ…å«æ–‡æ¡£IDã€å†…å®¹ç­‰å­—æ®µï¼‰ã€‚ä¸ºäº†ç®€åŒ–ï¼Œå®ç°ä¸Šå¯ä»¥åˆ©ç”¨Spring Data Elasticsearchå®šä¹‰ä¸€ä¸ªæ–‡æ¡£å®ä½“åŠå¯¹åº”çš„Repositoryã€‚ä¾‹å¦‚å®šä¹‰DocumentEntity(id, content, metadata)å¹¶å»ºç«‹å…¨æ–‡ç´¢å¼•ã€‚</p>
<p>æ–‡æ¡£ç´¢å¼•ç»“æ„ï¼šä¸ºäº†æ–¹ä¾¿æ··åˆæ£€ç´¢ç»“æœçš„åˆå¹¶ï¼Œæˆ‘ä»¬ä¸ºæ¯ä¸ªæ–‡æ¡£ç‰‡æ®µåˆ†é…å”¯ä¸€IDï¼Œå¹¶åœ¨Qdrantå’ŒElasticsearchä¸­å…±äº«è¯¥IDä½œä¸ºä¸»é”®ã€‚æ¯ä»½æ–‡æ¡£åœ¨å…¥åº“æ—¶é€šå¸¸ä¼šè¢«æ‹†åˆ†æˆè‹¥å¹²ç‰‡æ®µ (chunks)ï¼Œæ¯ä¸ªç‰‡æ®µæ˜¯ä¸€æ®µé€‚åˆæ£€ç´¢å’Œä¸Šä¸‹æ–‡é•¿åº¦çš„æ–‡æœ¬ã€‚æˆ‘ä»¬å°†æ¯ä¸ªç‰‡æ®µä½œä¸ºç‹¬ç«‹çš„Documentè¿›è¡Œç´¢å¼•å’Œå‘é‡å­˜å‚¨ã€‚è¿™æ ·åœ¨æ£€ç´¢é˜¶æ®µï¼Œæ— è®ºé€šè¿‡å‘é‡è¿˜æ˜¯å…³é”®è¯æ‰¾åˆ°æŸç‰‡æ®µï¼Œéƒ½å¯ä»¥æ ¹æ®IDç¡®å®šå¯¹åº”çš„å†…å®¹ã€‚å¯ä»¥å°†æ–‡æ¡£å†…å®¹å­˜å‚¨åœ¨ESç´¢å¼•ä¸­ï¼Œè€Œåœ¨Qdrantä¸­ä¸»è¦å­˜å‚¨å‘é‡å’Œå¿…è¦çš„å…ƒä¿¡æ¯(å¦‚æ–‡æ¡£IDã€æ¥æºç­‰)ä½œä¸º payloadã€‚</p>
<p>Hybrid Retriever å®ç°ï¼šåˆ›å»ºä¸€ä¸ªæ··åˆæ£€ç´¢å™¨ï¼Œä¾‹å¦‚ HybridRetriever implements DocumentRetrieverã€‚å…¶retrieve(Query query)æ–¹æ³•å†…éƒ¨æ‰§è¡Œä»¥ä¸‹æ­¥éª¤ï¼š</p>
<ul>
<li>ä½¿ç”¨ESæ‰§è¡Œå…³é”®è¯æŸ¥è¯¢ï¼šå¦‚æ„é€ ä¸€ä¸ªmatchæˆ–boolæŸ¥è¯¢ï¼ŒåŒ¹é…contentå­—æ®µåŒ…å«æŸ¥è¯¢æ–‡æœ¬ï¼Œå–Top Kç»“æœã€‚å¯å€ŸåŠ©ESçš„RESTå®¢æˆ·ç«¯æˆ–Repositoryæ–¹æ³•å®ç°ï¼Œå¾—åˆ°ä¸€ç»„Documentç‰‡æ®µåˆ—è¡¨ï¼ˆå«IDå’Œå†…å®¹ï¼‰ã€‚</li>
<li>ä½¿ç”¨Qdrantæ‰§è¡Œç›¸ä¼¼åº¦æŸ¥è¯¢ï¼šè°ƒç”¨ä¸Šé¢é…ç½®çš„vectorStore.similaritySearch()æ–¹æ³•ï¼Œå¯¹ç”¨æˆ·æŸ¥è¯¢æ–‡æœ¬è¿›è¡Œå‘é‡æŸ¥è¯¢ï¼Œè·å–Top Kç›¸ä¼¼æ–‡æ¡£ç‰‡æ®µ ã€‚Spring AI æä¾›äº† SearchRequest å¯æŒ‡å®šç›¸ä¼¼åº¦é˜ˆå€¼å’ŒtopKç­‰å‚æ•°  ã€‚ä¾‹å¦‚ï¼š</li>
</ul>
<blockquote><code> List&lt;Document&gt; vectorDocs = vectorStore.similaritySearch(</code><br>
<code>       SearchRequest.builder()</code><br>
<code>           .query(userQuery)</code><br>
<code>           .topK(5)</code><br>
<code>           .build()</code><br>
<code> );</code></blockquote><p>è¿™å°†è¿”å›ä¸æŸ¥è¯¢æœ€ç›¸ä¼¼çš„5ä¸ªæ–‡æ¡£ç‰‡æ®µã€‚</p>
<ul>
<li>åˆå¹¶ç»“æœï¼šå°†å…³é”®è¯ç»“æœä¸å‘é‡ç»“æœåˆå¹¶ã€‚å¯ä»¥ç”¨æ–‡æ¡£IDå»é‡ï¼Œé¿å…åŒä¸€ç‰‡æ®µé‡å¤ã€‚ç®€å•ç­–ç•¥æ˜¯ç›´æ¥åˆå¹¶åˆ—è¡¨ï¼›å¦‚éœ€æ›´ç²¾ç»†çš„èåˆï¼Œå¯æ ¹æ®ESç›¸å…³åº¦åˆ†å€¼å’Œå‘é‡ç›¸ä¼¼åº¦åˆ†å€¼å¯¹ç»“æœé‡æ–°æ’åºæˆ–åŠ æƒã€‚ç”±äºä¸åŒæ£€ç´¢çš„åˆ†æ•°ä¸ç›´æ¥å¯æ¯”ï¼Œä¸€ä¸ªå®é™…å·¥ç¨‹ç­–ç•¥æ˜¯ä¿ç•™å„è‡ªTop Kçš„ç»“æœï¼Œç„¶åè®©ä¸Šå±‚LLMåŸºäºè¿™äº›å€™é€‰ç‰‡æ®µè‡ªè¡Œåˆ¤æ–­ç›¸å…³æ€§ã€‚è¿™é‡Œæˆ‘ä»¬é‡‡å–ç®€å•å»é‡åˆå¹¶ç­–ç•¥ï¼Œå¹¶é™åˆ¶æ€»ç‰‡æ®µæ•°ï¼ˆå¦‚å–ä¸è¶…è¿‡6-10ä¸ªç‰‡æ®µï¼‰ä»¥æ§åˆ¶æç¤ºé•¿åº¦ã€‚</li>
<li>è¾“å‡ºï¼šè¿”å›åˆå¹¶åçš„Documentåˆ—è¡¨ã€‚æ¯ä¸ªDocumentåŒ…å«å†…å®¹æ–‡æœ¬ï¼Œä»¥åŠå¯èƒ½çš„å…ƒæ•°æ®ï¼ˆä¾‹å¦‚æ¥æºæ ‡è¯†ç”¨äºè¾“å‡ºå¼•ç”¨ï¼‰ã€‚
é€šè¿‡HybridRetrieverï¼Œæˆ‘ä»¬å°†è¯­ä¹‰åŒ¹é…å’Œç²¾ç¡®åŒ¹é…ç»“åˆï¼Œæœ€å¤§ç¨‹åº¦æ‰¾åˆ°ç›¸å…³å†…å®¹ã€‚ä¾‹å¦‚ï¼Œå½“ç”¨æˆ·æŸ¥è¯¢ä¸­åŒ…å«ä¸æ–‡æ¡£ä¸åŒçš„æªè¾æ—¶ï¼Œå‘é‡æ£€ç´¢å¯æ‰¾åˆ°è¯­ä¹‰ç›¸ä¼¼çš„å†…å®¹ï¼Œè€Œå…³é”®è¯æ£€ç´¢å¯ä¿è¯è‹¥æœ‰ç²¾ç¡®åŒ¹é…çš„æœ¯è¯­ä¸ä¼šè¢«é—æ¼ã€‚</li>
</ul>
<h3>LLM æ¨ç†ä¸åˆ‡æ¢æ¨¡å—</h3>
<p>ChatClientä¸ChatModelæŠ½è±¡ï¼šSpring AI æä¾›äº† ChatModel æ¥å£è¡¨ç¤ºå…·ä½“çš„å¤§è¯­è¨€æ¨¡å‹ï¼ˆå¦‚OpenAI ChatGPTã€Anthropic Claudeã€æœ¬åœ°Llamaç­‰ï¼‰ï¼ŒChatClient åˆ™å°è£…äº†ä¸è¿™äº›æ¨¡å‹äº¤äº’çš„é€šç”¨å®¢æˆ·ç«¯ ã€‚æœ¬æœåŠ¡é€šè¿‡æ³¨å…¥ä¸€ä¸ªChatClientå®ä¾‹æ¥è°ƒç”¨LLMè¿›è¡Œå›ç­”ç”Ÿæˆã€‚å¾—ç›ŠäºChatClientçš„æŠ½è±¡è®¾è®¡ï¼Œæˆ‘ä»¬å¯ä»¥çµæ´»åœ°æ›´æ¢èƒŒåçš„ChatModelï¼Œè€Œä¸šåŠ¡ä»£ç ä¿æŒä¸å˜ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥åœ¨é…ç½®ä¸­åˆ‡æ¢ä½¿ç”¨OpenAIçš„GPT-4æ¨¡å‹æˆ–æœ¬åœ°çš„Llama2æ¨¡å‹ ã€‚</p>
<ol>
<li>OpenAI æ¨¡å‹é›†æˆï¼šè‹¥ä½¿ç”¨OpenAIäº‘æœåŠ¡ï¼Œæ·»åŠ ä¾èµ–spring-ai-openaiï¼Œå¹¶åœ¨åº”ç”¨é…ç½®ä¸­æä¾›OpenAIçš„APIå¯†é’¥å’Œæ‰€é€‰æ¨¡å‹åç§°ã€‚ä¾‹å¦‚åœ¨application.ymlä¸­é…ç½®:</li>
</ol>
<blockquote><code>spring:</code><br>
<code>  ai:</code><br>
<code>    openai:</code><br>
<code>      api-key: YOUR_OPENAI_API_KEY</code><br>
<code>      chat:</code><br>
<code>        model: gpt-4</code></blockquote><p>è¿™å°†å¯ç”¨Spring AIå¯¹OpenAI Chat APIçš„è‡ªåŠ¨é…ç½®ã€‚æ³¨å…¥çš„ChatClientå°†é»˜è®¤ä½¿ç”¨OpenAIæŒ‡å®šçš„æ¨¡å‹ã€‚é€šè¿‡ChatClientçš„fluent APIï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿åœ°å‘é€å¯¹è¯æ¶ˆæ¯å¹¶è·å–å›å¤ã€‚ä¾‹å¦‚ï¼š</p>
<blockquote><code>ChatResponse response = chatClient.prompt()</code><br>
<code>    .user(&quot;è¯·è§£é‡ŠRAGçš„ä½œç”¨&quot;)</code><br>
<code>    .call()</code><br>
<code>    .chatResponse();</code><br>
<code>String answer = response.content();</code></blockquote><p>ä¸Šè¿°è°ƒç”¨ä¼šå°†ç”¨æˆ·æ¶ˆæ¯å‘é€åˆ°é…ç½®çš„OpenAIæ¨¡å‹å¹¶è·å¾—å›ç­” ã€‚</p>
<ol start="2">
<li>æœ¬åœ°Ollamaæ¨¡å‹é›†æˆï¼šè‹¥é‡‡ç”¨æœ¬åœ°LLMæ¨¡å‹ï¼Œéœ€å®‰è£…å¹¶è¿è¡Œ Ollama æœåŠ¡ã€‚Ollamaå¯ä»¥ç®¡ç†å’Œæä¾›æœ¬åœ°æ¨¡å‹çš„æ¨ç†æœåŠ¡ï¼Œå¹¶é€šè¿‡RESTæ¥å£ä¸åº”ç”¨äº¤äº’  ã€‚å¼•å…¥ä¾èµ–spring-ai-ollamaåï¼ŒSpring AIæä¾›äº† OllamaChatModel å’Œ OllamaApi æ¥å¯¹æ¥æœ¬åœ°Ollamaå®ä¾‹ ã€‚é…ç½®ä¸Šï¼Œå¯åœ¨application.ymlä¸­æŒ‡å®šOllamaæœåŠ¡åœ°å€åŠæ‰€ç”¨æ¨¡å‹ï¼Œä¾‹å¦‚:</li>
</ol>
<blockquote><code>spring:</code><br>
<code>  ai:</code><br>
<code>    ollama:</code><br>
<code>      base-url: http://localhost:11434</code><br>
<code>      default-model: llama2</code></blockquote><p>å‡è®¾å·²é€šè¿‡â€œOllama pullâ€å‘½ä»¤ä¸‹è½½äº†åç§°ä¸ºâ€œllama2â€çš„æ¨¡å‹ï¼ŒOllamaå°†ä»¥è¯¥æ¨¡å‹æä¾›æ¨ç†ã€‚åº”ç”¨å¯åŠ¨æ—¶ï¼Œä¼šè‡ªåŠ¨åˆ›å»ºè¿æ¥åˆ°Ollamaçš„APIå®¢æˆ·ç«¯ (OllamaApi) å’Œå¯¹åº”çš„ ChatModel å®ç°ã€‚ChatClientéšå³å¯ä½¿ç”¨æœ¬åœ°æ¨¡å‹è¿›è¡Œå¯¹è¯ã€‚</p>
<p>ä½¿ç”¨Ollamaæ—¶ï¼Œè°ƒç”¨æ–¹å¼ä¸OpenAIç±»ä¼¼ï¼Œåªæ˜¯ç”±æœ¬åœ°æœåŠ¡äº§ç”Ÿç»“æœã€‚ä¾‹å¦‚ï¼š</p>
<blockquote><code>ChatResponse response = chatClient.prompt()</code><br>
<code>    .system(&quot;ä½ æ˜¯èµ„æ·±JavaåŠ©ç†&quot;)   // å¯ä»¥è®¾å®šåˆå§‹ç³»ç»Ÿæç¤º</code><br>
<code>    .user(&quot;ç»™å‡ºRAGæœç´¢æœåŠ¡çš„ä¼˜åŠ¿&quot;)</code><br>
<code>    .call()</code><br>
<code>    .chatResponse();</code></blockquote><p>ChatClientå°†å‘æœ¬åœ°Ollamaå‘é€è¯·æ±‚å¹¶è·å–æ¨¡å‹å›å¤ã€‚</p>
<ol start="3">
<li>æ¨ç†æ–¹å¼åˆ‡æ¢ï¼šä¸ºäº†åœ¨æœ¬åœ°æ¨¡å‹å’Œäº‘APIä¹‹é—´åˆ‡æ¢ï¼Œè®¾è®¡ä¸Šå¯ä»¥ä½¿ç”¨Spring Profilesæˆ–é…ç½®å¼€å…³ã€‚ä¾‹å¦‚å®šä¹‰llm.modeé…ç½®é¡¹ï¼Œå¯å–å€¼localæˆ–openaiã€‚é€šè¿‡æ¡ä»¶é…ç½®ï¼Œåœ¨localæ¨¡å¼ä¸‹æ³¨å…¥Ollamaçš„ChatClient Beanï¼Œåœ¨openaiæ¨¡å¼ä¸‹æ³¨å…¥OpenAIçš„ChatClient Beanã€‚å€ŸåŠ©Spring AIï¼Œå¯¹ä¸åŒChatModelçš„æ”¯æŒæ˜¯å¼€ç®±å³ç”¨çš„ï¼Œå¼€å‘è€…åªéœ€æ›´æ”¹é…ç½®å³å¯æ— ç¼åˆ‡æ¢LLMæä¾›æ–¹ï¼Œå¤§å¤§å‡å°‘åˆ‡æ¢å¸¦æ¥çš„ä»£ç æ”¹åŠ¨ ã€‚</li>
</ol>
<h3>æ–‡æœ¬åµŒå…¥ç”Ÿæˆæ¨¡å—</h3>
<ol>
<li>HuggingFace æœ¬åœ°åµŒå…¥ï¼šä¸ºäº†ç¡®ä¿æ•°æ®å®‰å…¨å’Œé™ä½ä¾èµ–ï¼Œæœ¬æ–¹æ¡ˆæ”¯æŒä½¿ç”¨æœ¬åœ°Embeddingæ¨¡å‹ã€‚åˆ©ç”¨Spring AIçš„Transformer ONNXæ”¯æŒï¼Œæˆ‘ä»¬å¯ä»¥åœ¨Javaä¸­ç›´æ¥åŠ è½½HuggingFaceæä¾›çš„embeddingæ¨¡å‹ï¼ˆè½¬æ¢ä¸ºONNXæ ¼å¼ï¼‰å¹¶ç”Ÿæˆå‘é‡ã€‚ ä¾‹å¦‚é€‰æ‹©sentence-transformers/all-MiniLM-L6-v2æ¨¡å‹ï¼Œè¯¥æ¨¡å‹è¾“å‡º768ç»´å¥å‘é‡ã€‚é¦–å…ˆå°†ONNXæ¨¡å‹æ–‡ä»¶å’Œtokenizeræ–‡ä»¶å‡†å¤‡å¥½ï¼ˆå¯é€šè¿‡Spring AIè‡ªåŠ¨ä¸‹è½½ç¼“å­˜ï¼‰ã€‚ç„¶åé…ç½®EmbeddingModel Beanï¼š</li>
</ol>
<blockquote><code>@Bean</code><br>
<code>public EmbeddingModel embeddingModel() {</code><br>
<code>    TransformersEmbeddingModel model = new TransformersEmbeddingModel();</code><br>
<code>    // å¯é€‰ï¼šæŒ‡å®šæ¨¡å‹å’Œåˆ†è¯å™¨èµ„æºè·¯å¾„æˆ–URLï¼ˆå¦åˆ™ä½¿ç”¨é»˜è®¤çš„all-MiniLM-L6-v2ï¼‰</code><br>
<code>    model.setModelResource(&quot;classpath:/onnx/all-MiniLM-L6-v2/model.onnx&quot;);</code><br>
<code>    model.setTokenizerResource(&quot;classpath:/onnx/all-MiniLM-L6-v2/tokenizer.json&quot;);</code><br>
<code>    return model;</code><br>
<code>}</code></blockquote><p>ä¸Šè¿° TransformersEmbeddingModel ä¼šåŠ è½½æœ¬åœ°ONNXæ¨¡å‹ï¼Œåœ¨è°ƒç”¨embed()æ—¶å¯¹è¾“å…¥æ–‡æœ¬åˆ—è¡¨è¾“å‡ºå¯¹åº”çš„å‘é‡è¡¨ç¤º  ã€‚ä½œä¸ºSpring Beanæ—¶ï¼ŒSpring AIä¼šè‡ªåŠ¨è°ƒç”¨å…¶afterPropertiesSet()å®Œæˆåˆå§‹åŒ– ã€‚ç¬¬ä¸€æ¬¡ä½¿ç”¨æ—¶æ¨¡å‹æ–‡ä»¶å¯èƒ½ä»æŒ‡å®šä½ç½®åŠ è½½æˆ–ä¸‹è½½å¹¶ç¼“å­˜ã€‚ ä¹‹åå³å¯é€šè¿‡ embeddingModel.embed(List<String> texts) è·å–åµŒå…¥å‘é‡ã€‚</p>
<p>å¦‚æœä½¿ç”¨Ollamaä½œä¸ºæœ¬åœ°å¼•æ“ï¼Œå¦ä¸€ç§æ–¹æ³•æ˜¯åˆ©ç”¨Ollamaçš„Embedding APIã€‚Spring AIæä¾›äº†OllamaEmbeddingModelå°è£…Ollamaçš„å‘é‡ç”Ÿæˆæ¥å£ ã€‚é€šè¿‡pullç›¸åº”çš„åµŒå…¥æ¨¡å‹ï¼ˆOllamaæ”¯æŒç›´æ¥pull HuggingFaceä¸Šçš„embeddingæ¨¡å‹ï¼Œå¦‚ollama pull hf.co/intfloat/e5-small-v2ï¼‰ï¼Œç„¶åï¼š</p>
<blockquote><code>@Bean</code><br>
<code>public EmbeddingModel embeddingModel(OllamaApi ollamaApi) {</code><br>
<code>    // å‡è®¾ä½¿ç”¨ä¸€ä¸ªåä¸º&#039;e5-small-v2&#039;çš„embeddingæ¨¡å‹</code><br>
<code>    var options = OllamaOptions.builder().model(&quot;e5-small-v2&quot;).build();</code><br>
<code>    return new OllamaEmbeddingModel(ollamaApi, options);</code><br>
<code>}</code></blockquote><p>æ­¤æ–¹å¼ä¸‹ï¼Œæ‰€æœ‰æ–‡æœ¬å‘é‡å°†ç”±Ollamaæœ¬åœ°æœåŠ¡ç”Ÿæˆï¼Œæ•ˆæœç­‰åŒäºç›´æ¥ä½¿ç”¨HuggingFaceæ¨¡å‹ã€‚ </p>
<ol start="2">
<li>OpenAI Embedding APIï¼šå¦‚éœ€å€ŸåŠ©OpenAIçš„é¢„è®­ç»ƒæ¨¡å‹å¿«é€Ÿè·å–åµŒå…¥ï¼Œå¯ä»¥ä½¿ç”¨OpenAIæä¾›çš„Embeddingæ¥å£ï¼ˆä¾‹å¦‚text-embedding-ada-002æ¨¡å‹ï¼‰ã€‚Spring AIçš„OpenAiEmbeddingModelå°è£…äº†è°ƒç”¨é€»è¾‘ï¼Œåªéœ€æä¾›APIå¯†é’¥å’Œå¯é€‰çš„æ¨¡å‹åç§°å³å¯ä½¿ç”¨ã€‚ä¾‹å¦‚ï¼š</li>
</ol>
<blockquote><code>@Bean</code><br>
<code>public EmbeddingModel embeddingModel() {</code><br>
<code>    return new OpenAiEmbeddingModel(new OpenAiApi(System.getenv(&quot;OPENAI_API_KEY&quot;)));</code><br>
<code>}</code></blockquote><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œå°†ä½¿ç”¨Adaæ¨¡å‹ç”Ÿæˆ1536ç»´çš„åµŒå…¥å‘é‡ ã€‚è¿™ç§æ–¹å¼é€‚åˆå¯¹æ¥OpenAIå¼ºå¤§çš„å‘é‡è´¨é‡ï¼Œä½†éœ€è€ƒè™‘ç½‘ç»œå»¶è¿Ÿå’Œè°ƒç”¨æˆæœ¬ã€‚</p>
<ol start="3">
<li>åµŒå…¥æ¨¡å¼åˆ‡æ¢ï¼šå’ŒLLMç±»ä¼¼ï¼Œå¯é€šè¿‡é…ç½®åˆ‡æ¢åµŒå…¥æ¨¡å‹æ¥æºã€‚æ¯”å¦‚é…ç½®embedding.modeä¸ºlocalæˆ–openaiã€‚å½“ä¸ºlocalæ—¶ï¼Œå¯ç”¨TransformersEmbeddingModelæˆ–OllamaEmbeddingModelï¼›ä¸ºopenaiæ—¶ï¼Œåˆ™ä½¿ç”¨OpenAiEmbeddingModelã€‚å¼€å‘æ—¶å¯ä»¥æä¾›é»˜è®¤å®ç°ï¼Œå¹¶å…è®¸é€šè¿‡é…ç½®æ–‡ä»¶ä¿®æ”¹ã€‚ä¾‹å¦‚é»˜è®¤é‡‡ç”¨æœ¬åœ°æ¨¡å‹ï¼Œè‹¥ç”¨æˆ·æä¾›äº†OpenAIçš„apiKeyåˆ™è‡ªåŠ¨æ”¹ç”¨OpenAIåµŒå…¥æœåŠ¡ã€‚</li>
</ol>
<p>æ— è®ºå“ªç§å®ç°ï¼Œæˆ‘ä»¬çš„VectorStoreåœ¨åˆå§‹åŒ–æ—¶éƒ½ä¼šç»‘å®šä¸€ä¸ªEmbeddingModelï¼Œç”¨äºåœ¨å‘é‡æ•°æ®åº“ä¸­å­˜å‚¨å’Œæ£€ç´¢æ—¶è½¬æ¢æ–‡æœ¬ ã€‚ä¾‹å¦‚ï¼Œä¸Šè¿°é…ç½®çš„embeddingModelå°†è¢«æ³¨å…¥åˆ°QdrantVectorStoreä¸­ï¼Œå½“è°ƒç”¨vectorStore.add(documents)æ—¶ï¼Œæ¯ä¸ªDocumentçš„æ–‡æœ¬å†…å®¹ä¼šç»ç”±EmbeddingModelè½¬ä¸ºå‘é‡å¹¶å­˜å…¥Qdrant ã€‚</p>
<h2>æ•°æ®æµç¨‹è¯´æ˜</h2>
<h3>æ–‡æ¡£ç´¢å¼•æµç¨‹ (ETLç¦»çº¿å…¥åº“)</h3>
<ol>
<li>   æ–‡æ¡£è·å–ä¸é¢„å¤„ç†ï¼šé€šè¿‡ç®¡ç†åå°æˆ–æ‰¹å¤„ç†ä»»åŠ¡ï¼Œè·å–éœ€è¦çº³å…¥çŸ¥è¯†åº“çš„åŸå§‹æ–‡æ¡£ã€‚æ–‡æ¡£æ ¼å¼å¯ä»¥æ˜¯çº¯æ–‡æœ¬ã€PDFã€Markdownç­‰ã€‚ä½¿ç”¨Spring AIçš„æ–‡æ¡£è¯»å–å™¨å°†æ–‡æ¡£è½¬æ¢ä¸ºæ–‡æœ¬å†…å®¹ï¼Œå¹¶æŒ‰æ®µè½æˆ–å›ºå®šé•¿åº¦å¯¹æ–‡æœ¬è¿›è¡Œåˆ†å—ï¼Œç”Ÿæˆæ–‡æ¡£ç‰‡æ®µåˆ—è¡¨ã€‚æ¯ä¸ªç‰‡æ®µå¯ä»¥å°è£…ä¸ºSpring AIçš„ Document å¯¹è±¡ï¼Œå…¶ä¸­åŒ…å«å†…å®¹æ–‡æœ¬å’Œå…ƒæ•°æ®ï¼ˆå¦‚æ–‡æ¡£IDã€æ ‡é¢˜ã€æ¥æºç­‰ï¼‰ã€‚</li>
<li>   åµŒå…¥å‘é‡ç”Ÿæˆï¼šé’ˆå¯¹æ¯ä¸ªæ–‡æ¡£ç‰‡æ®µï¼Œè°ƒç”¨EmbeddingModelç”Ÿæˆå…¶è¯­ä¹‰å‘é‡è¡¨ç¤ºã€‚ä¾‹å¦‚åˆ©ç”¨æœ¬åœ°æ¨¡å‹å°†æ¯ä¸ªç‰‡æ®µè½¬æ¢ä¸º768ç»´å‘é‡ã€‚å‘é‡é€šå¸¸å­˜äºDocumentå¯¹è±¡çš„embeddingå­—æ®µï¼Œæˆ–ç›´æ¥åœ¨æ’å…¥å‘é‡æ•°æ®åº“æ—¶è®¡ç®—ã€‚ å±•ç¤ºäº†ä»æ–‡æ¡£åˆ°å‘é‡çš„è½¬æ¢è¿‡ç¨‹ï¼šé¦–å…ˆå°†æ–‡æ¡£åˆ†å‰²ä¸ºå°å—ï¼Œç„¶åä½¿ç”¨åµŒå…¥æ¨¡å‹å°†æ¯ä¸ªå—æ˜ å°„ä¸ºé«˜ç»´å‘é‡è¡¨ç¤ºï¼Œæ•æ‰è¯­ä¹‰ä¿¡æ¯ã€‚</li>
<li>   å‘é‡å­˜å‚¨å…¥åº“ï¼šè°ƒç”¨vectorStore.add(documents)æ–¹æ³•ï¼Œå°†æ–‡æ¡£ç‰‡æ®µæ‰¹é‡æ’å…¥Qdrantå‘é‡æ•°æ®åº“ ã€‚Spring AI çš„ VectorStore æ¥å£å¯¹åº•å±‚æ•°æ®åº“æ‰§è¡Œæ’å…¥æ“ä½œï¼Œå¹¶è‡ªåŠ¨å¤„ç†å‘é‡æ•°æ®å’Œå…ƒä¿¡æ¯å­˜å‚¨ã€‚ä¾‹å¦‚å¯¹äºQdrantï¼Œæ¯ä¸ªDocumentçš„embeddingå‘é‡å’Œé™„åŠ payloadä¼šå­˜å…¥æŒ‡å®šcollectionä¸­ã€‚å¦‚æœcollectionå°šä¸å­˜åœ¨ä¸”initializeSchema=trueï¼ŒVectorStoreå®ç°ä¼šè‡ªåŠ¨åˆ›å»ºé›†åˆï¼ˆç›¸åº”çš„ç»´åº¦å’Œç´¢å¼•å‚æ•°ï¼‰  ã€‚æ’å…¥æˆåŠŸåï¼Œæ–‡æ¡£çš„è¯­ä¹‰è¡¨ç¤ºå°±æŒä¹…åŒ–åœ¨Qdrantä¸­äº†ï¼Œå¯ç”¨äºç›¸ä¼¼æ£€ç´¢ã€‚</li>
<li>   å…¨æ–‡ç´¢å¼•å…¥åº“ï¼šå°†æ–‡æ¡£ç‰‡æ®µç´¢å¼•åˆ°Elasticsearchã€‚å¯¹äºæ¯ä¸ªDocumentå¯¹è±¡ï¼Œä»ä¸­æå–å¿…è¦å­—æ®µï¼ˆå¦‚idã€contentã€metadataï¼‰ï¼Œè°ƒç”¨ESçš„ç´¢å¼•APIå­˜å‚¨ã€‚è‹¥ä½¿ç”¨Spring Data Elasticsearchï¼Œå¯ä»¥è°ƒç”¨Repositoryçš„save()æ–¹æ³•æ‰¹é‡ä¿å­˜ç‰‡æ®µå®ä½“ã€‚å¦‚æœç›´æ¥ä½¿ç”¨ES REST APIï¼Œåˆ™æ„é€ æ‰¹é‡ç´¢å¼•è¯·æ±‚ã€‚æ¯ä¸ªç‰‡æ®µå°†æˆä¸ºESä¸­ä¸€æ¡æ–‡æ¡£è®°å½•ï¼Œå†…å®¹å­—æ®µåšå…¨æ–‡æ£€ç´¢ç´¢å¼•å¤„ç†ã€‚å¯ä»¥è€ƒè™‘åœ¨contentå­—æ®µä¸Šåº”ç”¨ESè‡ªå¸¦çš„ä¸­æ–‡åˆ†è¯ï¼ˆå¦‚æœå†…å®¹ä¸ºä¸­æ–‡ï¼‰ä»¥æé«˜æ£€ç´¢æ•ˆæœã€‚</li>
<li>   ç´¢å¼•å®Œæˆï¼šç»è¿‡ä»¥ä¸Šè¿‡ç¨‹ï¼ŒçŸ¥è¯†åº“æ–‡æ¡£è¢«æœ‰æ•ˆåœ°å­˜å‚¨ä¸ºå‘é‡åº“+å…¨æ–‡ç´¢å¼•çš„æ··åˆå½¢å¼ï¼šQdrantæŒæœ‰æ¯ä¸ªç‰‡æ®µçš„å‘é‡åŠå…ƒæ•°æ®ï¼ŒElasticsearchæŒæœ‰ç‰‡æ®µçš„å¯æ£€ç´¢æ–‡æœ¬ã€‚åç»­æŸ¥è¯¢å³å¯åˆ©ç”¨è¿™ä¸¤ç§å­˜å‚¨æä¾›çš„èƒ½åŠ›ã€‚</li>
</ol>
<p>æ³¨æ„ï¼š æ–‡æ¡£å…¥åº“æµç¨‹å¯ä»¥ç¦»çº¿æ‰¹å¤„ç†ï¼Œä¹Ÿå¯ä»¥é€šè¿‡æä¾›APIè®©ç”¨æˆ·åŠ¨æ€ä¸Šä¼ æ–‡æ¡£ã€‚åœ¨æœ¬è®¾è®¡ä¸­ï¼Œå¯ä»¥å®ç°ä¸€ä¸ª/documents/loadæ¥å£ï¼ˆæˆ–ä½¿ç”¨Stackademicåšæ–‡ä¸­çš„/loadæ¦‚å¿µ ï¼‰ï¼Œæ¥å—æ–‡ä»¶ä¸Šä¼ è¯·æ±‚ï¼ŒæœåŠ¡æ¥æ”¶æ–‡ä»¶åæ‰§è¡Œä¸Šè¿°æ­¥éª¤å®Œæˆç´¢å¼•ã€‚åŒæ—¶è¿”å›çŠ¶æ€æˆ–ç»“æœç»™å®¢æˆ·ç«¯ã€‚ä¸ºç®€åŒ–ï¼Œæ­¤æ¥å£ç»†èŠ‚åœ¨æ­¤ä¸å±•å¼€ã€‚</p>
<h3>åœ¨çº¿æ£€ç´¢é—®ç­”æµç¨‹</h3>
<ol>
<li>   ç”¨æˆ·æŸ¥è¯¢è¾“å…¥ï¼šç”¨æˆ·é€šè¿‡å‰ç«¯æˆ–APIè°ƒç”¨å‘é€æŸ¥è¯¢è¯·æ±‚ç»™RAGæœåŠ¡ï¼ˆä¾‹å¦‚HTTP GET/POST /ask?question=...ï¼‰ã€‚æŸ¥è¯¢å†…å®¹ä¸ºè‡ªç„¶è¯­è¨€é—®é¢˜ï¼Œä¾‹å¦‚ï¼šâ€œè¿™ä¸ªç³»ç»Ÿå¦‚ä½•æ”¯æŒæœ¬åœ°æ¨¡å‹ï¼Ÿâ€ã€‚Controllerå±‚æ¥æ”¶è¯·æ±‚åï¼Œå°†æŸ¥è¯¢å­—ç¬¦ä¸²å°è£…ä¸ºQueryå¯¹è±¡æˆ–ç›´æ¥ä¼ ç»™æœåŠ¡å±‚ã€‚</li>
<li>   æ··åˆæ£€ç´¢ï¼šRAGæœåŠ¡è°ƒç”¨ HybridRetriever æ¥ä»çŸ¥è¯†åº“ä¸­æ£€ç´¢ç›¸å…³ä¿¡æ¯ï¼š<ul>
<li>ESå…³é”®è¯æ£€ç´¢ï¼šå¯¹Elasticsearchæ‰§è¡ŒæŸ¥è¯¢ï¼Œå¯ä½¿ç”¨matchæˆ–multi_matchåœ¨contentå­—æ®µæœç´¢ç”¨æˆ·é—®é¢˜ä¸­çš„å…³é”®è¯ã€‚å¦‚æœæœ‰åŒ¹é…ï¼Œè¿”å›ç›¸å…³åº¦æœ€é«˜çš„å‰Nä¸ªç‰‡æ®µï¼Œä¾‹å¦‚N=5ã€‚</li>
<li>Qdrantå‘é‡æ£€ç´¢ï¼šå°†ç”¨æˆ·é—®é¢˜å­—ç¬¦ä¸²é€šè¿‡EmbeddingModelç¼–ç ä¸ºå‘é‡æŸ¥è¯¢ï¼Œè°ƒç”¨vectorStore.similaritySearch()è·å–ç›¸ä¼¼åº¦æœ€é«˜çš„å‰Mä¸ªç‰‡æ®µï¼Œä¾‹å¦‚M=5 ã€‚å¯ä»¥è®¾ç½®ä¸€å®šçš„ç›¸ä¼¼åº¦é˜ˆå€¼ï¼Œå¿½ç•¥ä½äºé˜ˆå€¼çš„ç»“æœ ã€‚</li>
<li>ç»“æœèåˆï¼šå°†ä¸Šä¸¤æ­¥è·å¾—çš„ç‰‡æ®µé›†åˆå¹¶é›†æˆã€‚å‡å®šæˆ‘ä»¬è·å–äº†æœ€å¤š10ä¸ªç›¸å…³ç‰‡æ®µã€‚å¯å¯¹è¿™äº›ç‰‡æ®µæŒ‰é‡è¦æ€§ç®€å•æ’åºï¼ˆæ¯”å¦‚æ ¹æ®æ˜¯å¦åŒ…å«å…³é”®è¯å°†ESç»“æœé å‰ï¼‰ï¼Œæˆ–ä¸æ’åºç›´æ¥ä¼ é€’ç»™LLMã€‚åœ¨æœ¬è®¾è®¡ä¸­ï¼Œæˆ‘ä»¬å°†ç‰‡æ®µæ–‡æœ¬ç›´æ¥ä½œä¸ºä¸Šä¸‹æ–‡ä¼ é€’ï¼Œå› æ­¤é¡ºåºå½±å“ä¸å¤§ï¼Œä½†å¯ä»¥å°†æ›´ç›¸å…³çš„æ”¾åœ¨å‰é¢ä»¥æé«˜å›ç­”è´¨é‡ã€‚</li>
</ul>
</li>
<li>   æ„é€ æç¤º (Prompt)ï¼šå°†ç”¨æˆ·é—®é¢˜å’Œæ£€ç´¢åˆ°çš„æ–‡æ¡£ç‰‡æ®µç»„è£…æˆæç¤ºå†…å®¹ä¼ ç»™LLMã€‚é€šå¸¸é‡‡ç”¨ä¸€ä¸ªé¢„å®šä¹‰çš„Promptæ¨¡æ¿ï¼Œä¾‹å¦‚ï¼š</li>
</ol>
<blockquote><code>è¯·æ ¹æ®ä»¥ä¸‹æ–‡æ¡£å†…å®¹å›ç­”é—®é¢˜ã€‚å¦‚æœæ— æ³•ä»ä¸­æ‰¾åˆ°ç­”æ¡ˆï¼Œè¯·å›å¤â€œæœªæ‰¾åˆ°ç›¸å…³ä¿¡æ¯â€ã€‚</code><br>
<code></code><br>
<code>æ–‡æ¡£å†…å®¹:</code><br>
<code>{{{context}}}</code><br>
<code></code><br>
<code>é—®é¢˜: {{{question}}}</code><br>
<code></code><br>
<code>ç­”æ¡ˆ:</code></blockquote><p>å…¶ä¸­{{{context}}}å ä½ç¬¦ç”±æ£€ç´¢åˆ°çš„å¤šä¸ªæ–‡æ¡£ç‰‡æ®µæ–‡æœ¬æ‹¼æ¥å¡«å……ï¼Œ{{{question}}}ä¸ºç”¨æˆ·åŸå§‹é—®é¢˜ã€‚è¿™æ ·ç”Ÿæˆçš„å®Œæ•´æç¤ºæä¾›äº†é—®é¢˜æ‰€éœ€çš„å‚è€ƒä¿¡æ¯ã€‚æ­¤æ­¥éª¤å¯ä»¥ä½¿ç”¨Spring AIçš„PromptTemplateè¾…åŠ©å®Œæˆï¼Œä¹Ÿå¯æ‰‹åŠ¨æ‹¼æ¥å­—ç¬¦ä¸²ã€‚ æåˆ°åœ¨æŸ¥è¯¢é˜¶æ®µå¯ä½¿ç”¨PromptTemplateæ’å…¥æ£€ç´¢åˆ°çš„å†…å®¹å¹¶æ¸²æŸ“æœ€ç»ˆæç¤ºï¼Œç„¶åå‘é€ç»™æ¨¡å‹ã€‚
Spring AI ä¹Ÿæ”¯æŒç›´æ¥ä½¿ç”¨ QuestionAnswerAdvisor ç®€åŒ–è¿™ä¸€è¿‡ç¨‹ã€‚å¦‚æœä½¿ç”¨ChatClient.prompt().advisors(new QuestionAnswerAdvisor(vectorStore))ï¼Œå®ƒä¼šè‡ªåŠ¨åœ¨è°ƒç”¨æ¨¡å‹å‰æŸ¥è¯¢å‘é‡åº“å¹¶é™„åŠ ç»“æœ ã€‚ä½†ç”±äºæˆ‘ä»¬å®ç°äº†è‡ªå®šä¹‰çš„HybridRetrieverï¼ˆåŒ…å«ESï¼‰ï¼Œæˆ‘ä»¬å°†è‡ªè¡Œæ„é€ promptï¼Œä»¥ä¾¿åŠ å…¥ä¸¤ç§æ£€ç´¢ç»“æœã€‚</p>
<ol start="4">
<li>LLMç”Ÿæˆå›ç­”ï¼šè°ƒç”¨LLMæ¨¡å‹ç”Ÿæˆç­”æ¡ˆã€‚é€šè¿‡å‰è¿°é…ç½®å¥½çš„ChatClientæ¥æ‰§è¡Œï¼š</li>
</ol>
<blockquote><code>String promptText = promptTemplate.render(Map.of(&quot;context&quot;, combinedDocsText, &quot;question&quot;, userQuestion));</code><br>
<code>ChatResponse response = chatClient.prompt(promptText).call().chatResponse();</code><br>
<code>String answer = response.content();</code></blockquote><p>ChatClientä¼šå°†æˆ‘ä»¬æä¾›çš„å®Œæ•´æç¤ºå‘é€ç»™åº•å±‚ChatModelï¼ˆOpenAIæˆ–Ollamaï¼‰ã€‚æ¨¡å‹æ¥æ”¶åˆ°å«æœ‰å‚è€ƒå†…å®¹çš„æé—®åï¼ŒåŸºäºæä¾›çš„ä¸Šä¸‹æ–‡è¿›è¡Œä½œç­”ï¼Œä»è€Œå‡å°å¹»è§‰å’Œå‡ºé”™çš„æ¦‚ç‡  ã€‚ç”Ÿæˆçš„ç­”æ¡ˆé€šè¿‡ChatResponseè¿”å›ï¼Œæå–å…¶å†…å®¹å­—ç¬¦ä¸²ï¼Œå³ä¸ºæœ€ç»ˆè§£ç­”ã€‚</p>
<ol start="5">
<li>ç»“æœè¿”å›ï¼šå°†LLMçš„å›ç­”å­—ç¬¦ä¸²å°è£…ä¸ºå“åº”ï¼Œé€šè¿‡Controllerè¿”å›ç»™è°ƒç”¨æ–¹ã€‚å¯ä»¥åªè¿”å›ç­”æ¡ˆæ–‡æœ¬ï¼Œæˆ–è€…åŒ…å«ä¸€äº›å…ƒä¿¡æ¯ï¼ˆå¦‚å¼•ç”¨çš„æ–‡æ¡£æ¥æºåˆ—è¡¨ç­‰ï¼‰ã€‚æœ¬è®¾è®¡èšç„¦æ ¸å¿ƒåŠŸèƒ½ï¼Œå‡å®šä»…è¿”å›ç­”æ¡ˆæ–‡æœ¬ã€‚åœ¨å‰ç«¯ç•Œé¢ä¸Šï¼Œç”¨æˆ·å³å¯çœ‹åˆ°æ ¹æ®å…¶æé—®ç”Ÿæˆçš„å›ç­”ã€‚</li>
<li>å¯¹è¯è®°å¿†ï¼ˆå¯é€‰ï¼‰ï¼šå¦‚æœéœ€è¦å¤šè½®å¯¹è¯æ”¯æŒï¼Œå¯ç»“åˆSpring AIçš„ChatMemoryåŠŸèƒ½ï¼Œå°†ä¹‹å‰çš„é—®é¢˜å’Œç­”æ¡ˆä½œä¸ºå¯¹è¯å†å²æä¾›ç»™ChatClientï¼Œä»¥å®ç°ä¸Šä¸‹æ–‡è®°å¿†ã€‚ä½†åŸºæœ¬çš„RAGé—®ç­”åœºæ™¯å¯ä¸è€ƒè™‘å¯¹è¯å†å²ï¼Œæ¯æ¬¡ç‹¬ç«‹è¿›è¡Œã€‚</li>
</ol>
<p>æ•´ä¸ªæŸ¥è¯¢æµç¨‹åœ¨ç”¨æˆ·çœ‹æ¥åªæ˜¯æä¾›é—®é¢˜ã€è·å¾—ç­”æ¡ˆï¼Œä½†èƒŒåç»è¿‡äº†å…³é”®è¯å’Œè¯­ä¹‰åŒé€šé“æ£€ç´¢ï¼Œå†ç”±å¤§æ¨¡å‹ç»¼åˆåˆ†ææ–‡æ¡£ç»™å‡ºç»“æœï¼Œä»è€Œå®ç°â€œä»¥çŸ¥è¯†åº“ä¸ºåŸºç¡€çš„é—®ç­”â€ã€‚è¿™ç§RAGæŠ€æœ¯æœ‰æ•ˆç¼“è§£äº†LLMä¸Šä¸‹æ–‡é•¿åº¦é™åˆ¶ã€çŸ¥è¯†æˆªæ­¢å’Œå¹»è§‰é—®é¢˜  ã€‚</p>
<h2>å…³é”®ç»„ä»¶ä¸æ¥å£å®šä¹‰</h2>
<h3>é…ç½®ä¸ç»„ä»¶æ‘˜è¦</h3>
<p>ä¸»è¦ä¾èµ–ï¼šé¡¹ç›®å¼•å…¥ä»¥ä¸‹å…³é”®ä¾èµ–ï¼š</p>
<ul>
<li>Spring Boot 3.xï¼ˆåŸºç¡€æ¡†æ¶ï¼‰</li>
<li>Spring AI æ ¸å¿ƒ (spring-ai-bom BOM å’Œæ‰€éœ€starter)</li>
<li>Spring AI OpenAI Starter ï¼ˆå¦‚ä½¿ç”¨OpenAI APIï¼‰</li>
<li>Spring AI Ollama Starter ï¼ˆå¦‚ä½¿ç”¨æœ¬åœ°Ollamaï¼‰</li>
<li>Spring AI Qdrant Vector Store Starter (spring-ai-qdrant-store-spring-boot-starter) </li>
<li>Spring AI ONNX Embedding (å¦‚ä½¿ç”¨æœ¬åœ°Transformeræ¨¡å‹ï¼Œå¯é€‰ spring-ai-embeddings-transformer-onnx)</li>
<li>Spring Data Elasticsearch æˆ– Elasticsearch Javaå®¢æˆ·ç«¯</li>
<li>Qdrant Java SDK æˆ–é€šè¿‡Spring AIçš„ QdrantClient æ”¯æŒ</li>
<li>å…¶ä»–ï¼šå¦‚éœ€è¦æ–‡æ¡£è§£æï¼Œå¯é€‰ Spring AI æä¾›çš„ PDF/Text æ–‡æ¡£è¯»å–ç»„ä»¶ã€‚</li>
</ul>
<p>åº”ç”¨é…ç½®ï¼šé€šè¿‡application.ymlç®¡ç†ä¸Šè¿°æ¨¡å¼åˆ‡æ¢å‚æ•°ï¼Œä¾‹å¦‚ï¼š</p>
<blockquote><code>app:</code><br>
<code>  llm: mode: local        # æœ¬åœ°(local)æˆ–openai</code><br>
<code>  embedding: mode: local  # æœ¬åœ°(local)æˆ–openai</code><br>
<code>spring:</code><br>
<code>  ai:</code><br>
<code>    # OpenAI é…ç½®ï¼ˆä»…å½“ä½¿ç”¨openaiæ¨¡å¼ï¼‰</code><br>
<code>    openai:</code><br>
<code>      api-key: xxxx</code><br>
<code># ... (10 more lines)</code></blockquote>
<p><em>Full code available in the <a href="https://github.com/geyuxu">GitHub repository</a>.</em></p><p>ä¸Šä¾‹å±•ç¤ºäº†è‡ªå®šä¹‰çš„appé…ç½®æ®µç”¨äºæ§åˆ¶æ¨¡å¼ï¼Œä»¥åŠSpring AIè‡ªå¸¦çš„ä¸€äº›é…ç½®é¡¹ã€‚é€šè¿‡profilesæˆ–æ¡ä»¶æ³¨å…¥ï¼Œå¯ä»¥æ ¹æ®app.llm.modeé€‰æ‹©ä¸åŒçš„ChatModelé…ç½®ã€‚</p>
<p>å…³é”®Beanï¼šæ±‡æ€»æœ¬è®¾è®¡æ¶‰åŠçš„é‡è¦Spring BeanåŠå…¶é…ç½®æ–¹å¼ï¼š</p>
<ul>
<li>EmbeddingModel Beanï¼šå¦‚ä¸Šæ‰€è¿°ï¼Œå¯ä»¥æ˜¯OpenAiEmbeddingModelæˆ–TransformersEmbeddingModelï¼Œè´Ÿè´£æ–‡æœ¬åµŒå…¥ã€‚  </li>
<li>QdrantClient Beanï¼šå°è£…ä¸QdrantæœåŠ¡çš„è¿æ¥ï¼Œä½¿ç”¨gRPCæˆ–RESTå®¢æˆ·ç«¯ã€‚ </li>
<li>VectorStore Beanï¼šæ¯”å¦‚QdrantVectorStoreï¼Œæ„é€ æ—¶éœ€æ³¨å…¥QdrantClientå’ŒEmbeddingModelã€‚ </li>
<li>ChatClient Beanï¼šé€šå¸¸é€šè¿‡Spring AIè‡ªåŠ¨é…ç½®çš„ChatClient.Builderç”Ÿæˆã€‚å¯ç›´æ¥æ³¨å…¥ChatClientæˆ–å…¶Builderã€‚åœ¨ä½¿ç”¨å¤šä¸ªChatModelæ—¶ï¼Œä¹Ÿå¯ä»¥æ³¨å…¥å¤šä¸ªå‘½åçš„ChatClientã€‚ä¾‹å¦‚ï¼š</li>
</ul>
<blockquote><code>@Bean</code><br>
<code>@ConditionalOnProperty(name=&quot;app.llm.mode&quot;, havingValue=&quot;openai&quot;)</code><br>
<code>ChatClient chatClientOpenAI(OpenAiChatModel model) {</code><br>
<code>    return ChatClient.builder(model).build();</code><br>
<code>}</code><br>
<code></code><br>
<code>@Bean</code><br>
<code>@ConditionalOnProperty(name=&quot;app.llm.mode&quot;, havingValue=&quot;local&quot;)</code><br>
<code>ChatClient chatClientOllama(OllamaChatModel model) {</code><br>
<code>    return ChatClient.builder(model).build();</code><br>
<code>}</code></blockquote><p>ä¸Šè¿°ä¼ªä»£ç è¡¨æ˜æ ¹æ®é…ç½®é€‰æ‹©ä¸åŒçš„ChatModelåˆ›å»ºChatClientã€‚å®é™…ä¸Šè‹¥ä½¿ç”¨Spring Boot Starterå’Œé…ç½®æ–‡ä»¶ï¼Œå¤§éƒ¨åˆ†æƒ…å†µç›´æ¥@Autowired ChatClientå³å¯ï¼ˆåº•å±‚å·²æ ¹æ®é…ç½®é€‰å¥½äº†æ¨¡å‹ï¼‰ã€‚</p>
<ul>
<li>HybridRetriever Beanï¼šå¦‚æœå®ç°äº†HybridRetrieverç±»ï¼Œå¯å°†å…¶å£°æ˜ä¸ºBeanï¼Œå†…éƒ¨@Autowiredæ‰€éœ€çš„ESå®¢æˆ·ç«¯å’ŒVectorStoreï¼Œç”¨äºæ‰§è¡Œæ£€ç´¢é€»è¾‘ã€‚</li>
<li>RagService Beanï¼šå°è£…RAGæµç¨‹çš„æœåŠ¡ç±»ã€‚å®ƒä¼š@Autowired HybridRetrieverå’ŒChatClientï¼Œç”¨æ¥å®ç°answerQuestion(String question)æ–¹æ³•ã€‚</li>
</ul>
<h3>RagService æ¥å£å®šä¹‰</h3>
<p>RagServiceå¯ä»¥å®šä¹‰å¦‚ä¸‹æ¥å£ä»¥ä¾›Controllerè°ƒç”¨ï¼š</p>
<blockquote><code>public interface RagService {</code><br>
<code>    /** æ ¹æ®ç”¨æˆ·é—®é¢˜è¿”å›ç­”æ¡ˆ */</code><br>
<code>    String getAnswer(String question);</code><br>
<code>}</code></blockquote><p>å…¶å®ç°ç±» RagServiceImpl è´Ÿè´£æŒ‰ç…§åœ¨çº¿æ£€ç´¢é—®ç­”æµç¨‹çš„æ­¥éª¤å®Œæˆå·¥ä½œï¼š</p>
<blockquote><code>@Service</code><br>
<code>public class RagServiceImpl implements RagService {</code><br>
<code>    @Autowired private HybridRetriever retriever;</code><br>
<code>    @Autowired private ChatClient chatClient;</code><br>
<code>    @Value(&quot;${app.maxDocs:6}&quot;) private int maxDocs;</code><br>
<code></code><br>
<code>    @Override</code><br>
<code>    public String getAnswer(String question) {</code><br>
<code># ... (18 more lines)</code></blockquote>
<p><em>Full code available in the <a href="https://github.com/geyuxu">GitHub repository</a>.</em></p><p>ä¸Šè¿°ä»£ç ä¸­ï¼š</p>
<ul>
<li>retriever.retrieveè¿”å›Documentåˆ—è¡¨ï¼Œæ¯ä¸ªDocumentåŒ…å«contentæ–‡æœ¬ç­‰ä¿¡æ¯ã€‚</li>
<li>å°†ç‰‡æ®µå†…å®¹ç®€å•æ‹¼æ¥ä¸ºä¸Šä¸‹æ–‡ï¼ˆçœŸå®åº”ç”¨å¯åŠ å…¥åˆ†éš”ç¬¦å¹¶æ³¨æ˜æ¥æºï¼‰ã€‚</li>
<li>ç”¨ChatClient.prompt()å‘é€ç»„è£…çš„promptè·å–å“åº”ã€‚è‹¥æ— ç›¸å…³ç‰‡æ®µåˆ™ç›´æ¥è¿”å›æ— æ³•æ‰¾åˆ°ä¿¡æ¯çš„ç­”å¤ã€‚</li>
</ul>
<p>é€šè¿‡è¿™ç§å®ç°ï¼ŒRagServiceå¯¹å¤–æä¾›äº†ä¸€ä¸ªé«˜å±‚æ¥å£ï¼Œéšè—äº†å†…éƒ¨å¤æ‚æ€§ï¼ŒControlleråªéœ€ä¼ å…¥é—®é¢˜å­—ç¬¦ä¸²å³å¯è·å¾—ç­”æ¡ˆã€‚</p>
<h3>ç¤ºä¾‹ Controller</h3>
<p>æœ€åï¼Œæä¾›ä¸€ä¸ªç¤ºä¾‹æ§åˆ¶å™¨æ¥æ¼”ç¤ºæ¥å£å®šä¹‰å’Œè°ƒç”¨æµç¨‹ï¼š</p>
<blockquote><code>@RestController</code><br>
<code>@RequestMapping(&quot;/api&quot;)</code><br>
<code>public class QaController {</code><br>
<code>    @Autowired</code><br>
<code>    private RagService ragService;</code><br>
<code></code><br>
<code>    // æé—®æ¥å£</code><br>
<code>    @GetMapping(&quot;/ask&quot;)</code><br>
<code># ... (13 more lines)</code></blockquote>
<p><em>Full code available in the <a href="https://github.com/geyuxu">GitHub repository</a>.</em></p><ul>
<li>/api/ask æ¥å£æ¥å—æŸ¥è¯¢å‚æ•°qä¸ºç”¨æˆ·é—®é¢˜ï¼Œè°ƒç”¨RagServiceè·å–ç­”æ¡ˆå¹¶ç›´æ¥è¿”å›ã€‚HTTPæ–¹æ³•ç”¨GETç®€å•èµ·è§ï¼Œä¹Ÿå¯ç”¨POSTæäº¤å¤æ‚æŸ¥è¯¢ã€‚</li>
<li>/api/documents æ¥å£ç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•æ¥æ”¶æ–‡ä»¶å¹¶è°ƒç”¨æ–‡æ¡£åŠ è½½æµç¨‹ï¼Œå°†å†…å®¹ç´¢å¼•åˆ°ç³»ç»Ÿä¸­ã€‚æ–‡æ¡£å¤„ç†å¯ä»¥å‚è€ƒå‰è¿°æ–‡æ¡£ç´¢å¼•æµç¨‹å®ç°ã€‚</li>
</ul>
<p>é€šè¿‡ä¸Šè¿°Controllerï¼Œå‰ç«¯æˆ–ç”¨æˆ·å¯ä»¥é€šè¿‡HTTPè¯·æ±‚ä¸RAGæœåŠ¡äº¤äº’ï¼Œå®ç°åŠ¨æ€é—®ç­”ã€‚</p>
<h2>Docker Compose ç¯å¢ƒéƒ¨ç½²æ–¹æ¡ˆ</h2>
<p>ä¸ºæ–¹ä¾¿å¼€å‘å’Œéƒ¨ç½²ï¼Œæä¾›Docker Composeé…ç½®åŒæ—¶å¯åŠ¨æ‰€éœ€çš„å¤–éƒ¨æœåŠ¡ï¼ˆQdrantã€Elasticsearchã€Ollamaï¼‰å’Œæœ¬Spring Bootåº”ç”¨ã€‚æœ¬é¡¹ç›®çš„docker-compose.ymlç¤ºä¾‹å¦‚ä¸‹ï¼š</p>
<blockquote><code>version: &#039;3.9&#039;</code><br>
<code>services:</code><br>
<code>  elasticsearch:</code><br>
<code>    image: docker.elastic.co/elasticsearch/elasticsearch:8.9.0</code><br>
<code>    container_name: elasticsearch</code><br>
<code>    environment:</code><br>
<code>      - discovery.type=single-node</code><br>
<code>      - xpack.security.enabled=false       # ç¦ç”¨å®‰å…¨è®¤è¯</code><br>
<code># ... (39 more lines)</code></blockquote>
<p><em>Full code available in the <a href="https://github.com/geyuxu">GitHub repository</a>.</em></p><p>è¯´æ˜ï¼š</p>
<ul>
<li>Elasticsearchï¼šä½¿ç”¨å®˜æ–¹ES 8.9é•œåƒï¼Œé…ç½®ä¸ºå•èŠ‚ç‚¹æ¨¡å¼å¹¶å…³é—­å®‰å…¨ï¼Œä»¥ä¾¿ç®€åŒ–å¼€å‘æµ‹è¯•ã€‚æ˜ å°„ç«¯å£9200ç”¨äºRESTè®¿é—®ã€‚</li>
<li>Qdrantï¼šä½¿ç”¨å®˜æ–¹Qdranté•œåƒï¼Œå¼€æ”¾6333ç«¯å£ä¾›HTTP APIï¼ˆè‹¥ä½¿ç”¨ï¼‰å’Œ6334ç«¯å£ä¾›gRPCå®¢æˆ·ç«¯ã€‚æŒ‚è½½å·qdrant_dataæŒä¹…åŒ–å‘é‡æ•°æ®ã€‚</li>
<li>Ollamaï¼šä½¿ç”¨Ollamaå®˜æ–¹Dockeré•œåƒã€‚æ˜ å°„11434ç«¯å£ç”¨äºä¸Springåº”ç”¨é€šä¿¡ï¼ˆOllamaæä¾›REST APIï¼‰ï¼ŒæŒ‚è½½å·ollama_dataä¿å­˜å·²ä¸‹è½½çš„æ¨¡å‹æ•°æ®ï¼Œä»¥é¿å…å®¹å™¨é‡å¯åéœ€è¦é‡æ–°pullæ¨¡å‹  ã€‚åœ¨å¯åŠ¨å‰å¯ä»¥å…ˆè¿è¡Œç±»ä¼¼docker exec -it ollama ollama pull llama2çš„å‘½ä»¤ä¸‹è½½æ‰€éœ€æ¨¡å‹ï¼Œæˆ–åœ¨åº”ç”¨åˆå§‹åŒ–æ—¶é€šè¿‡Ollama APIè§¦å‘æ¨¡å‹ä¸‹è½½ã€‚</li>
<li>RAGæœåŠ¡ï¼šå‡è®¾Spring Bootåº”ç”¨å·²æ‰“åŒ…ä¸ºé•œåƒï¼ˆComposeä¸­é€šè¿‡buildæ„å»ºï¼‰ã€‚é€šè¿‡ç¯å¢ƒå˜é‡é…ç½®åº”ç”¨Profileå’Œæ‰€éœ€å‚æ•°ï¼šä¾‹å¦‚æ¿€æ´»local Profileè¡¨ç¤ºä½¿ç”¨æœ¬åœ°Ollamaï¼›å¦‚éœ€OpenAIåˆ™å¯¹åº”Profileä¸‹æä¾›OPENAI_API_KEYç­‰ã€‚depends_onç¡®ä¿å…¶ä»–æœåŠ¡å…ˆè¡Œå¯åŠ¨ã€‚ç«¯å£8080ç”¨äºå¯¹å¤–æä¾›HTTPæ¥å£ã€‚</li>
</ul>
<p>ç½‘ç»œé…ç½®ï¼šComposeé»˜è®¤ä¼šå°†è¿™äº›æœåŠ¡ç½®äºåŒä¸€ç½‘ç»œä¸‹ï¼Œå®¹å™¨åç§°å°±æ˜¯ä¸»æœºåã€‚å› æ­¤åº”ç”¨åœ¨è¿æ¥Qdrantå’ŒESæ—¶ï¼Œå¯ä»¥ä½¿ç”¨qdrant:6334ã€elasticsearch:9200ä½œä¸ºåœ°å€ã€‚Spring AI Docker Composeé›†æˆæ¨¡å—ç”šè‡³å¯ä»¥æ ¹æ®å®¹å™¨åè‡ªåŠ¨å‘ç°æœåŠ¡å¹¶é…ç½®è¿æ¥ï¼Œä¾‹å¦‚åå­—åŒ…å«â€œollama/ollamaâ€çš„å®¹å™¨ä¼šè¢«è¯†åˆ«ä¸ºOllamaæœåŠ¡  ã€‚</p>
<p>å¯åŠ¨ï¼šè¿è¡Œdocker-compose up -då°†åå°å¯åŠ¨æ‰€æœ‰å®¹å™¨ã€‚å¾…Elasticsearchå’ŒQdrantå®Œæˆå¯åŠ¨ï¼ˆå¯é€šè¿‡å¥åº·æ£€æŸ¥æ—¥å¿—æˆ–APIéªŒè¯ï¼‰ï¼ŒSpring Bootåº”ç”¨ä¼šè‡ªåŠ¨è¿æ¥å®ƒä»¬ã€‚æ­¤æ—¶ï¼š</p>
<ul>
<li>å¯ä»¥è°ƒç”¨POST /api/documentsä¸Šä¼ æ–‡æ¡£ï¼ˆæˆ–é€šè¿‡å…¶ä»–æ–¹å¼é¢„å…ˆç´¢å¼•æ–‡æ¡£ï¼‰ï¼›</li>
<li>ç„¶åè°ƒç”¨GET /api/ask?q=ä½ çš„é—®é¢˜è·å–ç­”æ¡ˆã€‚</li>
</ul>
<p>é€šè¿‡Docker Composeï¼Œä¸€é”®éƒ¨ç½²æ•´ä¸ªRAGç³»ç»Ÿçš„ä¾èµ–ï¼Œæ–¹ä¾¿åœ¨æœ¬åœ°æˆ–æœåŠ¡å™¨ä¸Šè¿è¡Œæµ‹è¯•ã€‚</p>
<h2>ç»“è®º</h2>
<p>æœ¬è®¾è®¡æ–‡æ¡£è¯¦ç»†æè¿°äº†ä¸€ä¸ªåŸºäºJava Springç”Ÿæ€çš„RAGæœç´¢æœåŠ¡æ–¹æ¡ˆã€‚é€šè¿‡Spring AIæ¡†æ¶æä¾›çš„æŠ½è±¡å’Œé›†æˆèƒ½åŠ›ï¼Œæˆ‘ä»¬å®ç°äº†Retriever-VectorStore-RAG Serviceçš„æ¨¡å—åŒ–æ¶æ„ï¼Œæ”¯æŒæ··åˆæ£€ç´¢ã€çµæ´»çš„LLM/Embeddingåˆ‡æ¢ä»¥åŠå®¹å™¨åŒ–éƒ¨ç½²ã€‚æ ¸å¿ƒæŠ€æœ¯é€‰å‹åŒ…æ‹¬Spring Bootã€Spring AIã€Elasticsearchã€Qdrantå’ŒOllamaç­‰ï¼Œå‡ä¸ºå½“ä¸‹æµè¡Œä¸”æœ‰è‰¯å¥½æ”¯æŒçš„ç»„ä»¶ã€‚æ–‡æ¡£æä¾›äº†æ•´ä½“æ¶æ„å’Œæ•°æ®æµç¨‹è§£æï¼Œç»™å‡ºäº†å…³é”®é…ç½®å’Œä»£ç ç¤ºä¾‹ï¼Œç¡®ä¿å®ç°ç»†èŠ‚æ¸…æ™°å¯è¡Œã€‚å¼€å‘è€…å¯ä»¥æ®æ­¤æ­å»ºèµ·ä¸€ä¸ªå¯å¤ç°çš„RAGé—®ç­”ç³»ç»Ÿï¼Œåœ¨ä¿è¯å›ç­”å‡†ç¡®æ€§çš„åŒæ—¶å…¼é¡¾éƒ¨ç½²çµæ´»æ€§å’Œæ•°æ®ç§æœ‰æ€§ï¼Œä¸ºä¼ä¸šçŸ¥è¯†åº“é—®ç­”ã€æ™ºèƒ½æœç´¢ç­‰åº”ç”¨åœºæ™¯æä¾›æœ‰åŠ›æ”¯æŒã€‚</p>

    </article>
    </main>
</div>

<script src="https://cdn.jsdelivr.net/npm/prismjs@1/prism.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/prismjs@1/components/prism-python.min.js"></script>
<script>
Prism.highlightAll();
document.querySelectorAll('article pre').forEach(pre => {
    const code = pre.querySelector('code');
    if (!code) return;
    const toolbar = document.createElement('div');
    toolbar.className = 'code-toolbar';
    const btn = document.createElement('button');
    btn.className = 'copy-btn';
    btn.textContent = 'Copy';
    btn.onclick = () => {
        navigator.clipboard.writeText(code.textContent).then(() => {
            btn.textContent = 'Copied!';
            btn.classList.add('copied');
            setTimeout(() => { btn.textContent = 'Copy'; btn.classList.remove('copied'); }, 2000);
        });
    };
    toolbar.appendChild(btn);
    pre.parentNode.insertBefore(toolbar, pre);
});
</script>
</body>
</html>