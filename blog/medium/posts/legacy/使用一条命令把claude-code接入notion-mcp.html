<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>使用一条命令把 Claude Code 接入 Notion MCP</title>
    <style>
        body { font-family: Georgia, serif; max-width: 700px; margin: 2rem auto; padding: 0 1rem; line-height: 1.7; color: #333; }
        h1 { font-size: 2rem; margin-bottom: 0.5rem; }
        h2 { font-size: 1.4rem; margin-top: 2rem; }
        pre { background: #f4f4f4; padding: 1rem; overflow-x: auto; border-radius: 4px; }
        code { font-family: Menlo, Monaco, monospace; font-size: 0.9em; }
        p code { background: #f4f4f4; padding: 0.2em 0.4em; border-radius: 3px; }
        img { max-width: 100%; }
        blockquote { border-left: 3px solid #ddd; margin-left: 0; padding-left: 1rem; color: #666; }
        ul { padding-left: 1.5rem; }
        hr { border: none; border-top: 1px solid #ddd; margin: 2rem 0; }
        a { color: #1a8917; }
    </style>
</head>
<body>
<hr>
<h2>date: 2024-01-01
tags: [ai, claude, notion, api, automation, cli, mcp]
legacy: true</h2>
<h1>使用一条命令把 Claude Code 接入 Notion MCP</h1>
<p>让我们开始吧。</p>
<h2>2. 基础准备</h2>
<p>在开始连接之前，请确保完成以下两个简单的准备步骤。</p>
<h3>2.1 更新 Claude CLI / Desktop</h3>
<p>MCP (Message-based Communication Protocol) 是 Claude Code 中较新的功能，它负责管理与外部服务的安全通信。请确保你的客户端版本足够新（<strong>≥ v0.7.0</strong>）以支持此功能。</p>
<p><strong>对于 CLI 用户：</strong></p>
<p>打开你的终端，运行以下命令进行升级：</p>
<p><code>pip install --upgrade claude-cli</code></p><p><strong>对于 Claude Desktop 用户：</strong></p>
<p>打开桌面应用，通过菜单栏检查更新，确保你运行的是最新版本。</p>
<h3>2.2 检查 Notion 侧权限</h3>
<p>为了让 Claude 能够访问你的 Notion 内容，你需要：</p>
<ol>
<li><strong>拥有编辑权限</strong>：确保你对希望 Claude 操作的 Notion 工作区（Workspace）拥有管理员或成员权限。</li>
<li><strong>预先选好授权范围</strong>：想好你希望授权给 Claude 的具体页面或数据库。一个最佳实践是专门创建一个数据库（例如，命名为 &quot;AI Drafts&quot;）或一个顶级页面（例如 &quot;Claude Inbox&quot;），仅将 Claude Integration 授权给这个特定范围，以遵循最小权限原则。</li>
</ol>
<h2>3. 一条命令添加 MCP 服务器</h2>
<p>准备工作就绪后，打开你的终端，执行这关键的一条命令：</p>
<p><code>claude mcp add --transport http notion https://mcp.notion.com/mcp</code></p><p>让我们来分解这个命令：</p>
<ul>
<li><code>claude mcp add</code>: 这是 <code>claude-cli</code> 中用于添加一个新的 MCP 服务的指令。</li>
<li><code>--transport http</code>: 指定通信协议为标准的 HTTP/S 请求。这是最常用、最通用的方式。</li>
<li><code>notion</code>: 这是你为这个连接设置的<strong>本地别名</strong>。你可以随意命名，比如 <code>my-notion</code>、<code>work-notion</code> 等。后续所有与 Notion 相关的指令都将使用这个别名作为前缀，例如 <code>notion.help</code>。</li>
<li><code>https://mcp.notion.com/mcp</code>: 这是 Claude 官方提供的、用于连接 Notion 的公共 MCP 端点。它是一个托管在云端的安全代理，负责处理 Claude 与 Notion API 之间的 OAuth 流程和数据交换。</li>
</ul>
<blockquote>
<p><strong>高级选项</strong>：如果你偏好使用 Server-Sent Events (SSE) 以获得更实时的双向通信体验，可以将命令调整为：
<code>claude mcp add --transport sse notion https://mcp.notion.com/mcp/sse</code></p>
</blockquote>
<p>执行命令后，CLI 会确认 MCP 服务器已添加，但此时的状态是&quot;未连接&quot;。</p>
<h2>4. 首次 OAuth 授权流程</h2>
<p>现在，我们需要触发一次授权，让 Notion 知道你允许 Claude 访问你的账户。</p>
<ol>
<li><p>在你的 Claude 对话或终端中，尝试调用任何一个以你刚才设置的别名开头的工具指令。最简单的就是请求帮助：</p>
<p><code>notion.help</code></p></li>
<li><p>此时，Claude CLI 或桌面应用会检测到 <code>notion</code> 服务尚未授权，并<strong>自动打开你的默认浏览器</strong>，跳转到 Notion 的登录和授权页面。</p>
</li>
<li><p>在浏览器中，登录你的 Notion 账户（如果尚未登录），然后选择你想要授权的<strong>工作区 (Workspace)</strong>，接着选择你希望授予权限的<strong>具体页面或数据库</strong>。</p>
</li>
<li><p>点击 <strong>&quot;Allow access&quot;</strong> 按钮。</p>
</li>
<li><p>授权成功后，浏览器会显示一个成功页面，提示你可以返回到你的应用。此时，你可以关闭这个浏览器标签页。</p>
</li>
</ol>
<p>回到 Claude，连接已经悄然建立。整个过程你没有接触到任何 API Token，非常安全。</p>
<h2>5. 验证连接是否生效</h2>
<p>如何确认连接真的成功了？我们可以用 <code>mcp</code> 子命令来检查。请注意，以下命令<strong>只检查状态，不会对你的 Notion 内容进行任何写入或修改操作</strong>。</p>
<p>首先，列出所有已配置的 MCP 服务：</p>
<p><code>claude mcp list</code></p><p>你应该能看到刚才添加的 <code>notion</code> 服务，以及它的通信方式：</p>
<blockquote><code>Available MCP servers:</code><br>
<code>- notion (http)</code></blockquote><p>接下来，获取 <code>notion</code> 服务的详细信息：</p>
<p><code>claude mcp get notion</code></p><p>你会看到一段 JSON 输出，其中最重要的字段是 <code>status</code>。如果一切顺利，它应该显示为 <code>connected</code>。</p>
<blockquote><code>{</code><br>
<code>  &quot;name&quot;: &quot;notion&quot;,</code><br>
<code>  &quot;transport&quot;: &quot;http&quot;,</code><br>
<code>  &quot;url&quot;: &quot;https://mcp.notion.com/mcp&quot;,</code><br>
<code>  &quot;status&quot;: &quot;connected&quot;,</code><br>
<code>  &quot;last_error&quot;: null</code><br>
<code>}</code></blockquote><p>看到 <code>status: &quot;connected&quot;</code>，恭喜你，大功告成！Claude 现在已经拥有了与你的 Notion 账户安全通信的能力。</p>
<h2>6. 常见问题 &amp; 排错</h2>
<p>如果在设置过程中遇到问题，可以参考下表进行排查：</p>
<p><img src="/blog/images/tables/table-6838327d.png" alt="Table"></p><h2>7. 后续可做的事（预告）</h2>
<p>现在，连接的桥梁已经架设完毕，一片广阔的自动化大陆正等待我们去探索。在接下来的文章中，我们将展示如何利用这个连接做一些真正酷的事情：</p>
<ul>
<li><strong>管理笔记和任务</strong>：使用 <code>notion.create_page</code>、<code>notion.append_block_children</code> 和 <code>notion.search</code> 等工具，直接在对话中创建、更新和查找 Notion 内容。</li>
<li><strong>构建自动化流水线</strong>：结合本地文件系统工具，实现一个 &quot;Markdown → Notion&quot; 的摘要流水线，自动将本地的 <code>*.md</code> 文件内容总结并写入到 Notion 数据库。</li>
<li><strong>自托管 MCP 服务</strong>：对于有特殊需求（如私有化部署、离线环境、企业合规）的开发者，我们将探讨如何自托管 MCP 服务器，实现完全可控的端到端连接。</li>
</ul>
<h2>8. 结语</h2>
<p>我们通过<strong>一条命令</strong>和一次简单的 <strong>OAuth 网页授权</strong>，就完成了 Claude 与 Notion 之间可信连接的建立。这种现代化的集成方式，彻底告别了手动管理 Access Token 的繁琐与不安全。</p>
<p>这个连接是所有后续 Notion 自动化的基石。现在，你的 Claude 已经准备好成为你真正的 Notion 助理了。</p>
<p>在下一篇文章中，我们将深入探讨如何实际调用 Notion 的各种工具指令，完成内容的写入、查询与同步。敬请期待！</p>

</body>
</html>