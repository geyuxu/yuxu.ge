<!DOCTYPE html><html lang="zh" data-astro-cid-bvzihdzo> <head><!-- Global Metadata --><meta charset="utf-8"><!--<meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">--><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.css"><link rel="shortcut icon" href="/favicon.png" type="image/png"><link rel="sitemap" href="/sitemap-index.xml"><link rel="alternate" type="application/rss+xml" title="Ge Yuxu • AI &#38; Engineering" href="https://geyuxu.com/rss.xml"><meta name="generator" content="Astro v5.5.6"><!-- Font preloads --><link rel="preload" href="/fonts/atkinson-regular.woff" as="font" type="font/woff" crossorigin><link rel="preload" href="/fonts/atkinson-bold.woff" as="font" type="font/woff" crossorigin><!-- Canonical URL --><link rel="canonical" href="https://geyuxu.com/blog/notes/html5-canvas-classic-tank-battle-game-development-single-file-game-architecture-practice/"><!-- Primary Meta Tags --><title>HTML5 Canvas Classic Tank Battle Game Development: Single-File Game Architecture Practice</title><meta name="title" content="HTML5 Canvas Classic Tank Battle Game Development: Single-File Game Architecture Practice"><meta name="description"><!-- Open Graph / Facebook --><meta property="og:type" content="website"><meta property="og:url" content="https://geyuxu.com/blog/notes/html5-canvas-classic-tank-battle-game-development-single-file-game-architecture-practice/"><meta property="og:title" content="HTML5 Canvas Classic Tank Battle Game Development: Single-File Game Architecture Practice"><meta property="og:description"><meta property="og:image" content="https://geyuxu.com/blog-placeholder-1.jpg"><!-- Twitter --><meta property="twitter:card" content="summary_large_image"><meta property="twitter:url" content="https://geyuxu.com/blog/notes/html5-canvas-classic-tank-battle-game-development-single-file-game-architecture-practice/"><meta property="twitter:title" content="HTML5 Canvas Classic Tank Battle Game Development: Single-File Game Architecture Practice"><meta property="twitter:description"><meta property="twitter:image" content="https://geyuxu.com/blog-placeholder-1.jpg"><script src="/js/jquery-3.7.1.min.js"></script><script is:global>
	window.addEventListener('DOMContentLoaded', () => {
		$('.toc ol').css({
		'list-style': 'none',   // 隐藏 1. 2. 3.
		'margin': 0,
		'padding-left': 0,       // 可按需调整
		});
		$('.toc ol > li').css({
		'list-style': 'none',   // 隐藏 1. 2. 3.
		'padding-left': 10  
		});
        $('.sidebar').append($('.toc'));
      });
	</script><style>:root{--accent: #2337ff;--accent-dark: #000d8a;--black: 15, 18, 25;--gray: 96, 115, 159;--gray-light: 229, 233, 240;--gray-dark: 34, 41, 57;--gray-gradient: rgba(var(--gray-light), 50%), #fff;--box-shadow: 0 2px 6px rgba(var(--gray), 25%), 0 8px 24px rgba(var(--gray), 33%), 0 16px 32px rgba(var(--gray), 33%)}@font-face{font-family:Atkinson;src:url(/fonts/atkinson-regular.woff) format("woff");font-weight:400;font-style:normal;font-display:swap}@font-face{font-family:Atkinson;src:url(/fonts/atkinson-bold.woff) format("woff");font-weight:700;font-style:normal;font-display:swap}body{font-family:Atkinson,sans-serif;margin:0;padding:0;text-align:left;background:linear-gradient(var(--gray-gradient)) no-repeat;background-size:100% 600px;word-wrap:break-word;overflow-wrap:break-word;color:rgb(var(--gray-dark));font-size:20px;line-height:1.7}main{width:960px;max-width:calc(100% - 2em);margin:auto;padding:3em 1em}h1,h2,h3,h4,h5,h6{margin:0 0 .5rem;color:rgb(var(--black));line-height:1.2}h1{font-size:3.052em}h2{font-size:2.441em}h3{font-size:1.953em}h4{font-size:1.563em}h5{font-size:1.25em}strong,b{font-weight:700}a,a:hover{color:var(--accent)}p{margin-bottom:1em}.prose p{margin-bottom:2em}textarea{width:100%;font-size:16px}input{font-size:16px}table{width:100%;border-collapse:collapse}th,td{border:1px solid rgba(var(--gray-light));padding:8px;text-align:left}th{background-color:rgba(var(--gray-light),.5)}img{max-width:100%;height:auto;border-radius:8px}code{padding:2px 5px;background-color:rgb(var(--gray-light));border-radius:2px}pre{padding:1.5em;border-radius:8px}pre>code{all:unset}blockquote{border-left:4px solid var(--accent);padding:0 0 0 20px;margin:0;font-size:1.333em}hr{border:none;border-top:1px solid rgb(var(--gray-light))}@media (max-width: 720px){body{font-size:18px}main{padding:1em}}.sr-only{border:0;padding:0;margin:0;position:absolute!important;height:1px;width:1px;overflow:hidden;clip:rect(1px 1px 1px 1px);clip:rect(1px,1px,1px,1px);clip-path:inset(50%);white-space:nowrap}.title_li{list-style:none}.title_li>a,.title_li_num>a,.toc-link,.series-list>li>a,.series_title>a{color:#7a888e}.content{max-width:960px;margin:0 auto;padding:2rem 1rem;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,sans-serif;font-size:1.05rem;line-height:1.75;color:#333}.content h1,.content h2,.content h3{font-weight:600;margin-top:2rem;margin-bottom:1rem;line-height:1.3}.content p{margin-bottom:1.25rem}.content a{color:var(--accent, #0070f3);text-decoration:underline}.content img{max-width:100%;border-radius:6px;margin:1.5rem 0}.content pre,.content code{font-family:Menlo,Monaco,Consolas,Courier New,monospace;font-size:.9em;border-radius:4px}.content pre{padding:1em;overflow-x:auto}article.prose{font-size:var(--fs-base);line-height:1.7}@media (max-width: 640px){nav>div,nav>h2{font-size:.6em}ul,ol{padding-left:20px}main,.content-wrapper{padding-left:0;width:350px;max-width:60350px0px;margin:0 auto}img,table,pre{max-width:100%}table,pre{overflow-x:auto}.content{margin:0;padding:0;border:0;max-width:3350px00px;font-size:11px}h1{font-size:1.3rem}h2{font-size:1.2rem}h3{font-size:1.1rem}h4{font-size:1rem}h5{font-size:.9rem}}
a[data-astro-cid-eimmu3lg]{display:inline-block;text-decoration:none}a[data-astro-cid-eimmu3lg].active{font-weight:bolder;text-decoration:underline}header[data-astro-cid-3ef6ksr2]{margin:0;padding:0 1em;background:#fff;box-shadow:0 2px 8px rgba(var(--black),5%)}h2[data-astro-cid-3ef6ksr2]{margin:0;font-size:1em}h2[data-astro-cid-3ef6ksr2] a[data-astro-cid-3ef6ksr2],h2[data-astro-cid-3ef6ksr2] a[data-astro-cid-3ef6ksr2].active{text-decoration:none}nav[data-astro-cid-3ef6ksr2]{display:flex;align-items:center;justify-content:space-between}nav[data-astro-cid-3ef6ksr2] a[data-astro-cid-3ef6ksr2]{padding:1em .5em;color:var(--black);border-bottom:4px solid transparent;text-decoration:none}nav[data-astro-cid-3ef6ksr2] a[data-astro-cid-3ef6ksr2].active{text-decoration:none;border-bottom-color:var(--accent)}.social-links[data-astro-cid-3ef6ksr2],.social-links[data-astro-cid-3ef6ksr2] a[data-astro-cid-3ef6ksr2]{display:flex}@media (max-width: 720px){.social-links[data-astro-cid-3ef6ksr2]{display:none}}footer[data-astro-cid-sz7xmlte]{padding:2em 1em 6em;background:linear-gradient(var(--gray-gradient)) no-repeat;color:rgb(var(--gray));text-align:center}.social-links[data-astro-cid-sz7xmlte]{display:flex;justify-content:center;gap:1em;margin-top:1em}.social-links[data-astro-cid-sz7xmlte] a[data-astro-cid-sz7xmlte]{text-decoration:none;color:rgb(var(--gray))}.social-links[data-astro-cid-sz7xmlte] a[data-astro-cid-sz7xmlte]:hover{color:rgb(var(--gray-dark))}
.statement[data-astro-cid-uffxixac]{font-size:10px;color:gray}@media (max-width: 640px){.statement[data-astro-cid-uffxixac]{font-size:6px;color:gray}}
main[data-astro-cid-bvzihdzo].page{display:grid;grid-template-columns:260px minmax(0,1fr);width:100%;margin:0}aside[data-astro-cid-bvzihdzo].sidebar{box-sizing:border-box;width:260px;padding:2rem 1rem;font-size:.95rem;position:sticky;top:4rem;align-self:start}.sidebar[data-astro-cid-bvzihdzo] .meta[data-astro-cid-bvzihdzo] p[data-astro-cid-bvzihdzo]{margin:.25rem 0}nav[data-astro-cid-bvzihdzo].toc li[data-astro-cid-bvzihdzo]{margin:.35rem 0 .35rem 1rem}nav[data-astro-cid-bvzihdzo].toc a[data-astro-cid-bvzihdzo]{color:var(--gray-dark,#444);text-decoration:none}nav[data-astro-cid-bvzihdzo].toc a[data-astro-cid-bvzihdzo]:hover{text-decoration:underline}.content-wrapper[data-astro-cid-bvzihdzo]{display:flex;justify-content:center;padding:2rem 1rem}article[data-astro-cid-bvzihdzo].prose{max-width:960px;width:100%}@media (max-width: 768px){main[data-astro-cid-bvzihdzo].page{grid-template-columns:1fr}aside[data-astro-cid-bvzihdzo].sidebar{position:static;width:100%;padding:1rem}.content-wrapper[data-astro-cid-bvzihdzo]{justify-content:flex-start}article[data-astro-cid-bvzihdzo].prose{max-width:100%}}.series-list[data-astro-cid-bvzihdzo]{list-style:none;margin:0;padding-left:10px}.series-list[data-astro-cid-bvzihdzo]{list-style:none;margin:0;padding-left:10px;max-height:calc(16em + .5rem);overflow-y:auto}.series-list[data-astro-cid-bvzihdzo]::-webkit-scrollbar{width:6px}.series-list[data-astro-cid-bvzihdzo]::-webkit-scrollbar-thumb{background:#0003;border-radius:3px}
</style></head> <body data-astro-cid-bvzihdzo> <header data-astro-cid-3ef6ksr2> <nav data-astro-cid-3ef6ksr2> <!--<h2><a href="/">{SITE_TITLE}</a></h2>--> <h2 data-astro-cid-3ef6ksr2><a style="padding-left:0;color:blue;" href="/" data-astro-cid-3ef6ksr2>Ge Yuxu<br data-astro-cid-3ef6ksr2>AI & Engineering</a></h2> <div class="internal-links" data-astro-cid-3ef6ksr2> <a href="/" data-astro-cid-3ef6ksr2="true" data-astro-cid-eimmu3lg> Home </a>  <a href="/blog/1" class="active" data-astro-cid-3ef6ksr2="true" data-astro-cid-eimmu3lg> Blog </a>  <a href="/series" data-astro-cid-3ef6ksr2="true" data-astro-cid-eimmu3lg> Series </a>  <a href="/projects" data-astro-cid-3ef6ksr2="true" data-astro-cid-eimmu3lg> Projects </a>  </div> <div class="social-links" data-astro-cid-3ef6ksr2> <a href="https://github.com/geyuxu" target="_blank" data-astro-cid-3ef6ksr2> <span class="sr-only" data-astro-cid-3ef6ksr2>Go to Ge Yuxu's GitHub repo</span> <svg viewBox="0 0 16 16" aria-hidden="true" width="32" height="32" data-astro-cid-3ef6ksr2><path fill="currentColor" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.012 8.012 0 0 0 16 8c0-4.42-3.58-8-8-8z" data-astro-cid-3ef6ksr2></path></svg> </a> <a href="https://www.linkedin.com/in/geyuxu/" target="_blank" data-astro-cid-3ef6ksr2> <span class="sr-only" data-astro-cid-3ef6ksr2>Go to Ge Yuxu's LinkedIn profile</span> <svg viewBox="0 0 24 24" width="32" height="32" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" data-astro-cid-3ef6ksr2> <path fill="currentColor" d="M20.447 20.452H17.2v-5.569c0-1.328-.025-3.039-1.852-3.039-1.853 0-2.136 1.447-2.136 2.942v5.666h-3.248V9h3.122v1.561h.045c.435-.823 1.498-1.688 3.083-1.688 3.295 0 3.903 2.17 3.903 4.989v6.59zM5.337 7.433a1.882 1.882 0 110-3.764 1.882 1.882 0 010 3.764zm1.626 13.019H3.708V9h3.255v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.226.792 24 1.771 24h20.451C23.2 24 24 23.226 24 22.271V1.729C24 .774 23.2 0 22.222 0z" data-astro-cid-3ef6ksr2></path> </svg> </a> </div> </nav> <!-- Microsoft Clarity --> <script type="text/javascript">
		(function(c,l,a,r,i,t,y){
			c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
			t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
			y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
		})(window, document, "clarity", "script", "rc2w96osp6");
	</script> </header>  <main class="page" data-astro-cid-bvzihdzo> <!-- 左侧栏 --> <aside class="sidebar" data-astro-cid-bvzihdzo> <div class="meta" data-astro-cid-bvzihdzo> <b data-astro-cid-bvzihdzo>HTML5 Canvas Classic Tank Battle Game Development: Single-File Game Architecture Practice</b> <p data-astro-cid-bvzihdzo><time datetime="2025-07-20T00:00:00.000Z"> 2025/07/20 08:00:00 </time></p> <p style="font-size:.85rem;color:var(--gray);" data-astro-cid-bvzihdzo>更新：<time datetime="2025-07-20T00:00:00.000Z"> 2025/07/20 08:00:00 </time></p>  </div> <hr data-astro-cid-bvzihdzo> <br data-astro-cid-bvzihdzo> </aside> <!-- 右侧正文区域（flex 居中） --> <div class="content-wrapper" data-astro-cid-bvzihdzo> <article class="prose" data-astro-cid-bvzihdzo>  <article class="content"> <nav class="toc"><ol class="toc-level toc-level-1"><li class="toc-item toc-item-h2"><a class="toc-link toc-link-h2" href="#project-overview">Project Overview</a></li><li class="toc-item toc-item-h2"><a class="toc-link toc-link-h2" href="#technology-selection-and-architecture">Technology Selection and Architecture</a><ol class="toc-level toc-level-2"><li class="toc-item toc-item-h3"><a class="toc-link toc-link-h3" href="#core-technologies">Core Technologies</a></li><li class="toc-item toc-item-h3"><a class="toc-link toc-link-h3" href="#architecture-characteristics">Architecture Characteristics</a></li></ol></li><li class="toc-item toc-item-h2"><a class="toc-link toc-link-h2" href="#game-system-design">Game System Design</a><ol class="toc-level toc-level-2"><li class="toc-item toc-item-h3"><a class="toc-link toc-link-h3" href="#core-class-structure">Core Class Structure</a></li><li class="toc-item toc-item-h3"><a class="toc-link toc-link-h3" href="#tank-class-implementation">Tank Class Implementation</a></li><li class="toc-item toc-item-h3"><a class="toc-link toc-link-h3" href="#bullet-system">Bullet System</a></li></ol></li><li class="toc-item toc-item-h2"><a class="toc-link toc-link-h2" href="#game-mechanics-implementation">Game Mechanics Implementation</a><ol class="toc-level toc-level-2"><li class="toc-item toc-item-h3"><a class="toc-link toc-link-h3" href="#collision-detection-system">Collision Detection System</a></li><li class="toc-item toc-item-h3"><a class="toc-link toc-link-h3" href="#level-system">Level System</a></li></ol></li><li class="toc-item toc-item-h2"><a class="toc-link toc-link-h2" href="#ui-system-and-game-state">UI System and Game State</a><ol class="toc-level toc-level-2"><li class="toc-item toc-item-h3"><a class="toc-link toc-link-h3" href="#user-interface-rendering">User Interface Rendering</a></li></ol></li><li class="toc-item toc-item-h2"><a class="toc-link toc-link-h2" href="#performance-optimization-strategies">Performance Optimization Strategies</a><ol class="toc-level toc-level-2"><li class="toc-item toc-item-h3"><a class="toc-link toc-link-h3" href="#1-object-pool-pattern">1. Object Pool Pattern</a></li><li class="toc-item toc-item-h3"><a class="toc-link toc-link-h3" href="#2-rendering-optimization">2. Rendering Optimization</a></li></ol></li><li class="toc-item toc-item-h2"><a class="toc-link toc-link-h2" href="#project-features">Project Features</a><ol class="toc-level toc-level-2"><li class="toc-item toc-item-h3"><a class="toc-link toc-link-h3" href="#1-single-file-architecture-advantages">1. Single-file Architecture Advantages</a></li><li class="toc-item toc-item-h3"><a class="toc-link toc-link-h3" href="#2-classic-game-mechanics">2. Classic Game Mechanics</a></li><li class="toc-item toc-item-h3"><a class="toc-link toc-link-h3" href="#3-extensible-design">3. Extensible Design</a></li></ol></li><li class="toc-item toc-item-h2"><a class="toc-link toc-link-h2" href="#technical-insights">Technical Insights</a><ol class="toc-level toc-level-2"><li class="toc-item toc-item-h3"><a class="toc-link toc-link-h3" href="#canvas-2d-programming">Canvas 2D Programming</a></li><li class="toc-item toc-item-h3"><a class="toc-link toc-link-h3" href="#game-development-fundamentals">Game Development Fundamentals</a></li><li class="toc-item toc-item-h3"><a class="toc-link toc-link-h3" href="#performance-optimization-practice">Performance Optimization Practice</a></li></ol></li><li class="toc-item toc-item-h2"><a class="toc-link toc-link-h2" href="#future-extension-directions">Future Extension Directions</a></li><li class="toc-item toc-item-h2"><a class="toc-link toc-link-h2" href="#summary">Summary</a></li></ol></nav><h2 id="project-overview"><a aria-hidden="true" tabindex="-1" href="#project-overview"><span class="icon icon-link"></span></a>Project Overview</h2>
<p>Developed a classic tank battle game based on <strong>HTML5 Canvas</strong> and <strong>native JavaScript</strong>, using a single-file architecture design. The game implements a complete game system including player control, enemy AI, bullet system, collision detection, multi-wave enemies, and other core features, showcasing the essence of lightweight Web game development.</p>
<h2 id="technology-selection-and-architecture"><a aria-hidden="true" tabindex="-1" href="#technology-selection-and-architecture"><span class="icon icon-link"></span></a>Technology Selection and Architecture</h2>
<h3 id="core-technologies"><a aria-hidden="true" tabindex="-1" href="#core-technologies"><span class="icon icon-link"></span></a>Core Technologies</h3>
<ul>
<li><strong>HTML5 Canvas</strong>: 2D graphics rendering</li>
<li><strong>Native JavaScript</strong>: Game logic implementation</li>
<li><strong>CSS3</strong>: Interface styling and layout</li>
<li><strong>Web Audio API</strong>: Audio system (optional extension)</li>
</ul>
<h3 id="architecture-characteristics"><a aria-hidden="true" tabindex="-1" href="#architecture-characteristics"><span class="icon icon-link"></span></a>Architecture Characteristics</h3>
<ul>
<li><strong>Single-file Design</strong>: All code centralized in one HTML file</li>
<li><strong>Object-oriented</strong>: Using ES6 class syntax for code structure organization</li>
<li><strong>Modular Thinking</strong>: Clear functional separation and responsibility division</li>
<li><strong>Zero Dependencies</strong>: No external libraries or frameworks required</li>
</ul>
<h2 id="game-system-design"><a aria-hidden="true" tabindex="-1" href="#game-system-design"><span class="icon icon-link"></span></a>Game System Design</h2>
<h3 id="core-class-structure"><a aria-hidden="true" tabindex="-1" href="#core-class-structure"><span class="icon icon-link"></span></a>Core Class Structure</h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="javascript"><code><span class="line"><span style="color:#6A737D">// Main game class</span></span>
<span class="line"><span style="color:#F97583">class</span><span style="color:#B392F0"> TankWarGame</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">    constructor</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#79B8FF">        this</span><span style="color:#E1E4E8">.canvas </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> document.</span><span style="color:#B392F0">getElementById</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'gameCanvas'</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#79B8FF">        this</span><span style="color:#E1E4E8">.ctx </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> this</span><span style="color:#E1E4E8">.canvas.</span><span style="color:#B392F0">getContext</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'2d'</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#79B8FF">        this</span><span style="color:#E1E4E8">.width </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 800</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#79B8FF">        this</span><span style="color:#E1E4E8">.height </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 600</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">        </span></span>
<span class="line"><span style="color:#79B8FF">        this</span><span style="color:#E1E4E8">.player </span><span style="color:#F97583">=</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> PlayerTank</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">100</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">500</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#79B8FF">        this</span><span style="color:#E1E4E8">.enemies </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> [];</span></span>
<span class="line"><span style="color:#79B8FF">        this</span><span style="color:#E1E4E8">.bullets </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> [];</span></span>
<span class="line"><span style="color:#79B8FF">        this</span><span style="color:#E1E4E8">.obstacles </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> [];</span></span>
<span class="line"><span style="color:#E1E4E8">        </span></span>
<span class="line"><span style="color:#79B8FF">        this</span><span style="color:#E1E4E8">.gameState </span><span style="color:#F97583">=</span><span style="color:#9ECBFF"> 'playing'</span><span style="color:#E1E4E8">; </span><span style="color:#6A737D">// playing, paused, gameOver</span></span>
<span class="line"><span style="color:#79B8FF">        this</span><span style="color:#E1E4E8">.score </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#79B8FF">        this</span><span style="color:#E1E4E8">.level </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 1</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#79B8FF">        this</span><span style="color:#E1E4E8">.enemiesRemaining </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 20</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">        </span></span>
<span class="line"><span style="color:#79B8FF">        this</span><span style="color:#E1E4E8">.keys </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> {};</span></span>
<span class="line"><span style="color:#79B8FF">        this</span><span style="color:#E1E4E8">.lastTime </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">        </span></span>
<span class="line"><span style="color:#79B8FF">        this</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">init</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">    init</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#79B8FF">        this</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">setupCanvas</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#79B8FF">        this</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">bindEvents</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#79B8FF">        this</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">createObstacles</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#79B8FF">        this</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">spawnEnemies</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#79B8FF">        this</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">gameLoop</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">    setupCanvas</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#79B8FF">        this</span><span style="color:#E1E4E8">.canvas.width </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> this</span><span style="color:#E1E4E8">.width;</span></span>
<span class="line"><span style="color:#79B8FF">        this</span><span style="color:#E1E4E8">.canvas.height </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> this</span><span style="color:#E1E4E8">.height;</span></span>
<span class="line"><span style="color:#79B8FF">        this</span><span style="color:#E1E4E8">.canvas.style.border </span><span style="color:#F97583">=</span><span style="color:#9ECBFF"> '2px solid #333'</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#79B8FF">        this</span><span style="color:#E1E4E8">.canvas.style.background </span><span style="color:#F97583">=</span><span style="color:#9ECBFF"> '#000'</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">    bindEvents</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#6A737D">        // Keyboard event handling</span></span>
<span class="line"><span style="color:#E1E4E8">        document.</span><span style="color:#B392F0">addEventListener</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'keydown'</span><span style="color:#E1E4E8">, (</span><span style="color:#FFAB70">e</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#79B8FF">            this</span><span style="color:#E1E4E8">.keys[e.code] </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> true</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">        });</span></span>
<span class="line"><span style="color:#E1E4E8">        </span></span>
<span class="line"><span style="color:#E1E4E8">        document.</span><span style="color:#B392F0">addEventListener</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'keyup'</span><span style="color:#E1E4E8">, (</span><span style="color:#FFAB70">e</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#79B8FF">            this</span><span style="color:#E1E4E8">.keys[e.code] </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> false</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">        });</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">    gameLoop</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">currentTime</span><span style="color:#F97583"> =</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#F97583">        const</span><span style="color:#79B8FF"> deltaTime</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> currentTime </span><span style="color:#F97583">-</span><span style="color:#79B8FF"> this</span><span style="color:#E1E4E8">.lastTime;</span></span>
<span class="line"><span style="color:#79B8FF">        this</span><span style="color:#E1E4E8">.lastTime </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> currentTime;</span></span>
<span class="line"><span style="color:#E1E4E8">        </span></span>
<span class="line"><span style="color:#F97583">        if</span><span style="color:#E1E4E8"> (</span><span style="color:#79B8FF">this</span><span style="color:#E1E4E8">.gameState </span><span style="color:#F97583">===</span><span style="color:#9ECBFF"> 'playing'</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#79B8FF">            this</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">update</span><span style="color:#E1E4E8">(deltaTime);</span></span>
<span class="line"><span style="color:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#E1E4E8">        </span></span>
<span class="line"><span style="color:#79B8FF">        this</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">render</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#B392F0">        requestAnimationFrame</span><span style="color:#E1E4E8">((</span><span style="color:#FFAB70">time</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#79B8FF"> this</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">gameLoop</span><span style="color:#E1E4E8">(time));</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">    update</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">deltaTime</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#6A737D">        // Update player</span></span>
<span class="line"><span style="color:#79B8FF">        this</span><span style="color:#E1E4E8">.player.</span><span style="color:#B392F0">update</span><span style="color:#E1E4E8">(deltaTime, </span><span style="color:#79B8FF">this</span><span style="color:#E1E4E8">.keys);</span></span>
<span class="line"><span style="color:#E1E4E8">        </span></span>
<span class="line"><span style="color:#6A737D">        // Update enemies</span></span>
<span class="line"><span style="color:#79B8FF">        this</span><span style="color:#E1E4E8">.enemies.</span><span style="color:#B392F0">forEach</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">enemy</span><span style="color:#F97583"> =></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">            enemy.</span><span style="color:#B392F0">update</span><span style="color:#E1E4E8">(deltaTime, </span><span style="color:#79B8FF">this</span><span style="color:#E1E4E8">.player, </span><span style="color:#79B8FF">this</span><span style="color:#E1E4E8">.obstacles);</span></span>
<span class="line"><span style="color:#E1E4E8">        });</span></span>
<span class="line"><span style="color:#E1E4E8">        </span></span>
<span class="line"><span style="color:#6A737D">        // Update bullets</span></span>
<span class="line"><span style="color:#79B8FF">        this</span><span style="color:#E1E4E8">.bullets.</span><span style="color:#B392F0">forEach</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">bullet</span><span style="color:#F97583"> =></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">            bullet.</span><span style="color:#B392F0">update</span><span style="color:#E1E4E8">(deltaTime);</span></span>
<span class="line"><span style="color:#E1E4E8">        });</span></span>
<span class="line"><span style="color:#E1E4E8">        </span></span>
<span class="line"><span style="color:#6A737D">        // Handle collisions</span></span>
<span class="line"><span style="color:#79B8FF">        this</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">handleCollisions</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#E1E4E8">        </span></span>
<span class="line"><span style="color:#6A737D">        // Clean up invalid objects</span></span>
<span class="line"><span style="color:#79B8FF">        this</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">cleanup</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#E1E4E8">        </span></span>
<span class="line"><span style="color:#6A737D">        // Check game state</span></span>
<span class="line"><span style="color:#79B8FF">        this</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">checkGameState</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">    render</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#6A737D">        // Clear canvas</span></span>
<span class="line"><span style="color:#79B8FF">        this</span><span style="color:#E1E4E8">.ctx.fillStyle </span><span style="color:#F97583">=</span><span style="color:#9ECBFF"> '#000'</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#79B8FF">        this</span><span style="color:#E1E4E8">.ctx.</span><span style="color:#B392F0">fillRect</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">this</span><span style="color:#E1E4E8">.width, </span><span style="color:#79B8FF">this</span><span style="color:#E1E4E8">.height);</span></span>
<span class="line"><span style="color:#E1E4E8">        </span></span>
<span class="line"><span style="color:#6A737D">        // Render obstacles</span></span>
<span class="line"><span style="color:#79B8FF">        this</span><span style="color:#E1E4E8">.obstacles.</span><span style="color:#B392F0">forEach</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">obstacle</span><span style="color:#F97583"> =></span><span style="color:#E1E4E8"> obstacle.</span><span style="color:#B392F0">render</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">this</span><span style="color:#E1E4E8">.ctx));</span></span>
<span class="line"><span style="color:#E1E4E8">        </span></span>
<span class="line"><span style="color:#6A737D">        // Render tanks</span></span>
<span class="line"><span style="color:#79B8FF">        this</span><span style="color:#E1E4E8">.player.</span><span style="color:#B392F0">render</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">this</span><span style="color:#E1E4E8">.ctx);</span></span>
<span class="line"><span style="color:#79B8FF">        this</span><span style="color:#E1E4E8">.enemies.</span><span style="color:#B392F0">forEach</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">enemy</span><span style="color:#F97583"> =></span><span style="color:#E1E4E8"> enemy.</span><span style="color:#B392F0">render</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">this</span><span style="color:#E1E4E8">.ctx));</span></span>
<span class="line"><span style="color:#E1E4E8">        </span></span>
<span class="line"><span style="color:#6A737D">        // Render bullets</span></span>
<span class="line"><span style="color:#79B8FF">        this</span><span style="color:#E1E4E8">.bullets.</span><span style="color:#B392F0">forEach</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">bullet</span><span style="color:#F97583"> =></span><span style="color:#E1E4E8"> bullet.</span><span style="color:#B392F0">render</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">this</span><span style="color:#E1E4E8">.ctx));</span></span>
<span class="line"><span style="color:#E1E4E8">        </span></span>
<span class="line"><span style="color:#6A737D">        // Render UI</span></span>
<span class="line"><span style="color:#79B8FF">        this</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">renderUI</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<h3 id="tank-class-implementation"><a aria-hidden="true" tabindex="-1" href="#tank-class-implementation"><span class="icon icon-link"></span></a>Tank Class Implementation</h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="javascript"><code><span class="line"><span style="color:#F97583">class</span><span style="color:#B392F0"> Tank</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">    constructor</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">x</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">y</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">color</span><span style="color:#F97583"> =</span><span style="color:#9ECBFF"> '#00FF00'</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#79B8FF">        this</span><span style="color:#E1E4E8">.x </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> x;</span></span>
<span class="line"><span style="color:#79B8FF">        this</span><span style="color:#E1E4E8">.y </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> y;</span></span>
<span class="line"><span style="color:#79B8FF">        this</span><span style="color:#E1E4E8">.width </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 32</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#79B8FF">        this</span><span style="color:#E1E4E8">.height </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 32</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#79B8FF">        this</span><span style="color:#E1E4E8">.speed </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 100</span><span style="color:#E1E4E8">; </span><span style="color:#6A737D">// pixels per second</span></span>
<span class="line"><span style="color:#79B8FF">        this</span><span style="color:#E1E4E8">.direction </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8">; </span><span style="color:#6A737D">// 0:up, 1:right, 2:down, 3:left</span></span>
<span class="line"><span style="color:#79B8FF">        this</span><span style="color:#E1E4E8">.color </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> color;</span></span>
<span class="line"><span style="color:#79B8FF">        this</span><span style="color:#E1E4E8">.health </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 1</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#79B8FF">        this</span><span style="color:#E1E4E8">.fireRate </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 500</span><span style="color:#E1E4E8">; </span><span style="color:#6A737D">// milliseconds</span></span>
<span class="line"><span style="color:#79B8FF">        this</span><span style="color:#E1E4E8">.lastFireTime </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">    move</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">direction</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">deltaTime</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">obstacles</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> []) {</span></span>
<span class="line"><span style="color:#F97583">        const</span><span style="color:#79B8FF"> speed</span><span style="color:#F97583"> =</span><span style="color:#79B8FF"> this</span><span style="color:#E1E4E8">.speed </span><span style="color:#F97583">*</span><span style="color:#E1E4E8"> (deltaTime </span><span style="color:#F97583">/</span><span style="color:#79B8FF"> 1000</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#F97583">        let</span><span style="color:#E1E4E8"> newX </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> this</span><span style="color:#E1E4E8">.x;</span></span>
<span class="line"><span style="color:#F97583">        let</span><span style="color:#E1E4E8"> newY </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> this</span><span style="color:#E1E4E8">.y;</span></span>
<span class="line"><span style="color:#E1E4E8">        </span></span>
<span class="line"><span style="color:#6A737D">        // Calculate new position</span></span>
<span class="line"><span style="color:#F97583">        switch</span><span style="color:#E1E4E8">(direction) {</span></span>
<span class="line"><span style="color:#F97583">            case</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8">: newY </span><span style="color:#F97583">-=</span><span style="color:#E1E4E8"> speed; </span><span style="color:#F97583">break</span><span style="color:#E1E4E8">; </span><span style="color:#6A737D">// up</span></span>
<span class="line"><span style="color:#F97583">            case</span><span style="color:#79B8FF"> 1</span><span style="color:#E1E4E8">: newX </span><span style="color:#F97583">+=</span><span style="color:#E1E4E8"> speed; </span><span style="color:#F97583">break</span><span style="color:#E1E4E8">; </span><span style="color:#6A737D">// right</span></span>
<span class="line"><span style="color:#F97583">            case</span><span style="color:#79B8FF"> 2</span><span style="color:#E1E4E8">: newY </span><span style="color:#F97583">+=</span><span style="color:#E1E4E8"> speed; </span><span style="color:#F97583">break</span><span style="color:#E1E4E8">; </span><span style="color:#6A737D">// down</span></span>
<span class="line"><span style="color:#F97583">            case</span><span style="color:#79B8FF"> 3</span><span style="color:#E1E4E8">: newX </span><span style="color:#F97583">-=</span><span style="color:#E1E4E8"> speed; </span><span style="color:#F97583">break</span><span style="color:#E1E4E8">; </span><span style="color:#6A737D">// left</span></span>
<span class="line"><span style="color:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#E1E4E8">        </span></span>
<span class="line"><span style="color:#6A737D">        // Boundary check</span></span>
<span class="line"><span style="color:#F97583">        if</span><span style="color:#E1E4E8"> (newX </span><span style="color:#F97583">&#x3C;</span><span style="color:#79B8FF"> 0</span><span style="color:#F97583"> ||</span><span style="color:#E1E4E8"> newX </span><span style="color:#F97583">+</span><span style="color:#79B8FF"> this</span><span style="color:#E1E4E8">.width </span><span style="color:#F97583">></span><span style="color:#79B8FF"> 800</span><span style="color:#F97583"> ||</span></span>
<span class="line"><span style="color:#E1E4E8">            newY </span><span style="color:#F97583">&#x3C;</span><span style="color:#79B8FF"> 0</span><span style="color:#F97583"> ||</span><span style="color:#E1E4E8"> newY </span><span style="color:#F97583">+</span><span style="color:#79B8FF"> this</span><span style="color:#E1E4E8">.height </span><span style="color:#F97583">></span><span style="color:#79B8FF"> 600</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#F97583">            return</span><span style="color:#79B8FF"> false</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#E1E4E8">        </span></span>
<span class="line"><span style="color:#6A737D">        // Collision detection</span></span>
<span class="line"><span style="color:#F97583">        const</span><span style="color:#79B8FF"> tempTank</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> { </span></span>
<span class="line"><span style="color:#E1E4E8">            x: newX, </span></span>
<span class="line"><span style="color:#E1E4E8">            y: newY, </span></span>
<span class="line"><span style="color:#E1E4E8">            width: </span><span style="color:#79B8FF">this</span><span style="color:#E1E4E8">.width, </span></span>
<span class="line"><span style="color:#E1E4E8">            height: </span><span style="color:#79B8FF">this</span><span style="color:#E1E4E8">.height </span></span>
<span class="line"><span style="color:#E1E4E8">        };</span></span>
<span class="line"><span style="color:#E1E4E8">        </span></span>
<span class="line"><span style="color:#F97583">        if</span><span style="color:#E1E4E8"> (</span><span style="color:#79B8FF">this</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">checkCollisions</span><span style="color:#E1E4E8">(tempTank, obstacles)) {</span></span>
<span class="line"><span style="color:#F97583">            return</span><span style="color:#79B8FF"> false</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#E1E4E8">        </span></span>
<span class="line"><span style="color:#6A737D">        // Update position and direction</span></span>
<span class="line"><span style="color:#79B8FF">        this</span><span style="color:#E1E4E8">.x </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> newX;</span></span>
<span class="line"><span style="color:#79B8FF">        this</span><span style="color:#E1E4E8">.y </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> newY;</span></span>
<span class="line"><span style="color:#79B8FF">        this</span><span style="color:#E1E4E8">.direction </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> direction;</span></span>
<span class="line"><span style="color:#F97583">        return</span><span style="color:#79B8FF"> true</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">    checkCollisions</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">rect</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">obstacles</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#F97583">        return</span><span style="color:#E1E4E8"> obstacles.</span><span style="color:#B392F0">some</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">obstacle</span><span style="color:#F97583"> =></span><span style="color:#E1E4E8"> </span></span>
<span class="line"><span style="color:#79B8FF">            this</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">isColliding</span><span style="color:#E1E4E8">(rect, obstacle)</span></span>
<span class="line"><span style="color:#E1E4E8">        );</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">    isColliding</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">rect1</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">rect2</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#F97583">        return</span><span style="color:#E1E4E8"> rect1.x </span><span style="color:#F97583">&#x3C;</span><span style="color:#E1E4E8"> rect2.x </span><span style="color:#F97583">+</span><span style="color:#E1E4E8"> rect2.width </span><span style="color:#F97583">&#x26;&#x26;</span></span>
<span class="line"><span style="color:#E1E4E8">               rect1.x </span><span style="color:#F97583">+</span><span style="color:#E1E4E8"> rect1.width </span><span style="color:#F97583">></span><span style="color:#E1E4E8"> rect2.x </span><span style="color:#F97583">&#x26;&#x26;</span></span>
<span class="line"><span style="color:#E1E4E8">               rect1.y </span><span style="color:#F97583">&#x3C;</span><span style="color:#E1E4E8"> rect2.y </span><span style="color:#F97583">+</span><span style="color:#E1E4E8"> rect2.height </span><span style="color:#F97583">&#x26;&#x26;</span></span>
<span class="line"><span style="color:#E1E4E8">               rect1.y </span><span style="color:#F97583">+</span><span style="color:#E1E4E8"> rect1.height </span><span style="color:#F97583">></span><span style="color:#E1E4E8"> rect2.y;</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">    fire</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">currentTime</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#F97583">        if</span><span style="color:#E1E4E8"> (currentTime </span><span style="color:#F97583">-</span><span style="color:#79B8FF"> this</span><span style="color:#E1E4E8">.lastFireTime </span><span style="color:#F97583">&#x3C;</span><span style="color:#79B8FF"> this</span><span style="color:#E1E4E8">.fireRate) {</span></span>
<span class="line"><span style="color:#F97583">            return</span><span style="color:#79B8FF"> null</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#E1E4E8">        </span></span>
<span class="line"><span style="color:#79B8FF">        this</span><span style="color:#E1E4E8">.lastFireTime </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> currentTime;</span></span>
<span class="line"><span style="color:#E1E4E8">        </span></span>
<span class="line"><span style="color:#6A737D">        // Calculate bullet starting position and direction</span></span>
<span class="line"><span style="color:#F97583">        let</span><span style="color:#E1E4E8"> bulletX </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> this</span><span style="color:#E1E4E8">.x </span><span style="color:#F97583">+</span><span style="color:#79B8FF"> this</span><span style="color:#E1E4E8">.width </span><span style="color:#F97583">/</span><span style="color:#79B8FF"> 2</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">        let</span><span style="color:#E1E4E8"> bulletY </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> this</span><span style="color:#E1E4E8">.y </span><span style="color:#F97583">+</span><span style="color:#79B8FF"> this</span><span style="color:#E1E4E8">.height </span><span style="color:#F97583">/</span><span style="color:#79B8FF"> 2</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">        </span></span>
<span class="line"><span style="color:#F97583">        return</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> Bullet</span><span style="color:#E1E4E8">(bulletX, bulletY, </span><span style="color:#79B8FF">this</span><span style="color:#E1E4E8">.direction, </span><span style="color:#79B8FF">this</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">    render</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">ctx</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#E1E4E8">        ctx.</span><span style="color:#B392F0">save</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#E1E4E8">        </span></span>
<span class="line"><span style="color:#6A737D">        // Move to tank center</span></span>
<span class="line"><span style="color:#E1E4E8">        ctx.</span><span style="color:#B392F0">translate</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">this</span><span style="color:#E1E4E8">.x </span><span style="color:#F97583">+</span><span style="color:#79B8FF"> this</span><span style="color:#E1E4E8">.width</span><span style="color:#F97583">/</span><span style="color:#79B8FF">2</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">this</span><span style="color:#E1E4E8">.y </span><span style="color:#F97583">+</span><span style="color:#79B8FF"> this</span><span style="color:#E1E4E8">.height</span><span style="color:#F97583">/</span><span style="color:#79B8FF">2</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">        </span></span>
<span class="line"><span style="color:#6A737D">        // Rotate based on direction</span></span>
<span class="line"><span style="color:#E1E4E8">        ctx.</span><span style="color:#B392F0">rotate</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">this</span><span style="color:#E1E4E8">.direction </span><span style="color:#F97583">*</span><span style="color:#E1E4E8"> Math.</span><span style="color:#79B8FF">PI</span><span style="color:#F97583"> /</span><span style="color:#79B8FF"> 2</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">        </span></span>
<span class="line"><span style="color:#6A737D">        // Draw tank body</span></span>
<span class="line"><span style="color:#E1E4E8">        ctx.fillStyle </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> this</span><span style="color:#E1E4E8">.color;</span></span>
<span class="line"><span style="color:#E1E4E8">        ctx.</span><span style="color:#B392F0">fillRect</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">-</span><span style="color:#79B8FF">this</span><span style="color:#E1E4E8">.width</span><span style="color:#F97583">/</span><span style="color:#79B8FF">2</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">-</span><span style="color:#79B8FF">this</span><span style="color:#E1E4E8">.height</span><span style="color:#F97583">/</span><span style="color:#79B8FF">2</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">this</span><span style="color:#E1E4E8">.width, </span><span style="color:#79B8FF">this</span><span style="color:#E1E4E8">.height);</span></span>
<span class="line"><span style="color:#E1E4E8">        </span></span>
<span class="line"><span style="color:#6A737D">        // Draw cannon</span></span>
<span class="line"><span style="color:#E1E4E8">        ctx.fillStyle </span><span style="color:#F97583">=</span><span style="color:#9ECBFF"> '#444'</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">        ctx.</span><span style="color:#B392F0">fillRect</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">-</span><span style="color:#79B8FF">2</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">-</span><span style="color:#79B8FF">this</span><span style="color:#E1E4E8">.height</span><span style="color:#F97583">/</span><span style="color:#79B8FF">2</span><span style="color:#F97583"> -</span><span style="color:#79B8FF"> 8</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">4</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">12</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">        </span></span>
<span class="line"><span style="color:#6A737D">        // Draw tracks</span></span>
<span class="line"><span style="color:#E1E4E8">        ctx.fillStyle </span><span style="color:#F97583">=</span><span style="color:#9ECBFF"> '#333'</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">        ctx.</span><span style="color:#B392F0">fillRect</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">-</span><span style="color:#79B8FF">this</span><span style="color:#E1E4E8">.width</span><span style="color:#F97583">/</span><span style="color:#79B8FF">2</span><span style="color:#F97583"> -</span><span style="color:#79B8FF"> 2</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">-</span><span style="color:#79B8FF">this</span><span style="color:#E1E4E8">.height</span><span style="color:#F97583">/</span><span style="color:#79B8FF">2</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">2</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">this</span><span style="color:#E1E4E8">.height);</span></span>
<span class="line"><span style="color:#E1E4E8">        ctx.</span><span style="color:#B392F0">fillRect</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">this</span><span style="color:#E1E4E8">.width</span><span style="color:#F97583">/</span><span style="color:#79B8FF">2</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">-</span><span style="color:#79B8FF">this</span><span style="color:#E1E4E8">.height</span><span style="color:#F97583">/</span><span style="color:#79B8FF">2</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">2</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">this</span><span style="color:#E1E4E8">.height);</span></span>
<span class="line"><span style="color:#E1E4E8">        </span></span>
<span class="line"><span style="color:#E1E4E8">        ctx.</span><span style="color:#B392F0">restore</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#E1E4E8">        </span></span>
<span class="line"><span style="color:#6A737D">        // Draw health bar</span></span>
<span class="line"><span style="color:#F97583">        if</span><span style="color:#E1E4E8"> (</span><span style="color:#79B8FF">this</span><span style="color:#E1E4E8">.health </span><span style="color:#F97583">&#x3C;</span><span style="color:#79B8FF"> this</span><span style="color:#E1E4E8">.maxHealth) {</span></span>
<span class="line"><span style="color:#79B8FF">            this</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">drawHealthBar</span><span style="color:#E1E4E8">(ctx);</span></span>
<span class="line"><span style="color:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">    drawHealthBar</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">ctx</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#F97583">        const</span><span style="color:#79B8FF"> barWidth</span><span style="color:#F97583"> =</span><span style="color:#79B8FF"> this</span><span style="color:#E1E4E8">.width;</span></span>
<span class="line"><span style="color:#F97583">        const</span><span style="color:#79B8FF"> barHeight</span><span style="color:#F97583"> =</span><span style="color:#79B8FF"> 4</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">        const</span><span style="color:#79B8FF"> barY</span><span style="color:#F97583"> =</span><span style="color:#79B8FF"> this</span><span style="color:#E1E4E8">.y </span><span style="color:#F97583">-</span><span style="color:#79B8FF"> 8</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">        </span></span>
<span class="line"><span style="color:#6A737D">        // Background</span></span>
<span class="line"><span style="color:#E1E4E8">        ctx.fillStyle </span><span style="color:#F97583">=</span><span style="color:#9ECBFF"> '#FF0000'</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">        ctx.</span><span style="color:#B392F0">fillRect</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">this</span><span style="color:#E1E4E8">.x, barY, barWidth, barHeight);</span></span>
<span class="line"><span style="color:#E1E4E8">        </span></span>
<span class="line"><span style="color:#6A737D">        // Health</span></span>
<span class="line"><span style="color:#E1E4E8">        ctx.fillStyle </span><span style="color:#F97583">=</span><span style="color:#9ECBFF"> '#00FF00'</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">        const</span><span style="color:#79B8FF"> healthWidth</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> (</span><span style="color:#79B8FF">this</span><span style="color:#E1E4E8">.health </span><span style="color:#F97583">/</span><span style="color:#79B8FF"> this</span><span style="color:#E1E4E8">.maxHealth) </span><span style="color:#F97583">*</span><span style="color:#E1E4E8"> barWidth;</span></span>
<span class="line"><span style="color:#E1E4E8">        ctx.</span><span style="color:#B392F0">fillRect</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">this</span><span style="color:#E1E4E8">.x, barY, healthWidth, barHeight);</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">// Player tank class</span></span>
<span class="line"><span style="color:#F97583">class</span><span style="color:#B392F0"> PlayerTank</span><span style="color:#F97583"> extends</span><span style="color:#B392F0"> Tank</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">    constructor</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">x</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">y</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#79B8FF">        super</span><span style="color:#E1E4E8">(x, y, </span><span style="color:#9ECBFF">'#00FF00'</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#79B8FF">        this</span><span style="color:#E1E4E8">.maxHealth </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 3</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#79B8FF">        this</span><span style="color:#E1E4E8">.health </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> this</span><span style="color:#E1E4E8">.maxHealth;</span></span>
<span class="line"><span style="color:#79B8FF">        this</span><span style="color:#E1E4E8">.lives </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 3</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">    update</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">deltaTime</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">keys</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#6A737D">        // Handle movement input</span></span>
<span class="line"><span style="color:#F97583">        if</span><span style="color:#E1E4E8"> (keys[</span><span style="color:#9ECBFF">'ArrowUp'</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">||</span><span style="color:#E1E4E8"> keys[</span><span style="color:#9ECBFF">'KeyW'</span><span style="color:#E1E4E8">]) {</span></span>
<span class="line"><span style="color:#79B8FF">            this</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">move</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">, deltaTime, game.obstacles);</span></span>
<span class="line"><span style="color:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#F97583">        if</span><span style="color:#E1E4E8"> (keys[</span><span style="color:#9ECBFF">'ArrowRight'</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">||</span><span style="color:#E1E4E8"> keys[</span><span style="color:#9ECBFF">'KeyD'</span><span style="color:#E1E4E8">]) {</span></span>
<span class="line"><span style="color:#79B8FF">            this</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">move</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">, deltaTime, game.obstacles);</span></span>
<span class="line"><span style="color:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#F97583">        if</span><span style="color:#E1E4E8"> (keys[</span><span style="color:#9ECBFF">'ArrowDown'</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">||</span><span style="color:#E1E4E8"> keys[</span><span style="color:#9ECBFF">'KeyS'</span><span style="color:#E1E4E8">]) {</span></span>
<span class="line"><span style="color:#79B8FF">            this</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">move</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">2</span><span style="color:#E1E4E8">, deltaTime, game.obstacles);</span></span>
<span class="line"><span style="color:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#F97583">        if</span><span style="color:#E1E4E8"> (keys[</span><span style="color:#9ECBFF">'ArrowLeft'</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">||</span><span style="color:#E1E4E8"> keys[</span><span style="color:#9ECBFF">'KeyA'</span><span style="color:#E1E4E8">]) {</span></span>
<span class="line"><span style="color:#79B8FF">            this</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">move</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">3</span><span style="color:#E1E4E8">, deltaTime, game.obstacles);</span></span>
<span class="line"><span style="color:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#E1E4E8">        </span></span>
<span class="line"><span style="color:#6A737D">        // Handle shooting input</span></span>
<span class="line"><span style="color:#F97583">        if</span><span style="color:#E1E4E8"> (keys[</span><span style="color:#9ECBFF">'Space'</span><span style="color:#E1E4E8">]) {</span></span>
<span class="line"><span style="color:#F97583">            const</span><span style="color:#79B8FF"> bullet</span><span style="color:#F97583"> =</span><span style="color:#79B8FF"> this</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">fire</span><span style="color:#E1E4E8">(Date.</span><span style="color:#B392F0">now</span><span style="color:#E1E4E8">());</span></span>
<span class="line"><span style="color:#F97583">            if</span><span style="color:#E1E4E8"> (bullet) {</span></span>
<span class="line"><span style="color:#E1E4E8">                game.bullets.</span><span style="color:#B392F0">push</span><span style="color:#E1E4E8">(bullet);</span></span>
<span class="line"><span style="color:#E1E4E8">            }</span></span>
<span class="line"><span style="color:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">// Enemy tank class</span></span>
<span class="line"><span style="color:#F97583">class</span><span style="color:#B392F0"> EnemyTank</span><span style="color:#F97583"> extends</span><span style="color:#B392F0"> Tank</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">    constructor</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">x</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">y</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#79B8FF">        super</span><span style="color:#E1E4E8">(x, y, </span><span style="color:#9ECBFF">'#FF0000'</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#79B8FF">        this</span><span style="color:#E1E4E8">.aiState </span><span style="color:#F97583">=</span><span style="color:#9ECBFF"> 'patrol'</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#79B8FF">        this</span><span style="color:#E1E4E8">.targetDirection </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> Math.</span><span style="color:#B392F0">floor</span><span style="color:#E1E4E8">(Math.</span><span style="color:#B392F0">random</span><span style="color:#E1E4E8">() </span><span style="color:#F97583">*</span><span style="color:#79B8FF"> 4</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#79B8FF">        this</span><span style="color:#E1E4E8">.stateChangeTime </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#79B8FF">        this</span><span style="color:#E1E4E8">.moveTime </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#79B8FF">        this</span><span style="color:#E1E4E8">.fireInterval </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 1000</span><span style="color:#F97583"> +</span><span style="color:#E1E4E8"> Math.</span><span style="color:#B392F0">random</span><span style="color:#E1E4E8">() </span><span style="color:#F97583">*</span><span style="color:#79B8FF"> 2000</span><span style="color:#E1E4E8">; </span><span style="color:#6A737D">// Random firing interval</span></span>
<span class="line"><span style="color:#79B8FF">        this</span><span style="color:#E1E4E8">.lastAIUpdate </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">    update</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">deltaTime</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">player</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">obstacles</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#F97583">        const</span><span style="color:#79B8FF"> currentTime</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> Date.</span><span style="color:#B392F0">now</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#E1E4E8">        </span></span>
<span class="line"><span style="color:#6A737D">        // AI decision update (reduce update frequency for performance)</span></span>
<span class="line"><span style="color:#F97583">        if</span><span style="color:#E1E4E8"> (currentTime </span><span style="color:#F97583">-</span><span style="color:#79B8FF"> this</span><span style="color:#E1E4E8">.lastAIUpdate </span><span style="color:#F97583">></span><span style="color:#79B8FF"> 100</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#79B8FF">            this</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">updateAI</span><span style="color:#E1E4E8">(deltaTime, player, obstacles);</span></span>
<span class="line"><span style="color:#79B8FF">            this</span><span style="color:#E1E4E8">.lastAIUpdate </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> currentTime;</span></span>
<span class="line"><span style="color:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#E1E4E8">        </span></span>
<span class="line"><span style="color:#6A737D">        // Movement</span></span>
<span class="line"><span style="color:#79B8FF">        this</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">executeMovement</span><span style="color:#E1E4E8">(deltaTime, obstacles);</span></span>
<span class="line"><span style="color:#E1E4E8">        </span></span>
<span class="line"><span style="color:#6A737D">        // Firing</span></span>
<span class="line"><span style="color:#79B8FF">        this</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">handleFiring</span><span style="color:#E1E4E8">(currentTime, player);</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">    updateAI</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">deltaTime</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">player</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">obstacles</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#F97583">        const</span><span style="color:#79B8FF"> distanceToPlayer</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> Math.</span><span style="color:#B392F0">sqrt</span><span style="color:#E1E4E8">(</span></span>
<span class="line"><span style="color:#E1E4E8">            Math.</span><span style="color:#B392F0">pow</span><span style="color:#E1E4E8">(player.x </span><span style="color:#F97583">-</span><span style="color:#79B8FF"> this</span><span style="color:#E1E4E8">.x, </span><span style="color:#79B8FF">2</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">+</span><span style="color:#E1E4E8"> </span></span>
<span class="line"><span style="color:#E1E4E8">            Math.</span><span style="color:#B392F0">pow</span><span style="color:#E1E4E8">(player.y </span><span style="color:#F97583">-</span><span style="color:#79B8FF"> this</span><span style="color:#E1E4E8">.y, </span><span style="color:#79B8FF">2</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">        );</span></span>
<span class="line"><span style="color:#E1E4E8">        </span></span>
<span class="line"><span style="color:#6A737D">        // State machine</span></span>
<span class="line"><span style="color:#F97583">        switch</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">this</span><span style="color:#E1E4E8">.aiState) {</span></span>
<span class="line"><span style="color:#F97583">            case</span><span style="color:#9ECBFF"> 'patrol'</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#F97583">                if</span><span style="color:#E1E4E8"> (distanceToPlayer </span><span style="color:#F97583">&#x3C;</span><span style="color:#79B8FF"> 150</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#79B8FF">                    this</span><span style="color:#E1E4E8">.aiState </span><span style="color:#F97583">=</span><span style="color:#9ECBFF"> 'attack'</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#79B8FF">                    this</span><span style="color:#E1E4E8">.targetDirection </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> this</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">getDirectionToPlayer</span><span style="color:#E1E4E8">(player);</span></span>
<span class="line"><span style="color:#E1E4E8">                }</span></span>
<span class="line"><span style="color:#F97583">                break</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">                </span></span>
<span class="line"><span style="color:#F97583">            case</span><span style="color:#9ECBFF"> 'attack'</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#F97583">                if</span><span style="color:#E1E4E8"> (distanceToPlayer </span><span style="color:#F97583">></span><span style="color:#79B8FF"> 200</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#79B8FF">                    this</span><span style="color:#E1E4E8">.aiState </span><span style="color:#F97583">=</span><span style="color:#9ECBFF"> 'patrol'</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">                } </span><span style="color:#F97583">else</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6A737D">                    // Face player</span></span>
<span class="line"><span style="color:#79B8FF">                    this</span><span style="color:#E1E4E8">.targetDirection </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> this</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">getDirectionToPlayer</span><span style="color:#E1E4E8">(player);</span></span>
<span class="line"><span style="color:#E1E4E8">                }</span></span>
<span class="line"><span style="color:#F97583">                break</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#E1E4E8">        </span></span>
<span class="line"><span style="color:#6A737D">        // Random direction change (patrol state)</span></span>
<span class="line"><span style="color:#F97583">        if</span><span style="color:#E1E4E8"> (</span><span style="color:#79B8FF">this</span><span style="color:#E1E4E8">.aiState </span><span style="color:#F97583">===</span><span style="color:#9ECBFF"> 'patrol'</span><span style="color:#F97583"> &#x26;&#x26;</span><span style="color:#E1E4E8"> Math.</span><span style="color:#B392F0">random</span><span style="color:#E1E4E8">() </span><span style="color:#F97583">&#x3C;</span><span style="color:#79B8FF"> 0.02</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#79B8FF">            this</span><span style="color:#E1E4E8">.targetDirection </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> Math.</span><span style="color:#B392F0">floor</span><span style="color:#E1E4E8">(Math.</span><span style="color:#B392F0">random</span><span style="color:#E1E4E8">() </span><span style="color:#F97583">*</span><span style="color:#79B8FF"> 4</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">    getDirectionToPlayer</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">player</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#F97583">        const</span><span style="color:#79B8FF"> dx</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> player.x </span><span style="color:#F97583">-</span><span style="color:#79B8FF"> this</span><span style="color:#E1E4E8">.x;</span></span>
<span class="line"><span style="color:#F97583">        const</span><span style="color:#79B8FF"> dy</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> player.y </span><span style="color:#F97583">-</span><span style="color:#79B8FF"> this</span><span style="color:#E1E4E8">.y;</span></span>
<span class="line"><span style="color:#E1E4E8">        </span></span>
<span class="line"><span style="color:#F97583">        if</span><span style="color:#E1E4E8"> (Math.</span><span style="color:#B392F0">abs</span><span style="color:#E1E4E8">(dx) </span><span style="color:#F97583">></span><span style="color:#E1E4E8"> Math.</span><span style="color:#B392F0">abs</span><span style="color:#E1E4E8">(dy)) {</span></span>
<span class="line"><span style="color:#F97583">            return</span><span style="color:#E1E4E8"> dx </span><span style="color:#F97583">></span><span style="color:#79B8FF"> 0</span><span style="color:#F97583"> ?</span><span style="color:#79B8FF"> 1</span><span style="color:#F97583"> :</span><span style="color:#79B8FF"> 3</span><span style="color:#E1E4E8">; </span><span style="color:#6A737D">// right or left</span></span>
<span class="line"><span style="color:#E1E4E8">        } </span><span style="color:#F97583">else</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">            return</span><span style="color:#E1E4E8"> dy </span><span style="color:#F97583">></span><span style="color:#79B8FF"> 0</span><span style="color:#F97583"> ?</span><span style="color:#79B8FF"> 2</span><span style="color:#F97583"> :</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8">; </span><span style="color:#6A737D">// down or up</span></span>
<span class="line"><span style="color:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">    executeMovement</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">deltaTime</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">obstacles</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#F97583">        if</span><span style="color:#E1E4E8"> (</span><span style="color:#F97583">!</span><span style="color:#79B8FF">this</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">move</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">this</span><span style="color:#E1E4E8">.targetDirection, deltaTime, obstacles)) {</span></span>
<span class="line"><span style="color:#6A737D">            // Hit a wall, change direction</span></span>
<span class="line"><span style="color:#79B8FF">            this</span><span style="color:#E1E4E8">.targetDirection </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> Math.</span><span style="color:#B392F0">floor</span><span style="color:#E1E4E8">(Math.</span><span style="color:#B392F0">random</span><span style="color:#E1E4E8">() </span><span style="color:#F97583">*</span><span style="color:#79B8FF"> 4</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">    handleFiring</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">currentTime</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">player</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#F97583">        if</span><span style="color:#E1E4E8"> (</span><span style="color:#79B8FF">this</span><span style="color:#E1E4E8">.aiState </span><span style="color:#F97583">===</span><span style="color:#9ECBFF"> 'attack'</span><span style="color:#F97583"> &#x26;&#x26;</span><span style="color:#E1E4E8"> </span></span>
<span class="line"><span style="color:#E1E4E8">            currentTime </span><span style="color:#F97583">-</span><span style="color:#79B8FF"> this</span><span style="color:#E1E4E8">.lastFireTime </span><span style="color:#F97583">></span><span style="color:#79B8FF"> this</span><span style="color:#E1E4E8">.fireInterval) {</span></span>
<span class="line"><span style="color:#E1E4E8">            </span></span>
<span class="line"><span style="color:#6A737D">            // Check if can shoot player (simple ray casting)</span></span>
<span class="line"><span style="color:#F97583">            if</span><span style="color:#E1E4E8"> (</span><span style="color:#79B8FF">this</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">canShootPlayer</span><span style="color:#E1E4E8">(player)) {</span></span>
<span class="line"><span style="color:#F97583">                const</span><span style="color:#79B8FF"> bullet</span><span style="color:#F97583"> =</span><span style="color:#79B8FF"> this</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">fire</span><span style="color:#E1E4E8">(currentTime);</span></span>
<span class="line"><span style="color:#F97583">                if</span><span style="color:#E1E4E8"> (bullet) {</span></span>
<span class="line"><span style="color:#E1E4E8">                    game.bullets.</span><span style="color:#B392F0">push</span><span style="color:#E1E4E8">(bullet);</span></span>
<span class="line"><span style="color:#E1E4E8">                }</span></span>
<span class="line"><span style="color:#E1E4E8">            }</span></span>
<span class="line"><span style="color:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">    canShootPlayer</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">player</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#6A737D">        // Simplified ray casting</span></span>
<span class="line"><span style="color:#F97583">        const</span><span style="color:#79B8FF"> dx</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> player.x </span><span style="color:#F97583">-</span><span style="color:#79B8FF"> this</span><span style="color:#E1E4E8">.x;</span></span>
<span class="line"><span style="color:#F97583">        const</span><span style="color:#79B8FF"> dy</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> player.y </span><span style="color:#F97583">-</span><span style="color:#79B8FF"> this</span><span style="color:#E1E4E8">.y;</span></span>
<span class="line"><span style="color:#E1E4E8">        </span></span>
<span class="line"><span style="color:#6A737D">        // Check if player is in firing direction</span></span>
<span class="line"><span style="color:#F97583">        switch</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">this</span><span style="color:#E1E4E8">.direction) {</span></span>
<span class="line"><span style="color:#F97583">            case</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8">: </span><span style="color:#F97583">return</span><span style="color:#E1E4E8"> dy </span><span style="color:#F97583">&#x3C;</span><span style="color:#79B8FF"> 0</span><span style="color:#F97583"> &#x26;&#x26;</span><span style="color:#E1E4E8"> Math.</span><span style="color:#B392F0">abs</span><span style="color:#E1E4E8">(dx) </span><span style="color:#F97583">&#x3C;</span><span style="color:#79B8FF"> 50</span><span style="color:#E1E4E8">; </span><span style="color:#6A737D">// up</span></span>
<span class="line"><span style="color:#F97583">            case</span><span style="color:#79B8FF"> 1</span><span style="color:#E1E4E8">: </span><span style="color:#F97583">return</span><span style="color:#E1E4E8"> dx </span><span style="color:#F97583">></span><span style="color:#79B8FF"> 0</span><span style="color:#F97583"> &#x26;&#x26;</span><span style="color:#E1E4E8"> Math.</span><span style="color:#B392F0">abs</span><span style="color:#E1E4E8">(dy) </span><span style="color:#F97583">&#x3C;</span><span style="color:#79B8FF"> 50</span><span style="color:#E1E4E8">; </span><span style="color:#6A737D">// right</span></span>
<span class="line"><span style="color:#F97583">            case</span><span style="color:#79B8FF"> 2</span><span style="color:#E1E4E8">: </span><span style="color:#F97583">return</span><span style="color:#E1E4E8"> dy </span><span style="color:#F97583">></span><span style="color:#79B8FF"> 0</span><span style="color:#F97583"> &#x26;&#x26;</span><span style="color:#E1E4E8"> Math.</span><span style="color:#B392F0">abs</span><span style="color:#E1E4E8">(dx) </span><span style="color:#F97583">&#x3C;</span><span style="color:#79B8FF"> 50</span><span style="color:#E1E4E8">; </span><span style="color:#6A737D">// down</span></span>
<span class="line"><span style="color:#F97583">            case</span><span style="color:#79B8FF"> 3</span><span style="color:#E1E4E8">: </span><span style="color:#F97583">return</span><span style="color:#E1E4E8"> dx </span><span style="color:#F97583">&#x3C;</span><span style="color:#79B8FF"> 0</span><span style="color:#F97583"> &#x26;&#x26;</span><span style="color:#E1E4E8"> Math.</span><span style="color:#B392F0">abs</span><span style="color:#E1E4E8">(dy) </span><span style="color:#F97583">&#x3C;</span><span style="color:#79B8FF"> 50</span><span style="color:#E1E4E8">; </span><span style="color:#6A737D">// left</span></span>
<span class="line"><span style="color:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#F97583">        return</span><span style="color:#79B8FF"> false</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<h3 id="bullet-system"><a aria-hidden="true" tabindex="-1" href="#bullet-system"><span class="icon icon-link"></span></a>Bullet System</h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="javascript"><code><span class="line"><span style="color:#F97583">class</span><span style="color:#B392F0"> Bullet</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">    constructor</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">x</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">y</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">direction</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">owner</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#79B8FF">        this</span><span style="color:#E1E4E8">.x </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> x;</span></span>
<span class="line"><span style="color:#79B8FF">        this</span><span style="color:#E1E4E8">.y </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> y;</span></span>
<span class="line"><span style="color:#79B8FF">        this</span><span style="color:#E1E4E8">.width </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 4</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#79B8FF">        this</span><span style="color:#E1E4E8">.height </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 4</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#79B8FF">        this</span><span style="color:#E1E4E8">.speed </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 300</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#79B8FF">        this</span><span style="color:#E1E4E8">.direction </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> direction;</span></span>
<span class="line"><span style="color:#79B8FF">        this</span><span style="color:#E1E4E8">.owner </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> owner;</span></span>
<span class="line"><span style="color:#79B8FF">        this</span><span style="color:#E1E4E8">.active </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> true</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">    update</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">deltaTime</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#F97583">        if</span><span style="color:#E1E4E8"> (</span><span style="color:#F97583">!</span><span style="color:#79B8FF">this</span><span style="color:#E1E4E8">.active) </span><span style="color:#F97583">return</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">        </span></span>
<span class="line"><span style="color:#F97583">        const</span><span style="color:#79B8FF"> speed</span><span style="color:#F97583"> =</span><span style="color:#79B8FF"> this</span><span style="color:#E1E4E8">.speed </span><span style="color:#F97583">*</span><span style="color:#E1E4E8"> (deltaTime </span><span style="color:#F97583">/</span><span style="color:#79B8FF"> 1000</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">        </span></span>
<span class="line"><span style="color:#6A737D">        // Move based on direction</span></span>
<span class="line"><span style="color:#F97583">        switch</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">this</span><span style="color:#E1E4E8">.direction) {</span></span>
<span class="line"><span style="color:#F97583">            case</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">this</span><span style="color:#E1E4E8">.y </span><span style="color:#F97583">-=</span><span style="color:#E1E4E8"> speed; </span><span style="color:#F97583">break</span><span style="color:#E1E4E8">; </span><span style="color:#6A737D">// up</span></span>
<span class="line"><span style="color:#F97583">            case</span><span style="color:#79B8FF"> 1</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">this</span><span style="color:#E1E4E8">.x </span><span style="color:#F97583">+=</span><span style="color:#E1E4E8"> speed; </span><span style="color:#F97583">break</span><span style="color:#E1E4E8">; </span><span style="color:#6A737D">// right</span></span>
<span class="line"><span style="color:#F97583">            case</span><span style="color:#79B8FF"> 2</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">this</span><span style="color:#E1E4E8">.y </span><span style="color:#F97583">+=</span><span style="color:#E1E4E8"> speed; </span><span style="color:#F97583">break</span><span style="color:#E1E4E8">; </span><span style="color:#6A737D">// down</span></span>
<span class="line"><span style="color:#F97583">            case</span><span style="color:#79B8FF"> 3</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">this</span><span style="color:#E1E4E8">.x </span><span style="color:#F97583">-=</span><span style="color:#E1E4E8"> speed; </span><span style="color:#F97583">break</span><span style="color:#E1E4E8">; </span><span style="color:#6A737D">// left</span></span>
<span class="line"><span style="color:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#E1E4E8">        </span></span>
<span class="line"><span style="color:#6A737D">        // Boundary check</span></span>
<span class="line"><span style="color:#F97583">        if</span><span style="color:#E1E4E8"> (</span><span style="color:#79B8FF">this</span><span style="color:#E1E4E8">.x </span><span style="color:#F97583">&#x3C;</span><span style="color:#79B8FF"> 0</span><span style="color:#F97583"> ||</span><span style="color:#79B8FF"> this</span><span style="color:#E1E4E8">.x </span><span style="color:#F97583">></span><span style="color:#79B8FF"> 800</span><span style="color:#F97583"> ||</span><span style="color:#79B8FF"> this</span><span style="color:#E1E4E8">.y </span><span style="color:#F97583">&#x3C;</span><span style="color:#79B8FF"> 0</span><span style="color:#F97583"> ||</span><span style="color:#79B8FF"> this</span><span style="color:#E1E4E8">.y </span><span style="color:#F97583">></span><span style="color:#79B8FF"> 600</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#79B8FF">            this</span><span style="color:#E1E4E8">.active </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> false</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">    render</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">ctx</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#F97583">        if</span><span style="color:#E1E4E8"> (</span><span style="color:#F97583">!</span><span style="color:#79B8FF">this</span><span style="color:#E1E4E8">.active) </span><span style="color:#F97583">return</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">        </span></span>
<span class="line"><span style="color:#E1E4E8">        ctx.fillStyle </span><span style="color:#F97583">=</span><span style="color:#9ECBFF"> '#FFFF00'</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">        ctx.</span><span style="color:#B392F0">fillRect</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">this</span><span style="color:#E1E4E8">.x </span><span style="color:#F97583">-</span><span style="color:#79B8FF"> this</span><span style="color:#E1E4E8">.width</span><span style="color:#F97583">/</span><span style="color:#79B8FF">2</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">this</span><span style="color:#E1E4E8">.y </span><span style="color:#F97583">-</span><span style="color:#79B8FF"> this</span><span style="color:#E1E4E8">.height</span><span style="color:#F97583">/</span><span style="color:#79B8FF">2</span><span style="color:#E1E4E8">, </span></span>
<span class="line"><span style="color:#79B8FF">                    this</span><span style="color:#E1E4E8">.width, </span><span style="color:#79B8FF">this</span><span style="color:#E1E4E8">.height);</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">    checkCollision</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">target</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#F97583">        if</span><span style="color:#E1E4E8"> (</span><span style="color:#F97583">!</span><span style="color:#79B8FF">this</span><span style="color:#E1E4E8">.active </span><span style="color:#F97583">||</span><span style="color:#79B8FF"> this</span><span style="color:#E1E4E8">.owner </span><span style="color:#F97583">===</span><span style="color:#E1E4E8"> target) </span><span style="color:#F97583">return</span><span style="color:#79B8FF"> false</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">        </span></span>
<span class="line"><span style="color:#F97583">        return</span><span style="color:#79B8FF"> this</span><span style="color:#E1E4E8">.x </span><span style="color:#F97583">&#x3C;</span><span style="color:#E1E4E8"> target.x </span><span style="color:#F97583">+</span><span style="color:#E1E4E8"> target.width </span><span style="color:#F97583">&#x26;&#x26;</span></span>
<span class="line"><span style="color:#79B8FF">               this</span><span style="color:#E1E4E8">.x </span><span style="color:#F97583">+</span><span style="color:#79B8FF"> this</span><span style="color:#E1E4E8">.width </span><span style="color:#F97583">></span><span style="color:#E1E4E8"> target.x </span><span style="color:#F97583">&#x26;&#x26;</span></span>
<span class="line"><span style="color:#79B8FF">               this</span><span style="color:#E1E4E8">.y </span><span style="color:#F97583">&#x3C;</span><span style="color:#E1E4E8"> target.y </span><span style="color:#F97583">+</span><span style="color:#E1E4E8"> target.height </span><span style="color:#F97583">&#x26;&#x26;</span></span>
<span class="line"><span style="color:#79B8FF">               this</span><span style="color:#E1E4E8">.y </span><span style="color:#F97583">+</span><span style="color:#79B8FF"> this</span><span style="color:#E1E4E8">.height </span><span style="color:#F97583">></span><span style="color:#E1E4E8"> target.y;</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<h2 id="game-mechanics-implementation"><a aria-hidden="true" tabindex="-1" href="#game-mechanics-implementation"><span class="icon icon-link"></span></a>Game Mechanics Implementation</h2>
<h3 id="collision-detection-system"><a aria-hidden="true" tabindex="-1" href="#collision-detection-system"><span class="icon icon-link"></span></a>Collision Detection System</h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="javascript"><code><span class="line"><span style="color:#F97583">class</span><span style="color:#B392F0"> CollisionManager</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">    static</span><span style="color:#B392F0"> handleBulletCollisions</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">bullets</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">targets</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#E1E4E8">        bullets.</span><span style="color:#B392F0">forEach</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">bullet</span><span style="color:#F97583"> =></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">            if</span><span style="color:#E1E4E8"> (</span><span style="color:#F97583">!</span><span style="color:#E1E4E8">bullet.active) </span><span style="color:#F97583">return</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">            </span></span>
<span class="line"><span style="color:#6A737D">            // Check collision with obstacles</span></span>
<span class="line"><span style="color:#E1E4E8">            game.obstacles.</span><span style="color:#B392F0">forEach</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">obstacle</span><span style="color:#F97583"> =></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">                if</span><span style="color:#E1E4E8"> (bullet.</span><span style="color:#B392F0">checkCollision</span><span style="color:#E1E4E8">(obstacle)) {</span></span>
<span class="line"><span style="color:#E1E4E8">                    bullet.active </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> false</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#6A737D">                    // Can add explosion effect</span></span>
<span class="line"><span style="color:#79B8FF">                    this</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">createExplosion</span><span style="color:#E1E4E8">(bullet.x, bullet.y);</span></span>
<span class="line"><span style="color:#E1E4E8">                }</span></span>
<span class="line"><span style="color:#E1E4E8">            });</span></span>
<span class="line"><span style="color:#E1E4E8">            </span></span>
<span class="line"><span style="color:#6A737D">            // Check collision with tanks</span></span>
<span class="line"><span style="color:#E1E4E8">            targets.</span><span style="color:#B392F0">forEach</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">target</span><span style="color:#F97583"> =></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">                if</span><span style="color:#E1E4E8"> (bullet.</span><span style="color:#B392F0">checkCollision</span><span style="color:#E1E4E8">(target)) {</span></span>
<span class="line"><span style="color:#E1E4E8">                    bullet.active </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> false</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">                    target.health</span><span style="color:#F97583">--</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">                    </span></span>
<span class="line"><span style="color:#6A737D">                    // Create hit effect</span></span>
<span class="line"><span style="color:#79B8FF">                    this</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">createHitEffect</span><span style="color:#E1E4E8">(target.x, target.y);</span></span>
<span class="line"><span style="color:#E1E4E8">                    </span></span>
<span class="line"><span style="color:#6A737D">                    // Check if target is destroyed</span></span>
<span class="line"><span style="color:#F97583">                    if</span><span style="color:#E1E4E8"> (target.health </span><span style="color:#F97583">&#x3C;=</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#79B8FF">                        this</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">destroyTarget</span><span style="color:#E1E4E8">(target);</span></span>
<span class="line"><span style="color:#E1E4E8">                    }</span></span>
<span class="line"><span style="color:#E1E4E8">                }</span></span>
<span class="line"><span style="color:#E1E4E8">            });</span></span>
<span class="line"><span style="color:#E1E4E8">        });</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">    static</span><span style="color:#B392F0"> createExplosion</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">x</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">y</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#6A737D">        // Simple explosion effect</span></span>
<span class="line"><span style="color:#F97583">        const</span><span style="color:#79B8FF"> explosion</span><span style="color:#F97583"> =</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> ParticleEffect</span><span style="color:#E1E4E8">(x, y, </span><span style="color:#9ECBFF">'explosion'</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">        game.effects.</span><span style="color:#B392F0">push</span><span style="color:#E1E4E8">(explosion);</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">    static</span><span style="color:#B392F0"> createHitEffect</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">x</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">y</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#6A737D">        // Hit effect</span></span>
<span class="line"><span style="color:#F97583">        const</span><span style="color:#79B8FF"> hitEffect</span><span style="color:#F97583"> =</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> ParticleEffect</span><span style="color:#E1E4E8">(x, y, </span><span style="color:#9ECBFF">'hit'</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">        game.effects.</span><span style="color:#B392F0">push</span><span style="color:#E1E4E8">(hitEffect);</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">    static</span><span style="color:#B392F0"> destroyTarget</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">target</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#F97583">        if</span><span style="color:#E1E4E8"> (target </span><span style="color:#F97583">instanceof</span><span style="color:#B392F0"> EnemyTank</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#6A737D">            // Enemy tank destroyed</span></span>
<span class="line"><span style="color:#E1E4E8">            game.score </span><span style="color:#F97583">+=</span><span style="color:#79B8FF"> 100</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">            game.enemiesRemaining</span><span style="color:#F97583">--</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">            </span></span>
<span class="line"><span style="color:#6A737D">            // Remove from array</span></span>
<span class="line"><span style="color:#F97583">            const</span><span style="color:#79B8FF"> index</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> game.enemies.</span><span style="color:#B392F0">indexOf</span><span style="color:#E1E4E8">(target);</span></span>
<span class="line"><span style="color:#F97583">            if</span><span style="color:#E1E4E8"> (index </span><span style="color:#F97583">></span><span style="color:#F97583"> -</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#E1E4E8">                game.enemies.</span><span style="color:#B392F0">splice</span><span style="color:#E1E4E8">(index, </span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">            }</span></span>
<span class="line"><span style="color:#E1E4E8">            </span></span>
<span class="line"><span style="color:#6A737D">            // Create explosion effect</span></span>
<span class="line"><span style="color:#79B8FF">            this</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">createExplosion</span><span style="color:#E1E4E8">(target.x, target.y);</span></span>
<span class="line"><span style="color:#E1E4E8">            </span></span>
<span class="line"><span style="color:#E1E4E8">        } </span><span style="color:#F97583">else</span><span style="color:#F97583"> if</span><span style="color:#E1E4E8"> (target </span><span style="color:#F97583">instanceof</span><span style="color:#B392F0"> PlayerTank</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#6A737D">            // Player tank destroyed</span></span>
<span class="line"><span style="color:#E1E4E8">            target.lives</span><span style="color:#F97583">--</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">            target.health </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> target.maxHealth;</span></span>
<span class="line"><span style="color:#E1E4E8">            </span></span>
<span class="line"><span style="color:#F97583">            if</span><span style="color:#E1E4E8"> (target.lives </span><span style="color:#F97583">&#x3C;=</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#E1E4E8">                game.gameState </span><span style="color:#F97583">=</span><span style="color:#9ECBFF"> 'gameOver'</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">            } </span><span style="color:#F97583">else</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6A737D">                // Reset player position</span></span>
<span class="line"><span style="color:#E1E4E8">                target.x </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 100</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">                target.y </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 500</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">            }</span></span>
<span class="line"><span style="color:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<h3 id="level-system"><a aria-hidden="true" tabindex="-1" href="#level-system"><span class="icon icon-link"></span></a>Level System</h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="javascript"><code><span class="line"><span style="color:#F97583">class</span><span style="color:#B392F0"> LevelManager</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">    static</span><span style="color:#FFAB70"> levels</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> [</span></span>
<span class="line"><span style="color:#E1E4E8">        { enemies: </span><span style="color:#79B8FF">5</span><span style="color:#E1E4E8">, speed: </span><span style="color:#79B8FF">1.0</span><span style="color:#E1E4E8">, fireRate: </span><span style="color:#79B8FF">1.0</span><span style="color:#E1E4E8"> },</span></span>
<span class="line"><span style="color:#E1E4E8">        { enemies: </span><span style="color:#79B8FF">8</span><span style="color:#E1E4E8">, speed: </span><span style="color:#79B8FF">1.2</span><span style="color:#E1E4E8">, fireRate: </span><span style="color:#79B8FF">1.2</span><span style="color:#E1E4E8"> },</span></span>
<span class="line"><span style="color:#E1E4E8">        { enemies: </span><span style="color:#79B8FF">12</span><span style="color:#E1E4E8">, speed: </span><span style="color:#79B8FF">1.4</span><span style="color:#E1E4E8">, fireRate: </span><span style="color:#79B8FF">1.4</span><span style="color:#E1E4E8"> },</span></span>
<span class="line"><span style="color:#E1E4E8">        { enemies: </span><span style="color:#79B8FF">16</span><span style="color:#E1E4E8">, speed: </span><span style="color:#79B8FF">1.6</span><span style="color:#E1E4E8">, fireRate: </span><span style="color:#79B8FF">1.6</span><span style="color:#E1E4E8"> },</span></span>
<span class="line"><span style="color:#E1E4E8">        { enemies: </span><span style="color:#79B8FF">20</span><span style="color:#E1E4E8">, speed: </span><span style="color:#79B8FF">1.8</span><span style="color:#E1E4E8">, fireRate: </span><span style="color:#79B8FF">1.8</span><span style="color:#E1E4E8"> }</span></span>
<span class="line"><span style="color:#E1E4E8">    ];</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">    static</span><span style="color:#B392F0"> loadLevel</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">levelNumber</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#F97583">        const</span><span style="color:#79B8FF"> level</span><span style="color:#F97583"> =</span><span style="color:#79B8FF"> this</span><span style="color:#E1E4E8">.levels[levelNumber </span><span style="color:#F97583">-</span><span style="color:#79B8FF"> 1</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">||</span><span style="color:#79B8FF"> this</span><span style="color:#E1E4E8">.levels[</span><span style="color:#79B8FF">this</span><span style="color:#E1E4E8">.levels.</span><span style="color:#79B8FF">length</span><span style="color:#F97583"> -</span><span style="color:#79B8FF"> 1</span><span style="color:#E1E4E8">];</span></span>
<span class="line"><span style="color:#E1E4E8">        </span></span>
<span class="line"><span style="color:#6A737D">        // Clear existing enemies</span></span>
<span class="line"><span style="color:#E1E4E8">        game.enemies </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> [];</span></span>
<span class="line"><span style="color:#E1E4E8">        game.bullets </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> [];</span></span>
<span class="line"><span style="color:#E1E4E8">        </span></span>
<span class="line"><span style="color:#6A737D">        // Set level parameters</span></span>
<span class="line"><span style="color:#E1E4E8">        game.enemiesRemaining </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> level.enemies;</span></span>
<span class="line"><span style="color:#E1E4E8">        game.level </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> levelNumber;</span></span>
<span class="line"><span style="color:#E1E4E8">        </span></span>
<span class="line"><span style="color:#6A737D">        // Spawn enemies</span></span>
<span class="line"><span style="color:#79B8FF">        this</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">spawnEnemies</span><span style="color:#E1E4E8">(level);</span></span>
<span class="line"><span style="color:#E1E4E8">        </span></span>
<span class="line"><span style="color:#6A737D">        // Reset player</span></span>
<span class="line"><span style="color:#E1E4E8">        game.player.x </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 100</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">        game.player.y </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 500</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">        game.player.health </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> game.player.maxHealth;</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">    static</span><span style="color:#B392F0"> spawnEnemies</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">levelConfig</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#F97583">        const</span><span style="color:#79B8FF"> spawnPositions</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> [</span></span>
<span class="line"><span style="color:#E1E4E8">            { x: </span><span style="color:#79B8FF">50</span><span style="color:#E1E4E8">, y: </span><span style="color:#79B8FF">50</span><span style="color:#E1E4E8"> },</span></span>
<span class="line"><span style="color:#E1E4E8">            { x: </span><span style="color:#79B8FF">400</span><span style="color:#E1E4E8">, y: </span><span style="color:#79B8FF">50</span><span style="color:#E1E4E8"> },</span></span>
<span class="line"><span style="color:#E1E4E8">            { x: </span><span style="color:#79B8FF">750</span><span style="color:#E1E4E8">, y: </span><span style="color:#79B8FF">50</span><span style="color:#E1E4E8"> },</span></span>
<span class="line"><span style="color:#E1E4E8">            { x: </span><span style="color:#79B8FF">750</span><span style="color:#E1E4E8">, y: </span><span style="color:#79B8FF">300</span><span style="color:#E1E4E8"> },</span></span>
<span class="line"><span style="color:#E1E4E8">            { x: </span><span style="color:#79B8FF">400</span><span style="color:#E1E4E8">, y: </span><span style="color:#79B8FF">300</span><span style="color:#E1E4E8"> }</span></span>
<span class="line"><span style="color:#E1E4E8">        ];</span></span>
<span class="line"><span style="color:#E1E4E8">        </span></span>
<span class="line"><span style="color:#F97583">        for</span><span style="color:#E1E4E8"> (</span><span style="color:#F97583">let</span><span style="color:#E1E4E8"> i </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8">; i </span><span style="color:#F97583">&#x3C;</span><span style="color:#E1E4E8"> Math.</span><span style="color:#B392F0">min</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">5</span><span style="color:#E1E4E8">, levelConfig.enemies); i</span><span style="color:#F97583">++</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#F97583">            const</span><span style="color:#79B8FF"> pos</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> spawnPositions[i];</span></span>
<span class="line"><span style="color:#F97583">            const</span><span style="color:#79B8FF"> enemy</span><span style="color:#F97583"> =</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> EnemyTank</span><span style="color:#E1E4E8">(pos.x, pos.y);</span></span>
<span class="line"><span style="color:#E1E4E8">            </span></span>
<span class="line"><span style="color:#6A737D">            // Apply level difficulty</span></span>
<span class="line"><span style="color:#E1E4E8">            enemy.speed </span><span style="color:#F97583">*=</span><span style="color:#E1E4E8"> levelConfig.speed;</span></span>
<span class="line"><span style="color:#E1E4E8">            enemy.fireInterval </span><span style="color:#F97583">/=</span><span style="color:#E1E4E8"> levelConfig.fireRate;</span></span>
<span class="line"><span style="color:#E1E4E8">            </span></span>
<span class="line"><span style="color:#E1E4E8">            game.enemies.</span><span style="color:#B392F0">push</span><span style="color:#E1E4E8">(enemy);</span></span>
<span class="line"><span style="color:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#E1E4E8">        </span></span>
<span class="line"><span style="color:#6A737D">        // Set remaining enemy count</span></span>
<span class="line"><span style="color:#E1E4E8">        game.enemiesToSpawn </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> levelConfig.enemies </span><span style="color:#F97583">-</span><span style="color:#E1E4E8"> game.enemies.</span><span style="color:#79B8FF">length</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">    static</span><span style="color:#B392F0"> checkLevelComplete</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#F97583">        if</span><span style="color:#E1E4E8"> (game.enemies.</span><span style="color:#79B8FF">length</span><span style="color:#F97583"> ===</span><span style="color:#79B8FF"> 0</span><span style="color:#F97583"> &#x26;&#x26;</span><span style="color:#E1E4E8"> game.enemiesToSpawn </span><span style="color:#F97583">===</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#6A737D">            // Level complete</span></span>
<span class="line"><span style="color:#E1E4E8">            game.level</span><span style="color:#F97583">++</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#B392F0">            setTimeout</span><span style="color:#E1E4E8">(() </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#79B8FF">                this</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">loadLevel</span><span style="color:#E1E4E8">(game.level);</span></span>
<span class="line"><span style="color:#E1E4E8">            }, </span><span style="color:#79B8FF">2000</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">            </span></span>
<span class="line"><span style="color:#F97583">            return</span><span style="color:#79B8FF"> true</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#F97583">        return</span><span style="color:#79B8FF"> false</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<h2 id="ui-system-and-game-state"><a aria-hidden="true" tabindex="-1" href="#ui-system-and-game-state"><span class="icon icon-link"></span></a>UI System and Game State</h2>
<h3 id="user-interface-rendering"><a aria-hidden="true" tabindex="-1" href="#user-interface-rendering"><span class="icon icon-link"></span></a>User Interface Rendering</h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="javascript"><code><span class="line"><span style="color:#F97583">class</span><span style="color:#B392F0"> UIRenderer</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">    static</span><span style="color:#B392F0"> render</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">ctx</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">game</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#6A737D">        // Set font</span></span>
<span class="line"><span style="color:#E1E4E8">        ctx.font </span><span style="color:#F97583">=</span><span style="color:#9ECBFF"> '16px Arial'</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">        ctx.fillStyle </span><span style="color:#F97583">=</span><span style="color:#9ECBFF"> '#FFFFFF'</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">        </span></span>
<span class="line"><span style="color:#6A737D">        // Render score</span></span>
<span class="line"><span style="color:#E1E4E8">        ctx.</span><span style="color:#B392F0">fillText</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">`Score: ${</span><span style="color:#E1E4E8">game</span><span style="color:#9ECBFF">.</span><span style="color:#E1E4E8">score</span><span style="color:#9ECBFF">}`</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">10</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">25</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">        </span></span>
<span class="line"><span style="color:#6A737D">        // Render level</span></span>
<span class="line"><span style="color:#E1E4E8">        ctx.</span><span style="color:#B392F0">fillText</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">`Level: ${</span><span style="color:#E1E4E8">game</span><span style="color:#9ECBFF">.</span><span style="color:#E1E4E8">level</span><span style="color:#9ECBFF">}`</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">10</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">45</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">        </span></span>
<span class="line"><span style="color:#6A737D">        // Render lives</span></span>
<span class="line"><span style="color:#E1E4E8">        ctx.</span><span style="color:#B392F0">fillText</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">`Lives: ${</span><span style="color:#E1E4E8">game</span><span style="color:#9ECBFF">.</span><span style="color:#E1E4E8">player</span><span style="color:#9ECBFF">.</span><span style="color:#E1E4E8">lives</span><span style="color:#9ECBFF">}`</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">10</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">65</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">        </span></span>
<span class="line"><span style="color:#6A737D">        // Render remaining enemies</span></span>
<span class="line"><span style="color:#E1E4E8">        ctx.</span><span style="color:#B392F0">fillText</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">`Enemies: ${</span><span style="color:#E1E4E8">game</span><span style="color:#9ECBFF">.</span><span style="color:#E1E4E8">enemiesRemaining</span><span style="color:#9ECBFF">}`</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">10</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">85</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">        </span></span>
<span class="line"><span style="color:#6A737D">        // Render game state information</span></span>
<span class="line"><span style="color:#F97583">        if</span><span style="color:#E1E4E8"> (game.gameState </span><span style="color:#F97583">===</span><span style="color:#9ECBFF"> 'paused'</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#79B8FF">            this</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">renderPauseScreen</span><span style="color:#E1E4E8">(ctx);</span></span>
<span class="line"><span style="color:#E1E4E8">        } </span><span style="color:#F97583">else</span><span style="color:#F97583"> if</span><span style="color:#E1E4E8"> (game.gameState </span><span style="color:#F97583">===</span><span style="color:#9ECBFF"> 'gameOver'</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#79B8FF">            this</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">renderGameOverScreen</span><span style="color:#E1E4E8">(ctx);</span></span>
<span class="line"><span style="color:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">    static</span><span style="color:#B392F0"> renderPauseScreen</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">ctx</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#6A737D">        // Semi-transparent background</span></span>
<span class="line"><span style="color:#E1E4E8">        ctx.fillStyle </span><span style="color:#F97583">=</span><span style="color:#9ECBFF"> 'rgba(0, 0, 0, 0.7)'</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">        ctx.</span><span style="color:#B392F0">fillRect</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">800</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">600</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">        </span></span>
<span class="line"><span style="color:#6A737D">        // Pause text</span></span>
<span class="line"><span style="color:#E1E4E8">        ctx.font </span><span style="color:#F97583">=</span><span style="color:#9ECBFF"> '48px Arial'</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">        ctx.fillStyle </span><span style="color:#F97583">=</span><span style="color:#9ECBFF"> '#FFFFFF'</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">        ctx.textAlign </span><span style="color:#F97583">=</span><span style="color:#9ECBFF"> 'center'</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">        ctx.</span><span style="color:#B392F0">fillText</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'PAUSED'</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">400</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">300</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">        </span></span>
<span class="line"><span style="color:#E1E4E8">        ctx.font </span><span style="color:#F97583">=</span><span style="color:#9ECBFF"> '24px Arial'</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">        ctx.</span><span style="color:#B392F0">fillText</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'Press P to continue'</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">400</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">350</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">        ctx.textAlign </span><span style="color:#F97583">=</span><span style="color:#9ECBFF"> 'left'</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">    static</span><span style="color:#B392F0"> renderGameOverScreen</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">ctx</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#6A737D">        // Semi-transparent background</span></span>
<span class="line"><span style="color:#E1E4E8">        ctx.fillStyle </span><span style="color:#F97583">=</span><span style="color:#9ECBFF"> 'rgba(0, 0, 0, 0.8)'</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">        ctx.</span><span style="color:#B392F0">fillRect</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">800</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">600</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">        </span></span>
<span class="line"><span style="color:#6A737D">        // Game over text</span></span>
<span class="line"><span style="color:#E1E4E8">        ctx.font </span><span style="color:#F97583">=</span><span style="color:#9ECBFF"> '48px Arial'</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">        ctx.fillStyle </span><span style="color:#F97583">=</span><span style="color:#9ECBFF"> '#FF0000'</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">        ctx.textAlign </span><span style="color:#F97583">=</span><span style="color:#9ECBFF"> 'center'</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">        ctx.</span><span style="color:#B392F0">fillText</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'GAME OVER'</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">400</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">250</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">        </span></span>
<span class="line"><span style="color:#E1E4E8">        ctx.font </span><span style="color:#F97583">=</span><span style="color:#9ECBFF"> '24px Arial'</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">        ctx.fillStyle </span><span style="color:#F97583">=</span><span style="color:#9ECBFF"> '#FFFFFF'</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">        ctx.</span><span style="color:#B392F0">fillText</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">`Final Score: ${</span><span style="color:#E1E4E8">game</span><span style="color:#9ECBFF">.</span><span style="color:#E1E4E8">score</span><span style="color:#9ECBFF">}`</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">400</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">300</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">        ctx.</span><span style="color:#B392F0">fillText</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'Press R to restart'</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">400</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">350</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">        ctx.textAlign </span><span style="color:#F97583">=</span><span style="color:#9ECBFF"> 'left'</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<h2 id="performance-optimization-strategies"><a aria-hidden="true" tabindex="-1" href="#performance-optimization-strategies"><span class="icon icon-link"></span></a>Performance Optimization Strategies</h2>
<h3 id="1-object-pool-pattern"><a aria-hidden="true" tabindex="-1" href="#1-object-pool-pattern"><span class="icon icon-link"></span></a>1. Object Pool Pattern</h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="javascript"><code><span class="line"><span style="color:#F97583">class</span><span style="color:#B392F0"> ObjectPool</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">    constructor</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">createFn</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">resetFn</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">initialSize</span><span style="color:#F97583"> =</span><span style="color:#79B8FF"> 10</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#79B8FF">        this</span><span style="color:#E1E4E8">.createFn </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> createFn;</span></span>
<span class="line"><span style="color:#79B8FF">        this</span><span style="color:#E1E4E8">.resetFn </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> resetFn;</span></span>
<span class="line"><span style="color:#79B8FF">        this</span><span style="color:#E1E4E8">.pool </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> [];</span></span>
<span class="line"><span style="color:#E1E4E8">        </span></span>
<span class="line"><span style="color:#6A737D">        // Pre-create objects</span></span>
<span class="line"><span style="color:#F97583">        for</span><span style="color:#E1E4E8"> (</span><span style="color:#F97583">let</span><span style="color:#E1E4E8"> i </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8">; i </span><span style="color:#F97583">&#x3C;</span><span style="color:#E1E4E8"> initialSize; i</span><span style="color:#F97583">++</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#79B8FF">            this</span><span style="color:#E1E4E8">.pool.</span><span style="color:#B392F0">push</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">this</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">createFn</span><span style="color:#E1E4E8">());</span></span>
<span class="line"><span style="color:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">    get</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#F97583">        if</span><span style="color:#E1E4E8"> (</span><span style="color:#79B8FF">this</span><span style="color:#E1E4E8">.pool.</span><span style="color:#79B8FF">length</span><span style="color:#F97583"> ></span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#F97583">            return</span><span style="color:#79B8FF"> this</span><span style="color:#E1E4E8">.pool.</span><span style="color:#B392F0">pop</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#F97583">        return</span><span style="color:#79B8FF"> this</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">createFn</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">    release</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">obj</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#79B8FF">        this</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">resetFn</span><span style="color:#E1E4E8">(obj);</span></span>
<span class="line"><span style="color:#79B8FF">        this</span><span style="color:#E1E4E8">.pool.</span><span style="color:#B392F0">push</span><span style="color:#E1E4E8">(obj);</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">// Usage example</span></span>
<span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> bulletPool</span><span style="color:#F97583"> =</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> ObjectPool</span><span style="color:#E1E4E8">(</span></span>
<span class="line"><span style="color:#E1E4E8">    () </span><span style="color:#F97583">=></span><span style="color:#F97583"> new</span><span style="color:#B392F0"> Bullet</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">null</span><span style="color:#E1E4E8">),</span></span>
<span class="line"><span style="color:#E1E4E8">    (</span><span style="color:#FFAB70">bullet</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> { bullet.active </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> false</span><span style="color:#E1E4E8">; },</span></span>
<span class="line"><span style="color:#79B8FF">    20</span></span>
<span class="line"><span style="color:#E1E4E8">);</span></span></code></pre>
<h3 id="2-rendering-optimization"><a aria-hidden="true" tabindex="-1" href="#2-rendering-optimization"><span class="icon icon-link"></span></a>2. Rendering Optimization</h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="javascript"><code><span class="line"><span style="color:#F97583">class</span><span style="color:#B392F0"> RenderOptimizer</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">    static</span><span style="color:#FFAB70"> dirtyRectangles</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> [];</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#F97583">    static</span><span style="color:#B392F0"> addDirtyRect</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">x</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">y</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">width</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">height</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#79B8FF">        this</span><span style="color:#E1E4E8">.dirtyRectangles.</span><span style="color:#B392F0">push</span><span style="color:#E1E4E8">({ x, y, width, height });</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#F97583">    static</span><span style="color:#B392F0"> clearDirtyRects</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">ctx</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#79B8FF">        this</span><span style="color:#E1E4E8">.dirtyRectangles.</span><span style="color:#B392F0">forEach</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">rect</span><span style="color:#F97583"> =></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">            ctx.</span><span style="color:#B392F0">clearRect</span><span style="color:#E1E4E8">(rect.x, rect.y, rect.width, rect.height);</span></span>
<span class="line"><span style="color:#E1E4E8">        });</span></span>
<span class="line"><span style="color:#79B8FF">        this</span><span style="color:#E1E4E8">.dirtyRectangles </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> [];</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#F97583">    static</span><span style="color:#B392F0"> isInViewport</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">obj</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">viewX</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">viewY</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">viewWidth</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">viewHeight</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#F97583">        return</span><span style="color:#E1E4E8"> obj.x </span><span style="color:#F97583">+</span><span style="color:#E1E4E8"> obj.width </span><span style="color:#F97583">>=</span><span style="color:#E1E4E8"> viewX </span><span style="color:#F97583">&#x26;&#x26;</span></span>
<span class="line"><span style="color:#E1E4E8">               obj.x </span><span style="color:#F97583">&#x3C;=</span><span style="color:#E1E4E8"> viewX </span><span style="color:#F97583">+</span><span style="color:#E1E4E8"> viewWidth </span><span style="color:#F97583">&#x26;&#x26;</span></span>
<span class="line"><span style="color:#E1E4E8">               obj.y </span><span style="color:#F97583">+</span><span style="color:#E1E4E8"> obj.height </span><span style="color:#F97583">>=</span><span style="color:#E1E4E8"> viewY </span><span style="color:#F97583">&#x26;&#x26;</span></span>
<span class="line"><span style="color:#E1E4E8">               obj.y </span><span style="color:#F97583">&#x3C;=</span><span style="color:#E1E4E8"> viewY </span><span style="color:#F97583">+</span><span style="color:#E1E4E8"> viewHeight;</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<h2 id="project-features"><a aria-hidden="true" tabindex="-1" href="#project-features"><span class="icon icon-link"></span></a>Project Features</h2>
<h3 id="1-single-file-architecture-advantages"><a aria-hidden="true" tabindex="-1" href="#1-single-file-architecture-advantages"><span class="icon icon-link"></span></a>1. Single-file Architecture Advantages</h3>
<ul>
<li><strong>Simple Deployment</strong>: Only one HTML file needed to run</li>
<li><strong>Zero Dependencies</strong>: No external libraries or frameworks required</li>
<li><strong>Easy Sharing</strong>: Convenient for code reading and learning</li>
<li><strong>Fast Loading</strong>: Reduced HTTP requests</li>
</ul>
<h3 id="2-classic-game-mechanics"><a aria-hidden="true" tabindex="-1" href="#2-classic-game-mechanics"><span class="icon icon-link"></span></a>2. Classic Game Mechanics</h3>
<ul>
<li><strong>Instant Response</strong>: Smooth real-time control experience</li>
<li><strong>Intelligent AI</strong>: Enemy tanks with basic tactical AI</li>
<li><strong>Progressive Difficulty</strong>: Multi-level difficulty escalation design</li>
<li><strong>Visual Feedback</strong>: Rich hit and explosion effects</li>
</ul>
<h3 id="3-extensible-design"><a aria-hidden="true" tabindex="-1" href="#3-extensible-design"><span class="icon icon-link"></span></a>3. Extensible Design</h3>
<ul>
<li><strong>Modular Code</strong>: Clear class structure for easy extension</li>
<li><strong>Event System</strong>: Support for custom game events</li>
<li><strong>Configuration-driven</strong>: Level data separated from logic</li>
</ul>
<h2 id="technical-insights"><a aria-hidden="true" tabindex="-1" href="#technical-insights"><span class="icon icon-link"></span></a>Technical Insights</h2>
<h3 id="canvas-2d-programming"><a aria-hidden="true" tabindex="-1" href="#canvas-2d-programming"><span class="icon icon-link"></span></a>Canvas 2D Programming</h3>
<ul>
<li>Mastered advanced usage of Canvas drawing API</li>
<li>Understood optimization strategies for game rendering loops</li>
<li>Learned graphic transformation and animation implementation</li>
</ul>
<h3 id="game-development-fundamentals"><a aria-hidden="true" tabindex="-1" href="#game-development-fundamentals"><span class="icon icon-link"></span></a>Game Development Fundamentals</h3>
<ul>
<li>Implemented complete game loop architecture</li>
<li>Designed efficient collision detection system</li>
<li>Built state management and AI decision system</li>
</ul>
<h3 id="performance-optimization-practice"><a aria-hidden="true" tabindex="-1" href="#performance-optimization-practice"><span class="icon icon-link"></span></a>Performance Optimization Practice</h3>
<ul>
<li>Applied memory management techniques like object pools</li>
<li>Implemented rendering optimizations like dirty rectangles</li>
<li>Balanced functional complexity with runtime efficiency</li>
</ul>
<h2 id="future-extension-directions"><a aria-hidden="true" tabindex="-1" href="#future-extension-directions"><span class="icon icon-link"></span></a>Future Extension Directions</h2>
<ol>
<li><strong>Multiplayer Mode</strong>: Local two-player battles</li>
<li><strong>Level Editor</strong>: Custom map functionality</li>
<li><strong>Power-up System</strong>: Weapon upgrades and special items</li>
<li><strong>Save Function</strong>: LocalStorage for game progress</li>
<li><strong>Mobile Adaptation</strong>: Touch controls and responsive design</li>
</ol>
<h2 id="summary"><a aria-hidden="true" tabindex="-1" href="#summary"><span class="icon icon-link"></span></a>Summary</h2>
<p>This HTML5 Canvas tank battle project successfully demonstrates the feasibility of developing complete games using native Web technologies. Through carefully designed architecture and efficient implementation strategies, it achieves rich game functionality while maintaining code simplicity.</p>
<p>The project is not only a tribute to classic games but also a practical application of modern Web game development technologies, providing a complete solution reference for lightweight game development.</p> </article> <html lang="en" data-astro-cid-uffxixac> <head><!-- Global Metadata --><meta charset="utf-8"><!--<meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">--><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.css"><link rel="shortcut icon" href="/favicon.png" type="image/png"><link rel="sitemap" href="/sitemap-index.xml"><link rel="alternate" type="application/rss+xml" title="Ge Yuxu • AI &#38; Engineering" href="https://geyuxu.com/rss.xml"><meta name="generator" content="Astro v5.5.6"><!-- Font preloads --><link rel="preload" href="/fonts/atkinson-regular.woff" as="font" type="font/woff" crossorigin><link rel="preload" href="/fonts/atkinson-bold.woff" as="font" type="font/woff" crossorigin><!-- Canonical URL --><link rel="canonical" href="https://geyuxu.com/blog/notes/html5-canvas-classic-tank-battle-game-development-single-file-game-architecture-practice/"><!-- Primary Meta Tags --><title>Ge Yuxu • AI &amp; Engineering</title><meta name="title" content="Ge Yuxu • AI &#38; Engineering"><meta name="description" content="Welcome to my blog!"><!-- Open Graph / Facebook --><meta property="og:type" content="website"><meta property="og:url" content="https://geyuxu.com/blog/notes/html5-canvas-classic-tank-battle-game-development-single-file-game-architecture-practice/"><meta property="og:title" content="Ge Yuxu • AI &#38; Engineering"><meta property="og:description" content="Welcome to my blog!"><meta property="og:image" content="https://geyuxu.com/blog-placeholder-1.jpg"><!-- Twitter --><meta property="twitter:card" content="summary_large_image"><meta property="twitter:url" content="https://geyuxu.com/blog/notes/html5-canvas-classic-tank-battle-game-development-single-file-game-architecture-practice/"><meta property="twitter:title" content="Ge Yuxu • AI &#38; Engineering"><meta property="twitter:description" content="Welcome to my blog!"><meta property="twitter:image" content="https://geyuxu.com/blog-placeholder-1.jpg"><script src="/js/jquery-3.7.1.min.js"></script></head> <body data-astro-cid-uffxixac>  <div class="statement" data-astro-cid-uffxixac> <blockquote data-astro-cid-uffxixac> <p data-astro-cid-uffxixac><strong data-astro-cid-uffxixac>脱敏说明</strong>：本文所有出现的表名、字段名、接口地址、变量名、IP地址及示例数据等均非真实，
    仅用于阐述技术思路与实现步骤，示例代码亦非公司真实代码。
    示例方案亦非公司真实完整方案，仅为本人记忆总结，用于技术学习探讨。<br data-astro-cid-uffxixac>
&nbsp;&nbsp;&nbsp;&nbsp;•&nbsp;文中所示任何标识符并不对应实际生产环境中的名称或编号。<br data-astro-cid-uffxixac>
&nbsp;&nbsp;&nbsp;&nbsp;•&nbsp;示例&nbsp;SQL、脚本、代码及数据等均为演示用途，不含真实业务数据，也不具备直接运行或复现的完整上下文。<br data-astro-cid-uffxixac>
&nbsp;&nbsp;&nbsp;&nbsp;•&nbsp;读者若需在实际项目中参考本文方案，请结合自身业务场景及数据安全规范，使用符合内部命名和权限控制的配置。</p> <p data-astro-cid-uffxixac><strong data-astro-cid-uffxixac>版权声明</strong>：本文版权归原作者所有，未经作者事先书面许可，任何单位或个人不得以任何方式复制、转载、摘编或用于商业用途。<br data-astro-cid-uffxixac>
&nbsp;&nbsp;&nbsp;&nbsp;•&nbsp;若需非商业性引用或转载本文内容，请务必注明出处并保持内容完整。<br data-astro-cid-uffxixac>
&nbsp;&nbsp;&nbsp;&nbsp;•&nbsp;对因商业使用、篡改或不当引用本文内容所产生的法律纠纷，作者保留追究法律责任的权利。<br data-astro-cid-uffxixac><br data-astro-cid-uffxixac> <em data-astro-cid-uffxixac>Copyright&nbsp;©&nbsp;1989–Present&nbsp;Ge&nbsp;Yuxu.&nbsp;All&nbsp;Rights&nbsp;Reserved.</em></p> </blockquote> </div></body></html>  </article> </div> </main> <footer data-astro-cid-sz7xmlte>
&copy; 2025 All rights reserved.
</footer>  </body></html>