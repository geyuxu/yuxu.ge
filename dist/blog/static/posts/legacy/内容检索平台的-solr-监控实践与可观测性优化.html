<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å†…å®¹æ£€ç´¢å¹³å°çš„ Solr ç›‘æ§å®è·µä¸å¯è§‚æµ‹æ€§ä¼˜åŒ– | Yuxu Ge</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1/themes/prism-tomorrow.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    <style>
        :root {
            --black: #111;
            --dark-grey: #444;
            --off-white: #f4f4f4;
            --vermilion: #C41E3A;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            font-size: 16px;
            scroll-behavior: smooth;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            line-height: 1.6;
            color: var(--black);
            background-color: var(--off-white);
        }

        a {
            color: var(--vermilion);
            text-decoration: none;
        }

        a:hover {
            opacity: 0.75;
        }

        .layout {
            min-height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            position: fixed;
            top: 0;
            left: 0;
            width: 320px;
            height: 100vh;
            background: var(--black);
            color: var(--off-white);
            padding: 3rem 2rem;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .sidebar-top {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
        }

        .avatar {
            display: block;
            width: 120px;
            height: 120px;
            border-radius: 50%;
            border: 3px solid var(--vermilion);
            margin-bottom: 1.5rem;
            overflow: hidden;
            transition: transform 0.2s ease;
        }

        .avatar:hover {
            opacity: 1;
            transform: scale(1.05);
        }

        .avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .name-block {
            margin-bottom: 0.5rem;
        }

        h1 {
            font-size: 1.8rem;
            font-weight: 700;
            letter-spacing: 1px;
            color: var(--off-white);
        }

        .title-role {
            font-size: 0.9rem;
            color: #888;
            margin-top: 0.25rem;
            font-weight: 400;
        }

        .contact-block {
            margin-top: 2.5rem;
            width: 100%;
        }

        .social-links {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.75rem;
        }

        .social-links a {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            width: 160px;
            color: var(--off-white);
            opacity: 0.7;
            padding: 0.5rem 0.75rem;
            border-radius: 4px;
            font-size: 0.9rem;
            transition: all 0.2s;
        }

        .social-links a:hover {
            color: var(--vermilion);
            opacity: 1;
            background: rgba(255, 255, 255, 0.05);
        }

        .social-links svg {
            width: 20px;
            height: 20px;
            flex-shrink: 0;
        }

        .social-links .orcid-link {
            font-size: 0.68rem;
            gap: 0.5rem;
            white-space: nowrap;
        }

        .sidebar-footer {
            text-align: center;
            font-size: 0.75rem;
            color: #555;
        }

        /* Content */
        .content {
            margin-left: 320px;
            padding: 3rem 4rem;
            max-width: calc(100vw - 320px - 8rem);
        }

        .back-link {
            display: inline-block;
            font-size: 0.85rem;
            margin-bottom: 2rem;
            color: var(--dark-grey);
        }

        .back-link:hover {
            color: var(--vermilion);
        }

        /* Article */
        article h1 {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 1.5rem;
            line-height: 1.3;
            color: var(--black);
        }

        article h2 {
            font-size: 1.4rem;
            font-weight: 600;
            margin: 2rem 0 1rem;
            color: var(--black);
        }

        article h3 {
            font-size: 1.1rem;
            font-weight: 600;
            margin: 1.5rem 0 0.75rem;
            color: var(--black);
        }

        article p {
            margin-bottom: 1rem;
            color: var(--dark-grey);
        }

        article ul,
        article ol {
            margin: 1rem 0 1rem 1.5rem;
            color: var(--dark-grey);
        }

        article li {
            margin-bottom: 0.5rem;
        }

        article strong {
            color: var(--black);
        }

        article code {
            font-family: "SF Mono", Monaco, monospace;
            font-size: 0.9em;
            background: #e8e8e8;
            padding: 0.15em 0.4em;
            border-radius: 3px;
        }

        article pre {
            margin: 1rem 0;
            border-radius: 6px;
            overflow-x: auto;
            background: #2d2d2d;
            padding: 1rem;
        }

        article pre code {
            background: none;
            padding: 0;
            font-size: 0.75em;
            white-space: pre !important;
            counter-reset: line;
            display: block;
            color: #ccc;
        }

        article pre code .line {
            counter-increment: line;
        }

        article pre code .line::before {
            content: counter(line);
            display: inline-block;
            width: 2.5em;
            margin-right: 1em;
            text-align: right;
            color: #666;
            user-select: none;
        }

        .code-toolbar {
            display: flex;
            justify-content: flex-start;
            padding: 0.35rem 0.5rem;
            background: #3a3a3a;
            border-radius: 6px 6px 0 0;
        }

        .code-toolbar+pre {
            margin-top: 0;
            border-radius: 0 0 6px 6px;
        }

        .copy-btn {
            padding: 0.2rem 0.5rem;
            font-size: 0.7rem;
            background: #555;
            color: #fff;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .copy-btn:hover,
        .copy-btn:active {
            background: #777;
        }

        .copy-btn.copied {
            background: #2a2;
        }

        article blockquote {
            border-left: 3px solid var(--vermilion);
            padding-left: 1rem;
            margin: 1rem 0;
            color: #666;
            font-style: italic;
        }

        article hr {
            border: none;
            border-top: 1px solid #ddd;
            margin: 2rem 0;
        }

        article table {
            width: 100%;
            border-collapse: collapse;
            margin: 1rem 0;
            font-size: 0.9rem;
        }

        article th,
        article td {
            border: 1px solid #ddd;
            padding: 0.5rem 0.75rem;
            text-align: left;
        }

        article th {
            background: #e8e8e8;
            font-weight: 600;
        }

        article img {
            max-width: 100%;
            height: auto;
            display: block;
            margin: 1.5rem 0;
            border-radius: 6px;
        }

        .loading {
            text-align: center;
            padding: 3rem;
            color: #888;
        }

        .error {
            color: var(--vermilion);
        }

        /* Language Selector */
        .lang-selector {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
            padding: 0.75rem 1rem;
            background: #fff;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            font-size: 0.85rem;
        }

        .lang-selector-label {
            color: #666;
            display: flex;
            align-items: center;
            gap: 0.35rem;
        }

        .lang-selector-label svg {
            width: 16px;
            height: 16px;
        }

        .lang-select {
            padding: 0.4rem 0.75rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            background: white;
            font-size: 0.85rem;
            cursor: pointer;
            min-width: 140px;
        }

        .lang-select:focus {
            outline: none;
            border-color: var(--vermilion);
        }

        .lang-status {
            font-size: 0.8rem;
            color: #888;
            margin-left: auto;
        }

        .lang-status.translating {
            color: var(--vermilion);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .lang-status.translating::before {
            content: '';
            width: 14px;
            height: 14px;
            border: 2px solid #f0f0f0;
            border-top-color: var(--vermilion);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .lang-status.cached {
            color: #4CAF50;
        }

        .lang-original-btn {
            padding: 0.35rem 0.6rem;
            font-size: 0.75rem;
            background: #f0f0f0;
            border: 1px solid #ddd;
            border-radius: 4px;
            cursor: pointer;
            color: #666;
            transition: all 0.2s;
        }

        .lang-original-btn:hover {
            background: #e0e0e0;
            color: #333;
        }

        @media (max-width: 600px) {
            .lang-selector {
                flex-wrap: wrap;
            }
            .lang-status {
                width: 100%;
                margin-left: 0;
                margin-top: 0.5rem;
            }
        }

        /* KaTeX math styles */
        .katex-display {
            overflow-x: auto;
            overflow-y: hidden;
            padding: 0.5rem 0;
        }

        .katex {
            font-size: 1.1em;
        }

        /* Jupyter Notebook Styles */
        .notebook-container {
            margin-top: 1rem;
        }

        .notebook-download {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            margin-bottom: 1.5rem;
            background: var(--black);
            color: var(--off-white);
            border-radius: 4px;
            font-size: 0.85rem;
            transition: opacity 0.2s;
        }

        .notebook-download:hover {
            opacity: 0.8;
            color: var(--off-white);
        }

        .notebook-download svg {
            width: 16px;
            height: 16px;
        }

        .nb-cell {
            margin-bottom: 1.5rem;
        }

        .nb-cell-code .nb-source {
            background: #2d2d2d;
            border-radius: 6px;
            overflow-x: auto;
        }

        .nb-cell-code .nb-source pre {
            margin: 0;
            padding: 1rem;
            color: #ccc;
            font-family: "SF Mono", Monaco, monospace;
            font-size: 0.85em;
        }

        .nb-cell-code .nb-source code {
            background: none;
            padding: 0;
        }

        .nb-output {
            background: #fff;
            border: 1px solid #ddd;
            border-radius: 6px;
            padding: 0.75rem;
            margin-top: 0.5rem;
        }

        .nb-output pre {
            margin: 0;
            padding: 0;
            background: transparent;
            white-space: pre-wrap;
            word-wrap: break-word;
            font-family: "SF Mono", Monaco, monospace;
            font-size: 0.85em;
            color: #222;
        }

        .nb-output img {
            max-width: 100%;
            height: auto;
            display: block;
            margin: 0.5rem 0;
        }

        .nb-output table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9rem;
        }

        .nb-output th,
        .nb-output td {
            border: 1px solid #ddd;
            padding: 0.5rem;
            text-align: left;
        }

        .nb-output th {
            background: #e8e8e8;
            font-weight: 600;
        }

        .nb-cell-markdown {
            padding: 0;
        }

        .nb-cell-markdown h1:first-child {
            margin-top: 0;
        }

        /* Document Download Button */
        .doc-download {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            margin-bottom: 1.5rem;
            background: var(--black);
            color: var(--off-white);
            border-radius: 4px;
            font-size: 0.85rem;
            transition: opacity 0.2s;
        }

        .doc-download:hover {
            opacity: 0.8;
            color: var(--off-white);
        }

        .doc-download svg {
            width: 16px;
            height: 16px;
        }

        /* PDF Viewer */
        .pdf-container {
            margin-top: 1rem;
        }

        .pdf-viewer {
            width: 100%;
            height: 80vh;
            border: 1px solid #ddd;
            border-radius: 6px;
            background: #f5f5f5;
        }

        /* Text File Display */
        .text-container {
            margin-top: 1rem;
        }

        .text-content {
            background: #fff;
            border: 1px solid #ddd;
            border-radius: 6px;
            padding: 1.5rem;
            font-family: "SF Mono", Monaco, monospace;
            font-size: 0.9em;
            line-height: 1.6;
            white-space: pre-wrap;
            word-wrap: break-word;
            color: var(--dark-grey);
            max-height: 80vh;
            overflow-y: auto;
        }

        /* Word Document Display */
        .word-container {
            margin-top: 1rem;
        }

        .word-content {
            background: #fff;
            border: 1px solid #ddd;
            border-radius: 6px;
            padding: 2rem;
            line-height: 1.8;
            color: var(--dark-grey);
        }

        .word-content p {
            margin-bottom: 1rem;
        }

        .word-content h1,
        .word-content h2,
        .word-content h3 {
            color: var(--black);
            margin: 1.5rem 0 1rem;
        }

        .word-content table {
            width: 100%;
            border-collapse: collapse;
            margin: 1rem 0;
        }

        .word-content th,
        .word-content td {
            border: 1px solid #ddd;
            padding: 0.5rem;
        }

        .word-content img {
            max-width: 100%;
            height: auto;
        }

        /* Excel Display */
        .excel-container {
            margin-top: 1rem;
        }

        .excel-tabs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }

        .excel-tab {
            padding: 0.5rem 1rem;
            background: #e8e8e8;
            border: none;
            border-radius: 4px 4px 0 0;
            cursor: pointer;
            font-size: 0.85rem;
        }

        .excel-tab.active {
            background: #4CAF50;
            color: white;
        }

        .excel-content {
            background: #fff;
            border: 1px solid #ddd;
            border-radius: 6px;
            overflow-x: auto;
            max-height: 70vh;
            overflow-y: auto;
        }

        .excel-content table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.85rem;
        }

        .excel-content th,
        .excel-content td {
            border: 1px solid #ddd;
            padding: 0.4rem 0.6rem;
            text-align: left;
            white-space: nowrap;
        }

        .excel-content th {
            background: #f5f5f5;
            font-weight: 600;
            position: sticky;
            top: 0;
        }

        .excel-content tr:nth-child(even) {
            background: #fafafa;
        }

        /* PowerPoint Display */
        .ppt-container {
            margin-top: 1rem;
        }

        .ppt-viewer {
            width: 100%;
            height: 80vh;
            border: 1px solid #ddd;
            border-radius: 6px;
            background: #f5f5f5;
        }

        /* CSV Display (uses excel styles) */
        .csv-container {
            margin-top: 1rem;
        }

        /* Responsive */
        @media (max-width: 900px) {
            .sidebar {
                position: relative;
                width: 100%;
                height: auto;
                padding: 2rem 1.5rem 1rem;
            }

            .social-links {
                flex-direction: row;
                flex-wrap: wrap;
                justify-content: center;
            }

            .social-links a,
            .social-links .orcid-link {
                width: auto;
                padding: 0.5rem;
                font-size: 0;
                gap: 0;
            }

            .social-links svg {
                width: 24px;
                height: 24px;
            }

            .social-links .hide-mobile {
                display: none;
            }

            .sidebar-footer {
                margin-top: 1rem;
            }

            .content {
                margin-left: 0;
                padding: 2rem 1rem;
            }
        }

        @media (max-width: 480px) {
            .sidebar {
                padding: 1.5rem 1rem 1rem;
            }

            .avatar {
                width: 80px;
                height: 80px;
            }

            h1 {
                font-size: 1.4rem;
            }

            article h1 {
                font-size: 1.5rem;
            }
        }
    </style>
</head>

<body>

    <div class="layout">
        <aside class="sidebar" id="sidebar-content"></aside>
        <script src="/components/sidebar.js?v=20260128"></script>

        <main class="content">
            <a href="/blog/" class="back-link">â† Back to Blog</a>

            <!-- Language Selector -->
            <div class="lang-selector" id="lang-selector" style="display: none;">
                <span class="lang-selector-label">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5h12M9 3v2m1.048 9.5A18.022 18.022 0 016.412 9m6.088 9h7M11 21l5-10 5 10M12.751 5C11.783 10.77 8.07 15.61 3 18.129" />
                    </svg>
                    Language
                </span>
                <select class="lang-select" id="lang-select">
                    <option value="en">ğŸ‡ºğŸ‡¸ English</option>
                    <option value="zh">ğŸ‡¨ğŸ‡³ ä¸­æ–‡</option>
                    <option value="ja">ğŸ‡¯ğŸ‡µ æ—¥æœ¬èª</option>
                    <option value="ko">ğŸ‡°ğŸ‡· í•œêµ­ì–´</option>
                    <option value="es">ğŸ‡ªğŸ‡¸ EspaÃ±ol</option>
                    <option value="fr">ğŸ‡«ğŸ‡· FranÃ§ais</option>
                    <option value="de">ğŸ‡©ğŸ‡ª Deutsch</option>
                    <option value="pt">ğŸ‡µğŸ‡¹ PortuguÃªs</option>
                    <option value="ru">ğŸ‡·ğŸ‡º Ğ ÑƒÑÑĞºĞ¸Ğ¹</option>
                    <option value="ar">ğŸ‡¸ğŸ‡¦ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option>
                </select>
                <button class="lang-original-btn" id="lang-original-btn" style="display: none;">Show Original</button>
                <span class="lang-status" id="lang-status"></span>
            </div>

            <article>
<hr>
<h2>date: 2019-10-24
tags: [search]
legacy: true</h2>
<h1>å†…å®¹æ£€ç´¢å¹³å°çš„ Solr ç›‘æ§å®è·µä¸å¯è§‚æµ‹æ€§ä¼˜åŒ–</h1>
<p>åœ¨å†…å®¹æœç´¢ç³»ç»Ÿä¸­ï¼ŒSolr çš„æ€§èƒ½å’Œç¨³å®šæ€§è‡³å…³é‡è¦ï¼Œç›‘æ§ Solr çš„å„é¡¹æŒ‡æ ‡èƒ½å¸®åŠ©æˆ‘ä»¬åŠæ—¶å‘ç°é—®é¢˜å¹¶ä¼˜åŒ–æœåŠ¡è¡¨ç°ã€‚æˆ‘ä»¬é€šå¸¸é€šè¿‡ Prometheus æ”¶é›† Solr æŒ‡æ ‡ï¼ˆä½¿ç”¨ Solr å®˜æ–¹çš„ solr-prometheus-exporterï¼‰ï¼Œå¹¶ç”¨ Grafana å¯è§†åŒ–ã€‚solr-prometheus-exporter å°† Solr çš„å†…éƒ¨æŒ‡æ ‡è½¬æ¢ä¸º Prometheus æ ¼å¼ï¼ŒåŒ…æ‹¬æ ¸å¿ƒï¼ˆcoreï¼‰çº§åˆ«çš„ç»Ÿè®¡å’Œ JVM çŠ¶æ€ç­‰ã€‚ä¸ºæ–¹ä¾¿è®¨è®ºï¼Œæˆ‘ä»¬å…ˆå®šä¹‰ä¸€äº›ç®€åŒ–çš„æŒ‡æ ‡åç§°ï¼š</p>
<ul>
<li>search_latency â€“ æœç´¢è¯·æ±‚å»¶è¿Ÿï¼Œå¦‚æŸ¥è¯¢è¯·æ±‚çš„å¹³å‡å“åº”æ—¶é—´æˆ– P95 å»¶è¿Ÿï¼ˆ95% åˆ†ä½å“åº”æ—¶é—´ï¼‰ã€‚</li>
<li>search_rate â€“ æœç´¢ååç‡ï¼Œé€šå¸¸ç”¨æ¯ç§’æŸ¥è¯¢æ•°ï¼ˆQPSï¼‰è¡¡é‡ã€‚</li>
<li>index_size â€“ ç´¢å¼•å¤§å°ï¼ˆå­—èŠ‚ï¼‰ï¼Œè¡¨ç¤ºå†…å®¹ç´¢å¼•åœ¨ç£ç›˜ä¸Šå ç”¨çš„ç©ºé—´ã€‚</li>
<li>doc_count â€“ æ–‡æ¡£æ•°é‡ï¼Œå·²ç´¢å¼•çš„å†…å®¹æ¡ç›®æ•°é‡ã€‚</li>
<li>gc_time â€“ GC è€—æ—¶ï¼ŒJVM åƒåœ¾å›æ”¶æš‚åœæ—¶é—´ï¼ˆå¦‚æ€»è€—æ—¶æˆ–æœ€è¿‘ä¸€æ¬¡ GC è€—æ—¶ï¼‰ã€‚</li>
<li>cpu_load â€“ CPU è´Ÿè½½ï¼ŒSolræœåŠ¡å™¨çš„CPUä½¿ç”¨ç‡æˆ–è´Ÿè½½æŒ‡æ•°ã€‚</li>
<li>mem_usage â€“ å†…å­˜ä½¿ç”¨ï¼Œç‰¹åˆ«æ˜¯ JVM å †å†…å­˜ä½¿ç”¨é‡ã€‚</li>
</ul>
<p>è¿™äº›æŒ‡æ ‡å¯¹åº”ç€å…³é”®é—®é¢˜ï¼šæŸ¥è¯¢å¿«ä¸å¿«ï¼Ÿè´Ÿè½½é«˜ä¸é«˜ï¼Ÿç´¢å¼•æ˜¯å¦æ­£å¸¸å¢é•¿ï¼ŸSolr å®ä¾‹æœ¬èº«æ˜¯å¦å¥åº·ï¼Ÿ</p>
<p>Solr æŒ‡æ ‡åˆ†ç±»ï¼š Solrï¼ˆå°¤å…¶æ˜¯ SolrCloud æ¨¡å¼ï¼‰æä¾›åˆ†é—¨åˆ«ç±»çš„æŒ‡æ ‡ï¼Œå¹¶å¸¦æœ‰ collectionã€shardã€replica ç­‰æ ‡ç­¾ç”¨äºåŒºåˆ†ã€‚æ¯”å¦‚ï¼Œsearch_latency åœ¨åº•å±‚å¯èƒ½å¯¹åº” Prometheus æŒ‡æ ‡ solr_metrics_core_time_seconds_totalï¼ˆæŸ¥è¯¢å¤„ç†ç´¯è®¡è€—æ—¶ï¼‰å’Œ solr_metrics_core_requests_totalï¼ˆæŸ¥è¯¢è¯·æ±‚æ€»æ¬¡æ•°ï¼‰ã€‚åˆ©ç”¨è¿™ä¸¤ä¸ªè®¡æ•°å™¨ï¼Œæˆ‘ä»¬å¯ä»¥è®¡ç®—å¹³å‡æŸ¥è¯¢å»¶è¿Ÿï¼š</p>
<p>å¹³å‡å»¶è¿Ÿ = $\frac{\Delta \text{time_seconds_total}}{\Delta \text{requests_total}}$</p>
<p>ç”¨ PromQL è¡¨è¾¾å³ï¼š</p>
<blockquote><code>increase(solr_metrics_core_time_seconds_total[5m])</code><br>
<code>/ increase(solr_metrics_core_requests_total[5m])</code></blockquote><p>è¿™ä¼šå¾—åˆ°è¿‡å» 5 åˆ†é’Ÿå†…æŸ¥è¯¢çš„å¹³å‡è€—æ—¶ã€‚ç„¶è€Œï¼Œä»…çœ‹å¹³å‡å€¼ä¼šæ©ç›–éƒ¨åˆ†æ…¢è¯·æ±‚çš„å½±å“ï¼Œè¿™å°±éœ€è¦å…³æ³¨ P95 å»¶è¿Ÿï¼ˆ95% åˆ†ä½æ•°å»¶è¿Ÿï¼‰ã€‚</p>
<p>P95 å»¶è¿ŸåŸç†ï¼š P95 è¡¨ç¤º 95% çš„è¯·æ±‚åœ¨è¯¥æ—¶é—´å†…å®Œæˆï¼Œè¿˜æœ‰ 5% æ›´æ…¢ã€‚å®ƒåˆ»ç”»äº†è¾ƒå·®ç”¨æˆ·ä½“éªŒçš„é˜ˆå€¼ï¼Œä¹Ÿæ˜¯è¡¡é‡å°¾éƒ¨æ€§èƒ½çš„é‡è¦æŒ‡æ ‡ã€‚è¦åœ¨ Prometheus ä¸­è®¡ç®— P95ï¼Œé€šå¸¸éœ€è¦ histogram ç±»å‹çš„æŒ‡æ ‡ã€‚å‡è®¾ search_latency æä¾›äº†ç›´æ–¹å›¾æ•°æ®ï¼ˆæŒ‰è€—æ—¶åˆ†æ¡¶ï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ PromQL çš„ histogram_quantile å‡½æ•°ï¼Œä¾‹å¦‚ï¼š</p>
<p><code>histogram_quantile(0.95, sum(rate(search_latency_bucket[5m])) by (le))</code></p><p>è¿™å°†è®¡ç®—è¿‡å»5åˆ†é’Ÿå†…æŸ¥è¯¢å»¶è¿Ÿçš„95åˆ†ä½å€¼ã€‚å¦‚æœ Solr çš„å¯¼å‡ºå™¨æœªé…ç½®è¾“å‡ºç›´æ–¹å›¾ï¼Œæˆ‘ä»¬åªæœ‰ä¸Šè¿°æ€»è€—æ—¶å’Œæ¬¡æ•°è®¡æ•°å™¨ï¼Œé‚£ä¹ˆåªèƒ½ç®—å¹³å‡å€¼ï¼Œæ— æ³•ç›´æ¥å¾—å‡º P95ã€‚è¿™ç§æƒ…å†µä¸‹å»ºè®®è°ƒæ•´å¯¼å‡ºå™¨é…ç½®é‡‡é›†åˆ†ä½ä¿¡æ¯ï¼Œæˆ–åˆ©ç”¨ Solr è‡ªèº«çš„ç»Ÿè®¡ï¼ˆSolr Metrics API æä¾›ä¸€äº›åˆ†ä½å€¼ï¼‰ã€‚ç†è§£å¹³å‡å€¼å’Œ P95 çš„åŒºåˆ«éå¸¸é‡è¦ï¼šå¹³å‡å“åº”æ—¶é—´ä¹Ÿè®¸åªæœ‰100msï¼Œä½†P95å¯èƒ½é«˜è¾¾500msâ€”â€”æ„å‘³å°‘æ•°è¯·æ±‚å¾ˆæ…¢ã€‚å¦‚æœåªçœ‹å¹³å‡å€¼ï¼Œä¼šè¯¯ä»¥ä¸ºâ€œä¸€åˆ‡æ­£å¸¸â€ï¼Œè€Œå®é™…ä¸Šéƒ¨åˆ†ç”¨æˆ·åœ¨å¿å—é«˜å»¶è¿Ÿã€‚</p>
<p>ç´¢å¼•ä¸ç³»ç»ŸæŒ‡æ ‡ï¼š é™¤äº†æŸ¥è¯¢æ€§èƒ½ï¼Œç´¢å¼•è§„æ¨¡å’Œç³»ç»Ÿèµ„æºåŒæ ·è¦ç›‘æ§ã€‚index_size çš„å˜åŒ–ä½“ç°ç´¢å¼•æ•°æ®é‡çš„å¢é•¿ï¼Œè¿‡å¿«å¢é•¿å¯èƒ½å½±å“æŸ¥è¯¢æ€§èƒ½æˆ–è€—å°½ç£ç›˜ç©ºé—´ï¼›doc_count å¯ä»¥éªŒè¯ç´¢å¼•æ˜¯å¦æŒç»­å¢åŠ ã€æœ‰æ²¡æœ‰é˜»å¡ã€‚ç³»ç»Ÿå±‚é¢æŒ‡æ ‡å¦‚ cpu_loadã€mem_usage ä»¥åŠ gc_time åæ˜ Solræ‰€åœ¨ä¸»æœºçš„å¥åº·åº¦ã€‚ä¾‹å¦‚ï¼Œè‹¥å‘ç° gc_time æŒç»­å‡é«˜ï¼Œè¯´æ˜ JVM åƒåœ¾å›æ”¶é¢‘ç¹ä¸”è€—æ—¶é•¿ï¼Œå¯èƒ½å¯¼è‡´æŸ¥è¯¢åœé¡¿ç”šè‡³æ½œåœ¨å†…å­˜æ³„æ¼é£é™©ã€‚CPU è´Ÿè½½è¿‡é«˜åˆ™å¯èƒ½ä½¿æŸ¥è¯¢å»¶è¿Ÿé™¡å¢æˆ–ååä¸‹é™ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥å°† Solr æŒ‡æ ‡å¤§è‡´åˆ†ä¸ºå‡ ç±»ï¼Œå¹¶å…³æ³¨å„è‡ªçš„æ„ä¹‰ï¼š</p>
<ul>
<li>æŸ¥è¯¢æ€§èƒ½ï¼šç›‘æ§ search_rateï¼ˆQPSï¼‰ã€search_latency å¹³å‡å€¼ä»¥åŠé«˜åˆ†ä½ï¼ˆå¦‚ P95/P99ï¼‰ã€‚ç¡®ä¿å¤§éƒ¨åˆ†æŸ¥è¯¢éƒ½åœ¨å¯æ¥å—æ—¶é—´å†…å®Œæˆï¼Œä¸”é«˜å³°æœŸæœåŠ¡æ‰›å¾—ä½ã€‚</li>
<li>ç´¢å¼•æƒ…å†µï¼šç›‘æ§ index_size å’Œ doc_count çš„è¶‹åŠ¿ï¼Œäº†è§£ç´¢å¼•æ˜¯å¦æŒ‰é¢„æœŸå¢é•¿ï¼Œæœ‰æ— å¼‚å¸¸æ¿€å¢æˆ–åœæ»ã€‚ç´¢å¼•å¤§å°ä¹Ÿå½±å“æ£€ç´¢é€Ÿåº¦å’Œèµ„æºå ç”¨ã€‚</li>
<li>ç³»ç»Ÿèµ„æºï¼šç›‘æ§ cpu_loadã€mem_usageã€gc_time ç­‰ JVM/æ“ä½œç³»ç»ŸæŒ‡æ ‡ï¼Œç¡®ä¿ Solr è¿è¡Œç¯å¢ƒå……è¶³ç¨³å®šï¼ˆCPU ä¸é•¿æ—¶é—´100%ï¼Œå†…å­˜ä¸é¢‘ç¹è§¦é¡¶è§¦å‘ Full GC ç­‰ï¼‰ã€‚</li>
<li>é›†ç¾¤çŠ¶æ€ï¼šå¦‚æœä½¿ç”¨ SolrCloudï¼Œå…³æ³¨é›†ç¾¤çš„èŠ‚ç‚¹/åˆ†ç‰‡çŠ¶æ€ã€‚Solr å¯¼å‡ºå™¨æä¾›è¯¸å¦‚ solr_collections_shard_stateã€solr_collections_replica_state è¿™ç±»æŒ‡æ ‡æ¥è·Ÿè¸ª shard æ˜¯å¦ä¸º â€œACTIVEâ€ çŠ¶æ€ã€å‰¯æœ¬æ˜¯å¦ down æ‰ç­‰ã€‚é€šè¿‡è¿™äº›å¯ä»¥åŠæ—¶å‘ç°é›†ç¾¤ä¸­æŸä¸ªèŠ‚ç‚¹å¼‚å¸¸æˆ–å‰¯æœ¬åŒæ­¥è½åã€‚</li>
</ul>
<p>æŒæ¡äº†æŒ‡æ ‡ç»“æ„å’Œå«ä¹‰ï¼Œæˆ‘ä»¬å°±æœ‰äº†ç›‘æ§ Solr çš„åŸºç¡€ã€‚æ¥ä¸‹æ¥çœ‹çœ‹å¦‚ä½•ç»“åˆä»£ç å’Œå·¥å…·æ¥åˆ©ç”¨è¿™äº›æŒ‡æ ‡ã€‚</p>
<h2>Python ç¤ºä¾‹ä»£ç </h2>
<p>ç›‘æ§ä¸ä»…ä»…æ˜¯çœ‹å›¾è¡¨ï¼Œæœ‰æ—¶æˆ‘ä»¬éœ€è¦ç¼–å†™è„šæœ¬åšè‡ªåŠ¨æ£€æŸ¥æˆ–æ•°æ®åˆ†æã€‚ä¸‹é¢é€šè¿‡ä¸¤ä¸ªç®€å•çš„ Python è„šæœ¬ç¤ºä¾‹ï¼Œå±•ç¤ºå¦‚ä½•è¿›è¡Œ Solr å¥åº·æ£€æŸ¥å’ŒæŒ‡æ ‡è¶‹åŠ¿ç»Ÿè®¡ã€‚è¿™äº›ç¤ºä¾‹ä½¿ç”¨ requests åº“ä¸ Solr å’Œ Prometheus äº¤äº’ã€‚</p>
<h3>Solr å¥åº·æ£€æŸ¥è„šæœ¬</h3>
<p>é¦–å…ˆï¼Œä¸€ä¸ªåŸºæœ¬çš„å¥åº·æ£€æŸ¥è„šæœ¬ï¼Œç”¨äºéªŒè¯ Solr æ˜¯å¦æ­£å¸¸å“åº”ã€‚Solr æä¾›äº† ping æ¥å£ï¼ˆ/admin/pingï¼‰ï¼Œå¯ä»¥è¿”å›å½“å‰ core çš„çŠ¶æ€ã€‚å¦‚æœ core æ­£å¸¸ä¼šè¿”å› â€œOKâ€ã€‚æˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸€ç‚¹ï¼š</p>
<blockquote><code>import requests</code><br>
<code></code><br>
<code>solr_url = &quot;http://&lt;Solrä¸»æœº&gt;:8983/solr/&lt;collection&gt;/admin/ping?wt=json&quot;</code><br>
<code>try:</code><br>
<code>    response = requests.get(solr_url, timeout=5)</code><br>
<code>    data = response.json()</code><br>
<code>    if response.status_code == 200 and data.get(&quot;status&quot;) == &quot;OK&quot;:</code><br>
<code>        print(&quot;Solr æ ¸å¿ƒæ­£å¸¸ï¼šPING çŠ¶æ€ OK&quot;)</code><br>
<code>    else:</code><br>
<code>        print(&quot;Solr æ ¸å¿ƒå¥åº·æ£€æŸ¥å¤±è´¥ï¼è¿”å›:&quot;, data)</code><br>
<code>except requests.RequestException as e:</code><br>
<code>    print(&quot;Solr å¥åº·æ£€æŸ¥å‡ºç°å¼‚å¸¸ï¼š&quot;, e)</code></blockquote><p>å°† &lt;Solrä¸»æœº&gt; å’Œ <collection> æ›¿æ¢ä¸ºå®é™… Solr æœåŠ¡åœ°å€å’Œé›†åˆåç§°ã€‚è„šæœ¬å‘ Solr çš„ ping æ¥å£å‘é€ HTTP GET è¯·æ±‚ï¼Œå¹¶æ£€æŸ¥è¿”å›çš„ JSON ä¸­çŠ¶æ€æ˜¯å¦ä¸º OKã€‚å¦‚æœ Solr åœ¨ 5 ç§’å†…æœªå“åº”æˆ–è¿”å›äº†éæ­£å¸¸ç»“æœï¼Œè„šæœ¬ä¼šæ‰“å°å‡ºå¤±è´¥ä¿¡æ¯æˆ–å¼‚å¸¸ã€‚</p>
<p>è¿™ç§å¥åº·æ£€æŸ¥è„šæœ¬å¯ä»¥å®šæœŸè¿è¡Œï¼ˆæ¯”å¦‚ç”¨ cron æ¯éš”å‡ åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡ï¼‰ã€‚ç»“åˆæŠ¥è­¦ç³»ç»Ÿï¼Œå½“è„šæœ¬æ£€æµ‹åˆ°å¼‚å¸¸æ—¶è§¦å‘å‘Šè­¦ï¼ˆæˆ–è€…ç›´æ¥åœ¨è„šæœ¬ä¸­å‘é‚®ä»¶/å¾®ä¿¡æé†’ï¼‰ã€‚ç›¸æ¯” Prometheus ä¸»åŠ¨æ‹‰å–ï¼Œè¿™ç§ç›´æ¥æ£€æŸ¥ä»å®¢æˆ·ç«¯è§†è§’éªŒè¯äº† Solr çš„å¯ç”¨æ€§ï¼Œæ˜¯ä¸€ç§å¾ˆå¥½çš„è¡¥å……ã€‚ä¾‹å¦‚ï¼ŒPrometheus å¯èƒ½æ¯åˆ†é’ŸæŠ“å–ä¸€æ¬¡æŒ‡æ ‡ï¼Œè€Œæˆ‘ä»¬çš„è„šæœ¬å¯ä»¥åœ¨ä¸¤æ¬¡æŠ“å–é—´éš”å†…å‘ç°ç¬æ—¶çš„å®•æœºï¼Œå¹¶å³æ—¶é€šçŸ¥ã€‚</p>
<h3>æŒ‡æ ‡è¶‹åŠ¿ç»Ÿè®¡è„šæœ¬</h3>
<p>æ¥ä¸‹æ¥ï¼Œé€šè¿‡ Prometheus çš„ HTTP API è·å–æŒ‡æ ‡æ•°æ®ï¼Œåˆ†æä¸€æ®µæ—¶é—´çš„è¶‹åŠ¿ã€‚å‡è®¾æˆ‘ä»¬æƒ³äº†è§£è¿‡å»ä¸€å‘¨ index_size çš„å˜åŒ–ï¼Œä»¥ä¾¿è¿›è¡Œå®¹é‡è§„åˆ’ã€‚å¯ä»¥æŸ¥è¯¢ Prometheus è·å–æ¯å¤©çš„ç´¢å¼•å¤§å°ï¼Œå¹¶è®¡ç®—å¢é•¿ç‡ï¼š</p>
<blockquote><code>import requests</code><br>
<code>import datetime</code><br>
<code></code><br>
<code># Prometheus HTTP API æ¥å£å’ŒæŸ¥è¯¢å‚æ•°</code><br>
<code>prom_url = &quot;http://&lt;PrometheusæœåŠ¡å™¨&gt;/api/v1/query_range&quot;</code><br>
<code>metric = &quot;index_size{collection=\&quot;main_content\&quot;}&quot;  # å‡è®¾ä¸»è¦å†…å®¹ç´¢å¼•çš„é›†åˆåä¸º main_content</code><br>
<code>end = int(datetime.datetime.now().timestamp())</code><br>
<code>start = end - 7*24*3600  # ä¸€å‘¨å‰</code><br>
<code># ... (25 more lines)</code></blockquote>
<p><em>Full code available in the <a href="https://github.com/geyuxu">GitHub repository</a>.</em></p><p>ä¸Šè¿°ä»£ç è°ƒç”¨ Prometheus çš„ query_range æ¥å£ï¼ŒæŸ¥è¯¢æŒ‡å®š index_size æŒ‡æ ‡åœ¨è¿‡å»7å¤©å†…çš„æ•°æ®ï¼Œæ¯å¤©ä¸€ä¸ªæ•°æ®ç‚¹ã€‚ç„¶åè®¡ç®—ç¬¬ä¸€ä¸ªå€¼å’Œæœ€åä¸€ä¸ªå€¼çš„å·®å€¼å’Œç™¾åˆ†æ¯”å¢é•¿ã€‚è¾“å‡ºç¤ºä¾‹ï¼š</p>
<blockquote><code>ä¸€å‘¨å‰ç´¢å¼•å¤§å°: 1.50e+10, ç°åœ¨ç´¢å¼•å¤§å°: 1.80e+10  </code><br>
<code>ä¸€å‘¨å†…ç´¢å¼•å¢é•¿äº† 3.00e+09 å­—èŠ‚, å¢å¹… 20.0%</code></blockquote><p>è¡¨ç¤ºä¸€å‘¨å‰ç´¢å¼•15GBï¼Œç°åœ¨18GBï¼Œä¸€å‘¨å¢é•¿äº†3GBï¼Œæ¶¨å¹…20%ã€‚é€šè¿‡è¿™æ ·çš„è„šæœ¬ï¼Œæˆ‘ä»¬å¯ä»¥ç›´è§‚äº†è§£ç´¢å¼•æ•°æ®é‡çš„è¶‹åŠ¿ï¼Œå¦‚æœå‘ç°å¢é•¿ç‡è¿‡é«˜ï¼Œå¯ä»¥æå‰æ‰©å®¹å­˜å‚¨æˆ–ä¼˜åŒ–ç´¢å¼•ç­–ç•¥ã€‚</p>
<p>ç±»ä¼¼åœ°ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨è„šæœ¬åˆ†æ search_rate çš„æ—¥æ³¢åŠ¨ï¼Œäº†è§£æµé‡é«˜å³°ï¼›æˆ–æ£€æŸ¥ gc_time éšæ—¶é—´çš„å˜åŒ–ï¼Œçœ‹ GC å¼€é”€æ˜¯å¦é€æ¸å˜å¤§ã€‚Prometheus çš„ API è¿”å› JSON æ•°æ®ï¼Œç”¨ Python è§£æååšè®¡ç®—éå¸¸æ–¹ä¾¿ï¼Œè¿™æ ·çš„å®šåˆ¶åˆ†ææœ‰æ—¶æ¯”å•çº¯çœ‹ç›‘æ§å›¾è¡¨æ›´çµæ´»ã€‚</p>
<p>é€šè¿‡ Python å®ä¾‹ï¼Œæˆ‘ä»¬å±•ç¤ºäº†å¦‚ä½•åœ¨ç›‘æ§ä½“ç³»ä¹‹å¤–å†åŠ ä¸€å±‚â€œè‡ªå®šä¹‰è§‚å¯Ÿâ€ï¼šå¥åº·æ£€æŸ¥è„šæœ¬æä¾›å³æ—¶å¯ç”¨æ€§åé¦ˆï¼Œè¶‹åŠ¿åˆ†æè„šæœ¬æä¾›å®¹é‡å’Œæ€§èƒ½æ¼”è¿›æ´å¯Ÿã€‚æŒæ¡äº†æŒ‡æ ‡å’Œç¼–ç¨‹ç»“åˆï¼Œæˆ‘ä»¬å†æ¥çœ‹å¦‚ä½•ä¼˜åŒ– Grafana ä»ªè¡¨æ¿ï¼Œæ›´é«˜æ•ˆåœ°å‘ˆç° Solr æŒ‡æ ‡ã€‚</p>
<h2>Grafana Dashboard ä¼˜åŒ–å»ºè®®</h2>
<p>ä¸€ä¸ªè®¾è®¡è‰¯å¥½çš„ Grafana ä»ªè¡¨æ¿å¯ä»¥è®©æˆ‘ä»¬å¿«é€Ÿå®šä½é—®é¢˜ã€‚æ ¹æ®æˆ‘ä»¬çš„ç»éªŒï¼ˆä»¥åŠç”¨æˆ·æä¾›çš„ Solr ç›‘æ§ä»ªè¡¨æ¿ JSONï¼‰ï¼Œè¿™é‡Œæœ‰ä¸€äº›ä¼˜åŒ–å»ºè®®ï¼š</p>
<ul>
<li>ä½¿ç”¨æ¨¡æ¿å˜é‡ (Template Variables)ï¼š ä¸è¦ä¸ºæ¯ä¸ª collection æˆ– èŠ‚ç‚¹ç¡¬ç¼–ç å•ç‹¬çš„å›¾è¡¨ã€‚åˆ©ç”¨ Grafana çš„å˜é‡åŠŸèƒ½ï¼Œé€šè¿‡ä¸‹æ‹‰èœå•åˆ‡æ¢ç›‘æ§è§†è§’ã€‚ä¾‹å¦‚ï¼Œå¯å®šä¹‰ zk_hostï¼ˆZookeeperé›†ç¾¤æ ‡è¯†ï¼‰å˜é‡ã€collection å˜é‡å’Œ base_urlï¼ˆSolr èŠ‚ç‚¹URLï¼‰å˜é‡ã€‚åœ¨ç¤ºä¾‹ä»ªè¡¨æ¿ JSON ä¸­ï¼š</li>
<li>zk_host å˜é‡é€šè¿‡ label_values(solr_ping, zk_host) åŠ¨æ€è·å–é›†ç¾¤åˆ—è¡¨ã€‚</li>
<li>collection å˜é‡ä¾èµ–é€‰å®šçš„ zk_hostï¼ˆä½¿ç”¨æŸ¥è¯¢ label_values(solr_ping{zk_host=&quot;$zk_host&quot;}, collection) è·å–è¯¥é›†ç¾¤ä¸‹æ‰€æœ‰é›†åˆåï¼‰ã€‚</li>
<li>ç±»ä¼¼åœ°è¿˜æœ‰ shard å’Œ replica å˜é‡ï¼Œç”¨äº SolrCloud åˆ†ç‰‡å’Œå‰¯æœ¬çš„é€‰æ‹©ã€‚
é€šè¿‡è¿™äº›å˜é‡ï¼Œä¸€ä¸ªä»ªè¡¨æ¿å³å¯ç›‘æ§ä¸åŒé›†ç¾¤ã€ä¸åŒ collectionã€‚é€‰æ‹© â€œAllâ€ æ—¶ï¼Œè¿˜èƒ½èšåˆæˆ–å¯¹æ¯”å¤šä¸ª collection/èŠ‚ç‚¹çš„æ•°æ®ï¼Œéå¸¸é€‚åˆæœ‰å¤šç´¢å¼•çš„å†…å®¹å¹³å°ã€‚æ¯”å¦‚å¹³å°é‡Œæœ‰æ–‡ç« ç´¢å¼•ã€è¯„è®ºç´¢å¼•ç­‰ï¼Œç”¨åŒä¸€å¥—å›¾è¡¨ï¼Œé€šè¿‡é€‰æ‹©ä¸åŒ collection å³å¯æŸ¥çœ‹å¯¹åº”æŒ‡æ ‡ï¼Œå¤§å¤§æé«˜å¤ç”¨æ€§ã€‚</li>
<li>ä¼˜åŒ–æŸ¥è¯¢å’Œå‡½æ•°ä½¿ç”¨ï¼š åœ¨ PromQL æŸ¥è¯¢ä¸­é«˜æ•ˆåœ°è·å–æ‰€éœ€æ•°æ®ï¼Œè®© Prometheus åšç¹é‡è®¡ç®—ï¼ŒGrafana åªæ¸²æŸ“ç»“æœã€‚å¯¹äºè®¡æ•°å™¨ç±»å‹æŒ‡æ ‡ï¼Œä½¿ç”¨ rate() æˆ– increase() å°†æ€»é‡è½¬æ¢ä¸ºé€Ÿç‡æˆ–å¢é‡ã€‚ä¾‹å¦‚ï¼Œæ˜¾ç¤ºæŸ¥è¯¢ QPS å¯ç”¨ï¼š</li>
</ul>
<p><code>rate(solr_metrics_core_requests_total{handler=&quot;/select&quot;}[1m])</code></p><p>è¿™ç›´æ¥å¾—åˆ°æ¯ç§’è¯·æ±‚æ•°ã€‚å¦‚æœæƒ³è¦æ¯åˆ†é’Ÿçš„è¯·æ±‚é‡ï¼Œå¯ç”¨ increase(...[1m]) å¾—åˆ°è¿‡å»1åˆ†é’Ÿè¯·æ±‚æ•°ã€‚æˆ‘ä»¬çš„ä»ªè¡¨æ¿ä¸­å°±ä½¿ç”¨äº† increase(...[1m]) æ›²çº¿æ¥è¡¨ç¤ºæ¯åˆ†é’Ÿçš„è¯·æ±‚æ¬¡æ•°ã€‚ä¸¤ç§æ–¹æ³•å„æœ‰ä¼˜åŠ£ï¼Œä½†éƒ½æ¯”ç›´æ¥ä½¿ç”¨ solr_metrics_core_requests_total ç´¯ç§¯å€¼è¦æœ‰æ„ä¹‰ã€‚
å¯¹äºå»¶è¿Ÿï¼Œå¦‚å‰æ‰€è¿°ï¼Œå¦‚æœåªèƒ½ç”¨æ€»è€—æ—¶/æ€»æ¬¡æ•°è®¡ç®—å¹³å‡ï¼Œå¯ä»¥åœ¨ PromQL ä¸­è¡¨è¾¾ï¼š</p>
<blockquote><code>increase(solr_metrics_core_time_seconds_total[5m])</code><br>
<code>/ increase(solr_metrics_core_requests_total[5m])</code></blockquote><p>ä½†æ›´æ¨èæœ‰æ¡ä»¶çš„è¯ä½¿ç”¨ç›´æ–¹å›¾åˆ†å¸ƒå¹¶è®¡ç®—é«˜åˆ†ä½ï¼Œæ¯”å¦‚ P95ã€‚å…³é”®æ˜¯é¿å…åœ¨ Grafana å‰ç«¯åšç¹é‡è®¡ç®—ï¼Œå°½é‡æŠŠè®¡ç®—æ”¾åœ¨ Prometheus åç«¯å®Œæˆã€‚ä¾‹å¦‚ï¼Œä¸è¦åœ¨ Grafana ä¸­è·å–åˆ°ä¸€é•¿ä¸²åŸå§‹æ•°æ®å†ç®—åˆ†ä½ï¼Œè¿™æ ·å¼€é”€å¤§ä¸”å®æ—¶æ€§å·®ã€‚</p>
<ul>
<li>åˆç†å¸ƒå±€å’Œå•ä½æ ‡è¯†ï¼š å°†ç›¸å…³æŒ‡æ ‡æ”¾åœ¨ç›¸é‚»é¢æ¿ä¾¿äºå…³è”åˆ†æã€‚ä¾‹å¦‚å°† search_rateï¼ˆååï¼‰å’Œ search_latencyï¼ˆå»¶æ—¶ï¼‰å›¾è¡¨æ”¾ä¸€èµ·ï¼Œè¿™æ ·å½“ QPS å³°å€¼æ—¶æ˜¯å¦å¼•èµ·å»¶è¿Ÿä¸Šå‡ä¸€ç›®äº†ç„¶ã€‚å¦‚æœéœ€è¦ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨åŒYè½´åœ¨åŒä¸€å›¾ä¸Šå åŠ ï¼ˆæ¯”å¦‚å°† P95 å»¶è¿Ÿå’Œå¹³å‡å»¶è¿Ÿç”»åœ¨ä¸€èµ·ï¼Œä½†éœ€åŒºåˆ†é¢œè‰²å’Œè½´ï¼‰ã€‚æ­¤å¤–ï¼Œä¸€å®šè¦æ ‡æ˜åº¦é‡å•ä½ï¼šGrafana é¢æ¿å¯ä»¥è®¾ç½®Yè½´å•ä½ï¼ˆæ¯«ç§’ã€QPSã€å­—èŠ‚ç­‰ï¼‰ã€‚å¾ˆå¤šåˆå§‹ä»ªè¡¨æ¿å¸¸è§æ²¡æœ‰å•ä½æˆ–è¯´æ˜ï¼Œå¯¼è‡´è¯»å›¾è€…ä¸çŸ¥é“ 0.1 æ˜¯0.1ç§’è¿˜æ˜¯0.1æ¯«ç§’ã€‚æ¸…æ™°çš„æ ‡ç­¾å’Œå•ä½å¯ä»¥é¿å…è¯¯è§£ã€‚</li>
<li>å……åˆ†åˆ©ç”¨æç¤ºä¿¡æ¯å’Œå›¾ä¾‹ï¼š Grafana çš„é¼ æ ‡æ‚¬åœæç¤ºå’Œå›¾ä¾‹èƒ½å¤Ÿè‡ªå®šä¹‰æ ¼å¼ã€‚åœ¨ä»ªè¡¨æ¿ JSON ä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ° legendFormat ä½¿ç”¨äº† {{base_url}}/{{collection}}<em>{{shard}}</em>{{replica}}{{handler}} è¿™æ ·çš„æ¨¡å¼ï¼Œæ¥æ˜¾ç¤ºæ¯æ¡æ›²çº¿å¯¹åº”çš„èŠ‚ç‚¹/é›†åˆ/åˆ†ç‰‡ä¿¡æ¯ã€‚å½“å¤šæ¡çº¿å åŠ æ—¶ï¼ˆæ¯”å¦‚é€‰äº† All è§‚çœ‹å¤šä¸ªèŠ‚ç‚¹ï¼‰ï¼Œè¿™æ ·å¯ä»¥åœ¨å›¾ä¾‹ä¸­ç›´è§‚åœ°åŒºåˆ†ä¸åŒæ›²çº¿ï¼Œå…å¾—æ··æ·†ã€‚æ ¹æ®éœ€è¦è®¾ç½®åˆé€‚çš„å›¾ä¾‹æ ¼å¼ï¼Œæˆ–è€…ä½¿ç”¨æç¤ºæ¨¡æ¿ï¼Œè®©è¿ç»´äººå‘˜æ‚¬åœæ—¶å°±èƒ½çœ‹åˆ°å…³é”®æ ‡ç­¾å€¼ã€‚Grafana è¿˜å¯ä»¥å¯¹æŸäº›åº¦é‡è®¾å®šå›ºå®šçš„é˜ˆå€¼é¢œè‰²ï¼Œæ¯”å¦‚å»¶è¿Ÿè¶…è¿‡æŸå€¼æ—¶æ›²çº¿å˜çº¢ï¼Œä»¥å¼ºè°ƒå¼‚å¸¸çŠ¶æ€ã€‚</li>
<li>å±‚æ¬¡åŒ–çš„ä»ªè¡¨æ¿è®¾è®¡ï¼š å‰é¢æåˆ°çš„å˜é‡è”åŠ¨å®é™…ä¸Šå°±æ˜¯ä¸€ç§å±‚æ¬¡é’»å–ã€‚æ¯”å¦‚æˆ‘ä»¬é¡¶å±‚æ¦‚è§ˆä»ªè¡¨æ¿å¯ä»¥ä¸è¿‡æ»¤ collectionï¼Œè§‚å¯Ÿæ•´ä½“æƒ…å†µï¼›ä¸€æ—¦æŸæŒ‡æ ‡å¼‚å¸¸ï¼Œæ¯”å¦‚æŸé›†åˆå»¶è¿Ÿé«˜ï¼Œå†ç”¨å˜é‡ä¸‹é’»åˆ°å…·ä½“ collection çœ‹è¯¦æƒ…ï¼›å¿…è¦æ—¶å†ä¸‹é’»åˆ°å…·ä½“ shard/replica è°ƒæŸ¥ã€‚Grafana æ”¯æŒä»ªè¡¨æ¿ä¹‹é—´è·³è½¬ï¼Œå¯ä»¥é…ç½®ç‚¹å‡»æŸä¸ªæ•°æ®ç‚¹è·³åˆ°å¦ä¸€ä¸ªä»ªè¡¨æ¿å¹¶å¸¦å…¥å˜é‡ã€‚è¿™ç§è®¾è®¡å¯¹ SolrCloud å¾ˆå®ç”¨â€”â€”å½“å‘Šè­¦æç¤ºâ€œé›†åˆXå»¶è¿Ÿé«˜â€æ—¶ï¼Œæˆ‘ä»¬ç‚¹å‡ ä¸‹å°±èƒ½ä»æ€»è§ˆè·³è½¬åˆ°è¯¥é›†åˆçš„è¯¦å›¾ç”šè‡³å¯¹åº”èŠ‚ç‚¹çš„ç³»ç»ŸæŒ‡æ ‡ï¼Œå¤§å¤§åŠ å¿«æ’æŸ¥é€Ÿåº¦ã€‚</li>
<li>æŸ¥è¯¢æ€§èƒ½å’Œæ•°æ®é‡æ§åˆ¶ï¼š å½“ç›‘æ§æ•°æ®å¾ˆå¤šæ—¶ï¼ŒåŠ¡å¿…æ³¨æ„ PromQL å†™æ³•å’Œ Grafana åˆ·æ–°é¢‘ç‡ã€‚å°½é‡é¿å…ä½¿ç”¨é«˜å¼€é”€çš„æ­£åˆ™åŒ¹é…æˆ– without/by å¤§èŒƒå›´åˆ†ç»„ã€‚å¦‚æœéœ€è¦åˆå¹¶ä¸åŒ handler æˆ–ç±»åˆ«çš„æ•°æ®ï¼Œå¯ä»¥åœ¨ Prometheus ä¾§é€šè¿‡ Recording Rule é¢„èšåˆã€‚ä¾‹å¦‚æŠŠ /select å’Œ /query è¯·æ±‚éƒ½ç®—ä½œæŸ¥è¯¢è¯·æ±‚ï¼Œåœ¨ Prometheus å†™è§„åˆ™ sum èµ·æ¥ï¼Œç”Ÿæˆä¸€ä¸ªç»Ÿä¸€çš„ search_requests_totalï¼ŒGrafana æŸ¥è¯¢è¿™ä¸ªæ–°æŒ‡æ ‡å°±ç®€å•é«˜æ•ˆã€‚å¦å¤–ï¼ŒGrafana é¢æ¿åˆ·æ–°é—´éš”ä¸å®œè¿‡çŸ­ï¼Œé€šå¸¸10~30ç§’å°±å¤Ÿäº†ï¼Œå¤ªé¢‘ç¹ä¼šå¢åŠ åç«¯å‹åŠ›ã€‚</li>
</ul>
<p>æ€»ä¹‹ï¼Œä»ªè¡¨æ¿çš„ç›®æ ‡æ˜¯è®©å€¼ç­äººå‘˜ä¸€çœ¼çœ‹å‡ºå¼‚å¸¸ï¼Œå¹¶è¿…é€Ÿå®šä½èŒƒå›´ã€‚é€šè¿‡ä¸Šè¿°ä¼˜åŒ–ï¼Œæˆ‘ä»¬çš„ Solr ä»ªè¡¨æ¿å˜å¾—çµæ´»åˆæ˜“è¯»ï¼Œå¤§éƒ¨åˆ†é—®é¢˜éƒ½èƒ½é€šè¿‡åˆ‡æ¢è§†è§’å’ŒæŸ¥çœ‹å…³è”å›¾è¡¨æ¥å®šä½ã€‚</p>
<h2>å¸¸è§è¯¯åŒºä¸å‘Šè­¦ç›²åŒºåˆ†æ</h2>
<p>åœ¨æ­å»º Solr ç›‘æ§å’Œå‘Šè­¦çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä¹Ÿè¸©è¿‡ä¸€äº›å‘ã€‚ä»¥ä¸‹æ˜¯å‡ ä¸ªå¸¸è§è¯¯åŒºå’Œç›²åŒºï¼Œè¦ç‰¹åˆ«æ³¨æ„ï¼š</p>
<ul>
<li>åªçœ‹å¹³å‡å€¼è€Œå¿½è§†é«˜åˆ†ä½ï¼š å‰é¢å·²ç»å¼ºè°ƒè¿‡è¿™ä¸€ç‚¹ã€‚æˆ‘ä»¬æ›¾åƒè¿‡äºï¼šå¹³å‡æŸ¥è¯¢å»¶æ—¶ä¸€ç›´å¾ˆä½ï¼Œç„¶è€Œå°‘æ•°æŸ¥è¯¢å¶å°”è¶…è¿‡1ç§’ä½†æœªå¼•èµ·é‡è§†ï¼Œç›´åˆ°ç”¨æˆ·æŠ•è¯‰æŸäº›æœç´¢å¾ˆæ…¢æ‰å‘ç°é—®é¢˜ã€‚åŸå› æ˜¯å½“æ—¶å‘Šè­¦åªç›¯å¹³å‡å€¼ï¼Œæ¼æ‰äº†é•¿å°¾å»¶è¿Ÿã€‚æ­£ç¡®åšæ³•æ˜¯åŒæ—¶ç›‘æ§ P95/P99ï¼Œå°†é«˜å»¶è¿Ÿæƒ…å†µçº³å…¥å‘Šè­¦è§¦å‘æ¡ä»¶ã€‚ä¾‹å¦‚ï¼Œè®¾ç½®â€œP95 å»¶è¿Ÿ&gt;200ms æŒç»­5åˆ†é’Ÿâ€è¿™æ ·çš„å‘Šè­¦ã€‚</li>
<li>æœªç›‘æ§é”™è¯¯ç‡ï¼š æ€§èƒ½æ­£å¸¸ä¸ä»£è¡¨æœåŠ¡æ­£å¸¸ã€‚å¦‚æœ Solr æŸ¥è¯¢æŠ¥é”™æˆ–è¶…æ—¶ï¼Œç”¨æˆ·æ‹¿ä¸åˆ°ç»“æœï¼Œæ¯”æ…¢æ›´ä¸¥é‡ã€‚Solr çš„ metrics å’Œæ—¥å¿—ä¸­éƒ½èƒ½çœ‹åˆ°é”™è¯¯è®¡æ•°ï¼Œä¾‹å¦‚è¯·æ±‚å¤„ç†å™¨çš„ errors è®¡æ•°ã€‚ä¸€ä¸ªç›²åŒºæ˜¯åœ¨åªçœ‹ QPS å’Œå»¶æ—¶çš„æƒ…å†µä¸‹ï¼Œä¸¥é‡é”™è¯¯ä¼šè®© QPS é™ä½ã€å»¶æ—¶åè€Œå˜å¥½çœ‹ï¼ˆå› ä¸ºéƒ¨åˆ†è¯·æ±‚ç›´æ¥å¤±è´¥å¾ˆå¿«è¿”å›æˆ–æ²¡è¿”å›ï¼‰ã€‚å› æ­¤éœ€è¦ç›‘æ§ error_rate æˆ–é”™è¯¯æ€»æ•°ã€‚å¯ä»¥ç»Ÿè®¡æ¯åˆ†é’Ÿé”™è¯¯æ¬¡æ•°ï¼Œæˆ–è®¡ç®—é”™è¯¯ç‡=é”™è¯¯æ•°/è¯·æ±‚æ•°ï¼Œä¸€æ—¦è¶…è¿‡æŸé˜ˆå€¼é©¬ä¸Šå‘Šè­¦ã€‚</li>
<li>å¿½è§† JVM å†…éƒ¨æŒ‡æ ‡ï¼ˆGCã€çº¿ç¨‹ç­‰ï¼‰ï¼š æˆ‘ä»¬ä¸€å¼€å§‹å…³æ³¨ç‚¹éƒ½åœ¨ QPSã€å»¶è¿Ÿè¿™äº›ç›´æ¥æŒ‡æ ‡ä¸Šï¼Œè€Œå¿½è§†äº† JVM æœ¬èº«çš„çŠ¶æ€ã€‚åæ¥æœ‰ä¸€æ¬¡ Solr å®ä¾‹é¢‘ç¹ Full GC å¯¼è‡´é•¿æ—¶é—´åœé¡¿ï¼Œä½†ç”±äºå¹³å‡å»¶è¿Ÿè®¡ç®—æ’é™¤äº†åœé¡¿ï¼ˆæ— è¯·æ±‚å¤„ç†æ—¶è¯·æ±‚è®¡æ•°æ²¡å¢åŠ ï¼Œå¹³å‡å€¼æ²¡æ‹‰é«˜ï¼‰ï¼Œç›‘æ§æœªæŠ¥å¼‚å¸¸ã€‚ç„¶è€Œç”¨æˆ·å·²ç»æ„Ÿè§‰åˆ°é•¿æ—¶é—´æ— å“åº”ã€‚è¿™æé†’æˆ‘ä»¬ä¸€å®šè¦ç›‘æ§ GC å’Œå†…å­˜ã€‚æ¯”å¦‚ç›‘æ§ gc_time æˆ–è€…ç›´æ¥ç›‘æ§ SolrJMXçš„ solr:jvm:gc æŒ‡æ ‡ï¼Œä»¥åŠå †å†…å­˜å ç”¨ã€‚å¦‚æœ Full GC æ¬¡æ•°æˆ–æ—¶é—´åœ¨çŸ­æ—¶é—´å†…æ¿€å¢ï¼Œåº”åŠæ—¶å‘Šè­¦ã€‚æ­¤å¤–ï¼Œç›‘æ§çº¿ç¨‹æ± é˜Ÿåˆ—ã€æ–‡ä»¶å¥æŸ„ç­‰åœ¨ç‰¹å®šåœºæ™¯ä¸‹ä¹Ÿå¾ˆé‡è¦ï¼Œé¿å… Solr è¾¾åˆ°èµ„æºä¸Šé™ã€‚</li>
<li>SolrCloud å‰¯æœ¬çŠ¶æ€çš„ç›²åŒºï¼š åœ¨ SolrCloud é›†ç¾¤ä¸­ï¼Œå¯èƒ½æŸä¸ª replica æŒ‚æ‰äº†ï¼Œä½†æ˜¯æŸ¥è¯¢ä»æœ‰å…¶å®ƒå‰¯æœ¬æ”¯æ’‘ï¼Œè¡¨é¢æŒ‡æ ‡ï¼ˆQPSã€å»¶è¿Ÿï¼‰ä¸å—å½±å“ã€‚è¿™ç§æƒ…å†µä¸‹å¦‚æœæ²¡æœ‰å¯¹é›†ç¾¤çŠ¶æ€çš„ç›‘æ§ï¼Œå°±ä¼šé—æ¼é£é™©ã€‚å¦‚æœå¦ä¸€ä¸ªå‰¯æœ¬å†å‡ºé—®é¢˜ï¼Œæ•´ä¸ª shard å°±ä¸å¯ç”¨ï¼Œå±Šæ—¶æ‰ä¼šé›ªå´©ã€‚ä¸ºé¿å…è¿™ç§ç›²åŒºï¼Œæˆ‘ä»¬éœ€è¦ç›‘æ§ Solr é›†ç¾¤çš„å¥åº·åº¦ã€‚ä¾‹å¦‚å®šæœŸæ£€æŸ¥ /solr/admin/collections?action=CLUSTERSTATUS æˆ–ä½¿ç”¨å‰è¿°å¯¼å‡ºçš„ solr_collections_replica_state æŒ‡æ ‡ï¼Œå…³æ³¨æ˜¯å¦æœ‰ replica é•¿æ—¶é—´ä¸æ˜¯ ACTIVE çŠ¶æ€ã€‚ä¸€æ—¦å‘ç°æœ‰ replica DOWNå¤šåˆ†é’Ÿï¼Œå°±å‘å‡ºå‘Šè­¦è¿›è¡Œè¿ç»´å¹²é¢„ã€‚</li>
<li>å‘Šè­¦é˜ˆå€¼å’Œç­–ç•¥ä¸å½“ï¼š å‘Šè­¦é…ç½®éœ€è¦å¹³è¡¡æ•æ„Ÿåº¦å’Œå™ªéŸ³ã€‚æˆ‘ä»¬æ›¾ç»æŠŠ CPU ä½¿ç”¨ç‡ &gt;90% å°±å‘Šè­¦ï¼Œç»“æœåœ¨ç´¢å¼•å¯¼å…¥æˆ–çŸ­æš‚æŸ¥è¯¢é«˜å³°æ—¶é¢‘ç¹è§¦å‘ï¼Œå±äºâ€œå‡è­¦â€ã€‚å¦ä¸€ç§é”™è¯¯æ˜¯é˜ˆå€¼è¿‡é«˜æˆ–ç¼ºå¤±ï¼Œå¯¼è‡´çœŸæ­£å‡ºé—®é¢˜æ—¶æ²¡æœ‰å‘Šè­¦ã€‚ä¾‹å¦‚ç£ç›˜å¿«æ»¡äº†æ²¡æœ‰åŠæ—¶æŠ¥è­¦ã€‚ç»éªŒæ˜¯æ ¹æ®å†å²æ•°æ®è°ƒæ•´é˜ˆå€¼ï¼Œå¹¶åŠ å…¥æŒç»­æ—¶é—´åˆ¤æ–­ã€‚ä¾‹å¦‚ CPU &gt;85% æŒç»­5åˆ†é’Ÿå†æŠ¥è­¦ï¼Œç¬æ—¶å°–å³°ä¸å¿…ç®¡ã€‚å†å¦‚ QPS é™ä¸º0éœ€è¦è€ƒè™‘æ˜¯å¦å¤œé—´æ— æµé‡è¿˜æ˜¯æœåŠ¡æŒ‚äº†ï¼Œå¯ä»¥ç»“åˆæ—¶é—´æ®µæˆ–å…¶ä»–æŒ‡æ ‡ï¼ˆå¦‚é”™è¯¯ç‡ï¼‰åˆ¤æ–­ã€‚æ€»ä¹‹ï¼Œå®šæœŸå›é¡¾å‘Šè­¦è§„åˆ™ï¼Œæ ¹æ®å®é™…è¡¨ç°è°ƒä¼˜ï¼Œæ˜¯é¿å…ç›²åŒºå’Œè¯¯æŠ¥çš„å…³é”®ã€‚</li>
</ul>
<p>äº†è§£äº†è¿™äº›è¯¯åŒºåï¼Œæˆ‘ä»¬è¡¥ä¸Šäº†ç›¸åº”çš„ç›‘æ§å’Œå‘Šè­¦ï¼Œæ•´ä½“ç³»ç»Ÿå˜å¾—æ›´åŠ å¥å£®å¯é ã€‚ç›‘æ§æ–¹æ¡ˆå¹¶éä¸€æˆä¸å˜ï¼Œåº”è¯¥éšç€å¯¹ç³»ç»Ÿäº†è§£åŠ æ·±ä¸æ–­æ”¹è¿›ã€‚</p>
<h2>ç»éªŒæ€»ç»“ä¸æ¨èå®è·µ</h2>
<p>å¯¹å†…å®¹æ£€ç´¢å¹³å°è€Œè¨€ï¼ŒSolr çš„ç›‘æ§ä¸å¯è§‚æµ‹æ€§å»ºè®¾æ˜¯ä¸€ä¸ªæŒç»­è¿­ä»£çš„è¿‡ç¨‹ã€‚æœ€åï¼Œæ ¹æ®æˆ‘ä»¬çš„å®è·µï¼Œç»™å‡ºå‡ ç‚¹æ€»ç»“å’Œå»ºè®®ï¼š</p>
<ul>
<li>æŒ‡æ ‡è¦†ç›–å…¨é¢ï¼Œè§†è§’ç›¸äº’ä½è¯ï¼š ç›‘æ§æ—¶å°½é‡åšåˆ°â€œæ—¢è§æ ‘æœ¨ï¼Œäº¦è§æ£®æ—â€ã€‚æ—¢è¦æœ‰å•èŠ‚ç‚¹è¯¦ç»†æŒ‡æ ‡ï¼Œä¹Ÿè¦æœ‰é›†ç¾¤æ•´ä½“è§†å›¾ï¼›æ—¢å…³æ³¨æŸ¥è¯¢æ€§èƒ½ï¼Œä¹Ÿåˆ«å¿˜äº†ç´¢å¼•å’Œèµ„æºåˆ©ç”¨ã€‚å°†ä¸åŒç±»åˆ«çš„æŒ‡æ ‡è”ç³»èµ·æ¥çœ‹æ•ˆæœæœ€å¥½â€”â€”ä¾‹å¦‚å½“å»¶è¿Ÿå‡é«˜æ—¶ï¼ŒåŒæ—¶æŸ¥çœ‹æ˜¯å¦å‘ç”Ÿ GC å°–å³°æˆ–CPUè·‘æ»¡ï¼Œè¿™æ ·èƒ½å¿«é€Ÿå®šä½ç“¶é¢ˆæ‰€åœ¨ã€‚</li>
<li>é‡è§†é«˜åˆ†ä½å’Œå¼‚å¸¸æƒ…å†µï¼š ç”¨æˆ·ä½“éªŒå¾€å¾€å–å†³äºæœ€æ…¢çš„é‚£å‡ ç¬”è¯·æ±‚ã€‚æˆ‘ä»¬åœ¨å®è·µä¸­å‘ç°ï¼Œé€šè¿‡ç›‘æ§ P95/P99 å»¶è¿Ÿå’Œé”™è¯¯ç‡ï¼Œèƒ½æ›´æ—©æ•è·å¼‚å¸¸è¿¹è±¡ã€‚å› æ­¤æ¨èå°†é«˜åˆ†ä½å»¶è¿Ÿã€é”™è¯¯æ•°ä½œä¸ºä¸»è¦å‘Šè­¦æŒ‡æ ‡ï¼Œå¹³å‡å€¼å’ŒQPSæ›´å¤šç”¨äºæä¾›èƒŒæ™¯å‚è€ƒï¼ˆä¾‹å¦‚æµé‡æš´å¢æ—¶å¹³å‡å»¶è¿Ÿå“ªæ€•ç•¥å‡é«˜ä¹Ÿå±æ­£å¸¸ï¼ŒP95 èƒ½åæ˜ æ›´çœŸå®çš„å‹åŠ›å˜åŒ–ï¼‰ã€‚</li>
<li>ä»ªè¡¨æ¿ä¸å‘Šè­¦è”åŠ¨ï¼š æ„å»ºç›‘æ§æ—¶ï¼Œè¦è€ƒè™‘åˆ°å€¼ç­äººå‘˜æ”¶åˆ°å‘Šè­¦åçš„åŠ¨ä½œé“¾ã€‚ç†æƒ³æƒ…å†µä¸‹ï¼Œæ¯æ¡å‘Šè­¦éƒ½èƒ½æŒ‡å‘ä¸€ä¸ª Grafana ä»ªè¡¨æ¿æˆ–ç‰¹å®šé¢æ¿è¿›è¡Œæ·±å…¥åˆ†æã€‚ä¾‹å¦‚æˆ‘ä»¬åœ¨å‘Šè­¦ä¿¡æ¯é‡Œé™„å¸¦äº† Grafana URLï¼Œå…¶ä¸­é¢„å…ˆå¸¦ä¸Šäº†å‡ºé—®é¢˜çš„ collection å˜é‡ï¼Œè¿™æ ·ä¸€ç‚¹å‡»å°±èƒ½çœ‹åˆ°ç›¸å…³å›¾è¡¨ã€‚è¿™ç§è”åŠ¨å¤§å¤§ç¼©çŸ­äº†æ•…éšœè¯Šæ–­æ—¶é—´ã€‚</li>
<li>å®šæœŸå¤ç›˜å’Œè°ƒæ•´ï¼š å°†ç›‘æ§çº³å…¥æŒç»­æ”¹è¿›æµç¨‹ã€‚æ¯æ¬¡äº‹æ•…æˆ–æ€§èƒ½é—®é¢˜è¿‡åï¼Œé—®è‡ªå·±ï¼šå“ªäº›æŒ‡æ ‡èƒ½æå‰é¢„è­¦è¿™æ¬¡é—®é¢˜ï¼Ÿæœ‰æ²¡æœ‰é—æ¼çš„ç›‘æ§ç‚¹ï¼Ÿä¾‹å¦‚å‘ç”Ÿè¿‡ä¸€æ¬¡ç£ç›˜æ‰“æ»¡å¯¼è‡´ Solr æ— æ³•å†™ç´¢å¼•åï¼Œæˆ‘ä»¬å°±åŠ å…¥äº†ç£ç›˜ä½¿ç”¨é‡å’Œç´¢å¼•å¤§å°å¢é•¿ç‡çš„ç›‘æ§å’Œå‘Šè­¦ã€‚é€šè¿‡ä¸æ–­å¤ç›˜ï¼Œä½ çš„ç›‘æ§ä½“ç³»ä¼šè¶Šæ¥è¶Šå®Œå–„ï¼Œè¦†ç›–åˆ°æœ€åˆæ„æ–™ä¹‹å¤–çš„è§’è½ã€‚</li>
<li>å–„ç”¨ç¤¾åŒºèµ„æºï¼š ä¸è¦é—­é—¨é€ è½¦ï¼ŒSolr ç¤¾åŒºå’Œå¹¿å¤§å¼€å‘è€…å·²ç»ç§¯ç´¯äº†å¾ˆå¤šç›‘æ§ç»éªŒã€‚ä¾‹å¦‚ Solr å®˜æ–¹æä¾›çš„ Prometheus Exporter é…ç½®å’Œç¤ºä¾‹ Grafana ä»ªè¡¨æ¿æ˜¯å¾ˆå¥½çš„èµ·ç‚¹ï¼Œå¯ä»¥æ ¹æ®è‡ªèº«å¹³å°éœ€è¦è¿›è¡Œä¿®æ”¹ã€‚é‡åˆ°ç–‘é—®æ—¶æŸ¥é˜… Solr Reference Guide æˆ– Prometheus æ–‡æ¡£ï¼Œäº†è§£æŸä¸ªæŒ‡æ ‡çš„ç¡®åˆ‡å«ä¹‰æˆ–æœ€ä½³é‡‡é›†æ–¹æ³•ã€‚åœ¨æ­¤åŸºç¡€ä¸Šç»“åˆè‡ªå·±ä¸šåŠ¡ç‰¹ç‚¹æ‰©å±•ç›‘æ§ï¼Œå°±èƒ½äº‹åŠåŠŸå€ã€‚</li>
</ul>
<p>æ€»è€Œè¨€ä¹‹ï¼Œä¸€ä¸ªå¥å£®çš„ Solr ç›‘æ§ä½“ç³»ä¸ä»…èƒ½é˜²æ‚£äºæœªç„¶ï¼Œè¿˜èƒ½æŒ‡å¯¼ä¼˜åŒ–ã€‚é€šè¿‡æ·±å…¥ç†è§£ Solr æŒ‡æ ‡ã€ä½¿ç”¨ä»£ç æé«˜ç›‘æ§è‡ªåŠ¨åŒ–ã€é¿å…å¸¸è§è¯¯åŒºå¹¶å®è·µæœ€ä½³ç­–ç•¥ï¼Œæˆ‘ä»¬æŠŠå†…å®¹æ£€ç´¢å¹³å°çš„ Solr ä»ä¸€ä¸ªâ€œé»‘ç›’â€å˜æˆäº†é€æ˜å¯è§‚å¯Ÿçš„ç³»ç»Ÿã€‚è¿™ç§ä¸»åŠ¨ç›‘æ§çš„æ€è·¯è®©æˆ‘ä»¬èƒ½å¤Ÿè‡ªä¿¡åœ°é¢å¯¹æµé‡å¢é•¿å’Œçªå‘æƒ…å†µï¼Œä¸ºç”¨æˆ·æä¾›æŒç»­å¿«é€Ÿçš„æœç´¢ä½“éªŒã€‚ç›¸ä¿¡åªè¦åšæŒâ€œæ—©ç›‘æ§ã€å‹¤åˆ†æã€å¸¸æ”¹è¿›â€ï¼Œä½ çš„ Solr æœåŠ¡ä¹Ÿä¼šæ›´åŠ ç¨³å®šé«˜æ•ˆï¼</p>

    </article>
    </main>
</div>

<script src="https://cdn.jsdelivr.net/npm/prismjs@1/prism.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/prismjs@1/components/prism-python.min.js"></script>
<script>
Prism.highlightAll();
document.querySelectorAll('article pre').forEach(pre => {
    const code = pre.querySelector('code');
    if (!code) return;
    const toolbar = document.createElement('div');
    toolbar.className = 'code-toolbar';
    const btn = document.createElement('button');
    btn.className = 'copy-btn';
    btn.textContent = 'Copy';
    btn.onclick = () => {
        navigator.clipboard.writeText(code.textContent).then(() => {
            btn.textContent = 'Copied!';
            btn.classList.add('copied');
            setTimeout(() => { btn.textContent = 'Copy'; btn.classList.remove('copied'); }, 2000);
        });
    };
    toolbar.appendChild(btn);
    pre.parentNode.insertBefore(toolbar, pre);
});
</script>
</body>
</html>