<!DOCTYPE html><html lang="zh" data-astro-cid-bvzihdzo> <head><!-- Global Metadata --><meta charset="utf-8"><!--<meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">--><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.css"><link rel="shortcut icon" href="/favicon.png" type="image/png"><link rel="sitemap" href="/sitemap-index.xml"><link rel="alternate" type="application/rss+xml" title="Ge Yuxu â€¢ AI &#38; Engineering" href="https://geyuxu.com/rss.xml"><meta name="generator" content="Astro v5.5.6"><!-- Font preloads --><link rel="preload" href="/fonts/atkinson-regular.woff" as="font" type="font/woff" crossorigin><link rel="preload" href="/fonts/atkinson-bold.woff" as="font" type="font/woff" crossorigin><!-- Canonical URL --><link rel="canonical" href="https://geyuxu.com/blog/ai/llm_rag_agent/spring_ai_rag/1_%E4%BD%BF%E7%94%A8-spring-ai-%E6%9E%84%E5%BB%BA-rag-%E6%90%9C%E7%B4%A2%E6%9C%8D%E5%8A%A1%E8%AE%BE%E8%AE%A1/"><!-- Primary Meta Tags --><title>ä½¿ç”¨ Spring AI æ„å»º RAG æœç´¢æœåŠ¡è®¾è®¡</title><meta name="title" content="ä½¿ç”¨ Spring AI æ„å»º RAG æœç´¢æœåŠ¡è®¾è®¡"><meta name="description"><!-- Open Graph / Facebook --><meta property="og:type" content="website"><meta property="og:url" content="https://geyuxu.com/blog/ai/llm_rag_agent/spring_ai_rag/1_%E4%BD%BF%E7%94%A8-spring-ai-%E6%9E%84%E5%BB%BA-rag-%E6%90%9C%E7%B4%A2%E6%9C%8D%E5%8A%A1%E8%AE%BE%E8%AE%A1/"><meta property="og:title" content="ä½¿ç”¨ Spring AI æ„å»º RAG æœç´¢æœåŠ¡è®¾è®¡"><meta property="og:description"><meta property="og:image" content="https://geyuxu.com/blog-placeholder-1.jpg"><!-- Twitter --><meta property="twitter:card" content="summary_large_image"><meta property="twitter:url" content="https://geyuxu.com/blog/ai/llm_rag_agent/spring_ai_rag/1_%E4%BD%BF%E7%94%A8-spring-ai-%E6%9E%84%E5%BB%BA-rag-%E6%90%9C%E7%B4%A2%E6%9C%8D%E5%8A%A1%E8%AE%BE%E8%AE%A1/"><meta property="twitter:title" content="ä½¿ç”¨ Spring AI æ„å»º RAG æœç´¢æœåŠ¡è®¾è®¡"><meta property="twitter:description"><meta property="twitter:image" content="https://geyuxu.com/blog-placeholder-1.jpg"><script src="/js/jquery-3.7.1.min.js"></script><script is:global>
	window.addEventListener('DOMContentLoaded', () => {
		$('.toc ol').css({
		'list-style': 'none',   // éšè— 1. 2. 3.
		'margin': 0,
		'padding-left': 0,       // å¯æŒ‰éœ€è°ƒæ•´
		});
		$('.toc ol > li').css({
		'list-style': 'none',   // éšè— 1. 2. 3.
		'padding-left': 10  
		});
        $('.sidebar').append($('.toc'));
      });
	</script><style>:root{--accent: #2337ff;--accent-dark: #000d8a;--black: 15, 18, 25;--gray: 96, 115, 159;--gray-light: 229, 233, 240;--gray-dark: 34, 41, 57;--gray-gradient: rgba(var(--gray-light), 50%), #fff;--box-shadow: 0 2px 6px rgba(var(--gray), 25%), 0 8px 24px rgba(var(--gray), 33%), 0 16px 32px rgba(var(--gray), 33%)}@font-face{font-family:Atkinson;src:url(/fonts/atkinson-regular.woff) format("woff");font-weight:400;font-style:normal;font-display:swap}@font-face{font-family:Atkinson;src:url(/fonts/atkinson-bold.woff) format("woff");font-weight:700;font-style:normal;font-display:swap}body{font-family:Atkinson,sans-serif;margin:0;padding:0;text-align:left;background:linear-gradient(var(--gray-gradient)) no-repeat;background-size:100% 600px;word-wrap:break-word;overflow-wrap:break-word;color:rgb(var(--gray-dark));font-size:20px;line-height:1.7}main{width:960px;max-width:calc(100% - 2em);margin:auto;padding:3em 1em}h1,h2,h3,h4,h5,h6{margin:0 0 .5rem;color:rgb(var(--black));line-height:1.2}h1{font-size:3.052em}h2{font-size:2.441em}h3{font-size:1.953em}h4{font-size:1.563em}h5{font-size:1.25em}strong,b{font-weight:700}a,a:hover{color:var(--accent)}p{margin-bottom:1em}.prose p{margin-bottom:2em}textarea{width:100%;font-size:16px}input{font-size:16px}table{width:100%;border-collapse:collapse}th,td{border:1px solid rgba(var(--gray-light));padding:8px;text-align:left}th{background-color:rgba(var(--gray-light),.5)}img{max-width:100%;height:auto;border-radius:8px}code{padding:2px 5px;background-color:rgb(var(--gray-light));border-radius:2px}pre{padding:1.5em;border-radius:8px}pre>code{all:unset}blockquote{border-left:4px solid var(--accent);padding:0 0 0 20px;margin:0;font-size:1.333em}hr{border:none;border-top:1px solid rgb(var(--gray-light))}@media (max-width: 720px){body{font-size:18px}main{padding:1em}}.sr-only{border:0;padding:0;margin:0;position:absolute!important;height:1px;width:1px;overflow:hidden;clip:rect(1px 1px 1px 1px);clip:rect(1px,1px,1px,1px);clip-path:inset(50%);white-space:nowrap}.title_li{list-style:none}.title_li>a,.title_li_num>a,.toc-link,.series-list>li>a,.series_title>a{color:#7a888e}.content{max-width:960px;margin:0 auto;padding:2rem 1rem;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,sans-serif;font-size:1.05rem;line-height:1.75;color:#333}.content h1,.content h2,.content h3{font-weight:600;margin-top:2rem;margin-bottom:1rem;line-height:1.3}.content p{margin-bottom:1.25rem}.content a{color:var(--accent, #0070f3);text-decoration:underline}.content img{max-width:100%;border-radius:6px;margin:1.5rem 0}.content pre,.content code{font-family:Menlo,Monaco,Consolas,Courier New,monospace;font-size:.9em;border-radius:4px}.content pre{padding:1em;overflow-x:auto}article.prose{font-size:var(--fs-base);line-height:1.7}@media (max-width: 640px){nav>div,nav>h2{font-size:.6em}ul,ol{padding-left:20px}main,.content-wrapper{padding-left:0;width:350px;max-width:60350px0px;margin:0 auto}img,table,pre{max-width:100%}table,pre{overflow-x:auto}.content{margin:0;padding:0;border:0;max-width:3350px00px;font-size:11px}h1{font-size:1.3rem}h2{font-size:1.2rem}h3{font-size:1.1rem}h4{font-size:1rem}h5{font-size:.9rem}}
a[data-astro-cid-eimmu3lg]{display:inline-block;text-decoration:none}a[data-astro-cid-eimmu3lg].active{font-weight:bolder;text-decoration:underline}header[data-astro-cid-3ef6ksr2]{margin:0;padding:0 1em;background:#fff;box-shadow:0 2px 8px rgba(var(--black),5%)}h2[data-astro-cid-3ef6ksr2]{margin:0;font-size:1em}h2[data-astro-cid-3ef6ksr2] a[data-astro-cid-3ef6ksr2],h2[data-astro-cid-3ef6ksr2] a[data-astro-cid-3ef6ksr2].active{text-decoration:none}nav[data-astro-cid-3ef6ksr2]{display:flex;align-items:center;justify-content:space-between}nav[data-astro-cid-3ef6ksr2] a[data-astro-cid-3ef6ksr2]{padding:1em .5em;color:var(--black);border-bottom:4px solid transparent;text-decoration:none}nav[data-astro-cid-3ef6ksr2] a[data-astro-cid-3ef6ksr2].active{text-decoration:none;border-bottom-color:var(--accent)}.social-links[data-astro-cid-3ef6ksr2],.social-links[data-astro-cid-3ef6ksr2] a[data-astro-cid-3ef6ksr2]{display:flex}@media (max-width: 720px){.social-links[data-astro-cid-3ef6ksr2]{display:none}}footer[data-astro-cid-sz7xmlte]{padding:2em 1em 6em;background:linear-gradient(var(--gray-gradient)) no-repeat;color:rgb(var(--gray));text-align:center}.social-links[data-astro-cid-sz7xmlte]{display:flex;justify-content:center;gap:1em;margin-top:1em}.social-links[data-astro-cid-sz7xmlte] a[data-astro-cid-sz7xmlte]{text-decoration:none;color:rgb(var(--gray))}.social-links[data-astro-cid-sz7xmlte] a[data-astro-cid-sz7xmlte]:hover{color:rgb(var(--gray-dark))}
.statement[data-astro-cid-uffxixac]{font-size:10px;color:gray}@media (max-width: 640px){.statement[data-astro-cid-uffxixac]{font-size:6px;color:gray}}
main[data-astro-cid-bvzihdzo].page{display:grid;grid-template-columns:260px minmax(0,1fr);width:100%;margin:0}aside[data-astro-cid-bvzihdzo].sidebar{box-sizing:border-box;width:260px;padding:2rem 1rem;font-size:.95rem;position:sticky;top:4rem;align-self:start}.sidebar[data-astro-cid-bvzihdzo] .meta[data-astro-cid-bvzihdzo] p[data-astro-cid-bvzihdzo]{margin:.25rem 0}nav[data-astro-cid-bvzihdzo].toc li[data-astro-cid-bvzihdzo]{margin:.35rem 0 .35rem 1rem}nav[data-astro-cid-bvzihdzo].toc a[data-astro-cid-bvzihdzo]{color:var(--gray-dark,#444);text-decoration:none}nav[data-astro-cid-bvzihdzo].toc a[data-astro-cid-bvzihdzo]:hover{text-decoration:underline}article[data-astro-cid-bvzihdzo].prose{max-width:75rem;width:100%;margin:0 auto;padding:2rem 1rem}@media (max-width: 768px){main[data-astro-cid-bvzihdzo].page{grid-template-columns:1fr}aside[data-astro-cid-bvzihdzo].sidebar{position:static;width:100%;padding:1rem}article[data-astro-cid-bvzihdzo].prose{max-width:100%;padding:1rem}}.series-list[data-astro-cid-bvzihdzo]{list-style:none;margin:0;padding-left:10px}.series-list[data-astro-cid-bvzihdzo]{list-style:none;margin:0;padding-left:10px;max-height:calc(16em + .5rem);overflow-y:auto}.series-list[data-astro-cid-bvzihdzo]::-webkit-scrollbar{width:6px}.series-list[data-astro-cid-bvzihdzo]::-webkit-scrollbar-thumb{background:#0003;border-radius:3px}
</style></head> <body data-astro-cid-bvzihdzo> <header data-astro-cid-3ef6ksr2> <nav data-astro-cid-3ef6ksr2> <!--<h2><a href="/">{SITE_TITLE}</a></h2>--> <h2 data-astro-cid-3ef6ksr2><a style="padding-left:0;color:blue;" href="/" data-astro-cid-3ef6ksr2>Ge Yuxu<br data-astro-cid-3ef6ksr2>AI & Engineering</a></h2> <div class="internal-links" data-astro-cid-3ef6ksr2> <a href="/" data-astro-cid-3ef6ksr2="true" data-astro-cid-eimmu3lg> Home </a>  <a href="/blog/1" class="active" data-astro-cid-3ef6ksr2="true" data-astro-cid-eimmu3lg> Blog </a>  <a href="/series" data-astro-cid-3ef6ksr2="true" data-astro-cid-eimmu3lg> Series </a>  <a href="/projects" data-astro-cid-3ef6ksr2="true" data-astro-cid-eimmu3lg> Projects </a>  </div> <div class="social-links" data-astro-cid-3ef6ksr2> <a href="https://github.com/geyuxu" target="_blank" data-astro-cid-3ef6ksr2> <span class="sr-only" data-astro-cid-3ef6ksr2>Go to Ge Yuxu's GitHub repo</span> <svg viewBox="0 0 16 16" aria-hidden="true" width="32" height="32" data-astro-cid-3ef6ksr2><path fill="currentColor" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.012 8.012 0 0 0 16 8c0-4.42-3.58-8-8-8z" data-astro-cid-3ef6ksr2></path></svg> </a> <a href="https://www.linkedin.com/in/geyuxu/" target="_blank" data-astro-cid-3ef6ksr2> <span class="sr-only" data-astro-cid-3ef6ksr2>Go to Ge Yuxu's LinkedIn profile</span> <svg viewBox="0 0 24 24" width="32" height="32" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" data-astro-cid-3ef6ksr2> <path fill="currentColor" d="M20.447 20.452H17.2v-5.569c0-1.328-.025-3.039-1.852-3.039-1.853 0-2.136 1.447-2.136 2.942v5.666h-3.248V9h3.122v1.561h.045c.435-.823 1.498-1.688 3.083-1.688 3.295 0 3.903 2.17 3.903 4.989v6.59zM5.337 7.433a1.882 1.882 0 110-3.764 1.882 1.882 0 010 3.764zm1.626 13.019H3.708V9h3.255v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.226.792 24 1.771 24h20.451C23.2 24 24 23.226 24 22.271V1.729C24 .774 23.2 0 22.222 0z" data-astro-cid-3ef6ksr2></path> </svg> </a> </div> </nav> <!-- Microsoft Clarity --> <script type="text/javascript">
		(function(c,l,a,r,i,t,y){
			c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
			t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
			y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
		})(window, document, "clarity", "script", "rc2w96osp6");
	</script> </header>  <main class="page" data-astro-cid-bvzihdzo> <!-- å·¦ä¾§æ  --> <aside class="sidebar" data-astro-cid-bvzihdzo> <div class="meta" data-astro-cid-bvzihdzo> <b data-astro-cid-bvzihdzo>ä½¿ç”¨ Spring AI æ„å»º RAG æœç´¢æœåŠ¡è®¾è®¡</b> <p data-astro-cid-bvzihdzo><time datetime="2025-04-28T16:00:00.000Z"> 2025/04/29 00:00:00 </time></p>   <p class="series_title" style="margin-top:1rem;font-weight:bold;" data-astro-cid-bvzihdzo>ç³»åˆ—ï¼š<a href="/series/åŸºäº-spring-ai-qdrant-elisticsearch-çš„-rag-æœç´¢æœåŠ¡/" data-astro-cid-bvzihdzo>åŸºäº Spring AI + Qdrant + Elisticsearch çš„ RAG æœç´¢æœåŠ¡</a></p> <ul class="series-list" data-astro-cid-bvzihdzo> <li data-astro-cid-bvzihdzo>ğŸ‰&nbsp;<a href="/blog/ai/llm_rag_agent/spring_ai_rag/1_ä½¿ç”¨-spring-ai-æ„å»º-rag-æœç´¢æœåŠ¡è®¾è®¡/" data-astro-cid-bvzihdzo>ä½¿ç”¨ Spring AI æ„å»º RAG æœç´¢æœåŠ¡è®¾è®¡</a></li><li data-astro-cid-bvzihdzo>ğŸ‰&nbsp;<a href="/blog/ai/llm_rag_agent/spring_ai_rag/2_java-rag-å¼€å‘ç¯å¢ƒå‡†å¤‡/" data-astro-cid-bvzihdzo>Java RAG å¼€å‘ç¯å¢ƒå‡†å¤‡</a></li> </ul>  </div> <hr data-astro-cid-bvzihdzo> <br data-astro-cid-bvzihdzo> </aside> <!-- å³ä¾§æ­£æ–‡åŒºåŸŸï¼ˆflex å±…ä¸­ï¼‰ --> <div class="content-wrapper" data-astro-cid-bvzihdzo> <article class="prose" data-astro-cid-bvzihdzo>  <article class="content"> <nav class="toc"><ol class="toc-level toc-level-1"><li class="toc-item toc-item-h2"><a class="toc-link toc-link-h2" href="#é¡¹ç›®æ¦‚è¿°">é¡¹ç›®æ¦‚è¿°</a></li><li class="toc-item toc-item-h2"><a class="toc-link toc-link-h2" href="#æ•´ä½“æ¶æ„">æ•´ä½“æ¶æ„</a></li><li class="toc-item toc-item-h2"><a class="toc-link toc-link-h2" href="#æ ¸å¿ƒæ¨¡å—è®¾è®¡">æ ¸å¿ƒæ¨¡å—è®¾è®¡</a><ol class="toc-level toc-level-2"><li class="toc-item toc-item-h3"><a class="toc-link toc-link-h3" href="#å‘é‡å­˜å‚¨ä¸æ··åˆæ£€ç´¢æ¨¡å—">å‘é‡å­˜å‚¨ä¸æ··åˆæ£€ç´¢æ¨¡å—</a></li><li class="toc-item toc-item-h3"><a class="toc-link toc-link-h3" href="#llm-æ¨ç†ä¸åˆ‡æ¢æ¨¡å—">LLM æ¨ç†ä¸åˆ‡æ¢æ¨¡å—</a></li><li class="toc-item toc-item-h3"><a class="toc-link toc-link-h3" href="#æ–‡æœ¬åµŒå…¥ç”Ÿæˆæ¨¡å—">æ–‡æœ¬åµŒå…¥ç”Ÿæˆæ¨¡å—</a></li></ol></li><li class="toc-item toc-item-h2"><a class="toc-link toc-link-h2" href="#æ•°æ®æµç¨‹è¯´æ˜">æ•°æ®æµç¨‹è¯´æ˜</a><ol class="toc-level toc-level-2"><li class="toc-item toc-item-h3"><a class="toc-link toc-link-h3" href="#æ–‡æ¡£ç´¢å¼•æµç¨‹-etlç¦»çº¿å…¥åº“">æ–‡æ¡£ç´¢å¼•æµç¨‹ (ETLç¦»çº¿å…¥åº“)</a></li><li class="toc-item toc-item-h3"><a class="toc-link toc-link-h3" href="#åœ¨çº¿æ£€ç´¢é—®ç­”æµç¨‹">åœ¨çº¿æ£€ç´¢é—®ç­”æµç¨‹</a></li></ol></li><li class="toc-item toc-item-h2"><a class="toc-link toc-link-h2" href="#å…³é”®ç»„ä»¶ä¸æ¥å£å®šä¹‰">å…³é”®ç»„ä»¶ä¸æ¥å£å®šä¹‰</a><ol class="toc-level toc-level-2"><li class="toc-item toc-item-h3"><a class="toc-link toc-link-h3" href="#é…ç½®ä¸ç»„ä»¶æ‘˜è¦">é…ç½®ä¸ç»„ä»¶æ‘˜è¦</a></li><li class="toc-item toc-item-h3"><a class="toc-link toc-link-h3" href="#ragservice-æ¥å£å®šä¹‰">RagService æ¥å£å®šä¹‰</a></li><li class="toc-item toc-item-h3"><a class="toc-link toc-link-h3" href="#ç¤ºä¾‹-controller">ç¤ºä¾‹ Controller</a></li></ol></li><li class="toc-item toc-item-h2"><a class="toc-link toc-link-h2" href="#docker-compose-ç¯å¢ƒéƒ¨ç½²æ–¹æ¡ˆ">Docker Compose ç¯å¢ƒéƒ¨ç½²æ–¹æ¡ˆ</a></li><li class="toc-item toc-item-h2"><a class="toc-link toc-link-h2" href="#ç»“è®º">ç»“è®º</a></li></ol></nav><h2 id="é¡¹ç›®æ¦‚è¿°"><a aria-hidden="true" tabindex="-1" href="#é¡¹ç›®æ¦‚è¿°"><span class="icon icon-link"></span></a>é¡¹ç›®æ¦‚è¿°</h2>
<p>æœ¬æ–‡æ¡£è®¾è®¡äº†ä¸€å¥—åŸºäºSpring Bootå’ŒSpring AIæ¡†æ¶çš„æ£€ç´¢å¢å¼ºç”Ÿæˆï¼ˆRetrieval-Augmented Generation, RAGï¼‰æœç´¢æœåŠ¡ã€‚è¯¥æœåŠ¡é€šè¿‡èåˆElasticsearchå…³é”®è¯æ£€ç´¢å’ŒQdrantå‘é‡æ£€ç´¢ï¼Œå®ç°å¯¹æ–‡æ¡£çŸ¥è¯†åº“çš„é«˜ç›¸å…³æ€§æŸ¥è¯¢ï¼Œå¹¶ç»“åˆå¤§è¯­è¨€æ¨¡å‹(LLM)ç”Ÿæˆæœ€ç»ˆå›ç­”ã€‚ç³»ç»Ÿæ”¯æŒåœ¨æœ¬åœ°æ¨¡å‹ï¼ˆé€šè¿‡Ollamaè¿è¡Œå¼€æºæ¨¡å‹ï¼‰ä¸OpenAIäº‘æ¥å£ä¹‹é—´çµæ´»åˆ‡æ¢æ¨ç†æ–¹å¼ï¼Œå¹¶æ”¯æŒä½¿ç”¨æœ¬åœ° HuggingFace åµŒå…¥æ¨¡å‹æˆ–OpenAI Embedding APIç”Ÿæˆæ–‡æœ¬å‘é‡ã€‚è®¾è®¡æ¶µç›–æ€»ä½“æ¶æ„ã€æ ¸å¿ƒæ¨¡å—ã€æ¥å£å®šä¹‰ã€æ•°æ®æµç¨‹ã€å…³é”®ç±»é…ç½®å’Œç¤ºä¾‹æ§åˆ¶å±‚ï¼Œå¹¶æä¾›å®Œæ•´çš„Docker Composeç¯å¢ƒé…ç½®ï¼Œç¡®ä¿æ–¹æ¡ˆå¯å¤ç°ä¸”ç»“æ„æ¸…æ™°ã€‚</p>
<h2 id="æ•´ä½“æ¶æ„"><a aria-hidden="true" tabindex="-1" href="#æ•´ä½“æ¶æ„"><span class="icon icon-link"></span></a>æ•´ä½“æ¶æ„</h2>
<p><img src="https://img.geyuxu.com/2025-04-29-120648mNImZC.png" alt="image-20250429120643387"></p>
<p>ç³»ç»Ÿæ•´ä½“æ¶æ„é‡‡ç”¨åˆ†å±‚æ¨¡å—åŒ–è®¾è®¡ï¼Œæ ¸å¿ƒåŒ…æ‹¬ä»¥ä¸‹éƒ¨åˆ†ï¼š</p>
<ul>
<li>æ–‡æ¡£å‘é‡å­˜å‚¨ï¼ˆVector Storeï¼‰ï¼šä½¿ç”¨ Qdrant ä½œä¸ºå‘é‡æ•°æ®åº“å­˜å‚¨æ–‡æ¡£çš„è¯­ä¹‰å‘é‡è¡¨ç¤ºï¼Œç”¨äºè¯­ä¹‰ç›¸ä¼¼åº¦æ£€ç´¢ã€‚Spring AI æä¾›äº†æŠ½è±¡çš„ VectorStore æ¥å£æ¥å°è£…å‘é‡æ•°æ®åº“æ“ä½œ ã€‚é€šè¿‡å¼•å…¥ Spring AI çš„ Qdrant é›†æˆæ¨¡å—ï¼Œå¯ä»¥å°† Qdrant ç”¨ä½œ VectorStoreï¼Œåœ¨åº”ç”¨ä¸­æ‰§è¡Œé«˜æ•ˆçš„ç›¸ä¼¼åº¦æŸ¥è¯¢ã€‚</li>
<li>å…¨æ–‡æ£€ç´¢å¼•æ“ï¼šä½¿ç”¨ Elasticsearch å­˜å‚¨æ–‡æ¡£çš„åŸå§‹æ–‡æœ¬æˆ–å…³é”®è¯ç´¢å¼•ï¼Œç”¨äºåŸºäºå…³é”®è¯çš„å¸ƒå°”/å…¨æ–‡æ£€ç´¢ã€‚Elasticsearch æä¾›å€’æ’ç´¢å¼•èƒ½å¤Ÿæœ‰æ•ˆåŒ¹é…ç”¨æˆ·æŸ¥è¯¢ä¸­çš„å…³é”®è¯ã€‚</li>
<li>æ··åˆæ£€ç´¢å™¨ï¼ˆHybrid Retrieverï¼‰ï¼šRAGæœåŠ¡çš„æ£€ç´¢å±‚ç»„ä»¶ï¼Œè´Ÿè´£å°†å…³é”®è¯æ£€ç´¢ä¸å‘é‡è¯­ä¹‰æ£€ç´¢ç»“æœç»“åˆã€‚æŸ¥è¯¢æ—¶åŒæ—¶å¯¹ESæ‰§è¡Œå…³é”®è¯åŒ¹é…æ£€ç´¢ï¼Œå¯¹Qdrantæ‰§è¡Œå‘é‡ç›¸ä¼¼åº¦æ£€ç´¢ï¼Œè·å–ä¸¤æ–¹é¢çš„æ–‡æ¡£åˆ—è¡¨ï¼Œå¹¶è¿›è¡Œç»“æœèåˆã€‚é€šè¿‡æ··åˆæ£€ç´¢ï¼Œæ—¢èƒ½åˆ©ç”¨å…³é”®è¯ç²¾ç¡®åŒ¹é…ï¼Œåˆèƒ½åˆ©ç”¨å‘é‡æ£€ç´¢æ•è·è¯­ä¹‰ç›¸å…³å†…å®¹ï¼Œæå‡å¬å›ç‡å’Œå‡†ç¡®æ€§ã€‚Spring AI æä¾›äº† DocumentRetriever æ¥å£è¡¨ç¤ºæŠ½è±¡çš„æ–‡æ¡£æ£€ç´¢å™¨ï¼Œä»¥åŠå‘é‡æ£€ç´¢å®ç° VectorStoreDocumentRetriever  ï¼›æœ¬æ–¹æ¡ˆå¯è‡ªå®šä¹‰å®ç°ä¸€ä¸ªHybridRetrieverï¼Œå†…éƒ¨ç»„åˆè°ƒç”¨ ES å’Œ Qdrant çš„æ£€ç´¢æ¥å£ï¼Œç„¶åç”¨ æ–‡æ¡£åˆå¹¶å™¨å°†ç»“æœåˆå¹¶ï¼ˆå¯ç®€å•å»é‡æ‹¼æ¥ï¼Œæˆ–æŒ‰åˆ†æ•°èåˆï¼‰ã€‚ä¾‹å¦‚ï¼Œå¯ä½¿ç”¨ Spring AI çš„ ConcatenationDocumentJoiner å°†å¤šæ•°æ®æºçš„ç»“æœé›†åˆå¹¶ä¸ºä¸€ä¸ªæ–‡æ¡£åˆ—è¡¨ ã€‚</li>
<li>RAGæœåŠ¡å±‚ï¼šå°è£…æ•´ä¸ªâ€œæ£€ç´¢-ç”Ÿæˆâ€æµç¨‹çš„æ ¸å¿ƒæœåŠ¡ï¼ˆå¯ç§°ä¸º RagServiceï¼‰ã€‚å®ƒè´Ÿè´£æ¥æ”¶ç”¨æˆ·æŸ¥è¯¢ï¼Œè°ƒç”¨Hybrid Retrieveræ£€ç´¢ç›¸å…³æ–‡æ¡£ï¼Œå°†æ£€ç´¢åˆ°çš„æ–‡æ¡£ä½œä¸ºä¸Šä¸‹æ–‡æäº¤ç»™LLMï¼Œå¹¶è¿”å›ç”Ÿæˆçš„ç­”æ¡ˆã€‚RAGæœåŠ¡é€šè¿‡ Spring AI æä¾›çš„ ChatClient ä¸åº•å±‚LLMæ¨¡å‹äº¤äº’ ã€‚ChatClientæŠ½è±¡å‡ºä¸AIæ¨¡å‹äº¤äº’çš„é€šç”¨æ¥å£ï¼Œæ”¯æŒåŒæ­¥æˆ–æµå¼åœ°å‘é€æç¤ºå¹¶è·å¾—å›å¤ ã€‚å€ŸåŠ©Spring AIçš„æ¨¡å—åŒ–è®¾è®¡ï¼Œå¯ä»¥æ–¹ä¾¿åœ°æ›´æ¢åº•å±‚ä½¿ç”¨çš„LLMæˆ–å‘é‡åº“ï¼Œè€Œæ— éœ€å¤§æ”¹ä¸šåŠ¡ä»£ç  ã€‚</li>
<li>LLMæ¨ç†å±‚ï¼šå¤§è¯­è¨€æ¨¡å‹ç”¨äºæ ¹æ®ç”¨æˆ·æŸ¥è¯¢å’Œæ£€ç´¢åˆ°çš„æ–‡æ¡£ä¸Šä¸‹æ–‡ç”Ÿæˆå›ç­”ã€‚é€šè¿‡Spring AIçš„ChatModelä¸ChatClientæŠ½è±¡ï¼Œæˆ‘ä»¬å¯ä»¥æ— ç¼åˆ‡æ¢ä¸åŒçš„æ¨¡å‹å’Œæä¾›å•†ã€‚ä¾‹å¦‚ï¼Œå½“ä½¿ç”¨OpenAIæ—¶ï¼Œå¯é…ç½®ChatClientè°ƒç”¨OpenAIçš„GPTæ¨¡å‹ï¼›å½“ä½¿ç”¨æœ¬åœ°æ¨¡å‹æ—¶ï¼Œåˆ©ç”¨Ollamaæä¾›æœ¬åœ°LLMæ¨ç†æœåŠ¡ã€‚ChatClientå±è”½äº†åº•å±‚å·®å¼‚ï¼Œä»¥ç»Ÿä¸€çš„APIå‘é€Promptå¹¶è·å–æ¨¡å‹å“åº” ã€‚</li>
<li>åµŒå…¥æ¨¡å‹ï¼šå°†æ–‡æœ¬è½¬æ¢ä¸ºå‘é‡è¡¨ç¤ºçš„åµŒå…¥æ¨¡å‹ç»„ä»¶ã€‚ç³»ç»Ÿæ”¯æŒä¸¤ç§æ–¹æ¡ˆï¼š
<ol>
<li>æœ¬åœ° HuggingFace æ¨¡å‹ï¼šé€šè¿‡Spring AIçš„Transformers ONNXæ”¯æŒï¼ŒåŠ è½½æœ¬åœ°é¢„è®­ç»ƒçš„Transformeræ¨¡å‹ï¼ˆä¾‹å¦‚all-MiniLM-L6-v2ï¼‰ä»¥ç”Ÿæˆæ–‡æœ¬åµŒå…¥ ã€‚æ­¤æ–¹å¼ä¿è¯æ•°æ®ä¸å‡ºæœ¬åœ°ï¼Œå“åº”é€Ÿåº¦å¿«ä¸”æ— éœ€è°ƒç”¨å¤–éƒ¨APIã€‚</li>
<li>OpenAI Embedding APIï¼šåˆ©ç”¨OpenAIçš„embeddingæ¥å£ï¼ˆå¦‚text-embedding-ada-002ï¼‰è·å–æ–‡æœ¬çš„å‘é‡è¡¨ç¤ºï¼Œéœ€è¦ç½‘ç»œè°ƒç”¨å’ŒAPIå¯†é’¥ã€‚Spring AI æä¾›äº†å¼€ç®±å³ç”¨çš„ OpenAiEmbeddingModel å®ç°ï¼Œæˆ‘ä»¬åªéœ€æä¾› OpenAI API key å³å¯ä½¿ç”¨ ã€‚</li>
</ol>
</li>
</ul>
<p>ä¸Šè¿°ç»„ä»¶é€šè¿‡Spring Bootè¿›è¡Œé…ç½®å’Œç»„ç»‡ï¼Œæœ€ç»ˆä»¥RESTful APIå½¢å¼æä¾›æœåŠ¡ï¼ŒåŒ…æ‹¬æ–‡æ¡£å…¥åº“æ¥å£å’Œé—®ç­”æŸ¥è¯¢æ¥å£ã€‚ä¸‹å›¾å±•ç¤ºäº†ç³»ç»Ÿå„ç»„ä»¶çš„äº¤äº’å…³ç³»ï¼š</p>
<p>(æ¶æ„è¯´æ˜ï¼šç”¨æˆ·é€šè¿‡Controllerå‘å‡ºè¯·æ±‚ï¼ŒRAG Serviceè°ƒç”¨Hybrid Retrieveråˆ†åˆ«ä¸ESå’ŒQdrantäº¤äº’æ£€ç´¢æ–‡æ¡£ï¼›åµŒå…¥æ¨¡å‹ç”¨äºå‘é‡ç”Ÿæˆä¾›Qdrantå­˜å‚¨ä¸æ£€ç´¢ï¼›ChatClientå°è£…LLMæ¨¡å‹è°ƒç”¨ï¼ˆæœ¬åœ°æˆ–äº‘ï¼‰ï¼›æœ€ç»ˆå°†æ£€ç´¢åˆ°çš„ç›¸å…³æ–‡æ¡£ä½œä¸ºæç¤ºä¸Šä¸‹æ–‡ï¼Œäº¤ç”±LLMç”Ÿæˆç­”æ¡ˆå¹¶è¿”å›ç»™ç”¨æˆ·ã€‚)</p>
<h2 id="æ ¸å¿ƒæ¨¡å—è®¾è®¡"><a aria-hidden="true" tabindex="-1" href="#æ ¸å¿ƒæ¨¡å—è®¾è®¡"><span class="icon icon-link"></span></a>æ ¸å¿ƒæ¨¡å—è®¾è®¡</h2>
<h3 id="å‘é‡å­˜å‚¨ä¸æ··åˆæ£€ç´¢æ¨¡å—"><a aria-hidden="true" tabindex="-1" href="#å‘é‡å­˜å‚¨ä¸æ··åˆæ£€ç´¢æ¨¡å—"><span class="icon icon-link"></span></a>å‘é‡å­˜å‚¨ä¸æ··åˆæ£€ç´¢æ¨¡å—</h3>
<p>Qdrant å‘é‡å­˜å‚¨é…ç½®ï¼šç³»ç»Ÿä½¿ç”¨Qdrantæ¥æŒä¹…åŒ–æ–‡æ¡£å‘é‡åŠå…ƒæ•°æ®ã€‚é€šè¿‡å¼•å…¥ä¾èµ– spring-ai-qdrant-storeï¼ŒSpring AIèƒ½å¤Ÿè‡ªåŠ¨é…ç½®Qdrantç›¸å…³çš„Bean  ã€‚æˆ‘ä»¬éœ€è¦æä¾›Qdrantå®¢æˆ·ç«¯ä»¥åŠVectorStore Beanï¼Œä¾‹å¦‚ï¼š</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="java"><code><span class="line"><span style="color:#E1E4E8">@</span><span style="color:#F97583">Bean</span></span>
<span class="line"><span style="color:#F97583">public</span><span style="color:#E1E4E8"> QdrantClient </span><span style="color:#B392F0">qdrantClient</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#6A737D">    // æ„å»ºè¿æ¥åˆ° Qdrant çš„ gRPC å®¢æˆ·ç«¯</span></span>
<span class="line"><span style="color:#E1E4E8">    QdrantGrpcClient.Builder grpcClientBuilder </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> </span></span>
<span class="line"><span style="color:#E1E4E8">        QdrantGrpcClient.</span><span style="color:#B392F0">newBuilder</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"qdrant-host"</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">6334</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">false</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">    grpcClientBuilder.</span><span style="color:#B392F0">withApiKey</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"&#x3C;QDRANT_API_KEY>"</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#F97583">    return</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> QdrantClient</span><span style="color:#E1E4E8">(grpcClientBuilder.</span><span style="color:#B392F0">build</span><span style="color:#E1E4E8">());</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">@</span><span style="color:#F97583">Bean</span></span>
<span class="line"><span style="color:#F97583">public</span><span style="color:#E1E4E8"> VectorStore </span><span style="color:#B392F0">vectorStore</span><span style="color:#E1E4E8">(QdrantClient client, EmbeddingModel embeddingModel) {</span></span>
<span class="line"><span style="color:#F97583">    return</span><span style="color:#E1E4E8"> QdrantVectorStore.</span><span style="color:#B392F0">builder</span><span style="color:#E1E4E8">(client, embeddingModel)</span></span>
<span class="line"><span style="color:#E1E4E8">            .</span><span style="color:#B392F0">collectionName</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"documents"</span><span style="color:#E1E4E8">)       </span><span style="color:#6A737D">// æŒ‡å®šé›†åˆåç§°</span></span>
<span class="line"><span style="color:#E1E4E8">            .</span><span style="color:#B392F0">initializeSchema</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">true</span><span style="color:#E1E4E8">)            </span><span style="color:#6A737D">// è‹¥æœªé¢„å»ºé›†åˆåˆ™è‡ªåŠ¨åˆ›å»º</span></span>
<span class="line"><span style="color:#E1E4E8">            .</span><span style="color:#B392F0">build</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p>ä¸Šè¿°é…ç½®åˆ›å»ºäº†VectorStoreæ¥å£çš„Qdrantå®ç°ï¼Œç”¨äºå­˜å‚¨å‘é‡åŠæ‰§è¡Œç›¸ä¼¼åº¦æœç´¢ã€‚  å…¶ä¸­æ³¨å…¥çš„ EmbeddingModel ç”¨äºåœ¨å­˜å‚¨æ–‡æ¡£æ—¶ç”Ÿæˆå…¶å‘é‡è¡¨ç¤ºã€‚æ³¨æ„ï¼šå¯ä»¥æå‰åœ¨Qdrantä¸­åˆ›å»ºé›†åˆå¹¶æŒ‡å®šå‘é‡ç»´åº¦å’Œç›¸ä¼¼åº¦åº¦é‡æ–¹å¼ï¼Œæˆ–é€šè¿‡ initializeSchema(true) ç”±ç¨‹åºè‡ªåŠ¨åˆ›å»º(é»˜è®¤ä½¿ç”¨ Cosine è·ç¦»ï¼Œç»´åº¦å–å†³äºæ‰€ç”¨åµŒå…¥æ¨¡å‹)  ã€‚ç¡®ä¿Qdrantå®ä¾‹å·²å¯åŠ¨å¹¶å¯è®¿é—®ï¼Œæ¯”å¦‚é€šè¿‡Dockerå¯åŠ¨ Qdrant å®¹å™¨ã€‚</p>
<p>Elasticsearch å…¨æ–‡æ£€ç´¢é…ç½®ï¼šElasticsearchç”¨äºå­˜å‚¨æ–‡æ¡£æ–‡æœ¬ç´¢å¼•ï¼Œå®ç°å…³é”®è¯åŒ¹é…æ£€ç´¢ã€‚å¯é‡‡ç”¨Spring Data Elasticsearchæˆ–Rest APIè¿›è¡Œé›†æˆã€‚é…ç½®ä¸Šï¼Œéœ€è¦æä¾›ESçš„åœ°å€ï¼ˆä¾‹å¦‚localhost:9200ï¼‰ã€ç´¢å¼•åç§°ï¼ˆå¦‚documentsï¼‰ä»¥åŠç´¢å¼•mappingï¼ˆåŒ…å«æ–‡æ¡£IDã€å†…å®¹ç­‰å­—æ®µï¼‰ã€‚ä¸ºäº†ç®€åŒ–ï¼Œå®ç°ä¸Šå¯ä»¥åˆ©ç”¨Spring Data Elasticsearchå®šä¹‰ä¸€ä¸ªæ–‡æ¡£å®ä½“åŠå¯¹åº”çš„Repositoryã€‚ä¾‹å¦‚å®šä¹‰DocumentEntity(id, content, metadata)å¹¶å»ºç«‹å…¨æ–‡ç´¢å¼•ã€‚</p>
<p>æ–‡æ¡£ç´¢å¼•ç»“æ„ï¼šä¸ºäº†æ–¹ä¾¿æ··åˆæ£€ç´¢ç»“æœçš„åˆå¹¶ï¼Œæˆ‘ä»¬ä¸ºæ¯ä¸ªæ–‡æ¡£ç‰‡æ®µåˆ†é…å”¯ä¸€IDï¼Œå¹¶åœ¨Qdrantå’ŒElasticsearchä¸­å…±äº«è¯¥IDä½œä¸ºä¸»é”®ã€‚æ¯ä»½æ–‡æ¡£åœ¨å…¥åº“æ—¶é€šå¸¸ä¼šè¢«æ‹†åˆ†æˆè‹¥å¹²ç‰‡æ®µ (chunks)ï¼Œæ¯ä¸ªç‰‡æ®µæ˜¯ä¸€æ®µé€‚åˆæ£€ç´¢å’Œä¸Šä¸‹æ–‡é•¿åº¦çš„æ–‡æœ¬ã€‚æˆ‘ä»¬å°†æ¯ä¸ªç‰‡æ®µä½œä¸ºç‹¬ç«‹çš„Documentè¿›è¡Œç´¢å¼•å’Œå‘é‡å­˜å‚¨ã€‚è¿™æ ·åœ¨æ£€ç´¢é˜¶æ®µï¼Œæ— è®ºé€šè¿‡å‘é‡è¿˜æ˜¯å…³é”®è¯æ‰¾åˆ°æŸç‰‡æ®µï¼Œéƒ½å¯ä»¥æ ¹æ®IDç¡®å®šå¯¹åº”çš„å†…å®¹ã€‚å¯ä»¥å°†æ–‡æ¡£å†…å®¹å­˜å‚¨åœ¨ESç´¢å¼•ä¸­ï¼Œè€Œåœ¨Qdrantä¸­ä¸»è¦å­˜å‚¨å‘é‡å’Œå¿…è¦çš„å…ƒä¿¡æ¯(å¦‚æ–‡æ¡£IDã€æ¥æºç­‰)ä½œä¸º payloadã€‚</p>
<p>Hybrid Retriever å®ç°ï¼šåˆ›å»ºä¸€ä¸ªæ··åˆæ£€ç´¢å™¨ï¼Œä¾‹å¦‚ HybridRetriever implements DocumentRetrieverã€‚å…¶retrieve(Query query)æ–¹æ³•å†…éƒ¨æ‰§è¡Œä»¥ä¸‹æ­¥éª¤ï¼š</p>
<ul>
<li>ä½¿ç”¨ESæ‰§è¡Œå…³é”®è¯æŸ¥è¯¢ï¼šå¦‚æ„é€ ä¸€ä¸ªmatchæˆ–boolæŸ¥è¯¢ï¼ŒåŒ¹é…contentå­—æ®µåŒ…å«æŸ¥è¯¢æ–‡æœ¬ï¼Œå–Top Kç»“æœã€‚å¯å€ŸåŠ©ESçš„RESTå®¢æˆ·ç«¯æˆ–Repositoryæ–¹æ³•å®ç°ï¼Œå¾—åˆ°ä¸€ç»„Documentç‰‡æ®µåˆ—è¡¨ï¼ˆå«IDå’Œå†…å®¹ï¼‰ã€‚</li>
<li>ä½¿ç”¨Qdrantæ‰§è¡Œç›¸ä¼¼åº¦æŸ¥è¯¢ï¼šè°ƒç”¨ä¸Šé¢é…ç½®çš„vectorStore.similaritySearch()æ–¹æ³•ï¼Œå¯¹ç”¨æˆ·æŸ¥è¯¢æ–‡æœ¬è¿›è¡Œå‘é‡æŸ¥è¯¢ï¼Œè·å–Top Kç›¸ä¼¼æ–‡æ¡£ç‰‡æ®µ ã€‚Spring AI æä¾›äº† SearchRequest å¯æŒ‡å®šç›¸ä¼¼åº¦é˜ˆå€¼å’ŒtopKç­‰å‚æ•°  ã€‚ä¾‹å¦‚ï¼š</li>
</ul>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="java"><code><span class="line"><span style="color:#E1E4E8"> List&#x3C;</span><span style="color:#F97583">Document</span><span style="color:#E1E4E8">> vectorDocs </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> vectorStore.</span><span style="color:#B392F0">similaritySearch</span><span style="color:#E1E4E8">(</span></span>
<span class="line"><span style="color:#E1E4E8">       SearchRequest.</span><span style="color:#B392F0">builder</span><span style="color:#E1E4E8">()</span></span>
<span class="line"><span style="color:#E1E4E8">           .</span><span style="color:#B392F0">query</span><span style="color:#E1E4E8">(userQuery)</span></span>
<span class="line"><span style="color:#E1E4E8">           .</span><span style="color:#B392F0">topK</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">5</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">           .</span><span style="color:#B392F0">build</span><span style="color:#E1E4E8">()</span></span>
<span class="line"><span style="color:#E1E4E8"> );</span></span></code></pre>
<p>è¿™å°†è¿”å›ä¸æŸ¥è¯¢æœ€ç›¸ä¼¼çš„5ä¸ªæ–‡æ¡£ç‰‡æ®µã€‚</p>
<ul>
<li>åˆå¹¶ç»“æœï¼šå°†å…³é”®è¯ç»“æœä¸å‘é‡ç»“æœåˆå¹¶ã€‚å¯ä»¥ç”¨æ–‡æ¡£IDå»é‡ï¼Œé¿å…åŒä¸€ç‰‡æ®µé‡å¤ã€‚ç®€å•ç­–ç•¥æ˜¯ç›´æ¥åˆå¹¶åˆ—è¡¨ï¼›å¦‚éœ€æ›´ç²¾ç»†çš„èåˆï¼Œå¯æ ¹æ®ESç›¸å…³åº¦åˆ†å€¼å’Œå‘é‡ç›¸ä¼¼åº¦åˆ†å€¼å¯¹ç»“æœé‡æ–°æ’åºæˆ–åŠ æƒã€‚ç”±äºä¸åŒæ£€ç´¢çš„åˆ†æ•°ä¸ç›´æ¥å¯æ¯”ï¼Œä¸€ä¸ªå®é™…å·¥ç¨‹ç­–ç•¥æ˜¯ä¿ç•™å„è‡ªTop Kçš„ç»“æœï¼Œç„¶åè®©ä¸Šå±‚LLMåŸºäºè¿™äº›å€™é€‰ç‰‡æ®µè‡ªè¡Œåˆ¤æ–­ç›¸å…³æ€§ã€‚è¿™é‡Œæˆ‘ä»¬é‡‡å–ç®€å•å»é‡åˆå¹¶ç­–ç•¥ï¼Œå¹¶é™åˆ¶æ€»ç‰‡æ®µæ•°ï¼ˆå¦‚å–ä¸è¶…è¿‡6-10ä¸ªç‰‡æ®µï¼‰ä»¥æ§åˆ¶æç¤ºé•¿åº¦ã€‚</li>
<li>è¾“å‡ºï¼šè¿”å›åˆå¹¶åçš„Documentåˆ—è¡¨ã€‚æ¯ä¸ªDocumentåŒ…å«å†…å®¹æ–‡æœ¬ï¼Œä»¥åŠå¯èƒ½çš„å…ƒæ•°æ®ï¼ˆä¾‹å¦‚æ¥æºæ ‡è¯†ç”¨äºè¾“å‡ºå¼•ç”¨ï¼‰ã€‚
é€šè¿‡HybridRetrieverï¼Œæˆ‘ä»¬å°†è¯­ä¹‰åŒ¹é…å’Œç²¾ç¡®åŒ¹é…ç»“åˆï¼Œæœ€å¤§ç¨‹åº¦æ‰¾åˆ°ç›¸å…³å†…å®¹ã€‚ä¾‹å¦‚ï¼Œå½“ç”¨æˆ·æŸ¥è¯¢ä¸­åŒ…å«ä¸æ–‡æ¡£ä¸åŒçš„æªè¾æ—¶ï¼Œå‘é‡æ£€ç´¢å¯æ‰¾åˆ°è¯­ä¹‰ç›¸ä¼¼çš„å†…å®¹ï¼Œè€Œå…³é”®è¯æ£€ç´¢å¯ä¿è¯è‹¥æœ‰ç²¾ç¡®åŒ¹é…çš„æœ¯è¯­ä¸ä¼šè¢«é—æ¼ã€‚</li>
</ul>
<h3 id="llm-æ¨ç†ä¸åˆ‡æ¢æ¨¡å—"><a aria-hidden="true" tabindex="-1" href="#llm-æ¨ç†ä¸åˆ‡æ¢æ¨¡å—"><span class="icon icon-link"></span></a>LLM æ¨ç†ä¸åˆ‡æ¢æ¨¡å—</h3>
<p>ChatClientä¸ChatModelæŠ½è±¡ï¼šSpring AI æä¾›äº† ChatModel æ¥å£è¡¨ç¤ºå…·ä½“çš„å¤§è¯­è¨€æ¨¡å‹ï¼ˆå¦‚OpenAI ChatGPTã€Anthropic Claudeã€æœ¬åœ°Llamaç­‰ï¼‰ï¼ŒChatClient åˆ™å°è£…äº†ä¸è¿™äº›æ¨¡å‹äº¤äº’çš„é€šç”¨å®¢æˆ·ç«¯ ã€‚æœ¬æœåŠ¡é€šè¿‡æ³¨å…¥ä¸€ä¸ªChatClientå®ä¾‹æ¥è°ƒç”¨LLMè¿›è¡Œå›ç­”ç”Ÿæˆã€‚å¾—ç›ŠäºChatClientçš„æŠ½è±¡è®¾è®¡ï¼Œæˆ‘ä»¬å¯ä»¥çµæ´»åœ°æ›´æ¢èƒŒåçš„ChatModelï¼Œè€Œä¸šåŠ¡ä»£ç ä¿æŒä¸å˜ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥åœ¨é…ç½®ä¸­åˆ‡æ¢ä½¿ç”¨OpenAIçš„GPT-4æ¨¡å‹æˆ–æœ¬åœ°çš„Llama2æ¨¡å‹ ã€‚</p>
<ol>
<li>OpenAI æ¨¡å‹é›†æˆï¼šè‹¥ä½¿ç”¨OpenAIäº‘æœåŠ¡ï¼Œæ·»åŠ ä¾èµ–spring-ai-openaiï¼Œå¹¶åœ¨åº”ç”¨é…ç½®ä¸­æä¾›OpenAIçš„APIå¯†é’¥å’Œæ‰€é€‰æ¨¡å‹åç§°ã€‚ä¾‹å¦‚åœ¨application.ymlä¸­é…ç½®:</li>
</ol>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="yaml"><code><span class="line"><span style="color:#85E89D">spring</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#85E89D">  ai</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#85E89D">    openai</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#85E89D">      api-key</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">YOUR_OPENAI_API_KEY</span></span>
<span class="line"><span style="color:#85E89D">      chat</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#85E89D">        model</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">gpt-4</span></span></code></pre>
<p>è¿™å°†å¯ç”¨Spring AIå¯¹OpenAI Chat APIçš„è‡ªåŠ¨é…ç½®ã€‚æ³¨å…¥çš„ChatClientå°†é»˜è®¤ä½¿ç”¨OpenAIæŒ‡å®šçš„æ¨¡å‹ã€‚é€šè¿‡ChatClientçš„fluent APIï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿åœ°å‘é€å¯¹è¯æ¶ˆæ¯å¹¶è·å–å›å¤ã€‚ä¾‹å¦‚ï¼š</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="java"><code><span class="line"><span style="color:#E1E4E8">ChatResponse response </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> chatClient.</span><span style="color:#B392F0">prompt</span><span style="color:#E1E4E8">()</span></span>
<span class="line"><span style="color:#E1E4E8">    .</span><span style="color:#B392F0">user</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"è¯·è§£é‡ŠRAGçš„ä½œç”¨"</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">    .</span><span style="color:#B392F0">call</span><span style="color:#E1E4E8">()</span></span>
<span class="line"><span style="color:#E1E4E8">    .</span><span style="color:#B392F0">chatResponse</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#E1E4E8">String answer </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> response.</span><span style="color:#B392F0">content</span><span style="color:#E1E4E8">();</span></span></code></pre>
<p>ä¸Šè¿°è°ƒç”¨ä¼šå°†ç”¨æˆ·æ¶ˆæ¯å‘é€åˆ°é…ç½®çš„OpenAIæ¨¡å‹å¹¶è·å¾—å›ç­” ã€‚</p>
<ol start="2">
<li>æœ¬åœ°Ollamaæ¨¡å‹é›†æˆï¼šè‹¥é‡‡ç”¨æœ¬åœ°LLMæ¨¡å‹ï¼Œéœ€å®‰è£…å¹¶è¿è¡Œ Ollama æœåŠ¡ã€‚Ollamaå¯ä»¥ç®¡ç†å’Œæä¾›æœ¬åœ°æ¨¡å‹çš„æ¨ç†æœåŠ¡ï¼Œå¹¶é€šè¿‡RESTæ¥å£ä¸åº”ç”¨äº¤äº’  ã€‚å¼•å…¥ä¾èµ–spring-ai-ollamaåï¼ŒSpring AIæä¾›äº† OllamaChatModel å’Œ OllamaApi æ¥å¯¹æ¥æœ¬åœ°Ollamaå®ä¾‹ ã€‚é…ç½®ä¸Šï¼Œå¯åœ¨application.ymlä¸­æŒ‡å®šOllamaæœåŠ¡åœ°å€åŠæ‰€ç”¨æ¨¡å‹ï¼Œä¾‹å¦‚:</li>
</ol>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="yaml"><code><span class="line"><span style="color:#85E89D">spring</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#85E89D">  ai</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#85E89D">    ollama</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#85E89D">      base-url</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">http://localhost:11434</span></span>
<span class="line"><span style="color:#85E89D">      default-model</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">llama2</span></span></code></pre>
<p>å‡è®¾å·²é€šè¿‡â€œOllama pullâ€å‘½ä»¤ä¸‹è½½äº†åç§°ä¸ºâ€œllama2â€çš„æ¨¡å‹ï¼ŒOllamaå°†ä»¥è¯¥æ¨¡å‹æä¾›æ¨ç†ã€‚åº”ç”¨å¯åŠ¨æ—¶ï¼Œä¼šè‡ªåŠ¨åˆ›å»ºè¿æ¥åˆ°Ollamaçš„APIå®¢æˆ·ç«¯ (OllamaApi) å’Œå¯¹åº”çš„ ChatModel å®ç°ã€‚ChatClientéšå³å¯ä½¿ç”¨æœ¬åœ°æ¨¡å‹è¿›è¡Œå¯¹è¯ã€‚</p>
<p>ä½¿ç”¨Ollamaæ—¶ï¼Œè°ƒç”¨æ–¹å¼ä¸OpenAIç±»ä¼¼ï¼Œåªæ˜¯ç”±æœ¬åœ°æœåŠ¡äº§ç”Ÿç»“æœã€‚ä¾‹å¦‚ï¼š</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="java"><code><span class="line"><span style="color:#E1E4E8">ChatResponse response </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> chatClient.</span><span style="color:#B392F0">prompt</span><span style="color:#E1E4E8">()</span></span>
<span class="line"><span style="color:#E1E4E8">    .</span><span style="color:#B392F0">system</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"ä½ æ˜¯èµ„æ·±JavaåŠ©ç†"</span><span style="color:#E1E4E8">)   </span><span style="color:#6A737D">// å¯ä»¥è®¾å®šåˆå§‹ç³»ç»Ÿæç¤º</span></span>
<span class="line"><span style="color:#E1E4E8">    .</span><span style="color:#B392F0">user</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"ç»™å‡ºRAGæœç´¢æœåŠ¡çš„ä¼˜åŠ¿"</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">    .</span><span style="color:#B392F0">call</span><span style="color:#E1E4E8">()</span></span>
<span class="line"><span style="color:#E1E4E8">    .</span><span style="color:#B392F0">chatResponse</span><span style="color:#E1E4E8">();</span></span></code></pre>
<p>ChatClientå°†å‘æœ¬åœ°Ollamaå‘é€è¯·æ±‚å¹¶è·å–æ¨¡å‹å›å¤ã€‚</p>
<ol start="3">
<li>æ¨ç†æ–¹å¼åˆ‡æ¢ï¼šä¸ºäº†åœ¨æœ¬åœ°æ¨¡å‹å’Œäº‘APIä¹‹é—´åˆ‡æ¢ï¼Œè®¾è®¡ä¸Šå¯ä»¥ä½¿ç”¨Spring Profilesæˆ–é…ç½®å¼€å…³ã€‚ä¾‹å¦‚å®šä¹‰llm.modeé…ç½®é¡¹ï¼Œå¯å–å€¼localæˆ–openaiã€‚é€šè¿‡æ¡ä»¶é…ç½®ï¼Œåœ¨localæ¨¡å¼ä¸‹æ³¨å…¥Ollamaçš„ChatClient Beanï¼Œåœ¨openaiæ¨¡å¼ä¸‹æ³¨å…¥OpenAIçš„ChatClient Beanã€‚å€ŸåŠ©Spring AIï¼Œå¯¹ä¸åŒChatModelçš„æ”¯æŒæ˜¯å¼€ç®±å³ç”¨çš„ï¼Œå¼€å‘è€…åªéœ€æ›´æ”¹é…ç½®å³å¯æ— ç¼åˆ‡æ¢LLMæä¾›æ–¹ï¼Œå¤§å¤§å‡å°‘åˆ‡æ¢å¸¦æ¥çš„ä»£ç æ”¹åŠ¨ ã€‚</li>
</ol>
<h3 id="æ–‡æœ¬åµŒå…¥ç”Ÿæˆæ¨¡å—"><a aria-hidden="true" tabindex="-1" href="#æ–‡æœ¬åµŒå…¥ç”Ÿæˆæ¨¡å—"><span class="icon icon-link"></span></a>æ–‡æœ¬åµŒå…¥ç”Ÿæˆæ¨¡å—</h3>
<ol>
<li>HuggingFace æœ¬åœ°åµŒå…¥ï¼šä¸ºäº†ç¡®ä¿æ•°æ®å®‰å…¨å’Œé™ä½ä¾èµ–ï¼Œæœ¬æ–¹æ¡ˆæ”¯æŒä½¿ç”¨æœ¬åœ°Embeddingæ¨¡å‹ã€‚åˆ©ç”¨Spring AIçš„Transformer ONNXæ”¯æŒï¼Œæˆ‘ä»¬å¯ä»¥åœ¨Javaä¸­ç›´æ¥åŠ è½½HuggingFaceæä¾›çš„embeddingæ¨¡å‹ï¼ˆè½¬æ¢ä¸ºONNXæ ¼å¼ï¼‰å¹¶ç”Ÿæˆå‘é‡ã€‚ ä¾‹å¦‚é€‰æ‹©sentence-transformers/all-MiniLM-L6-v2æ¨¡å‹ï¼Œè¯¥æ¨¡å‹è¾“å‡º768ç»´å¥å‘é‡ã€‚é¦–å…ˆå°†ONNXæ¨¡å‹æ–‡ä»¶å’Œtokenizeræ–‡ä»¶å‡†å¤‡å¥½ï¼ˆå¯é€šè¿‡Spring AIè‡ªåŠ¨ä¸‹è½½ç¼“å­˜ï¼‰ã€‚ç„¶åé…ç½®EmbeddingModel Beanï¼š</li>
</ol>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="java"><code><span class="line"><span style="color:#E1E4E8">@</span><span style="color:#F97583">Bean</span></span>
<span class="line"><span style="color:#F97583">public</span><span style="color:#E1E4E8"> EmbeddingModel </span><span style="color:#B392F0">embeddingModel</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#E1E4E8">    TransformersEmbeddingModel model </span><span style="color:#F97583">=</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> TransformersEmbeddingModel</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#6A737D">    // å¯é€‰ï¼šæŒ‡å®šæ¨¡å‹å’Œåˆ†è¯å™¨èµ„æºè·¯å¾„æˆ–URLï¼ˆå¦åˆ™ä½¿ç”¨é»˜è®¤çš„all-MiniLM-L6-v2ï¼‰</span></span>
<span class="line"><span style="color:#E1E4E8">    model.</span><span style="color:#B392F0">setModelResource</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"classpath:/onnx/all-MiniLM-L6-v2/model.onnx"</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">    model.</span><span style="color:#B392F0">setTokenizerResource</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"classpath:/onnx/all-MiniLM-L6-v2/tokenizer.json"</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#F97583">    return</span><span style="color:#E1E4E8"> model;</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p>ä¸Šè¿° TransformersEmbeddingModel ä¼šåŠ è½½æœ¬åœ°ONNXæ¨¡å‹ï¼Œåœ¨è°ƒç”¨embed()æ—¶å¯¹è¾“å…¥æ–‡æœ¬åˆ—è¡¨è¾“å‡ºå¯¹åº”çš„å‘é‡è¡¨ç¤º  ã€‚ä½œä¸ºSpring Beanæ—¶ï¼ŒSpring AIä¼šè‡ªåŠ¨è°ƒç”¨å…¶afterPropertiesSet()å®Œæˆåˆå§‹åŒ– ã€‚ç¬¬ä¸€æ¬¡ä½¿ç”¨æ—¶æ¨¡å‹æ–‡ä»¶å¯èƒ½ä»æŒ‡å®šä½ç½®åŠ è½½æˆ–ä¸‹è½½å¹¶ç¼“å­˜ã€‚ ä¹‹åå³å¯é€šè¿‡ embeddingModel.embed(List<string> texts) è·å–åµŒå…¥å‘é‡ã€‚</string></p>
<p>å¦‚æœä½¿ç”¨Ollamaä½œä¸ºæœ¬åœ°å¼•æ“ï¼Œå¦ä¸€ç§æ–¹æ³•æ˜¯åˆ©ç”¨Ollamaçš„Embedding APIã€‚Spring AIæä¾›äº†OllamaEmbeddingModelå°è£…Ollamaçš„å‘é‡ç”Ÿæˆæ¥å£ ã€‚é€šè¿‡pullç›¸åº”çš„åµŒå…¥æ¨¡å‹ï¼ˆOllamaæ”¯æŒç›´æ¥pull HuggingFaceä¸Šçš„embeddingæ¨¡å‹ï¼Œå¦‚ollama pull hf.co/intfloat/e5-small-v2ï¼‰ï¼Œç„¶åï¼š</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="java"><code><span class="line"><span style="color:#E1E4E8">@</span><span style="color:#F97583">Bean</span></span>
<span class="line"><span style="color:#F97583">public</span><span style="color:#E1E4E8"> EmbeddingModel </span><span style="color:#B392F0">embeddingModel</span><span style="color:#E1E4E8">(OllamaApi ollamaApi) {</span></span>
<span class="line"><span style="color:#6A737D">    // å‡è®¾ä½¿ç”¨ä¸€ä¸ªåä¸º'e5-small-v2'çš„embeddingæ¨¡å‹</span></span>
<span class="line"><span style="color:#F97583">    var</span><span style="color:#E1E4E8"> options </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> OllamaOptions.</span><span style="color:#B392F0">builder</span><span style="color:#E1E4E8">().</span><span style="color:#B392F0">model</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"e5-small-v2"</span><span style="color:#E1E4E8">).</span><span style="color:#B392F0">build</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#F97583">    return</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> OllamaEmbeddingModel</span><span style="color:#E1E4E8">(ollamaApi, options);</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p>æ­¤æ–¹å¼ä¸‹ï¼Œæ‰€æœ‰æ–‡æœ¬å‘é‡å°†ç”±Ollamaæœ¬åœ°æœåŠ¡ç”Ÿæˆï¼Œæ•ˆæœç­‰åŒäºç›´æ¥ä½¿ç”¨HuggingFaceæ¨¡å‹ã€‚</p>
<ol start="2">
<li>OpenAI Embedding APIï¼šå¦‚éœ€å€ŸåŠ©OpenAIçš„é¢„è®­ç»ƒæ¨¡å‹å¿«é€Ÿè·å–åµŒå…¥ï¼Œå¯ä»¥ä½¿ç”¨OpenAIæä¾›çš„Embeddingæ¥å£ï¼ˆä¾‹å¦‚text-embedding-ada-002æ¨¡å‹ï¼‰ã€‚Spring AIçš„OpenAiEmbeddingModelå°è£…äº†è°ƒç”¨é€»è¾‘ï¼Œåªéœ€æä¾›APIå¯†é’¥å’Œå¯é€‰çš„æ¨¡å‹åç§°å³å¯ä½¿ç”¨ã€‚ä¾‹å¦‚ï¼š</li>
</ol>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="java"><code><span class="line"><span style="color:#E1E4E8">@</span><span style="color:#F97583">Bean</span></span>
<span class="line"><span style="color:#F97583">public</span><span style="color:#E1E4E8"> EmbeddingModel </span><span style="color:#B392F0">embeddingModel</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#F97583">    return</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> OpenAiEmbeddingModel</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">new</span><span style="color:#B392F0"> OpenAiApi</span><span style="color:#E1E4E8">(System.</span><span style="color:#B392F0">getenv</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"OPENAI_API_KEY"</span><span style="color:#E1E4E8">)));</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œå°†ä½¿ç”¨Adaæ¨¡å‹ç”Ÿæˆ1536ç»´çš„åµŒå…¥å‘é‡ ã€‚è¿™ç§æ–¹å¼é€‚åˆå¯¹æ¥OpenAIå¼ºå¤§çš„å‘é‡è´¨é‡ï¼Œä½†éœ€è€ƒè™‘ç½‘ç»œå»¶è¿Ÿå’Œè°ƒç”¨æˆæœ¬ã€‚</p>
<ol start="3">
<li>åµŒå…¥æ¨¡å¼åˆ‡æ¢ï¼šå’ŒLLMç±»ä¼¼ï¼Œå¯é€šè¿‡é…ç½®åˆ‡æ¢åµŒå…¥æ¨¡å‹æ¥æºã€‚æ¯”å¦‚é…ç½®embedding.modeä¸ºlocalæˆ–openaiã€‚å½“ä¸ºlocalæ—¶ï¼Œå¯ç”¨TransformersEmbeddingModelæˆ–OllamaEmbeddingModelï¼›ä¸ºopenaiæ—¶ï¼Œåˆ™ä½¿ç”¨OpenAiEmbeddingModelã€‚å¼€å‘æ—¶å¯ä»¥æä¾›é»˜è®¤å®ç°ï¼Œå¹¶å…è®¸é€šè¿‡é…ç½®æ–‡ä»¶ä¿®æ”¹ã€‚ä¾‹å¦‚é»˜è®¤é‡‡ç”¨æœ¬åœ°æ¨¡å‹ï¼Œè‹¥ç”¨æˆ·æä¾›äº†OpenAIçš„apiKeyåˆ™è‡ªåŠ¨æ”¹ç”¨OpenAIåµŒå…¥æœåŠ¡ã€‚</li>
</ol>
<p>æ— è®ºå“ªç§å®ç°ï¼Œæˆ‘ä»¬çš„VectorStoreåœ¨åˆå§‹åŒ–æ—¶éƒ½ä¼šç»‘å®šä¸€ä¸ªEmbeddingModelï¼Œç”¨äºåœ¨å‘é‡æ•°æ®åº“ä¸­å­˜å‚¨å’Œæ£€ç´¢æ—¶è½¬æ¢æ–‡æœ¬ ã€‚ä¾‹å¦‚ï¼Œä¸Šè¿°é…ç½®çš„embeddingModelå°†è¢«æ³¨å…¥åˆ°QdrantVectorStoreä¸­ï¼Œå½“è°ƒç”¨vectorStore.add(documents)æ—¶ï¼Œæ¯ä¸ªDocumentçš„æ–‡æœ¬å†…å®¹ä¼šç»ç”±EmbeddingModelè½¬ä¸ºå‘é‡å¹¶å­˜å…¥Qdrant ã€‚</p>
<h2 id="æ•°æ®æµç¨‹è¯´æ˜"><a aria-hidden="true" tabindex="-1" href="#æ•°æ®æµç¨‹è¯´æ˜"><span class="icon icon-link"></span></a>æ•°æ®æµç¨‹è¯´æ˜</h2>
<h3 id="æ–‡æ¡£ç´¢å¼•æµç¨‹-etlç¦»çº¿å…¥åº“"><a aria-hidden="true" tabindex="-1" href="#æ–‡æ¡£ç´¢å¼•æµç¨‹-etlç¦»çº¿å…¥åº“"><span class="icon icon-link"></span></a>æ–‡æ¡£ç´¢å¼•æµç¨‹ (ETLç¦»çº¿å…¥åº“)</h3>
<ol>
<li>æ–‡æ¡£è·å–ä¸é¢„å¤„ç†ï¼šé€šè¿‡ç®¡ç†åå°æˆ–æ‰¹å¤„ç†ä»»åŠ¡ï¼Œè·å–éœ€è¦çº³å…¥çŸ¥è¯†åº“çš„åŸå§‹æ–‡æ¡£ã€‚æ–‡æ¡£æ ¼å¼å¯ä»¥æ˜¯çº¯æ–‡æœ¬ã€PDFã€Markdownç­‰ã€‚ä½¿ç”¨Spring AIçš„æ–‡æ¡£è¯»å–å™¨å°†æ–‡æ¡£è½¬æ¢ä¸ºæ–‡æœ¬å†…å®¹ï¼Œå¹¶æŒ‰æ®µè½æˆ–å›ºå®šé•¿åº¦å¯¹æ–‡æœ¬è¿›è¡Œåˆ†å—ï¼Œç”Ÿæˆæ–‡æ¡£ç‰‡æ®µåˆ—è¡¨ã€‚æ¯ä¸ªç‰‡æ®µå¯ä»¥å°è£…ä¸ºSpring AIçš„ Document å¯¹è±¡ï¼Œå…¶ä¸­åŒ…å«å†…å®¹æ–‡æœ¬å’Œå…ƒæ•°æ®ï¼ˆå¦‚æ–‡æ¡£IDã€æ ‡é¢˜ã€æ¥æºç­‰ï¼‰ã€‚</li>
<li>åµŒå…¥å‘é‡ç”Ÿæˆï¼šé’ˆå¯¹æ¯ä¸ªæ–‡æ¡£ç‰‡æ®µï¼Œè°ƒç”¨EmbeddingModelç”Ÿæˆå…¶è¯­ä¹‰å‘é‡è¡¨ç¤ºã€‚ä¾‹å¦‚åˆ©ç”¨æœ¬åœ°æ¨¡å‹å°†æ¯ä¸ªç‰‡æ®µè½¬æ¢ä¸º768ç»´å‘é‡ã€‚å‘é‡é€šå¸¸å­˜äºDocumentå¯¹è±¡çš„embeddingå­—æ®µï¼Œæˆ–ç›´æ¥åœ¨æ’å…¥å‘é‡æ•°æ®åº“æ—¶è®¡ç®—ã€‚ å±•ç¤ºäº†ä»æ–‡æ¡£åˆ°å‘é‡çš„è½¬æ¢è¿‡ç¨‹ï¼šé¦–å…ˆå°†æ–‡æ¡£åˆ†å‰²ä¸ºå°å—ï¼Œç„¶åä½¿ç”¨åµŒå…¥æ¨¡å‹å°†æ¯ä¸ªå—æ˜ å°„ä¸ºé«˜ç»´å‘é‡è¡¨ç¤ºï¼Œæ•æ‰è¯­ä¹‰ä¿¡æ¯ã€‚</li>
<li>å‘é‡å­˜å‚¨å…¥åº“ï¼šè°ƒç”¨vectorStore.add(documents)æ–¹æ³•ï¼Œå°†æ–‡æ¡£ç‰‡æ®µæ‰¹é‡æ’å…¥Qdrantå‘é‡æ•°æ®åº“ ã€‚Spring AI çš„ VectorStore æ¥å£å¯¹åº•å±‚æ•°æ®åº“æ‰§è¡Œæ’å…¥æ“ä½œï¼Œå¹¶è‡ªåŠ¨å¤„ç†å‘é‡æ•°æ®å’Œå…ƒä¿¡æ¯å­˜å‚¨ã€‚ä¾‹å¦‚å¯¹äºQdrantï¼Œæ¯ä¸ªDocumentçš„embeddingå‘é‡å’Œé™„åŠ payloadä¼šå­˜å…¥æŒ‡å®šcollectionä¸­ã€‚å¦‚æœcollectionå°šä¸å­˜åœ¨ä¸”initializeSchema=trueï¼ŒVectorStoreå®ç°ä¼šè‡ªåŠ¨åˆ›å»ºé›†åˆï¼ˆç›¸åº”çš„ç»´åº¦å’Œç´¢å¼•å‚æ•°ï¼‰  ã€‚æ’å…¥æˆåŠŸåï¼Œæ–‡æ¡£çš„è¯­ä¹‰è¡¨ç¤ºå°±æŒä¹…åŒ–åœ¨Qdrantä¸­äº†ï¼Œå¯ç”¨äºç›¸ä¼¼æ£€ç´¢ã€‚</li>
<li>å…¨æ–‡ç´¢å¼•å…¥åº“ï¼šå°†æ–‡æ¡£ç‰‡æ®µç´¢å¼•åˆ°Elasticsearchã€‚å¯¹äºæ¯ä¸ªDocumentå¯¹è±¡ï¼Œä»ä¸­æå–å¿…è¦å­—æ®µï¼ˆå¦‚idã€contentã€metadataï¼‰ï¼Œè°ƒç”¨ESçš„ç´¢å¼•APIå­˜å‚¨ã€‚è‹¥ä½¿ç”¨Spring Data Elasticsearchï¼Œå¯ä»¥è°ƒç”¨Repositoryçš„save()æ–¹æ³•æ‰¹é‡ä¿å­˜ç‰‡æ®µå®ä½“ã€‚å¦‚æœç›´æ¥ä½¿ç”¨ES REST APIï¼Œåˆ™æ„é€ æ‰¹é‡ç´¢å¼•è¯·æ±‚ã€‚æ¯ä¸ªç‰‡æ®µå°†æˆä¸ºESä¸­ä¸€æ¡æ–‡æ¡£è®°å½•ï¼Œå†…å®¹å­—æ®µåšå…¨æ–‡æ£€ç´¢ç´¢å¼•å¤„ç†ã€‚å¯ä»¥è€ƒè™‘åœ¨contentå­—æ®µä¸Šåº”ç”¨ESè‡ªå¸¦çš„ä¸­æ–‡åˆ†è¯ï¼ˆå¦‚æœå†…å®¹ä¸ºä¸­æ–‡ï¼‰ä»¥æé«˜æ£€ç´¢æ•ˆæœã€‚</li>
<li>ç´¢å¼•å®Œæˆï¼šç»è¿‡ä»¥ä¸Šè¿‡ç¨‹ï¼ŒçŸ¥è¯†åº“æ–‡æ¡£è¢«æœ‰æ•ˆåœ°å­˜å‚¨ä¸ºå‘é‡åº“+å…¨æ–‡ç´¢å¼•çš„æ··åˆå½¢å¼ï¼šQdrantæŒæœ‰æ¯ä¸ªç‰‡æ®µçš„å‘é‡åŠå…ƒæ•°æ®ï¼ŒElasticsearchæŒæœ‰ç‰‡æ®µçš„å¯æ£€ç´¢æ–‡æœ¬ã€‚åç»­æŸ¥è¯¢å³å¯åˆ©ç”¨è¿™ä¸¤ç§å­˜å‚¨æä¾›çš„èƒ½åŠ›ã€‚</li>
</ol>
<p>æ³¨æ„ï¼š æ–‡æ¡£å…¥åº“æµç¨‹å¯ä»¥ç¦»çº¿æ‰¹å¤„ç†ï¼Œä¹Ÿå¯ä»¥é€šè¿‡æä¾›APIè®©ç”¨æˆ·åŠ¨æ€ä¸Šä¼ æ–‡æ¡£ã€‚åœ¨æœ¬è®¾è®¡ä¸­ï¼Œå¯ä»¥å®ç°ä¸€ä¸ª/documents/loadæ¥å£ï¼ˆæˆ–ä½¿ç”¨Stackademicåšæ–‡ä¸­çš„/loadæ¦‚å¿µ ï¼‰ï¼Œæ¥å—æ–‡ä»¶ä¸Šä¼ è¯·æ±‚ï¼ŒæœåŠ¡æ¥æ”¶æ–‡ä»¶åæ‰§è¡Œä¸Šè¿°æ­¥éª¤å®Œæˆç´¢å¼•ã€‚åŒæ—¶è¿”å›çŠ¶æ€æˆ–ç»“æœç»™å®¢æˆ·ç«¯ã€‚ä¸ºç®€åŒ–ï¼Œæ­¤æ¥å£ç»†èŠ‚åœ¨æ­¤ä¸å±•å¼€ã€‚</p>
<h3 id="åœ¨çº¿æ£€ç´¢é—®ç­”æµç¨‹"><a aria-hidden="true" tabindex="-1" href="#åœ¨çº¿æ£€ç´¢é—®ç­”æµç¨‹"><span class="icon icon-link"></span></a>åœ¨çº¿æ£€ç´¢é—®ç­”æµç¨‹</h3>
<ol>
<li>ç”¨æˆ·æŸ¥è¯¢è¾“å…¥ï¼šç”¨æˆ·é€šè¿‡å‰ç«¯æˆ–APIè°ƒç”¨å‘é€æŸ¥è¯¢è¯·æ±‚ç»™RAGæœåŠ¡ï¼ˆä¾‹å¦‚HTTP GET/POST /ask?question=â€¦ï¼‰ã€‚æŸ¥è¯¢å†…å®¹ä¸ºè‡ªç„¶è¯­è¨€é—®é¢˜ï¼Œä¾‹å¦‚ï¼šâ€œè¿™ä¸ªç³»ç»Ÿå¦‚ä½•æ”¯æŒæœ¬åœ°æ¨¡å‹ï¼Ÿâ€ã€‚Controllerå±‚æ¥æ”¶è¯·æ±‚åï¼Œå°†æŸ¥è¯¢å­—ç¬¦ä¸²å°è£…ä¸ºQueryå¯¹è±¡æˆ–ç›´æ¥ä¼ ç»™æœåŠ¡å±‚ã€‚</li>
<li>æ··åˆæ£€ç´¢ï¼šRAGæœåŠ¡è°ƒç”¨ HybridRetriever æ¥ä»çŸ¥è¯†åº“ä¸­æ£€ç´¢ç›¸å…³ä¿¡æ¯ï¼š</li>
</ol>
<ul>
<li>ESå…³é”®è¯æ£€ç´¢ï¼šå¯¹Elasticsearchæ‰§è¡ŒæŸ¥è¯¢ï¼Œå¯ä½¿ç”¨matchæˆ–multi_matchåœ¨contentå­—æ®µæœç´¢ç”¨æˆ·é—®é¢˜ä¸­çš„å…³é”®è¯ã€‚å¦‚æœæœ‰åŒ¹é…ï¼Œè¿”å›ç›¸å…³åº¦æœ€é«˜çš„å‰Nä¸ªç‰‡æ®µï¼Œä¾‹å¦‚N=5ã€‚</li>
<li>Qdrantå‘é‡æ£€ç´¢ï¼šå°†ç”¨æˆ·é—®é¢˜å­—ç¬¦ä¸²é€šè¿‡EmbeddingModelç¼–ç ä¸ºå‘é‡æŸ¥è¯¢ï¼Œè°ƒç”¨vectorStore.similaritySearch()è·å–ç›¸ä¼¼åº¦æœ€é«˜çš„å‰Mä¸ªç‰‡æ®µï¼Œä¾‹å¦‚M=5 ã€‚å¯ä»¥è®¾ç½®ä¸€å®šçš„ç›¸ä¼¼åº¦é˜ˆå€¼ï¼Œå¿½ç•¥ä½äºé˜ˆå€¼çš„ç»“æœ ã€‚</li>
<li>ç»“æœèåˆï¼šå°†ä¸Šä¸¤æ­¥è·å¾—çš„ç‰‡æ®µé›†åˆå¹¶é›†æˆã€‚å‡å®šæˆ‘ä»¬è·å–äº†æœ€å¤š10ä¸ªç›¸å…³ç‰‡æ®µã€‚å¯å¯¹è¿™äº›ç‰‡æ®µæŒ‰é‡è¦æ€§ç®€å•æ’åºï¼ˆæ¯”å¦‚æ ¹æ®æ˜¯å¦åŒ…å«å…³é”®è¯å°†ESç»“æœé å‰ï¼‰ï¼Œæˆ–ä¸æ’åºç›´æ¥ä¼ é€’ç»™LLMã€‚åœ¨æœ¬è®¾è®¡ä¸­ï¼Œæˆ‘ä»¬å°†ç‰‡æ®µæ–‡æœ¬ç›´æ¥ä½œä¸ºä¸Šä¸‹æ–‡ä¼ é€’ï¼Œå› æ­¤é¡ºåºå½±å“ä¸å¤§ï¼Œä½†å¯ä»¥å°†æ›´ç›¸å…³çš„æ”¾åœ¨å‰é¢ä»¥æé«˜å›ç­”è´¨é‡ã€‚</li>
</ul>
<ol start="3">
<li>æ„é€ æç¤º (Prompt)ï¼šå°†ç”¨æˆ·é—®é¢˜å’Œæ£€ç´¢åˆ°çš„æ–‡æ¡£ç‰‡æ®µç»„è£…æˆæç¤ºå†…å®¹ä¼ ç»™LLMã€‚é€šå¸¸é‡‡ç”¨ä¸€ä¸ªé¢„å®šä¹‰çš„Promptæ¨¡æ¿ï¼Œä¾‹å¦‚ï¼š</li>
</ol>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>è¯·æ ¹æ®ä»¥ä¸‹æ–‡æ¡£å†…å®¹å›ç­”é—®é¢˜ã€‚å¦‚æœæ— æ³•ä»ä¸­æ‰¾åˆ°ç­”æ¡ˆï¼Œè¯·å›å¤â€œæœªæ‰¾åˆ°ç›¸å…³ä¿¡æ¯â€ã€‚</span></span>
<span class="line"><span></span></span>
<span class="line"><span>æ–‡æ¡£å†…å®¹:</span></span>
<span class="line"><span>{{{context}}}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>é—®é¢˜: {{{question}}}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>ç­”æ¡ˆ:</span></span></code></pre>
<p>å…¶ä¸­{{{context}}}å ä½ç¬¦ç”±æ£€ç´¢åˆ°çš„å¤šä¸ªæ–‡æ¡£ç‰‡æ®µæ–‡æœ¬æ‹¼æ¥å¡«å……ï¼Œ{{{question}}}ä¸ºç”¨æˆ·åŸå§‹é—®é¢˜ã€‚è¿™æ ·ç”Ÿæˆçš„å®Œæ•´æç¤ºæä¾›äº†é—®é¢˜æ‰€éœ€çš„å‚è€ƒä¿¡æ¯ã€‚æ­¤æ­¥éª¤å¯ä»¥ä½¿ç”¨Spring AIçš„PromptTemplateè¾…åŠ©å®Œæˆï¼Œä¹Ÿå¯æ‰‹åŠ¨æ‹¼æ¥å­—ç¬¦ä¸²ã€‚ æåˆ°åœ¨æŸ¥è¯¢é˜¶æ®µå¯ä½¿ç”¨PromptTemplateæ’å…¥æ£€ç´¢åˆ°çš„å†…å®¹å¹¶æ¸²æŸ“æœ€ç»ˆæç¤ºï¼Œç„¶åå‘é€ç»™æ¨¡å‹ã€‚
Spring AI ä¹Ÿæ”¯æŒç›´æ¥ä½¿ç”¨ QuestionAnswerAdvisor ç®€åŒ–è¿™ä¸€è¿‡ç¨‹ã€‚å¦‚æœä½¿ç”¨ChatClient.prompt().advisors(new QuestionAnswerAdvisor(vectorStore))ï¼Œå®ƒä¼šè‡ªåŠ¨åœ¨è°ƒç”¨æ¨¡å‹å‰æŸ¥è¯¢å‘é‡åº“å¹¶é™„åŠ ç»“æœ ã€‚ä½†ç”±äºæˆ‘ä»¬å®ç°äº†è‡ªå®šä¹‰çš„HybridRetrieverï¼ˆåŒ…å«ESï¼‰ï¼Œæˆ‘ä»¬å°†è‡ªè¡Œæ„é€ promptï¼Œä»¥ä¾¿åŠ å…¥ä¸¤ç§æ£€ç´¢ç»“æœã€‚</p>
<ol start="4">
<li>LLMç”Ÿæˆå›ç­”ï¼šè°ƒç”¨LLMæ¨¡å‹ç”Ÿæˆç­”æ¡ˆã€‚é€šè¿‡å‰è¿°é…ç½®å¥½çš„ChatClientæ¥æ‰§è¡Œï¼š</li>
</ol>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="java"><code><span class="line"><span style="color:#E1E4E8">String promptText </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> promptTemplate.</span><span style="color:#B392F0">render</span><span style="color:#E1E4E8">(Map.</span><span style="color:#B392F0">of</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"context"</span><span style="color:#E1E4E8">, combinedDocsText, </span><span style="color:#9ECBFF">"question"</span><span style="color:#E1E4E8">, userQuestion));</span></span>
<span class="line"><span style="color:#E1E4E8">ChatResponse response </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> chatClient.</span><span style="color:#B392F0">prompt</span><span style="color:#E1E4E8">(promptText).</span><span style="color:#B392F0">call</span><span style="color:#E1E4E8">().</span><span style="color:#B392F0">chatResponse</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#E1E4E8">String answer </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> response.</span><span style="color:#B392F0">content</span><span style="color:#E1E4E8">();</span></span></code></pre>
<p>ChatClientä¼šå°†æˆ‘ä»¬æä¾›çš„å®Œæ•´æç¤ºå‘é€ç»™åº•å±‚ChatModelï¼ˆOpenAIæˆ–Ollamaï¼‰ã€‚æ¨¡å‹æ¥æ”¶åˆ°å«æœ‰å‚è€ƒå†…å®¹çš„æé—®åï¼ŒåŸºäºæä¾›çš„ä¸Šä¸‹æ–‡è¿›è¡Œä½œç­”ï¼Œä»è€Œå‡å°å¹»è§‰å’Œå‡ºé”™çš„æ¦‚ç‡  ã€‚ç”Ÿæˆçš„ç­”æ¡ˆé€šè¿‡ChatResponseè¿”å›ï¼Œæå–å…¶å†…å®¹å­—ç¬¦ä¸²ï¼Œå³ä¸ºæœ€ç»ˆè§£ç­”ã€‚</p>
<ol start="5">
<li>ç»“æœè¿”å›ï¼šå°†LLMçš„å›ç­”å­—ç¬¦ä¸²å°è£…ä¸ºå“åº”ï¼Œé€šè¿‡Controllerè¿”å›ç»™è°ƒç”¨æ–¹ã€‚å¯ä»¥åªè¿”å›ç­”æ¡ˆæ–‡æœ¬ï¼Œæˆ–è€…åŒ…å«ä¸€äº›å…ƒä¿¡æ¯ï¼ˆå¦‚å¼•ç”¨çš„æ–‡æ¡£æ¥æºåˆ—è¡¨ç­‰ï¼‰ã€‚æœ¬è®¾è®¡èšç„¦æ ¸å¿ƒåŠŸèƒ½ï¼Œå‡å®šä»…è¿”å›ç­”æ¡ˆæ–‡æœ¬ã€‚åœ¨å‰ç«¯ç•Œé¢ä¸Šï¼Œç”¨æˆ·å³å¯çœ‹åˆ°æ ¹æ®å…¶æé—®ç”Ÿæˆçš„å›ç­”ã€‚</li>
<li>å¯¹è¯è®°å¿†ï¼ˆå¯é€‰ï¼‰ï¼šå¦‚æœéœ€è¦å¤šè½®å¯¹è¯æ”¯æŒï¼Œå¯ç»“åˆSpring AIçš„ChatMemoryåŠŸèƒ½ï¼Œå°†ä¹‹å‰çš„é—®é¢˜å’Œç­”æ¡ˆä½œä¸ºå¯¹è¯å†å²æä¾›ç»™ChatClientï¼Œä»¥å®ç°ä¸Šä¸‹æ–‡è®°å¿†ã€‚ä½†åŸºæœ¬çš„RAGé—®ç­”åœºæ™¯å¯ä¸è€ƒè™‘å¯¹è¯å†å²ï¼Œæ¯æ¬¡ç‹¬ç«‹è¿›è¡Œã€‚</li>
</ol>
<p>æ•´ä¸ªæŸ¥è¯¢æµç¨‹åœ¨ç”¨æˆ·çœ‹æ¥åªæ˜¯æä¾›é—®é¢˜ã€è·å¾—ç­”æ¡ˆï¼Œä½†èƒŒåç»è¿‡äº†å…³é”®è¯å’Œè¯­ä¹‰åŒé€šé“æ£€ç´¢ï¼Œå†ç”±å¤§æ¨¡å‹ç»¼åˆåˆ†ææ–‡æ¡£ç»™å‡ºç»“æœï¼Œä»è€Œå®ç°â€œä»¥çŸ¥è¯†åº“ä¸ºåŸºç¡€çš„é—®ç­”â€ã€‚è¿™ç§RAGæŠ€æœ¯æœ‰æ•ˆç¼“è§£äº†LLMä¸Šä¸‹æ–‡é•¿åº¦é™åˆ¶ã€çŸ¥è¯†æˆªæ­¢å’Œå¹»è§‰é—®é¢˜  ã€‚</p>
<h2 id="å…³é”®ç»„ä»¶ä¸æ¥å£å®šä¹‰"><a aria-hidden="true" tabindex="-1" href="#å…³é”®ç»„ä»¶ä¸æ¥å£å®šä¹‰"><span class="icon icon-link"></span></a>å…³é”®ç»„ä»¶ä¸æ¥å£å®šä¹‰</h2>
<h3 id="é…ç½®ä¸ç»„ä»¶æ‘˜è¦"><a aria-hidden="true" tabindex="-1" href="#é…ç½®ä¸ç»„ä»¶æ‘˜è¦"><span class="icon icon-link"></span></a>é…ç½®ä¸ç»„ä»¶æ‘˜è¦</h3>
<p>ä¸»è¦ä¾èµ–ï¼šé¡¹ç›®å¼•å…¥ä»¥ä¸‹å…³é”®ä¾èµ–ï¼š</p>
<ul>
<li>Spring Boot 3.xï¼ˆåŸºç¡€æ¡†æ¶ï¼‰</li>
<li>Spring AI æ ¸å¿ƒ (spring-ai-bom BOM å’Œæ‰€éœ€starter)</li>
<li>Spring AI OpenAI Starter ï¼ˆå¦‚ä½¿ç”¨OpenAI APIï¼‰</li>
<li>Spring AI Ollama Starter ï¼ˆå¦‚ä½¿ç”¨æœ¬åœ°Ollamaï¼‰</li>
<li>Spring AI Qdrant Vector Store Starter (spring-ai-qdrant-store-spring-boot-starter)</li>
<li>Spring AI ONNX Embedding (å¦‚ä½¿ç”¨æœ¬åœ°Transformeræ¨¡å‹ï¼Œå¯é€‰ spring-ai-embeddings-transformer-onnx)</li>
<li>Spring Data Elasticsearch æˆ– Elasticsearch Javaå®¢æˆ·ç«¯</li>
<li>Qdrant Java SDK æˆ–é€šè¿‡Spring AIçš„ QdrantClient æ”¯æŒ</li>
<li>å…¶ä»–ï¼šå¦‚éœ€è¦æ–‡æ¡£è§£æï¼Œå¯é€‰ Spring AI æä¾›çš„ PDF/Text æ–‡æ¡£è¯»å–ç»„ä»¶ã€‚</li>
</ul>
<p>åº”ç”¨é…ç½®ï¼šé€šè¿‡application.ymlç®¡ç†ä¸Šè¿°æ¨¡å¼åˆ‡æ¢å‚æ•°ï¼Œä¾‹å¦‚ï¼š</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="yaml"><code><span class="line"><span style="color:#85E89D">app</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#85E89D">  llm</span><span style="color:#E1E4E8">: </span><span style="color:#85E89D">mode</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">local</span><span style="color:#6A737D">        # æœ¬åœ°(local)æˆ–openai</span></span>
<span class="line"><span style="color:#85E89D">  embedding</span><span style="color:#E1E4E8">: </span><span style="color:#85E89D">mode</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">local</span><span style="color:#6A737D">  # æœ¬åœ°(local)æˆ–openai</span></span>
<span class="line"><span style="color:#85E89D">spring</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#85E89D">  ai</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#6A737D">    # OpenAI é…ç½®ï¼ˆä»…å½“ä½¿ç”¨openaiæ¨¡å¼ï¼‰</span></span>
<span class="line"><span style="color:#85E89D">    openai</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#85E89D">      api-key</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">xxxx</span></span>
<span class="line"><span style="color:#85E89D">      chat.model</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">gpt-4</span></span>
<span class="line"><span style="color:#6A737D">    # Ollama é…ç½®ï¼ˆä»…å½“ä½¿ç”¨localæ¨¡å¼ï¼‰</span></span>
<span class="line"><span style="color:#85E89D">    ollama</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#85E89D">      base-url</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">http://ollama:11434</span><span style="color:#6A737D">   # å‡è®¾Dockerå®¹å™¨å†…æœåŠ¡å</span></span>
<span class="line"><span style="color:#85E89D">      default-model</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">llama2-7b</span></span>
<span class="line"><span style="color:#6A737D">    # Qdrant å‘é‡åº“é…ç½®</span></span>
<span class="line"><span style="color:#85E89D">    vectorstore</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#85E89D">      qdrant</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#85E89D">        collection-name</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">documents</span></span>
<span class="line"><span style="color:#85E89D">        initialize-schema</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">true</span></span></code></pre>
<p>ä¸Šä¾‹å±•ç¤ºäº†è‡ªå®šä¹‰çš„appé…ç½®æ®µç”¨äºæ§åˆ¶æ¨¡å¼ï¼Œä»¥åŠSpring AIè‡ªå¸¦çš„ä¸€äº›é…ç½®é¡¹ã€‚é€šè¿‡profilesæˆ–æ¡ä»¶æ³¨å…¥ï¼Œå¯ä»¥æ ¹æ®app.llm.modeé€‰æ‹©ä¸åŒçš„ChatModelé…ç½®ã€‚</p>
<p>å…³é”®Beanï¼šæ±‡æ€»æœ¬è®¾è®¡æ¶‰åŠçš„é‡è¦Spring BeanåŠå…¶é…ç½®æ–¹å¼ï¼š</p>
<ul>
<li>EmbeddingModel Beanï¼šå¦‚ä¸Šæ‰€è¿°ï¼Œå¯ä»¥æ˜¯OpenAiEmbeddingModelæˆ–TransformersEmbeddingModelï¼Œè´Ÿè´£æ–‡æœ¬åµŒå…¥ã€‚</li>
<li>QdrantClient Beanï¼šå°è£…ä¸QdrantæœåŠ¡çš„è¿æ¥ï¼Œä½¿ç”¨gRPCæˆ–RESTå®¢æˆ·ç«¯ã€‚</li>
<li>VectorStore Beanï¼šæ¯”å¦‚QdrantVectorStoreï¼Œæ„é€ æ—¶éœ€æ³¨å…¥QdrantClientå’ŒEmbeddingModelã€‚</li>
<li>ChatClient Beanï¼šé€šå¸¸é€šè¿‡Spring AIè‡ªåŠ¨é…ç½®çš„ChatClient.Builderç”Ÿæˆã€‚å¯ç›´æ¥æ³¨å…¥ChatClientæˆ–å…¶Builderã€‚åœ¨ä½¿ç”¨å¤šä¸ªChatModelæ—¶ï¼Œä¹Ÿå¯ä»¥æ³¨å…¥å¤šä¸ªå‘½åçš„ChatClientã€‚ä¾‹å¦‚ï¼š</li>
</ul>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="java"><code><span class="line"><span style="color:#E1E4E8">@</span><span style="color:#F97583">Bean</span></span>
<span class="line"><span style="color:#E1E4E8">@</span><span style="color:#F97583">ConditionalOnProperty</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">name</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">"app.llm.mode"</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">havingValue</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">"openai"</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">ChatClient </span><span style="color:#B392F0">chatClientOpenAI</span><span style="color:#E1E4E8">(OpenAiChatModel model) {</span></span>
<span class="line"><span style="color:#F97583">    return</span><span style="color:#E1E4E8"> ChatClient.</span><span style="color:#B392F0">builder</span><span style="color:#E1E4E8">(model).</span><span style="color:#B392F0">build</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">@</span><span style="color:#F97583">Bean</span></span>
<span class="line"><span style="color:#E1E4E8">@</span><span style="color:#F97583">ConditionalOnProperty</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">name</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">"app.llm.mode"</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">havingValue</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">"local"</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">ChatClient </span><span style="color:#B392F0">chatClientOllama</span><span style="color:#E1E4E8">(OllamaChatModel model) {</span></span>
<span class="line"><span style="color:#F97583">    return</span><span style="color:#E1E4E8"> ChatClient.</span><span style="color:#B392F0">builder</span><span style="color:#E1E4E8">(model).</span><span style="color:#B392F0">build</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p>ä¸Šè¿°ä¼ªä»£ç è¡¨æ˜æ ¹æ®é…ç½®é€‰æ‹©ä¸åŒçš„ChatModelåˆ›å»ºChatClientã€‚å®é™…ä¸Šè‹¥ä½¿ç”¨Spring Boot Starterå’Œé…ç½®æ–‡ä»¶ï¼Œå¤§éƒ¨åˆ†æƒ…å†µç›´æ¥@Autowired ChatClientå³å¯ï¼ˆåº•å±‚å·²æ ¹æ®é…ç½®é€‰å¥½äº†æ¨¡å‹ï¼‰ã€‚</p>
<ul>
<li>HybridRetriever Beanï¼šå¦‚æœå®ç°äº†HybridRetrieverç±»ï¼Œå¯å°†å…¶å£°æ˜ä¸ºBeanï¼Œå†…éƒ¨@Autowiredæ‰€éœ€çš„ESå®¢æˆ·ç«¯å’ŒVectorStoreï¼Œç”¨äºæ‰§è¡Œæ£€ç´¢é€»è¾‘ã€‚</li>
<li>RagService Beanï¼šå°è£…RAGæµç¨‹çš„æœåŠ¡ç±»ã€‚å®ƒä¼š@Autowired HybridRetrieverå’ŒChatClientï¼Œç”¨æ¥å®ç°answerQuestion(String question)æ–¹æ³•ã€‚</li>
</ul>
<h3 id="ragservice-æ¥å£å®šä¹‰"><a aria-hidden="true" tabindex="-1" href="#ragservice-æ¥å£å®šä¹‰"><span class="icon icon-link"></span></a>RagService æ¥å£å®šä¹‰</h3>
<p>RagServiceå¯ä»¥å®šä¹‰å¦‚ä¸‹æ¥å£ä»¥ä¾›Controllerè°ƒç”¨ï¼š</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="java"><code><span class="line"><span style="color:#F97583">public</span><span style="color:#F97583"> interface</span><span style="color:#B392F0"> RagService</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6A737D">    /** æ ¹æ®ç”¨æˆ·é—®é¢˜è¿”å›ç­”æ¡ˆ */</span></span>
<span class="line"><span style="color:#E1E4E8">    String </span><span style="color:#B392F0">getAnswer</span><span style="color:#E1E4E8">(String </span><span style="color:#FFAB70">question</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p>å…¶å®ç°ç±» RagServiceImpl è´Ÿè´£æŒ‰ç…§åœ¨çº¿æ£€ç´¢é—®ç­”æµç¨‹çš„æ­¥éª¤å®Œæˆå·¥ä½œï¼š</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="java"><code><span class="line"><span style="color:#E1E4E8">@</span><span style="color:#F97583">Service</span></span>
<span class="line"><span style="color:#F97583">public</span><span style="color:#F97583"> class</span><span style="color:#B392F0"> RagServiceImpl</span><span style="color:#F97583"> implements</span><span style="color:#B392F0"> RagService</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">    @</span><span style="color:#F97583">Autowired</span><span style="color:#F97583"> private</span><span style="color:#E1E4E8"> HybridRetriever retriever;</span></span>
<span class="line"><span style="color:#E1E4E8">    @</span><span style="color:#F97583">Autowired</span><span style="color:#F97583"> private</span><span style="color:#E1E4E8"> ChatClient chatClient;</span></span>
<span class="line"><span style="color:#E1E4E8">    @</span><span style="color:#F97583">Value</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"${app.maxDocs:6}"</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">private</span><span style="color:#F97583"> int</span><span style="color:#E1E4E8"> maxDocs;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">    @</span><span style="color:#F97583">Override</span></span>
<span class="line"><span style="color:#F97583">    public</span><span style="color:#E1E4E8"> String </span><span style="color:#B392F0">getAnswer</span><span style="color:#E1E4E8">(String </span><span style="color:#FFAB70">question</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#6A737D">        // 1. è°ƒç”¨æ··åˆæ£€ç´¢è·å–ç›¸å…³æ–‡æ¡£ç‰‡æ®µåˆ—è¡¨</span></span>
<span class="line"><span style="color:#E1E4E8">        List&#x3C;</span><span style="color:#F97583">Document</span><span style="color:#E1E4E8">> docs </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> retriever.</span><span style="color:#B392F0">retrieve</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">new</span><span style="color:#B392F0"> Query</span><span style="color:#E1E4E8">(question));</span></span>
<span class="line"><span style="color:#F97583">        if</span><span style="color:#E1E4E8"> (docs.</span><span style="color:#B392F0">isEmpty</span><span style="color:#E1E4E8">()) {</span></span>
<span class="line"><span style="color:#F97583">            return</span><span style="color:#9ECBFF"> "æŠ±æ­‰ï¼Œæœªèƒ½æ‰¾åˆ°ç›¸å…³ä¿¡æ¯ã€‚"</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#6A737D">        // æˆªå–æœ€å¤šmaxDocsç¯‡ï¼Œä»¥é˜²è¿‡é•¿</span></span>
<span class="line"><span style="color:#E1E4E8">        List&#x3C;</span><span style="color:#F97583">Document</span><span style="color:#E1E4E8">> topDocs </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> docs.</span><span style="color:#B392F0">size</span><span style="color:#E1E4E8">() </span><span style="color:#F97583">></span><span style="color:#E1E4E8"> maxDocs </span><span style="color:#F97583">?</span><span style="color:#E1E4E8"> docs.</span><span style="color:#B392F0">subList</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">, maxDocs) </span><span style="color:#F97583">:</span><span style="color:#E1E4E8"> docs;</span></span>
<span class="line"><span style="color:#6A737D">        // 2. æ„é€ æç¤ºä¸Šä¸‹æ–‡æ–‡æœ¬</span></span>
<span class="line"><span style="color:#E1E4E8">        StringBuilder context </span><span style="color:#F97583">=</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> StringBuilder</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#F97583">        for</span><span style="color:#E1E4E8"> (Document doc </span><span style="color:#F97583">:</span><span style="color:#E1E4E8"> topDocs) {</span></span>
<span class="line"><span style="color:#E1E4E8">            context.</span><span style="color:#B392F0">append</span><span style="color:#E1E4E8">(doc.</span><span style="color:#B392F0">getContent</span><span style="color:#E1E4E8">()).</span><span style="color:#B392F0">append</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"</span><span style="color:#79B8FF">\n</span><span style="color:#9ECBFF">"</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#E1E4E8">        String prompt </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> String.</span><span style="color:#B392F0">format</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"åŸºäºä»¥ä¸‹å†…å®¹å›ç­”é—®é¢˜ï¼š</span><span style="color:#79B8FF">\n</span><span style="color:#9ECBFF">%s</span><span style="color:#79B8FF">\n</span><span style="color:#9ECBFF">é—®é¢˜ï¼š%s</span><span style="color:#79B8FF">\n</span><span style="color:#9ECBFF">å›ç­”ï¼š"</span><span style="color:#E1E4E8">, context, question);</span></span>
<span class="line"><span style="color:#6A737D">        // 3. è°ƒç”¨LLMç”Ÿæˆå›ç­”</span></span>
<span class="line"><span style="color:#E1E4E8">        ChatResponse response </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> chatClient.</span><span style="color:#B392F0">prompt</span><span style="color:#E1E4E8">(prompt).</span><span style="color:#B392F0">call</span><span style="color:#E1E4E8">().</span><span style="color:#B392F0">chatResponse</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#F97583">        return</span><span style="color:#E1E4E8"> response.</span><span style="color:#B392F0">content</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p>ä¸Šè¿°ä»£ç ä¸­ï¼š</p>
<ul>
<li>retriever.retrieveè¿”å›Documentåˆ—è¡¨ï¼Œæ¯ä¸ªDocumentåŒ…å«contentæ–‡æœ¬ç­‰ä¿¡æ¯ã€‚</li>
<li>å°†ç‰‡æ®µå†…å®¹ç®€å•æ‹¼æ¥ä¸ºä¸Šä¸‹æ–‡ï¼ˆçœŸå®åº”ç”¨å¯åŠ å…¥åˆ†éš”ç¬¦å¹¶æ³¨æ˜æ¥æºï¼‰ã€‚</li>
<li>ç”¨ChatClient.prompt()å‘é€ç»„è£…çš„promptè·å–å“åº”ã€‚è‹¥æ— ç›¸å…³ç‰‡æ®µåˆ™ç›´æ¥è¿”å›æ— æ³•æ‰¾åˆ°ä¿¡æ¯çš„ç­”å¤ã€‚</li>
</ul>
<p>é€šè¿‡è¿™ç§å®ç°ï¼ŒRagServiceå¯¹å¤–æä¾›äº†ä¸€ä¸ªé«˜å±‚æ¥å£ï¼Œéšè—äº†å†…éƒ¨å¤æ‚æ€§ï¼ŒControlleråªéœ€ä¼ å…¥é—®é¢˜å­—ç¬¦ä¸²å³å¯è·å¾—ç­”æ¡ˆã€‚</p>
<h3 id="ç¤ºä¾‹-controller"><a aria-hidden="true" tabindex="-1" href="#ç¤ºä¾‹-controller"><span class="icon icon-link"></span></a>ç¤ºä¾‹ Controller</h3>
<p>æœ€åï¼Œæä¾›ä¸€ä¸ªç¤ºä¾‹æ§åˆ¶å™¨æ¥æ¼”ç¤ºæ¥å£å®šä¹‰å’Œè°ƒç”¨æµç¨‹ï¼š</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="java"><code><span class="line"><span style="color:#E1E4E8">@</span><span style="color:#F97583">RestController</span></span>
<span class="line"><span style="color:#E1E4E8">@</span><span style="color:#F97583">RequestMapping</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"/api"</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#F97583">public</span><span style="color:#F97583"> class</span><span style="color:#B392F0"> QaController</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">    @</span><span style="color:#F97583">Autowired</span></span>
<span class="line"><span style="color:#F97583">    private</span><span style="color:#E1E4E8"> RagService ragService;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">    // æé—®æ¥å£</span></span>
<span class="line"><span style="color:#E1E4E8">    @</span><span style="color:#F97583">GetMapping</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"/ask"</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#F97583">    public</span><span style="color:#E1E4E8"> ResponseEntity&#x3C;</span><span style="color:#F97583">String</span><span style="color:#E1E4E8">> </span><span style="color:#B392F0">askQuestion</span><span style="color:#E1E4E8">(@</span><span style="color:#F97583">RequestParam</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"q"</span><span style="color:#E1E4E8">) String </span><span style="color:#FFAB70">question</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#E1E4E8">        String answer </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> ragService.</span><span style="color:#B392F0">getAnswer</span><span style="color:#E1E4E8">(question);</span></span>
<span class="line"><span style="color:#F97583">        return</span><span style="color:#E1E4E8"> ResponseEntity.</span><span style="color:#B392F0">ok</span><span style="color:#E1E4E8">(answer);</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">    // æ–‡æ¡£ä¸Šä¼ æ¥å£ï¼ˆå¯é€‰ï¼Œå®ç°æ–‡æ¡£å…¥åº“ï¼‰</span></span>
<span class="line"><span style="color:#E1E4E8">    @</span><span style="color:#F97583">PostMapping</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">value</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">"/documents"</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">consumes</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">MediaType.MULTIPART_FORM_DATA_VALUE)</span></span>
<span class="line"><span style="color:#F97583">    public</span><span style="color:#E1E4E8"> ResponseEntity&#x3C;</span><span style="color:#F97583">String</span><span style="color:#E1E4E8">> </span><span style="color:#B392F0">uploadDocument</span><span style="color:#E1E4E8">(@</span><span style="color:#F97583">RequestPart</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"file"</span><span style="color:#E1E4E8">) MultipartFile </span><span style="color:#FFAB70">file</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#6A737D">        // è°ƒç”¨æ–‡æ¡£å¤„ç†æœåŠ¡å°†æ–‡ä»¶å†…å®¹å­˜å…¥ESå’ŒQdrant</span></span>
<span class="line"><span style="color:#6A737D">        // DocumentLoader.load(file);</span></span>
<span class="line"><span style="color:#F97583">        return</span><span style="color:#E1E4E8"> ResponseEntity.</span><span style="color:#B392F0">ok</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"æ–‡æ¡£å·²ä¸Šä¼ å¹¶ç´¢å¼•å®Œæˆ"</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<ul>
<li>/api/ask æ¥å£æ¥å—æŸ¥è¯¢å‚æ•°qä¸ºç”¨æˆ·é—®é¢˜ï¼Œè°ƒç”¨RagServiceè·å–ç­”æ¡ˆå¹¶ç›´æ¥è¿”å›ã€‚HTTPæ–¹æ³•ç”¨GETç®€å•èµ·è§ï¼Œä¹Ÿå¯ç”¨POSTæäº¤å¤æ‚æŸ¥è¯¢ã€‚</li>
<li>/api/documents æ¥å£ç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•æ¥æ”¶æ–‡ä»¶å¹¶è°ƒç”¨æ–‡æ¡£åŠ è½½æµç¨‹ï¼Œå°†å†…å®¹ç´¢å¼•åˆ°ç³»ç»Ÿä¸­ã€‚æ–‡æ¡£å¤„ç†å¯ä»¥å‚è€ƒå‰è¿°æ–‡æ¡£ç´¢å¼•æµç¨‹å®ç°ã€‚</li>
</ul>
<p>é€šè¿‡ä¸Šè¿°Controllerï¼Œå‰ç«¯æˆ–ç”¨æˆ·å¯ä»¥é€šè¿‡HTTPè¯·æ±‚ä¸RAGæœåŠ¡äº¤äº’ï¼Œå®ç°åŠ¨æ€é—®ç­”ã€‚</p>
<h2 id="docker-compose-ç¯å¢ƒéƒ¨ç½²æ–¹æ¡ˆ"><a aria-hidden="true" tabindex="-1" href="#docker-compose-ç¯å¢ƒéƒ¨ç½²æ–¹æ¡ˆ"><span class="icon icon-link"></span></a>Docker Compose ç¯å¢ƒéƒ¨ç½²æ–¹æ¡ˆ</h2>
<p>ä¸ºæ–¹ä¾¿å¼€å‘å’Œéƒ¨ç½²ï¼Œæä¾›Docker Composeé…ç½®åŒæ—¶å¯åŠ¨æ‰€éœ€çš„å¤–éƒ¨æœåŠ¡ï¼ˆQdrantã€Elasticsearchã€Ollamaï¼‰å’Œæœ¬Spring Bootåº”ç”¨ã€‚æœ¬é¡¹ç›®çš„docker-compose.ymlç¤ºä¾‹å¦‚ä¸‹ï¼š</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="yaml"><code><span class="line"><span style="color:#85E89D">version</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">'3.9'</span></span>
<span class="line"><span style="color:#85E89D">services</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#85E89D">  elasticsearch</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#85E89D">    image</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">docker.elastic.co/elasticsearch/elasticsearch:8.9.0</span></span>
<span class="line"><span style="color:#85E89D">    container_name</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">elasticsearch</span></span>
<span class="line"><span style="color:#85E89D">    environment</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#E1E4E8">      - </span><span style="color:#9ECBFF">discovery.type=single-node</span></span>
<span class="line"><span style="color:#E1E4E8">      - </span><span style="color:#9ECBFF">xpack.security.enabled=false</span><span style="color:#6A737D">       # ç¦ç”¨å®‰å…¨è®¤è¯</span></span>
<span class="line"><span style="color:#E1E4E8">      - </span><span style="color:#9ECBFF">ES_JAVA_OPTS=-Xms1g -Xmx1g</span><span style="color:#6A737D">         # å†…å­˜é…ç½®ï¼Œå¯æ ¹æ®éœ€è¦è°ƒæ•´</span></span>
<span class="line"><span style="color:#85E89D">    ports</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#E1E4E8">      - </span><span style="color:#9ECBFF">"9200:9200"</span></span>
<span class="line"><span style="color:#85E89D">    healthcheck</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#85E89D">      test</span><span style="color:#E1E4E8">: [</span><span style="color:#9ECBFF">"CMD"</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">"curl"</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">"-f"</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">"http://localhost:9200"</span><span style="color:#E1E4E8">] </span></span>
<span class="line"><span style="color:#85E89D">      interval</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">30s</span></span>
<span class="line"><span style="color:#85E89D">      retries</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">3</span></span>
<span class="line"></span>
<span class="line"><span style="color:#85E89D">  qdrant</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#85E89D">    image</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">qdrant/qdrant:v1.3.5</span></span>
<span class="line"><span style="color:#85E89D">    container_name</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">qdrant</span></span>
<span class="line"><span style="color:#85E89D">    ports</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#E1E4E8">      - </span><span style="color:#9ECBFF">"6333:6333"</span><span style="color:#6A737D">   # HTTP API</span></span>
<span class="line"><span style="color:#E1E4E8">      - </span><span style="color:#9ECBFF">"6334:6334"</span><span style="color:#6A737D">   # gRPC API</span></span>
<span class="line"><span style="color:#85E89D">    volumes</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#E1E4E8">      - </span><span style="color:#9ECBFF">qdrant_data:/qdrant/storage</span></span>
<span class="line"></span>
<span class="line"><span style="color:#85E89D">  ollama</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#85E89D">    image</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">ollama/ollama:0.1.9</span></span>
<span class="line"><span style="color:#85E89D">    container_name</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">ollama</span></span>
<span class="line"><span style="color:#85E89D">    ports</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#E1E4E8">      - </span><span style="color:#9ECBFF">"11434:11434"</span><span style="color:#6A737D">  # Ollama REST API é»˜è®¤ç«¯å£</span></span>
<span class="line"><span style="color:#85E89D">    volumes</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#E1E4E8">      - </span><span style="color:#9ECBFF">ollama_data:/root/.ollama</span></span>
<span class="line"></span>
<span class="line"><span style="color:#85E89D">  rag-service</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#85E89D">    build</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">.</span></span>
<span class="line"><span style="color:#85E89D">    container_name</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">rag-service</span></span>
<span class="line"><span style="color:#85E89D">    environment</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#85E89D">      SPRING_PROFILES_ACTIVE</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">"local"</span><span style="color:#6A737D">          # æ¿€æ´»æœ¬åœ°LLMé…ç½®ã€‚å¦‚åˆ‡æ¢OpenAIåˆ™è®¾ä¸ºcloudç­‰ã€‚</span></span>
<span class="line"><span style="color:#85E89D">      OPENAI_API_KEY</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">"${OPENAI_API_KEY:-}"</span><span style="color:#6A737D">    # å¯é€‰ï¼Œæä¾›OpenAIå¯†é’¥</span></span>
<span class="line"><span style="color:#85E89D">      QDRANT_GRPC_HOST</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">"qdrant"</span><span style="color:#6A737D">               # è‹¥åº”ç”¨è¯»å–ç¯å¢ƒé…ç½®è¿æ¥Qdrant</span></span>
<span class="line"><span style="color:#85E89D">      QDRANT_GRPC_PORT</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">6334</span></span>
<span class="line"><span style="color:#85E89D">    depends_on</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#E1E4E8">      - </span><span style="color:#9ECBFF">elasticsearch</span></span>
<span class="line"><span style="color:#E1E4E8">      - </span><span style="color:#9ECBFF">qdrant</span></span>
<span class="line"><span style="color:#E1E4E8">      - </span><span style="color:#9ECBFF">ollama</span></span>
<span class="line"><span style="color:#85E89D">    ports</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#E1E4E8">      - </span><span style="color:#9ECBFF">"8080:8080"</span></span></code></pre>
<p>è¯´æ˜ï¼š</p>
<ul>
<li>Elasticsearchï¼šä½¿ç”¨å®˜æ–¹ES 8.9é•œåƒï¼Œé…ç½®ä¸ºå•èŠ‚ç‚¹æ¨¡å¼å¹¶å…³é—­å®‰å…¨ï¼Œä»¥ä¾¿ç®€åŒ–å¼€å‘æµ‹è¯•ã€‚æ˜ å°„ç«¯å£9200ç”¨äºRESTè®¿é—®ã€‚</li>
<li>Qdrantï¼šä½¿ç”¨å®˜æ–¹Qdranté•œåƒï¼Œå¼€æ”¾6333ç«¯å£ä¾›HTTP APIï¼ˆè‹¥ä½¿ç”¨ï¼‰å’Œ6334ç«¯å£ä¾›gRPCå®¢æˆ·ç«¯ã€‚æŒ‚è½½å·qdrant_dataæŒä¹…åŒ–å‘é‡æ•°æ®ã€‚</li>
<li>Ollamaï¼šä½¿ç”¨Ollamaå®˜æ–¹Dockeré•œåƒã€‚æ˜ å°„11434ç«¯å£ç”¨äºä¸Springåº”ç”¨é€šä¿¡ï¼ˆOllamaæä¾›REST APIï¼‰ï¼ŒæŒ‚è½½å·ollama_dataä¿å­˜å·²ä¸‹è½½çš„æ¨¡å‹æ•°æ®ï¼Œä»¥é¿å…å®¹å™¨é‡å¯åéœ€è¦é‡æ–°pullæ¨¡å‹  ã€‚åœ¨å¯åŠ¨å‰å¯ä»¥å…ˆè¿è¡Œç±»ä¼¼docker exec -it ollama ollama pull llama2çš„å‘½ä»¤ä¸‹è½½æ‰€éœ€æ¨¡å‹ï¼Œæˆ–åœ¨åº”ç”¨åˆå§‹åŒ–æ—¶é€šè¿‡Ollama APIè§¦å‘æ¨¡å‹ä¸‹è½½ã€‚</li>
<li>RAGæœåŠ¡ï¼šå‡è®¾Spring Bootåº”ç”¨å·²æ‰“åŒ…ä¸ºé•œåƒï¼ˆComposeä¸­é€šè¿‡buildæ„å»ºï¼‰ã€‚é€šè¿‡ç¯å¢ƒå˜é‡é…ç½®åº”ç”¨Profileå’Œæ‰€éœ€å‚æ•°ï¼šä¾‹å¦‚æ¿€æ´»local Profileè¡¨ç¤ºä½¿ç”¨æœ¬åœ°Ollamaï¼›å¦‚éœ€OpenAIåˆ™å¯¹åº”Profileä¸‹æä¾›OPENAI_API_KEYç­‰ã€‚depends_onç¡®ä¿å…¶ä»–æœåŠ¡å…ˆè¡Œå¯åŠ¨ã€‚ç«¯å£8080ç”¨äºå¯¹å¤–æä¾›HTTPæ¥å£ã€‚</li>
</ul>
<p>ç½‘ç»œé…ç½®ï¼šComposeé»˜è®¤ä¼šå°†è¿™äº›æœåŠ¡ç½®äºåŒä¸€ç½‘ç»œä¸‹ï¼Œå®¹å™¨åç§°å°±æ˜¯ä¸»æœºåã€‚å› æ­¤åº”ç”¨åœ¨è¿æ¥Qdrantå’ŒESæ—¶ï¼Œå¯ä»¥ä½¿ç”¨qdrant:6334ã€elasticsearch:9200ä½œä¸ºåœ°å€ã€‚Spring AI Docker Composeé›†æˆæ¨¡å—ç”šè‡³å¯ä»¥æ ¹æ®å®¹å™¨åè‡ªåŠ¨å‘ç°æœåŠ¡å¹¶é…ç½®è¿æ¥ï¼Œä¾‹å¦‚åå­—åŒ…å«â€œollama/ollamaâ€çš„å®¹å™¨ä¼šè¢«è¯†åˆ«ä¸ºOllamaæœåŠ¡  ã€‚</p>
<p>å¯åŠ¨ï¼šè¿è¡Œdocker-compose up -då°†åå°å¯åŠ¨æ‰€æœ‰å®¹å™¨ã€‚å¾…Elasticsearchå’ŒQdrantå®Œæˆå¯åŠ¨ï¼ˆå¯é€šè¿‡å¥åº·æ£€æŸ¥æ—¥å¿—æˆ–APIéªŒè¯ï¼‰ï¼ŒSpring Bootåº”ç”¨ä¼šè‡ªåŠ¨è¿æ¥å®ƒä»¬ã€‚æ­¤æ—¶ï¼š</p>
<ul>
<li>å¯ä»¥è°ƒç”¨POST /api/documentsä¸Šä¼ æ–‡æ¡£ï¼ˆæˆ–é€šè¿‡å…¶ä»–æ–¹å¼é¢„å…ˆç´¢å¼•æ–‡æ¡£ï¼‰ï¼›</li>
<li>ç„¶åè°ƒç”¨GET /api/ask?q=ä½ çš„é—®é¢˜è·å–ç­”æ¡ˆã€‚</li>
</ul>
<p>é€šè¿‡Docker Composeï¼Œä¸€é”®éƒ¨ç½²æ•´ä¸ªRAGç³»ç»Ÿçš„ä¾èµ–ï¼Œæ–¹ä¾¿åœ¨æœ¬åœ°æˆ–æœåŠ¡å™¨ä¸Šè¿è¡Œæµ‹è¯•ã€‚</p>
<h2 id="ç»“è®º"><a aria-hidden="true" tabindex="-1" href="#ç»“è®º"><span class="icon icon-link"></span></a>ç»“è®º</h2>
<p>æœ¬è®¾è®¡æ–‡æ¡£è¯¦ç»†æè¿°äº†ä¸€ä¸ªåŸºäºJava Springç”Ÿæ€çš„RAGæœç´¢æœåŠ¡æ–¹æ¡ˆã€‚é€šè¿‡Spring AIæ¡†æ¶æä¾›çš„æŠ½è±¡å’Œé›†æˆèƒ½åŠ›ï¼Œæˆ‘ä»¬å®ç°äº†Retriever-VectorStore-RAG Serviceçš„æ¨¡å—åŒ–æ¶æ„ï¼Œæ”¯æŒæ··åˆæ£€ç´¢ã€çµæ´»çš„LLM/Embeddingåˆ‡æ¢ä»¥åŠå®¹å™¨åŒ–éƒ¨ç½²ã€‚æ ¸å¿ƒæŠ€æœ¯é€‰å‹åŒ…æ‹¬Spring Bootã€Spring AIã€Elasticsearchã€Qdrantå’ŒOllamaç­‰ï¼Œå‡ä¸ºå½“ä¸‹æµè¡Œä¸”æœ‰è‰¯å¥½æ”¯æŒçš„ç»„ä»¶ã€‚æ–‡æ¡£æä¾›äº†æ•´ä½“æ¶æ„å’Œæ•°æ®æµç¨‹è§£æï¼Œç»™å‡ºäº†å…³é”®é…ç½®å’Œä»£ç ç¤ºä¾‹ï¼Œç¡®ä¿å®ç°ç»†èŠ‚æ¸…æ™°å¯è¡Œã€‚å¼€å‘è€…å¯ä»¥æ®æ­¤æ­å»ºèµ·ä¸€ä¸ªå¯å¤ç°çš„RAGé—®ç­”ç³»ç»Ÿï¼Œåœ¨ä¿è¯å›ç­”å‡†ç¡®æ€§çš„åŒæ—¶å…¼é¡¾éƒ¨ç½²çµæ´»æ€§å’Œæ•°æ®ç§æœ‰æ€§ï¼Œä¸ºä¼ä¸šçŸ¥è¯†åº“é—®ç­”ã€æ™ºèƒ½æœç´¢ç­‰åº”ç”¨åœºæ™¯æä¾›æœ‰åŠ›æ”¯æŒã€‚</p> </article> <html lang="en" data-astro-cid-uffxixac> <head><!-- Global Metadata --><meta charset="utf-8"><!--<meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">--><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.css"><link rel="shortcut icon" href="/favicon.png" type="image/png"><link rel="sitemap" href="/sitemap-index.xml"><link rel="alternate" type="application/rss+xml" title="Ge Yuxu â€¢ AI &#38; Engineering" href="https://geyuxu.com/rss.xml"><meta name="generator" content="Astro v5.5.6"><!-- Font preloads --><link rel="preload" href="/fonts/atkinson-regular.woff" as="font" type="font/woff" crossorigin><link rel="preload" href="/fonts/atkinson-bold.woff" as="font" type="font/woff" crossorigin><!-- Canonical URL --><link rel="canonical" href="https://geyuxu.com/blog/ai/llm_rag_agent/spring_ai_rag/1_%E4%BD%BF%E7%94%A8-spring-ai-%E6%9E%84%E5%BB%BA-rag-%E6%90%9C%E7%B4%A2%E6%9C%8D%E5%8A%A1%E8%AE%BE%E8%AE%A1/"><!-- Primary Meta Tags --><title>Ge Yuxu â€¢ AI &amp; Engineering</title><meta name="title" content="Ge Yuxu â€¢ AI &#38; Engineering"><meta name="description" content="Welcome to my blog!"><!-- Open Graph / Facebook --><meta property="og:type" content="website"><meta property="og:url" content="https://geyuxu.com/blog/ai/llm_rag_agent/spring_ai_rag/1_%E4%BD%BF%E7%94%A8-spring-ai-%E6%9E%84%E5%BB%BA-rag-%E6%90%9C%E7%B4%A2%E6%9C%8D%E5%8A%A1%E8%AE%BE%E8%AE%A1/"><meta property="og:title" content="Ge Yuxu â€¢ AI &#38; Engineering"><meta property="og:description" content="Welcome to my blog!"><meta property="og:image" content="https://geyuxu.com/blog-placeholder-1.jpg"><!-- Twitter --><meta property="twitter:card" content="summary_large_image"><meta property="twitter:url" content="https://geyuxu.com/blog/ai/llm_rag_agent/spring_ai_rag/1_%E4%BD%BF%E7%94%A8-spring-ai-%E6%9E%84%E5%BB%BA-rag-%E6%90%9C%E7%B4%A2%E6%9C%8D%E5%8A%A1%E8%AE%BE%E8%AE%A1/"><meta property="twitter:title" content="Ge Yuxu â€¢ AI &#38; Engineering"><meta property="twitter:description" content="Welcome to my blog!"><meta property="twitter:image" content="https://geyuxu.com/blog-placeholder-1.jpg"><script src="/js/jquery-3.7.1.min.js"></script></head> <body data-astro-cid-uffxixac>  <div class="statement" data-astro-cid-uffxixac> <blockquote data-astro-cid-uffxixac> <p data-astro-cid-uffxixac><strong data-astro-cid-uffxixac>è„±æ•è¯´æ˜</strong>ï¼šæœ¬æ–‡æ‰€æœ‰å‡ºç°çš„è¡¨åã€å­—æ®µåã€æ¥å£åœ°å€ã€å˜é‡åã€IPåœ°å€åŠç¤ºä¾‹æ•°æ®ç­‰å‡éçœŸå®ï¼Œ
    ä»…ç”¨äºé˜è¿°æŠ€æœ¯æ€è·¯ä¸å®ç°æ­¥éª¤ï¼Œç¤ºä¾‹ä»£ç äº¦éå…¬å¸çœŸå®ä»£ç ã€‚
    ç¤ºä¾‹æ–¹æ¡ˆäº¦éå…¬å¸çœŸå®å®Œæ•´æ–¹æ¡ˆï¼Œä»…ä¸ºæœ¬äººè®°å¿†æ€»ç»“ï¼Œç”¨äºæŠ€æœ¯å­¦ä¹ æ¢è®¨ã€‚<br data-astro-cid-uffxixac>
&nbsp;&nbsp;&nbsp;&nbsp;â€¢&nbsp;æ–‡ä¸­æ‰€ç¤ºä»»ä½•æ ‡è¯†ç¬¦å¹¶ä¸å¯¹åº”å®é™…ç”Ÿäº§ç¯å¢ƒä¸­çš„åç§°æˆ–ç¼–å·ã€‚<br data-astro-cid-uffxixac>
&nbsp;&nbsp;&nbsp;&nbsp;â€¢&nbsp;ç¤ºä¾‹&nbsp;SQLã€è„šæœ¬ã€ä»£ç åŠæ•°æ®ç­‰å‡ä¸ºæ¼”ç¤ºç”¨é€”ï¼Œä¸å«çœŸå®ä¸šåŠ¡æ•°æ®ï¼Œä¹Ÿä¸å…·å¤‡ç›´æ¥è¿è¡Œæˆ–å¤ç°çš„å®Œæ•´ä¸Šä¸‹æ–‡ã€‚<br data-astro-cid-uffxixac>
&nbsp;&nbsp;&nbsp;&nbsp;â€¢&nbsp;è¯»è€…è‹¥éœ€åœ¨å®é™…é¡¹ç›®ä¸­å‚è€ƒæœ¬æ–‡æ–¹æ¡ˆï¼Œè¯·ç»“åˆè‡ªèº«ä¸šåŠ¡åœºæ™¯åŠæ•°æ®å®‰å…¨è§„èŒƒï¼Œä½¿ç”¨ç¬¦åˆå†…éƒ¨å‘½åå’Œæƒé™æ§åˆ¶çš„é…ç½®ã€‚</p> <p data-astro-cid-uffxixac><strong data-astro-cid-uffxixac>ç‰ˆæƒå£°æ˜</strong>ï¼šæœ¬æ–‡ç‰ˆæƒå½’åŸä½œè€…æ‰€æœ‰ï¼Œæœªç»ä½œè€…äº‹å…ˆä¹¦é¢è®¸å¯ï¼Œä»»ä½•å•ä½æˆ–ä¸ªäººä¸å¾—ä»¥ä»»ä½•æ–¹å¼å¤åˆ¶ã€è½¬è½½ã€æ‘˜ç¼–æˆ–ç”¨äºå•†ä¸šç”¨é€”ã€‚<br data-astro-cid-uffxixac>
&nbsp;&nbsp;&nbsp;&nbsp;â€¢&nbsp;è‹¥éœ€éå•†ä¸šæ€§å¼•ç”¨æˆ–è½¬è½½æœ¬æ–‡å†…å®¹ï¼Œè¯·åŠ¡å¿…æ³¨æ˜å‡ºå¤„å¹¶ä¿æŒå†…å®¹å®Œæ•´ã€‚<br data-astro-cid-uffxixac>
&nbsp;&nbsp;&nbsp;&nbsp;â€¢&nbsp;å¯¹å› å•†ä¸šä½¿ç”¨ã€ç¯¡æ”¹æˆ–ä¸å½“å¼•ç”¨æœ¬æ–‡å†…å®¹æ‰€äº§ç”Ÿçš„æ³•å¾‹çº çº·ï¼Œä½œè€…ä¿ç•™è¿½ç©¶æ³•å¾‹è´£ä»»çš„æƒåˆ©ã€‚<br data-astro-cid-uffxixac><br data-astro-cid-uffxixac> <em data-astro-cid-uffxixac>Copyright&nbsp;Â©&nbsp;1989â€“Present&nbsp;Ge&nbsp;Yuxu.&nbsp;All&nbsp;Rights&nbsp;Reserved.</em></p> </blockquote> </div></body></html>  </article> </div> </main> <footer data-astro-cid-sz7xmlte>
&copy; 2025 All rights reserved.
</footer>  </body></html>