<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>积分商城用户数据加密改造实战技术博客</title>
    <style>
        body { font-family: Georgia, serif; max-width: 700px; margin: 2rem auto; padding: 0 1rem; line-height: 1.7; color: #333; }
        h1 { font-size: 2rem; margin-bottom: 0.5rem; }
        h2 { font-size: 1.4rem; margin-top: 2rem; }
        pre { background: #f4f4f4; padding: 1rem; overflow-x: auto; border-radius: 4px; }
        code { font-family: Menlo, Monaco, monospace; font-size: 0.9em; }
        p code { background: #f4f4f4; padding: 0.2em 0.4em; border-radius: 3px; }
        img { max-width: 100%; }
        blockquote { border-left: 3px solid #ddd; margin-left: 0; padding-left: 1rem; color: #666; }
        ul { padding-left: 1.5rem; }
        hr { border: none; border-top: 1px solid #ddd; margin: 2rem 0; }
        a { color: #1a8917; }
    </style>
</head>
<body>
<hr>
<h2>date: 2021-11-19
tags: [service_governance]
legacy: true</h2>
<h1>积分商城用户数据加密改造实战技术博客</h1>
<ul>
<li><strong>实现策略：</strong> 使用 <strong>AES</strong> 加密算法，将敏感字段加密后存储，同时保留原始数据处理方式以实现同时兼容。</li>
<li><strong>解决方案：</strong> 通过 <strong>MyBatis TypeHandler</strong> 解耦存取过程，自动将某些指定字段进行加密和解密操作，无需修改上应应用逻辑。</li>
<li><strong>分步执行：</strong><ul>
<li>分析需加密字段</li>
<li>编写AES加密/解密公共类</li>
<li>实现MyBatis TypeHandler</li>
<li>数据移植工具脚本，实现旧数据加密</li>
</ul>
</li>
</ul>
<h2>3. 具体技术进程</h2>
<h3>3.1 分析字段</h3>
<p>根据数据存储结构，确定哪些字段需要加密：</p>
<ul>
<li>用户姓名</li>
<li>电话号码</li>
<li>邮箱</li>
<li>身份证号</li>
</ul>
<h3>3.2 AES加密工具</h3>
<blockquote><code>import javax.crypto.Cipher;</code><br>
<code>import javax.crypto.spec.SecretKeySpec;</code><br>
<code>import java.util.Base64;</code><br>
<code></code><br>
<code>public class AesUtil {</code><br>
<code>    private static final String ALGORITHM = &quot;AES&quot;;</code><br>
<code>    private static final String KEY = &quot;1234567890abcdef&quot;; // 16位密钥</code><br>
<code></code><br>
<code># ... (17 more lines)</code></blockquote>
<p><em>View full code: <a href="https://gist.github.com/geyuxu/5636a07be9a0dbef0b640e453d6fb97e">GitHub Gist</a></em></p><h3>3.3 实现MyBatis TypeHandler</h3>
<blockquote><code>import org.apache.ibatis.type.BaseTypeHandler;</code><br>
<code>import org.apache.ibatis.type.JdbcType;</code><br>
<code></code><br>
<code>import java.sql.CallableStatement;</code><br>
<code>import java.sql.PreparedStatement;</code><br>
<code>import java.sql.ResultSet;</code><br>
<code>import java.sql.SQLException;</code><br>
<code></code><br>
<code># ... (38 more lines)</code></blockquote>
<p><em>View full code: <a href="https://gist.github.com/geyuxu/af3d9a6cdd5e633ffb1d050a29314627">GitHub Gist</a></em></p><p>配合 MyBatis Mapper 使用：</p>
<p><code>&lt;result property=&quot;phone&quot; column=&quot;phone&quot; typeHandler=&quot;xxx.EncryptTypeHandler&quot; /&gt;</code></p><h3>3.4 数据移植脚本</h3>
<p>写一个移植脚本，将旧数据转为加密形式。</p>
<p>基本步骤：</p>
<ul>
<li>找出所有旧数据</li>
<li>调用AesUtil进行加密</li>
<li>更新回原数据表</li>
</ul>
<p>示例：</p>
<blockquote><code>List&lt;User&gt; users = userDao.findAll();</code><br>
<code>for (User user : users) {</code><br>
<code>    String encryptedPhone = AesUtil.encrypt(user.getPhone());</code><br>
<code>    userDao.updatePhone(user.getId(), encryptedPhone);</code><br>
<code>}</code></blockquote><h2>4. 实践结果</h2>
<p>完成数据加密改造后，系统正常运行，上线用户体验无明显变化，同时提升了数据安全性，成功满足后续安全管控需求。</p>
<hr>
<p>整体过程中，最关键的是定制好规范，遵循加密协议，确保各组件互相兼容。实际工程中，还可考虑增加片段加密（如通过指定段名来分类加密），更精精刻控制实施效果。</p>

</body>
</html>