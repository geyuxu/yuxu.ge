<!DOCTYPE html><html lang="zh"> <head><!-- Global Metadata --><meta charset="utf-8"><!--<meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">--><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.css"><link rel="shortcut icon" href="/favicon.png" type="image/png"><link rel="sitemap" href="/sitemap-index.xml"><link rel="alternate" type="application/rss+xml" title="Ge Yuxu • AI &#38; Engineering" href="https://geyuxu.com/rss.xml"><meta name="generator" content="Astro v5.5.6"><!-- Font preloads --><link rel="preload" href="/fonts/atkinson-regular.woff" as="font" type="font/woff" crossorigin><link rel="preload" href="/fonts/atkinson-bold.woff" as="font" type="font/woff" crossorigin><!-- Canonical URL --><link rel="canonical" href="https://geyuxu.com/blog/notes/html5-canvas%E7%BB%8F%E5%85%B8%E5%9D%A6%E5%85%8B%E5%A4%A7%E6%88%98%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E5%8D%95%E6%96%87%E4%BB%B6%E6%B8%B8%E6%88%8F%E6%9E%B6%E6%9E%84%E5%AE%9E%E8%B7%B5/"><!-- Primary Meta Tags --><title>HTML5 Canvas经典坦克大战游戏开发：单文件游戏架构实践</title><meta name="title" content="HTML5 Canvas经典坦克大战游戏开发：单文件游戏架构实践"><meta name="description"><!-- Open Graph / Facebook --><meta property="og:type" content="website"><meta property="og:url" content="https://geyuxu.com/blog/notes/html5-canvas%E7%BB%8F%E5%85%B8%E5%9D%A6%E5%85%8B%E5%A4%A7%E6%88%98%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E5%8D%95%E6%96%87%E4%BB%B6%E6%B8%B8%E6%88%8F%E6%9E%B6%E6%9E%84%E5%AE%9E%E8%B7%B5/"><meta property="og:title" content="HTML5 Canvas经典坦克大战游戏开发：单文件游戏架构实践"><meta property="og:description"><meta property="og:image" content="https://geyuxu.com/blog-placeholder-1.jpg"><!-- Twitter --><meta property="twitter:card" content="summary_large_image"><meta property="twitter:url" content="https://geyuxu.com/blog/notes/html5-canvas%E7%BB%8F%E5%85%B8%E5%9D%A6%E5%85%8B%E5%A4%A7%E6%88%98%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E5%8D%95%E6%96%87%E4%BB%B6%E6%B8%B8%E6%88%8F%E6%9E%B6%E6%9E%84%E5%AE%9E%E8%B7%B5/"><meta property="twitter:title" content="HTML5 Canvas经典坦克大战游戏开发：单文件游戏架构实践"><meta property="twitter:description"><meta property="twitter:image" content="https://geyuxu.com/blog-placeholder-1.jpg"><script src="/js/jquery-3.7.1.min.js"></script><script src="/js/copy-code-button.js" defer></script><!-- Dify Chatbot Configuration --><script>
 window.difyChatbotConfig = {
  token: 'VgrjCAto93bjE0MW',
  systemVariables: {
    // user_id: 'YOU CAN DEFINE USER ID HERE',
    // conversation_id: 'YOU CAN DEFINE CONVERSATION ID HERE, IT MUST BE A VALID UUID',
  },
  userVariables: {
    // avatar_url: 'YOU CAN DEFINE USER AVATAR URL HERE',
    // name: 'YOU CAN DEFINE USER NAME HERE',
  },
 }
</script><!-- Dify Chatbot Script --><script src="https://udify.app/embed.min.js" id="VgrjCAto93bjE0MW" defer>
</script><!-- Dify Chatbot Custom Styles --><script is:global>
	window.addEventListener('DOMContentLoaded', () => {
		$('.toc ol').css({
		'list-style': 'none',   // 隐藏 1. 2. 3.
		'margin': 0,
		'padding-left': 0,       // 可按需调整
		});
		$('.toc ol > li').css({
		'list-style': 'none',   // 隐藏 1. 2. 3.
		'padding-left': 10
		});
        $('.sidebar').append($('.toc'));
      });
	</script><link rel="stylesheet" href="/_astro/assets-slug_.BFPovWfH.css">
<style>a[data-astro-cid-eimmu3lg]{display:inline-block;text-decoration:none}a[data-astro-cid-eimmu3lg].active{font-weight:bolder;text-decoration:underline}header[data-astro-cid-3ef6ksr2]{margin:0;padding:0 1em;background:#fff;box-shadow:0 2px 8px rgba(var(--black),5%)}h2[data-astro-cid-3ef6ksr2]{margin:0;font-size:1em}h2[data-astro-cid-3ef6ksr2] a[data-astro-cid-3ef6ksr2],h2[data-astro-cid-3ef6ksr2] a[data-astro-cid-3ef6ksr2].active{text-decoration:none}nav[data-astro-cid-3ef6ksr2]{display:flex;align-items:center;justify-content:space-between}nav[data-astro-cid-3ef6ksr2] a[data-astro-cid-3ef6ksr2]{padding:1em .5em;color:var(--black);border-bottom:4px solid transparent;text-decoration:none}nav[data-astro-cid-3ef6ksr2] a[data-astro-cid-3ef6ksr2].active{text-decoration:none;border-bottom-color:var(--accent)}.social-links[data-astro-cid-3ef6ksr2],.social-links[data-astro-cid-3ef6ksr2] a[data-astro-cid-3ef6ksr2]{display:flex}@media (max-width: 720px){.social-links[data-astro-cid-3ef6ksr2]{display:none}}footer[data-astro-cid-sz7xmlte]{padding:2em 1em 6em;background:linear-gradient(var(--gray-gradient)) no-repeat;color:rgb(var(--gray));text-align:center}.social-links[data-astro-cid-sz7xmlte]{display:flex;justify-content:center;gap:1em;margin-top:1em}.social-links[data-astro-cid-sz7xmlte] a[data-astro-cid-sz7xmlte]{text-decoration:none;color:rgb(var(--gray))}.social-links[data-astro-cid-sz7xmlte] a[data-astro-cid-sz7xmlte]:hover{color:rgb(var(--gray-dark))}
.statement[data-astro-cid-uffxixac]{font-size:10px;color:gray}@media (max-width: 640px){.statement[data-astro-cid-uffxixac]{font-size:6px;color:gray}}
</style></head> <body> <header data-astro-cid-3ef6ksr2> <nav data-astro-cid-3ef6ksr2> <!--<h2><a href="/">{SITE_TITLE}</a></h2>--> <h2 data-astro-cid-3ef6ksr2><a style="padding-left:0;color:blue;" href="/" data-astro-cid-3ef6ksr2>Ge Yuxu<br data-astro-cid-3ef6ksr2>AI & Engineering</a></h2> <div class="internal-links" data-astro-cid-3ef6ksr2> <a href="/" data-astro-cid-3ef6ksr2="true" data-astro-cid-eimmu3lg> Home </a>  <a href="/blog/1" class="active" data-astro-cid-3ef6ksr2="true" data-astro-cid-eimmu3lg> Blog </a>  <a href="/series" data-astro-cid-3ef6ksr2="true" data-astro-cid-eimmu3lg> Series </a>  <a href="/projects" data-astro-cid-3ef6ksr2="true" data-astro-cid-eimmu3lg> Projects </a>  </div> <div class="social-links" data-astro-cid-3ef6ksr2> <a href="https://github.com/geyuxu" target="_blank" data-astro-cid-3ef6ksr2> <span class="sr-only" data-astro-cid-3ef6ksr2>Go to Ge Yuxu's GitHub repo</span> <svg viewBox="0 0 16 16" aria-hidden="true" width="32" height="32" data-astro-cid-3ef6ksr2><path fill="currentColor" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.012 8.012 0 0 0 16 8c0-4.42-3.58-8-8-8z" data-astro-cid-3ef6ksr2></path></svg> </a> <a href="https://www.linkedin.com/in/geyuxu/" target="_blank" data-astro-cid-3ef6ksr2> <span class="sr-only" data-astro-cid-3ef6ksr2>Go to Ge Yuxu's LinkedIn profile</span> <svg viewBox="0 0 24 24" width="32" height="32" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" data-astro-cid-3ef6ksr2> <path fill="currentColor" d="M20.447 20.452H17.2v-5.569c0-1.328-.025-3.039-1.852-3.039-1.853 0-2.136 1.447-2.136 2.942v5.666h-3.248V9h3.122v1.561h.045c.435-.823 1.498-1.688 3.083-1.688 3.295 0 3.903 2.17 3.903 4.989v6.59zM5.337 7.433a1.882 1.882 0 110-3.764 1.882 1.882 0 010 3.764zm1.626 13.019H3.708V9h3.255v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.226.792 24 1.771 24h20.451C23.2 24 24 23.226 24 22.271V1.729C24 .774 23.2 0 22.222 0z" data-astro-cid-3ef6ksr2></path> </svg> </a> <a href="mailto:ngzerone@hotmail.com" target="_blank" data-astro-cid-3ef6ksr2> <span class="sr-only" data-astro-cid-3ef6ksr2>Send email to Ge Yuxu</span> <svg viewBox="0 0 24 24" width="32" height="32" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" data-astro-cid-3ef6ksr2> <path fill="currentColor" d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z" data-astro-cid-3ef6ksr2></path> </svg> </a> </div> </nav> <!-- Microsoft Clarity --> <script type="text/javascript">
		(function(c,l,a,r,i,t,y){
			c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
			t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
			y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
		})(window, document, "clarity", "script", "rc2w96osp6");
	</script> </header>  <main class="page"> <!-- 左侧栏 --> <aside class="sidebar"> <div class="meta"> <b>HTML5 Canvas经典坦克大战游戏开发：单文件游戏架构实践</b> <p><time datetime="2025-07-20T00:00:00.000Z"> 2025/07/20 08:00:00 </time></p> <p style="font-size:.85rem;color:var(--gray);">更新：<time datetime="2025-07-20T00:00:00.000Z"> 2025/07/20 08:00:00 </time></p>  </div> <hr> <br> </aside> <!-- 右侧正文区域（flex 居中） --> <div class="content-wrapper"> <article class="prose">  <nav class="toc"><ol class="toc-level toc-level-1"><li class="toc-item toc-item-h2"><a class="toc-link toc-link-h2" href="#项目概述">项目概述</a></li><li class="toc-item toc-item-h2"><a class="toc-link toc-link-h2" href="#技术选型与架构">技术选型与架构</a><ol class="toc-level toc-level-2"><li class="toc-item toc-item-h3"><a class="toc-link toc-link-h3" href="#核心技术">核心技术</a></li><li class="toc-item toc-item-h3"><a class="toc-link toc-link-h3" href="#架构特点">架构特点</a></li></ol></li><li class="toc-item toc-item-h2"><a class="toc-link toc-link-h2" href="#游戏系统设计">游戏系统设计</a><ol class="toc-level toc-level-2"><li class="toc-item toc-item-h3"><a class="toc-link toc-link-h3" href="#核心类结构">核心类结构</a></li><li class="toc-item toc-item-h3"><a class="toc-link toc-link-h3" href="#坦克类实现">坦克类实现</a></li><li class="toc-item toc-item-h3"><a class="toc-link toc-link-h3" href="#子弹系统">子弹系统</a></li></ol></li><li class="toc-item toc-item-h2"><a class="toc-link toc-link-h2" href="#游戏机制实现">游戏机制实现</a><ol class="toc-level toc-level-2"><li class="toc-item toc-item-h3"><a class="toc-link toc-link-h3" href="#碰撞检测系统">碰撞检测系统</a></li><li class="toc-item toc-item-h3"><a class="toc-link toc-link-h3" href="#关卡系统">关卡系统</a></li></ol></li><li class="toc-item toc-item-h2"><a class="toc-link toc-link-h2" href="#ui系统与游戏状态">UI系统与游戏状态</a><ol class="toc-level toc-level-2"><li class="toc-item toc-item-h3"><a class="toc-link toc-link-h3" href="#用户界面渲染">用户界面渲染</a></li></ol></li><li class="toc-item toc-item-h2"><a class="toc-link toc-link-h2" href="#性能优化策略">性能优化策略</a><ol class="toc-level toc-level-2"><li class="toc-item toc-item-h3"><a class="toc-link toc-link-h3" href="#1-对象池模式">1. 对象池模式</a></li><li class="toc-item toc-item-h3"><a class="toc-link toc-link-h3" href="#2-渲染优化">2. 渲染优化</a></li></ol></li><li class="toc-item toc-item-h2"><a class="toc-link toc-link-h2" href="#项目特色">项目特色</a><ol class="toc-level toc-level-2"><li class="toc-item toc-item-h3"><a class="toc-link toc-link-h3" href="#1-单文件架构优势">1. 单文件架构优势</a></li><li class="toc-item toc-item-h3"><a class="toc-link toc-link-h3" href="#2-经典游戏机制">2. 经典游戏机制</a></li><li class="toc-item toc-item-h3"><a class="toc-link toc-link-h3" href="#3-可扩展设计">3. 可扩展设计</a></li></ol></li><li class="toc-item toc-item-h2"><a class="toc-link toc-link-h2" href="#技术收获">技术收获</a><ol class="toc-level toc-level-2"><li class="toc-item toc-item-h3"><a class="toc-link toc-link-h3" href="#canvas-2d编程">Canvas 2D编程</a></li><li class="toc-item toc-item-h3"><a class="toc-link toc-link-h3" href="#游戏开发基础">游戏开发基础</a></li><li class="toc-item toc-item-h3"><a class="toc-link toc-link-h3" href="#性能优化实践">性能优化实践</a></li></ol></li><li class="toc-item toc-item-h2"><a class="toc-link toc-link-h2" href="#未来扩展方向">未来扩展方向</a></li><li class="toc-item toc-item-h2"><a class="toc-link toc-link-h2" href="#总结">总结</a></li></ol></nav><h2 id="项目概述"><a aria-hidden="true" tabindex="-1" href="#项目概述"><span class="icon icon-link"></span></a>项目概述</h2>
<p>开发了一款基于 <strong>HTML5 Canvas</strong> 和<strong>原生JavaScript</strong>的经典坦克大战游戏，采用单文件架构设计，实现了完整的游戏系统，包括玩家控制、敌人AI、子弹系统、碰撞检测、多波次敌人等核心功能，展示了轻量级Web游戏开发的精髓。</p>
<h2 id="技术选型与架构"><a aria-hidden="true" tabindex="-1" href="#技术选型与架构"><span class="icon icon-link"></span></a>技术选型与架构</h2>
<h3 id="核心技术"><a aria-hidden="true" tabindex="-1" href="#核心技术"><span class="icon icon-link"></span></a>核心技术</h3>
<ul>
<li><strong>HTML5 Canvas</strong>: 2D图形渲染</li>
<li><strong>原生JavaScript</strong>: 游戏逻辑实现</li>
<li><strong>CSS3</strong>: 界面样式和布局</li>
<li><strong>Web Audio API</strong>: 音效系统（可选扩展）</li>
</ul>
<h3 id="架构特点"><a aria-hidden="true" tabindex="-1" href="#架构特点"><span class="icon icon-link"></span></a>架构特点</h3>
<ul>
<li><strong>单文件设计</strong>: 所有代码集中在一个HTML文件中</li>
<li><strong>面向对象</strong>: 使用ES6类语法组织代码结构</li>
<li><strong>模块化思维</strong>: 清晰的功能分离和职责划分</li>
<li><strong>零依赖</strong>: 无需任何外部库或框架</li>
</ul>
<h2 id="游戏系统设计"><a aria-hidden="true" tabindex="-1" href="#游戏系统设计"><span class="icon icon-link"></span></a>游戏系统设计</h2>
<h3 id="核心类结构"><a aria-hidden="true" tabindex="-1" href="#核心类结构"><span class="icon icon-link"></span></a>核心类结构</h3>
<pre class="astro-code github-light" style="background-color:#fff;color:#24292e; overflow-x: auto;" tabindex="0" data-language="javascript"><code><span class="line"><span style="color:#6A737D">// 游戏主类</span></span>
<span class="line"><span style="color:#D73A49">class</span><span style="color:#6F42C1"> TankWarGame</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#D73A49">    constructor</span><span style="color:#24292E">() {</span></span>
<span class="line"><span style="color:#005CC5">        this</span><span style="color:#24292E">.canvas </span><span style="color:#D73A49">=</span><span style="color:#24292E"> document.</span><span style="color:#6F42C1">getElementById</span><span style="color:#24292E">(</span><span style="color:#032F62">'gameCanvas'</span><span style="color:#24292E">);</span></span>
<span class="line"><span style="color:#005CC5">        this</span><span style="color:#24292E">.ctx </span><span style="color:#D73A49">=</span><span style="color:#005CC5"> this</span><span style="color:#24292E">.canvas.</span><span style="color:#6F42C1">getContext</span><span style="color:#24292E">(</span><span style="color:#032F62">'2d'</span><span style="color:#24292E">);</span></span>
<span class="line"><span style="color:#005CC5">        this</span><span style="color:#24292E">.width </span><span style="color:#D73A49">=</span><span style="color:#005CC5"> 800</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#005CC5">        this</span><span style="color:#24292E">.height </span><span style="color:#D73A49">=</span><span style="color:#005CC5"> 600</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#24292E">        </span></span>
<span class="line"><span style="color:#005CC5">        this</span><span style="color:#24292E">.player </span><span style="color:#D73A49">=</span><span style="color:#D73A49"> new</span><span style="color:#6F42C1"> PlayerTank</span><span style="color:#24292E">(</span><span style="color:#005CC5">100</span><span style="color:#24292E">, </span><span style="color:#005CC5">500</span><span style="color:#24292E">);</span></span>
<span class="line"><span style="color:#005CC5">        this</span><span style="color:#24292E">.enemies </span><span style="color:#D73A49">=</span><span style="color:#24292E"> [];</span></span>
<span class="line"><span style="color:#005CC5">        this</span><span style="color:#24292E">.bullets </span><span style="color:#D73A49">=</span><span style="color:#24292E"> [];</span></span>
<span class="line"><span style="color:#005CC5">        this</span><span style="color:#24292E">.obstacles </span><span style="color:#D73A49">=</span><span style="color:#24292E"> [];</span></span>
<span class="line"><span style="color:#24292E">        </span></span>
<span class="line"><span style="color:#005CC5">        this</span><span style="color:#24292E">.gameState </span><span style="color:#D73A49">=</span><span style="color:#032F62"> 'playing'</span><span style="color:#24292E">; </span><span style="color:#6A737D">// playing, paused, gameOver</span></span>
<span class="line"><span style="color:#005CC5">        this</span><span style="color:#24292E">.score </span><span style="color:#D73A49">=</span><span style="color:#005CC5"> 0</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#005CC5">        this</span><span style="color:#24292E">.level </span><span style="color:#D73A49">=</span><span style="color:#005CC5"> 1</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#005CC5">        this</span><span style="color:#24292E">.enemiesRemaining </span><span style="color:#D73A49">=</span><span style="color:#005CC5"> 20</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#24292E">        </span></span>
<span class="line"><span style="color:#005CC5">        this</span><span style="color:#24292E">.keys </span><span style="color:#D73A49">=</span><span style="color:#24292E"> {};</span></span>
<span class="line"><span style="color:#005CC5">        this</span><span style="color:#24292E">.lastTime </span><span style="color:#D73A49">=</span><span style="color:#005CC5"> 0</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#24292E">        </span></span>
<span class="line"><span style="color:#005CC5">        this</span><span style="color:#24292E">.</span><span style="color:#6F42C1">init</span><span style="color:#24292E">();</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1">    init</span><span style="color:#24292E">() {</span></span>
<span class="line"><span style="color:#005CC5">        this</span><span style="color:#24292E">.</span><span style="color:#6F42C1">setupCanvas</span><span style="color:#24292E">();</span></span>
<span class="line"><span style="color:#005CC5">        this</span><span style="color:#24292E">.</span><span style="color:#6F42C1">bindEvents</span><span style="color:#24292E">();</span></span>
<span class="line"><span style="color:#005CC5">        this</span><span style="color:#24292E">.</span><span style="color:#6F42C1">createObstacles</span><span style="color:#24292E">();</span></span>
<span class="line"><span style="color:#005CC5">        this</span><span style="color:#24292E">.</span><span style="color:#6F42C1">spawnEnemies</span><span style="color:#24292E">();</span></span>
<span class="line"><span style="color:#005CC5">        this</span><span style="color:#24292E">.</span><span style="color:#6F42C1">gameLoop</span><span style="color:#24292E">();</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1">    setupCanvas</span><span style="color:#24292E">() {</span></span>
<span class="line"><span style="color:#005CC5">        this</span><span style="color:#24292E">.canvas.width </span><span style="color:#D73A49">=</span><span style="color:#005CC5"> this</span><span style="color:#24292E">.width;</span></span>
<span class="line"><span style="color:#005CC5">        this</span><span style="color:#24292E">.canvas.height </span><span style="color:#D73A49">=</span><span style="color:#005CC5"> this</span><span style="color:#24292E">.height;</span></span>
<span class="line"><span style="color:#005CC5">        this</span><span style="color:#24292E">.canvas.style.border </span><span style="color:#D73A49">=</span><span style="color:#032F62"> '2px solid #333'</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#005CC5">        this</span><span style="color:#24292E">.canvas.style.background </span><span style="color:#D73A49">=</span><span style="color:#032F62"> '#000'</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1">    bindEvents</span><span style="color:#24292E">() {</span></span>
<span class="line"><span style="color:#6A737D">        // 键盘事件处理</span></span>
<span class="line"><span style="color:#24292E">        document.</span><span style="color:#6F42C1">addEventListener</span><span style="color:#24292E">(</span><span style="color:#032F62">'keydown'</span><span style="color:#24292E">, (</span><span style="color:#E36209">e</span><span style="color:#24292E">) </span><span style="color:#D73A49">=></span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#005CC5">            this</span><span style="color:#24292E">.keys[e.code] </span><span style="color:#D73A49">=</span><span style="color:#005CC5"> true</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#24292E">        });</span></span>
<span class="line"><span style="color:#24292E">        </span></span>
<span class="line"><span style="color:#24292E">        document.</span><span style="color:#6F42C1">addEventListener</span><span style="color:#24292E">(</span><span style="color:#032F62">'keyup'</span><span style="color:#24292E">, (</span><span style="color:#E36209">e</span><span style="color:#24292E">) </span><span style="color:#D73A49">=></span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#005CC5">            this</span><span style="color:#24292E">.keys[e.code] </span><span style="color:#D73A49">=</span><span style="color:#005CC5"> false</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#24292E">        });</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1">    gameLoop</span><span style="color:#24292E">(</span><span style="color:#E36209">currentTime</span><span style="color:#D73A49"> =</span><span style="color:#005CC5"> 0</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#D73A49">        const</span><span style="color:#005CC5"> deltaTime</span><span style="color:#D73A49"> =</span><span style="color:#24292E"> currentTime </span><span style="color:#D73A49">-</span><span style="color:#005CC5"> this</span><span style="color:#24292E">.lastTime;</span></span>
<span class="line"><span style="color:#005CC5">        this</span><span style="color:#24292E">.lastTime </span><span style="color:#D73A49">=</span><span style="color:#24292E"> currentTime;</span></span>
<span class="line"><span style="color:#24292E">        </span></span>
<span class="line"><span style="color:#D73A49">        if</span><span style="color:#24292E"> (</span><span style="color:#005CC5">this</span><span style="color:#24292E">.gameState </span><span style="color:#D73A49">===</span><span style="color:#032F62"> 'playing'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#005CC5">            this</span><span style="color:#24292E">.</span><span style="color:#6F42C1">update</span><span style="color:#24292E">(deltaTime);</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">        </span></span>
<span class="line"><span style="color:#005CC5">        this</span><span style="color:#24292E">.</span><span style="color:#6F42C1">render</span><span style="color:#24292E">();</span></span>
<span class="line"><span style="color:#6F42C1">        requestAnimationFrame</span><span style="color:#24292E">((</span><span style="color:#E36209">time</span><span style="color:#24292E">) </span><span style="color:#D73A49">=></span><span style="color:#005CC5"> this</span><span style="color:#24292E">.</span><span style="color:#6F42C1">gameLoop</span><span style="color:#24292E">(time));</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1">    update</span><span style="color:#24292E">(</span><span style="color:#E36209">deltaTime</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#6A737D">        // 更新玩家</span></span>
<span class="line"><span style="color:#005CC5">        this</span><span style="color:#24292E">.player.</span><span style="color:#6F42C1">update</span><span style="color:#24292E">(deltaTime, </span><span style="color:#005CC5">this</span><span style="color:#24292E">.keys);</span></span>
<span class="line"><span style="color:#24292E">        </span></span>
<span class="line"><span style="color:#6A737D">        // 更新敌人</span></span>
<span class="line"><span style="color:#005CC5">        this</span><span style="color:#24292E">.enemies.</span><span style="color:#6F42C1">forEach</span><span style="color:#24292E">(</span><span style="color:#E36209">enemy</span><span style="color:#D73A49"> =></span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#24292E">            enemy.</span><span style="color:#6F42C1">update</span><span style="color:#24292E">(deltaTime, </span><span style="color:#005CC5">this</span><span style="color:#24292E">.player, </span><span style="color:#005CC5">this</span><span style="color:#24292E">.obstacles);</span></span>
<span class="line"><span style="color:#24292E">        });</span></span>
<span class="line"><span style="color:#24292E">        </span></span>
<span class="line"><span style="color:#6A737D">        // 更新子弹</span></span>
<span class="line"><span style="color:#005CC5">        this</span><span style="color:#24292E">.bullets.</span><span style="color:#6F42C1">forEach</span><span style="color:#24292E">(</span><span style="color:#E36209">bullet</span><span style="color:#D73A49"> =></span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#24292E">            bullet.</span><span style="color:#6F42C1">update</span><span style="color:#24292E">(deltaTime);</span></span>
<span class="line"><span style="color:#24292E">        });</span></span>
<span class="line"><span style="color:#24292E">        </span></span>
<span class="line"><span style="color:#6A737D">        // 处理碰撞</span></span>
<span class="line"><span style="color:#005CC5">        this</span><span style="color:#24292E">.</span><span style="color:#6F42C1">handleCollisions</span><span style="color:#24292E">();</span></span>
<span class="line"><span style="color:#24292E">        </span></span>
<span class="line"><span style="color:#6A737D">        // 清理无效对象</span></span>
<span class="line"><span style="color:#005CC5">        this</span><span style="color:#24292E">.</span><span style="color:#6F42C1">cleanup</span><span style="color:#24292E">();</span></span>
<span class="line"><span style="color:#24292E">        </span></span>
<span class="line"><span style="color:#6A737D">        // 检查游戏状态</span></span>
<span class="line"><span style="color:#005CC5">        this</span><span style="color:#24292E">.</span><span style="color:#6F42C1">checkGameState</span><span style="color:#24292E">();</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1">    render</span><span style="color:#24292E">() {</span></span>
<span class="line"><span style="color:#6A737D">        // 清除画布</span></span>
<span class="line"><span style="color:#005CC5">        this</span><span style="color:#24292E">.ctx.fillStyle </span><span style="color:#D73A49">=</span><span style="color:#032F62"> '#000'</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#005CC5">        this</span><span style="color:#24292E">.ctx.</span><span style="color:#6F42C1">fillRect</span><span style="color:#24292E">(</span><span style="color:#005CC5">0</span><span style="color:#24292E">, </span><span style="color:#005CC5">0</span><span style="color:#24292E">, </span><span style="color:#005CC5">this</span><span style="color:#24292E">.width, </span><span style="color:#005CC5">this</span><span style="color:#24292E">.height);</span></span>
<span class="line"><span style="color:#24292E">        </span></span>
<span class="line"><span style="color:#6A737D">        // 渲染障碍物</span></span>
<span class="line"><span style="color:#005CC5">        this</span><span style="color:#24292E">.obstacles.</span><span style="color:#6F42C1">forEach</span><span style="color:#24292E">(</span><span style="color:#E36209">obstacle</span><span style="color:#D73A49"> =></span><span style="color:#24292E"> obstacle.</span><span style="color:#6F42C1">render</span><span style="color:#24292E">(</span><span style="color:#005CC5">this</span><span style="color:#24292E">.ctx));</span></span>
<span class="line"><span style="color:#24292E">        </span></span>
<span class="line"><span style="color:#6A737D">        // 渲染坦克</span></span>
<span class="line"><span style="color:#005CC5">        this</span><span style="color:#24292E">.player.</span><span style="color:#6F42C1">render</span><span style="color:#24292E">(</span><span style="color:#005CC5">this</span><span style="color:#24292E">.ctx);</span></span>
<span class="line"><span style="color:#005CC5">        this</span><span style="color:#24292E">.enemies.</span><span style="color:#6F42C1">forEach</span><span style="color:#24292E">(</span><span style="color:#E36209">enemy</span><span style="color:#D73A49"> =></span><span style="color:#24292E"> enemy.</span><span style="color:#6F42C1">render</span><span style="color:#24292E">(</span><span style="color:#005CC5">this</span><span style="color:#24292E">.ctx));</span></span>
<span class="line"><span style="color:#24292E">        </span></span>
<span class="line"><span style="color:#6A737D">        // 渲染子弹</span></span>
<span class="line"><span style="color:#005CC5">        this</span><span style="color:#24292E">.bullets.</span><span style="color:#6F42C1">forEach</span><span style="color:#24292E">(</span><span style="color:#E36209">bullet</span><span style="color:#D73A49"> =></span><span style="color:#24292E"> bullet.</span><span style="color:#6F42C1">render</span><span style="color:#24292E">(</span><span style="color:#005CC5">this</span><span style="color:#24292E">.ctx));</span></span>
<span class="line"><span style="color:#24292E">        </span></span>
<span class="line"><span style="color:#6A737D">        // 渲染UI</span></span>
<span class="line"><span style="color:#005CC5">        this</span><span style="color:#24292E">.</span><span style="color:#6F42C1">renderUI</span><span style="color:#24292E">();</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">}</span></span></code></pre>
<h3 id="坦克类实现"><a aria-hidden="true" tabindex="-1" href="#坦克类实现"><span class="icon icon-link"></span></a>坦克类实现</h3>
<pre class="astro-code github-light" style="background-color:#fff;color:#24292e; overflow-x: auto;" tabindex="0" data-language="javascript"><code><span class="line"><span style="color:#D73A49">class</span><span style="color:#6F42C1"> Tank</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#D73A49">    constructor</span><span style="color:#24292E">(</span><span style="color:#E36209">x</span><span style="color:#24292E">, </span><span style="color:#E36209">y</span><span style="color:#24292E">, </span><span style="color:#E36209">color</span><span style="color:#D73A49"> =</span><span style="color:#032F62"> '#00FF00'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#005CC5">        this</span><span style="color:#24292E">.x </span><span style="color:#D73A49">=</span><span style="color:#24292E"> x;</span></span>
<span class="line"><span style="color:#005CC5">        this</span><span style="color:#24292E">.y </span><span style="color:#D73A49">=</span><span style="color:#24292E"> y;</span></span>
<span class="line"><span style="color:#005CC5">        this</span><span style="color:#24292E">.width </span><span style="color:#D73A49">=</span><span style="color:#005CC5"> 32</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#005CC5">        this</span><span style="color:#24292E">.height </span><span style="color:#D73A49">=</span><span style="color:#005CC5"> 32</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#005CC5">        this</span><span style="color:#24292E">.speed </span><span style="color:#D73A49">=</span><span style="color:#005CC5"> 100</span><span style="color:#24292E">; </span><span style="color:#6A737D">// pixels per second</span></span>
<span class="line"><span style="color:#005CC5">        this</span><span style="color:#24292E">.direction </span><span style="color:#D73A49">=</span><span style="color:#005CC5"> 0</span><span style="color:#24292E">; </span><span style="color:#6A737D">// 0:上, 1:右, 2:下, 3:左</span></span>
<span class="line"><span style="color:#005CC5">        this</span><span style="color:#24292E">.color </span><span style="color:#D73A49">=</span><span style="color:#24292E"> color;</span></span>
<span class="line"><span style="color:#005CC5">        this</span><span style="color:#24292E">.health </span><span style="color:#D73A49">=</span><span style="color:#005CC5"> 1</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#005CC5">        this</span><span style="color:#24292E">.fireRate </span><span style="color:#D73A49">=</span><span style="color:#005CC5"> 500</span><span style="color:#24292E">; </span><span style="color:#6A737D">// 毫秒</span></span>
<span class="line"><span style="color:#005CC5">        this</span><span style="color:#24292E">.lastFireTime </span><span style="color:#D73A49">=</span><span style="color:#005CC5"> 0</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1">    move</span><span style="color:#24292E">(</span><span style="color:#E36209">direction</span><span style="color:#24292E">, </span><span style="color:#E36209">deltaTime</span><span style="color:#24292E">, </span><span style="color:#E36209">obstacles</span><span style="color:#D73A49"> =</span><span style="color:#24292E"> []) {</span></span>
<span class="line"><span style="color:#D73A49">        const</span><span style="color:#005CC5"> speed</span><span style="color:#D73A49"> =</span><span style="color:#005CC5"> this</span><span style="color:#24292E">.speed </span><span style="color:#D73A49">*</span><span style="color:#24292E"> (deltaTime </span><span style="color:#D73A49">/</span><span style="color:#005CC5"> 1000</span><span style="color:#24292E">);</span></span>
<span class="line"><span style="color:#D73A49">        let</span><span style="color:#24292E"> newX </span><span style="color:#D73A49">=</span><span style="color:#005CC5"> this</span><span style="color:#24292E">.x;</span></span>
<span class="line"><span style="color:#D73A49">        let</span><span style="color:#24292E"> newY </span><span style="color:#D73A49">=</span><span style="color:#005CC5"> this</span><span style="color:#24292E">.y;</span></span>
<span class="line"><span style="color:#24292E">        </span></span>
<span class="line"><span style="color:#6A737D">        // 计算新位置</span></span>
<span class="line"><span style="color:#D73A49">        switch</span><span style="color:#24292E">(direction) {</span></span>
<span class="line"><span style="color:#D73A49">            case</span><span style="color:#005CC5"> 0</span><span style="color:#24292E">: newY </span><span style="color:#D73A49">-=</span><span style="color:#24292E"> speed; </span><span style="color:#D73A49">break</span><span style="color:#24292E">; </span><span style="color:#6A737D">// 上</span></span>
<span class="line"><span style="color:#D73A49">            case</span><span style="color:#005CC5"> 1</span><span style="color:#24292E">: newX </span><span style="color:#D73A49">+=</span><span style="color:#24292E"> speed; </span><span style="color:#D73A49">break</span><span style="color:#24292E">; </span><span style="color:#6A737D">// 右</span></span>
<span class="line"><span style="color:#D73A49">            case</span><span style="color:#005CC5"> 2</span><span style="color:#24292E">: newY </span><span style="color:#D73A49">+=</span><span style="color:#24292E"> speed; </span><span style="color:#D73A49">break</span><span style="color:#24292E">; </span><span style="color:#6A737D">// 下</span></span>
<span class="line"><span style="color:#D73A49">            case</span><span style="color:#005CC5"> 3</span><span style="color:#24292E">: newX </span><span style="color:#D73A49">-=</span><span style="color:#24292E"> speed; </span><span style="color:#D73A49">break</span><span style="color:#24292E">; </span><span style="color:#6A737D">// 左</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">        </span></span>
<span class="line"><span style="color:#6A737D">        // 边界检查</span></span>
<span class="line"><span style="color:#D73A49">        if</span><span style="color:#24292E"> (newX </span><span style="color:#D73A49">&#x3C;</span><span style="color:#005CC5"> 0</span><span style="color:#D73A49"> ||</span><span style="color:#24292E"> newX </span><span style="color:#D73A49">+</span><span style="color:#005CC5"> this</span><span style="color:#24292E">.width </span><span style="color:#D73A49">></span><span style="color:#005CC5"> 800</span><span style="color:#D73A49"> ||</span></span>
<span class="line"><span style="color:#24292E">            newY </span><span style="color:#D73A49">&#x3C;</span><span style="color:#005CC5"> 0</span><span style="color:#D73A49"> ||</span><span style="color:#24292E"> newY </span><span style="color:#D73A49">+</span><span style="color:#005CC5"> this</span><span style="color:#24292E">.height </span><span style="color:#D73A49">></span><span style="color:#005CC5"> 600</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#D73A49">            return</span><span style="color:#005CC5"> false</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">        </span></span>
<span class="line"><span style="color:#6A737D">        // 碰撞检测</span></span>
<span class="line"><span style="color:#D73A49">        const</span><span style="color:#005CC5"> tempTank</span><span style="color:#D73A49"> =</span><span style="color:#24292E"> { </span></span>
<span class="line"><span style="color:#24292E">            x: newX, </span></span>
<span class="line"><span style="color:#24292E">            y: newY, </span></span>
<span class="line"><span style="color:#24292E">            width: </span><span style="color:#005CC5">this</span><span style="color:#24292E">.width, </span></span>
<span class="line"><span style="color:#24292E">            height: </span><span style="color:#005CC5">this</span><span style="color:#24292E">.height </span></span>
<span class="line"><span style="color:#24292E">        };</span></span>
<span class="line"><span style="color:#24292E">        </span></span>
<span class="line"><span style="color:#D73A49">        if</span><span style="color:#24292E"> (</span><span style="color:#005CC5">this</span><span style="color:#24292E">.</span><span style="color:#6F42C1">checkCollisions</span><span style="color:#24292E">(tempTank, obstacles)) {</span></span>
<span class="line"><span style="color:#D73A49">            return</span><span style="color:#005CC5"> false</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">        </span></span>
<span class="line"><span style="color:#6A737D">        // 更新位置和方向</span></span>
<span class="line"><span style="color:#005CC5">        this</span><span style="color:#24292E">.x </span><span style="color:#D73A49">=</span><span style="color:#24292E"> newX;</span></span>
<span class="line"><span style="color:#005CC5">        this</span><span style="color:#24292E">.y </span><span style="color:#D73A49">=</span><span style="color:#24292E"> newY;</span></span>
<span class="line"><span style="color:#005CC5">        this</span><span style="color:#24292E">.direction </span><span style="color:#D73A49">=</span><span style="color:#24292E"> direction;</span></span>
<span class="line"><span style="color:#D73A49">        return</span><span style="color:#005CC5"> true</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1">    checkCollisions</span><span style="color:#24292E">(</span><span style="color:#E36209">rect</span><span style="color:#24292E">, </span><span style="color:#E36209">obstacles</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#D73A49">        return</span><span style="color:#24292E"> obstacles.</span><span style="color:#6F42C1">some</span><span style="color:#24292E">(</span><span style="color:#E36209">obstacle</span><span style="color:#D73A49"> =></span><span style="color:#24292E"> </span></span>
<span class="line"><span style="color:#005CC5">            this</span><span style="color:#24292E">.</span><span style="color:#6F42C1">isColliding</span><span style="color:#24292E">(rect, obstacle)</span></span>
<span class="line"><span style="color:#24292E">        );</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1">    isColliding</span><span style="color:#24292E">(</span><span style="color:#E36209">rect1</span><span style="color:#24292E">, </span><span style="color:#E36209">rect2</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#D73A49">        return</span><span style="color:#24292E"> rect1.x </span><span style="color:#D73A49">&#x3C;</span><span style="color:#24292E"> rect2.x </span><span style="color:#D73A49">+</span><span style="color:#24292E"> rect2.width </span><span style="color:#D73A49">&#x26;&#x26;</span></span>
<span class="line"><span style="color:#24292E">               rect1.x </span><span style="color:#D73A49">+</span><span style="color:#24292E"> rect1.width </span><span style="color:#D73A49">></span><span style="color:#24292E"> rect2.x </span><span style="color:#D73A49">&#x26;&#x26;</span></span>
<span class="line"><span style="color:#24292E">               rect1.y </span><span style="color:#D73A49">&#x3C;</span><span style="color:#24292E"> rect2.y </span><span style="color:#D73A49">+</span><span style="color:#24292E"> rect2.height </span><span style="color:#D73A49">&#x26;&#x26;</span></span>
<span class="line"><span style="color:#24292E">               rect1.y </span><span style="color:#D73A49">+</span><span style="color:#24292E"> rect1.height </span><span style="color:#D73A49">></span><span style="color:#24292E"> rect2.y;</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1">    fire</span><span style="color:#24292E">(</span><span style="color:#E36209">currentTime</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#D73A49">        if</span><span style="color:#24292E"> (currentTime </span><span style="color:#D73A49">-</span><span style="color:#005CC5"> this</span><span style="color:#24292E">.lastFireTime </span><span style="color:#D73A49">&#x3C;</span><span style="color:#005CC5"> this</span><span style="color:#24292E">.fireRate) {</span></span>
<span class="line"><span style="color:#D73A49">            return</span><span style="color:#005CC5"> null</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">        </span></span>
<span class="line"><span style="color:#005CC5">        this</span><span style="color:#24292E">.lastFireTime </span><span style="color:#D73A49">=</span><span style="color:#24292E"> currentTime;</span></span>
<span class="line"><span style="color:#24292E">        </span></span>
<span class="line"><span style="color:#6A737D">        // 计算子弹起始位置和方向</span></span>
<span class="line"><span style="color:#D73A49">        let</span><span style="color:#24292E"> bulletX </span><span style="color:#D73A49">=</span><span style="color:#005CC5"> this</span><span style="color:#24292E">.x </span><span style="color:#D73A49">+</span><span style="color:#005CC5"> this</span><span style="color:#24292E">.width </span><span style="color:#D73A49">/</span><span style="color:#005CC5"> 2</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#D73A49">        let</span><span style="color:#24292E"> bulletY </span><span style="color:#D73A49">=</span><span style="color:#005CC5"> this</span><span style="color:#24292E">.y </span><span style="color:#D73A49">+</span><span style="color:#005CC5"> this</span><span style="color:#24292E">.height </span><span style="color:#D73A49">/</span><span style="color:#005CC5"> 2</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#24292E">        </span></span>
<span class="line"><span style="color:#D73A49">        return</span><span style="color:#D73A49"> new</span><span style="color:#6F42C1"> Bullet</span><span style="color:#24292E">(bulletX, bulletY, </span><span style="color:#005CC5">this</span><span style="color:#24292E">.direction, </span><span style="color:#005CC5">this</span><span style="color:#24292E">);</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1">    render</span><span style="color:#24292E">(</span><span style="color:#E36209">ctx</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">        ctx.</span><span style="color:#6F42C1">save</span><span style="color:#24292E">();</span></span>
<span class="line"><span style="color:#24292E">        </span></span>
<span class="line"><span style="color:#6A737D">        // 移动到坦克中心</span></span>
<span class="line"><span style="color:#24292E">        ctx.</span><span style="color:#6F42C1">translate</span><span style="color:#24292E">(</span><span style="color:#005CC5">this</span><span style="color:#24292E">.x </span><span style="color:#D73A49">+</span><span style="color:#005CC5"> this</span><span style="color:#24292E">.width</span><span style="color:#D73A49">/</span><span style="color:#005CC5">2</span><span style="color:#24292E">, </span><span style="color:#005CC5">this</span><span style="color:#24292E">.y </span><span style="color:#D73A49">+</span><span style="color:#005CC5"> this</span><span style="color:#24292E">.height</span><span style="color:#D73A49">/</span><span style="color:#005CC5">2</span><span style="color:#24292E">);</span></span>
<span class="line"><span style="color:#24292E">        </span></span>
<span class="line"><span style="color:#6A737D">        // 根据方向旋转</span></span>
<span class="line"><span style="color:#24292E">        ctx.</span><span style="color:#6F42C1">rotate</span><span style="color:#24292E">(</span><span style="color:#005CC5">this</span><span style="color:#24292E">.direction </span><span style="color:#D73A49">*</span><span style="color:#24292E"> Math.</span><span style="color:#005CC5">PI</span><span style="color:#D73A49"> /</span><span style="color:#005CC5"> 2</span><span style="color:#24292E">);</span></span>
<span class="line"><span style="color:#24292E">        </span></span>
<span class="line"><span style="color:#6A737D">        // 绘制坦克主体</span></span>
<span class="line"><span style="color:#24292E">        ctx.fillStyle </span><span style="color:#D73A49">=</span><span style="color:#005CC5"> this</span><span style="color:#24292E">.color;</span></span>
<span class="line"><span style="color:#24292E">        ctx.</span><span style="color:#6F42C1">fillRect</span><span style="color:#24292E">(</span><span style="color:#D73A49">-</span><span style="color:#005CC5">this</span><span style="color:#24292E">.width</span><span style="color:#D73A49">/</span><span style="color:#005CC5">2</span><span style="color:#24292E">, </span><span style="color:#D73A49">-</span><span style="color:#005CC5">this</span><span style="color:#24292E">.height</span><span style="color:#D73A49">/</span><span style="color:#005CC5">2</span><span style="color:#24292E">, </span><span style="color:#005CC5">this</span><span style="color:#24292E">.width, </span><span style="color:#005CC5">this</span><span style="color:#24292E">.height);</span></span>
<span class="line"><span style="color:#24292E">        </span></span>
<span class="line"><span style="color:#6A737D">        // 绘制炮管</span></span>
<span class="line"><span style="color:#24292E">        ctx.fillStyle </span><span style="color:#D73A49">=</span><span style="color:#032F62"> '#444'</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#24292E">        ctx.</span><span style="color:#6F42C1">fillRect</span><span style="color:#24292E">(</span><span style="color:#D73A49">-</span><span style="color:#005CC5">2</span><span style="color:#24292E">, </span><span style="color:#D73A49">-</span><span style="color:#005CC5">this</span><span style="color:#24292E">.height</span><span style="color:#D73A49">/</span><span style="color:#005CC5">2</span><span style="color:#D73A49"> -</span><span style="color:#005CC5"> 8</span><span style="color:#24292E">, </span><span style="color:#005CC5">4</span><span style="color:#24292E">, </span><span style="color:#005CC5">12</span><span style="color:#24292E">);</span></span>
<span class="line"><span style="color:#24292E">        </span></span>
<span class="line"><span style="color:#6A737D">        // 绘制履带</span></span>
<span class="line"><span style="color:#24292E">        ctx.fillStyle </span><span style="color:#D73A49">=</span><span style="color:#032F62"> '#333'</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#24292E">        ctx.</span><span style="color:#6F42C1">fillRect</span><span style="color:#24292E">(</span><span style="color:#D73A49">-</span><span style="color:#005CC5">this</span><span style="color:#24292E">.width</span><span style="color:#D73A49">/</span><span style="color:#005CC5">2</span><span style="color:#D73A49"> -</span><span style="color:#005CC5"> 2</span><span style="color:#24292E">, </span><span style="color:#D73A49">-</span><span style="color:#005CC5">this</span><span style="color:#24292E">.height</span><span style="color:#D73A49">/</span><span style="color:#005CC5">2</span><span style="color:#24292E">, </span><span style="color:#005CC5">2</span><span style="color:#24292E">, </span><span style="color:#005CC5">this</span><span style="color:#24292E">.height);</span></span>
<span class="line"><span style="color:#24292E">        ctx.</span><span style="color:#6F42C1">fillRect</span><span style="color:#24292E">(</span><span style="color:#005CC5">this</span><span style="color:#24292E">.width</span><span style="color:#D73A49">/</span><span style="color:#005CC5">2</span><span style="color:#24292E">, </span><span style="color:#D73A49">-</span><span style="color:#005CC5">this</span><span style="color:#24292E">.height</span><span style="color:#D73A49">/</span><span style="color:#005CC5">2</span><span style="color:#24292E">, </span><span style="color:#005CC5">2</span><span style="color:#24292E">, </span><span style="color:#005CC5">this</span><span style="color:#24292E">.height);</span></span>
<span class="line"><span style="color:#24292E">        </span></span>
<span class="line"><span style="color:#24292E">        ctx.</span><span style="color:#6F42C1">restore</span><span style="color:#24292E">();</span></span>
<span class="line"><span style="color:#24292E">        </span></span>
<span class="line"><span style="color:#6A737D">        // 绘制血量条</span></span>
<span class="line"><span style="color:#D73A49">        if</span><span style="color:#24292E"> (</span><span style="color:#005CC5">this</span><span style="color:#24292E">.health </span><span style="color:#D73A49">&#x3C;</span><span style="color:#005CC5"> this</span><span style="color:#24292E">.maxHealth) {</span></span>
<span class="line"><span style="color:#005CC5">            this</span><span style="color:#24292E">.</span><span style="color:#6F42C1">drawHealthBar</span><span style="color:#24292E">(ctx);</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1">    drawHealthBar</span><span style="color:#24292E">(</span><span style="color:#E36209">ctx</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#D73A49">        const</span><span style="color:#005CC5"> barWidth</span><span style="color:#D73A49"> =</span><span style="color:#005CC5"> this</span><span style="color:#24292E">.width;</span></span>
<span class="line"><span style="color:#D73A49">        const</span><span style="color:#005CC5"> barHeight</span><span style="color:#D73A49"> =</span><span style="color:#005CC5"> 4</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#D73A49">        const</span><span style="color:#005CC5"> barY</span><span style="color:#D73A49"> =</span><span style="color:#005CC5"> this</span><span style="color:#24292E">.y </span><span style="color:#D73A49">-</span><span style="color:#005CC5"> 8</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#24292E">        </span></span>
<span class="line"><span style="color:#6A737D">        // 背景</span></span>
<span class="line"><span style="color:#24292E">        ctx.fillStyle </span><span style="color:#D73A49">=</span><span style="color:#032F62"> '#FF0000'</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#24292E">        ctx.</span><span style="color:#6F42C1">fillRect</span><span style="color:#24292E">(</span><span style="color:#005CC5">this</span><span style="color:#24292E">.x, barY, barWidth, barHeight);</span></span>
<span class="line"><span style="color:#24292E">        </span></span>
<span class="line"><span style="color:#6A737D">        // 血量</span></span>
<span class="line"><span style="color:#24292E">        ctx.fillStyle </span><span style="color:#D73A49">=</span><span style="color:#032F62"> '#00FF00'</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#D73A49">        const</span><span style="color:#005CC5"> healthWidth</span><span style="color:#D73A49"> =</span><span style="color:#24292E"> (</span><span style="color:#005CC5">this</span><span style="color:#24292E">.health </span><span style="color:#D73A49">/</span><span style="color:#005CC5"> this</span><span style="color:#24292E">.maxHealth) </span><span style="color:#D73A49">*</span><span style="color:#24292E"> barWidth;</span></span>
<span class="line"><span style="color:#24292E">        ctx.</span><span style="color:#6F42C1">fillRect</span><span style="color:#24292E">(</span><span style="color:#005CC5">this</span><span style="color:#24292E">.x, barY, healthWidth, barHeight);</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">// 玩家坦克类</span></span>
<span class="line"><span style="color:#D73A49">class</span><span style="color:#6F42C1"> PlayerTank</span><span style="color:#D73A49"> extends</span><span style="color:#6F42C1"> Tank</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#D73A49">    constructor</span><span style="color:#24292E">(</span><span style="color:#E36209">x</span><span style="color:#24292E">, </span><span style="color:#E36209">y</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#005CC5">        super</span><span style="color:#24292E">(x, y, </span><span style="color:#032F62">'#00FF00'</span><span style="color:#24292E">);</span></span>
<span class="line"><span style="color:#005CC5">        this</span><span style="color:#24292E">.maxHealth </span><span style="color:#D73A49">=</span><span style="color:#005CC5"> 3</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#005CC5">        this</span><span style="color:#24292E">.health </span><span style="color:#D73A49">=</span><span style="color:#005CC5"> this</span><span style="color:#24292E">.maxHealth;</span></span>
<span class="line"><span style="color:#005CC5">        this</span><span style="color:#24292E">.lives </span><span style="color:#D73A49">=</span><span style="color:#005CC5"> 3</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1">    update</span><span style="color:#24292E">(</span><span style="color:#E36209">deltaTime</span><span style="color:#24292E">, </span><span style="color:#E36209">keys</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#6A737D">        // 处理移动输入</span></span>
<span class="line"><span style="color:#D73A49">        if</span><span style="color:#24292E"> (keys[</span><span style="color:#032F62">'ArrowUp'</span><span style="color:#24292E">] </span><span style="color:#D73A49">||</span><span style="color:#24292E"> keys[</span><span style="color:#032F62">'KeyW'</span><span style="color:#24292E">]) {</span></span>
<span class="line"><span style="color:#005CC5">            this</span><span style="color:#24292E">.</span><span style="color:#6F42C1">move</span><span style="color:#24292E">(</span><span style="color:#005CC5">0</span><span style="color:#24292E">, deltaTime, game.obstacles);</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#D73A49">        if</span><span style="color:#24292E"> (keys[</span><span style="color:#032F62">'ArrowRight'</span><span style="color:#24292E">] </span><span style="color:#D73A49">||</span><span style="color:#24292E"> keys[</span><span style="color:#032F62">'KeyD'</span><span style="color:#24292E">]) {</span></span>
<span class="line"><span style="color:#005CC5">            this</span><span style="color:#24292E">.</span><span style="color:#6F42C1">move</span><span style="color:#24292E">(</span><span style="color:#005CC5">1</span><span style="color:#24292E">, deltaTime, game.obstacles);</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#D73A49">        if</span><span style="color:#24292E"> (keys[</span><span style="color:#032F62">'ArrowDown'</span><span style="color:#24292E">] </span><span style="color:#D73A49">||</span><span style="color:#24292E"> keys[</span><span style="color:#032F62">'KeyS'</span><span style="color:#24292E">]) {</span></span>
<span class="line"><span style="color:#005CC5">            this</span><span style="color:#24292E">.</span><span style="color:#6F42C1">move</span><span style="color:#24292E">(</span><span style="color:#005CC5">2</span><span style="color:#24292E">, deltaTime, game.obstacles);</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#D73A49">        if</span><span style="color:#24292E"> (keys[</span><span style="color:#032F62">'ArrowLeft'</span><span style="color:#24292E">] </span><span style="color:#D73A49">||</span><span style="color:#24292E"> keys[</span><span style="color:#032F62">'KeyA'</span><span style="color:#24292E">]) {</span></span>
<span class="line"><span style="color:#005CC5">            this</span><span style="color:#24292E">.</span><span style="color:#6F42C1">move</span><span style="color:#24292E">(</span><span style="color:#005CC5">3</span><span style="color:#24292E">, deltaTime, game.obstacles);</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">        </span></span>
<span class="line"><span style="color:#6A737D">        // 处理射击输入</span></span>
<span class="line"><span style="color:#D73A49">        if</span><span style="color:#24292E"> (keys[</span><span style="color:#032F62">'Space'</span><span style="color:#24292E">]) {</span></span>
<span class="line"><span style="color:#D73A49">            const</span><span style="color:#005CC5"> bullet</span><span style="color:#D73A49"> =</span><span style="color:#005CC5"> this</span><span style="color:#24292E">.</span><span style="color:#6F42C1">fire</span><span style="color:#24292E">(Date.</span><span style="color:#6F42C1">now</span><span style="color:#24292E">());</span></span>
<span class="line"><span style="color:#D73A49">            if</span><span style="color:#24292E"> (bullet) {</span></span>
<span class="line"><span style="color:#24292E">                game.bullets.</span><span style="color:#6F42C1">push</span><span style="color:#24292E">(bullet);</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">// 敌方坦克类</span></span>
<span class="line"><span style="color:#D73A49">class</span><span style="color:#6F42C1"> EnemyTank</span><span style="color:#D73A49"> extends</span><span style="color:#6F42C1"> Tank</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#D73A49">    constructor</span><span style="color:#24292E">(</span><span style="color:#E36209">x</span><span style="color:#24292E">, </span><span style="color:#E36209">y</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#005CC5">        super</span><span style="color:#24292E">(x, y, </span><span style="color:#032F62">'#FF0000'</span><span style="color:#24292E">);</span></span>
<span class="line"><span style="color:#005CC5">        this</span><span style="color:#24292E">.aiState </span><span style="color:#D73A49">=</span><span style="color:#032F62"> 'patrol'</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#005CC5">        this</span><span style="color:#24292E">.targetDirection </span><span style="color:#D73A49">=</span><span style="color:#24292E"> Math.</span><span style="color:#6F42C1">floor</span><span style="color:#24292E">(Math.</span><span style="color:#6F42C1">random</span><span style="color:#24292E">() </span><span style="color:#D73A49">*</span><span style="color:#005CC5"> 4</span><span style="color:#24292E">);</span></span>
<span class="line"><span style="color:#005CC5">        this</span><span style="color:#24292E">.stateChangeTime </span><span style="color:#D73A49">=</span><span style="color:#005CC5"> 0</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#005CC5">        this</span><span style="color:#24292E">.moveTime </span><span style="color:#D73A49">=</span><span style="color:#005CC5"> 0</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#005CC5">        this</span><span style="color:#24292E">.fireInterval </span><span style="color:#D73A49">=</span><span style="color:#005CC5"> 1000</span><span style="color:#D73A49"> +</span><span style="color:#24292E"> Math.</span><span style="color:#6F42C1">random</span><span style="color:#24292E">() </span><span style="color:#D73A49">*</span><span style="color:#005CC5"> 2000</span><span style="color:#24292E">; </span><span style="color:#6A737D">// 随机射击间隔</span></span>
<span class="line"><span style="color:#005CC5">        this</span><span style="color:#24292E">.lastAIUpdate </span><span style="color:#D73A49">=</span><span style="color:#005CC5"> 0</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1">    update</span><span style="color:#24292E">(</span><span style="color:#E36209">deltaTime</span><span style="color:#24292E">, </span><span style="color:#E36209">player</span><span style="color:#24292E">, </span><span style="color:#E36209">obstacles</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#D73A49">        const</span><span style="color:#005CC5"> currentTime</span><span style="color:#D73A49"> =</span><span style="color:#24292E"> Date.</span><span style="color:#6F42C1">now</span><span style="color:#24292E">();</span></span>
<span class="line"><span style="color:#24292E">        </span></span>
<span class="line"><span style="color:#6A737D">        // AI决策更新（降低更新频率以提升性能）</span></span>
<span class="line"><span style="color:#D73A49">        if</span><span style="color:#24292E"> (currentTime </span><span style="color:#D73A49">-</span><span style="color:#005CC5"> this</span><span style="color:#24292E">.lastAIUpdate </span><span style="color:#D73A49">></span><span style="color:#005CC5"> 100</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#005CC5">            this</span><span style="color:#24292E">.</span><span style="color:#6F42C1">updateAI</span><span style="color:#24292E">(deltaTime, player, obstacles);</span></span>
<span class="line"><span style="color:#005CC5">            this</span><span style="color:#24292E">.lastAIUpdate </span><span style="color:#D73A49">=</span><span style="color:#24292E"> currentTime;</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">        </span></span>
<span class="line"><span style="color:#6A737D">        // 移动</span></span>
<span class="line"><span style="color:#005CC5">        this</span><span style="color:#24292E">.</span><span style="color:#6F42C1">executeMovement</span><span style="color:#24292E">(deltaTime, obstacles);</span></span>
<span class="line"><span style="color:#24292E">        </span></span>
<span class="line"><span style="color:#6A737D">        // 射击</span></span>
<span class="line"><span style="color:#005CC5">        this</span><span style="color:#24292E">.</span><span style="color:#6F42C1">handleFiring</span><span style="color:#24292E">(currentTime, player);</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1">    updateAI</span><span style="color:#24292E">(</span><span style="color:#E36209">deltaTime</span><span style="color:#24292E">, </span><span style="color:#E36209">player</span><span style="color:#24292E">, </span><span style="color:#E36209">obstacles</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#D73A49">        const</span><span style="color:#005CC5"> distanceToPlayer</span><span style="color:#D73A49"> =</span><span style="color:#24292E"> Math.</span><span style="color:#6F42C1">sqrt</span><span style="color:#24292E">(</span></span>
<span class="line"><span style="color:#24292E">            Math.</span><span style="color:#6F42C1">pow</span><span style="color:#24292E">(player.x </span><span style="color:#D73A49">-</span><span style="color:#005CC5"> this</span><span style="color:#24292E">.x, </span><span style="color:#005CC5">2</span><span style="color:#24292E">) </span><span style="color:#D73A49">+</span><span style="color:#24292E"> </span></span>
<span class="line"><span style="color:#24292E">            Math.</span><span style="color:#6F42C1">pow</span><span style="color:#24292E">(player.y </span><span style="color:#D73A49">-</span><span style="color:#005CC5"> this</span><span style="color:#24292E">.y, </span><span style="color:#005CC5">2</span><span style="color:#24292E">)</span></span>
<span class="line"><span style="color:#24292E">        );</span></span>
<span class="line"><span style="color:#24292E">        </span></span>
<span class="line"><span style="color:#6A737D">        // 状态机</span></span>
<span class="line"><span style="color:#D73A49">        switch</span><span style="color:#24292E">(</span><span style="color:#005CC5">this</span><span style="color:#24292E">.aiState) {</span></span>
<span class="line"><span style="color:#D73A49">            case</span><span style="color:#032F62"> 'patrol'</span><span style="color:#24292E">:</span></span>
<span class="line"><span style="color:#D73A49">                if</span><span style="color:#24292E"> (distanceToPlayer </span><span style="color:#D73A49">&#x3C;</span><span style="color:#005CC5"> 150</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#005CC5">                    this</span><span style="color:#24292E">.aiState </span><span style="color:#D73A49">=</span><span style="color:#032F62"> 'attack'</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#005CC5">                    this</span><span style="color:#24292E">.targetDirection </span><span style="color:#D73A49">=</span><span style="color:#005CC5"> this</span><span style="color:#24292E">.</span><span style="color:#6F42C1">getDirectionToPlayer</span><span style="color:#24292E">(player);</span></span>
<span class="line"><span style="color:#24292E">                }</span></span>
<span class="line"><span style="color:#D73A49">                break</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#24292E">                </span></span>
<span class="line"><span style="color:#D73A49">            case</span><span style="color:#032F62"> 'attack'</span><span style="color:#24292E">:</span></span>
<span class="line"><span style="color:#D73A49">                if</span><span style="color:#24292E"> (distanceToPlayer </span><span style="color:#D73A49">></span><span style="color:#005CC5"> 200</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#005CC5">                    this</span><span style="color:#24292E">.aiState </span><span style="color:#D73A49">=</span><span style="color:#032F62"> 'patrol'</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#24292E">                } </span><span style="color:#D73A49">else</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#6A737D">                    // 朝向玩家</span></span>
<span class="line"><span style="color:#005CC5">                    this</span><span style="color:#24292E">.targetDirection </span><span style="color:#D73A49">=</span><span style="color:#005CC5"> this</span><span style="color:#24292E">.</span><span style="color:#6F42C1">getDirectionToPlayer</span><span style="color:#24292E">(player);</span></span>
<span class="line"><span style="color:#24292E">                }</span></span>
<span class="line"><span style="color:#D73A49">                break</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">        </span></span>
<span class="line"><span style="color:#6A737D">        // 随机改变方向（巡逻状态）</span></span>
<span class="line"><span style="color:#D73A49">        if</span><span style="color:#24292E"> (</span><span style="color:#005CC5">this</span><span style="color:#24292E">.aiState </span><span style="color:#D73A49">===</span><span style="color:#032F62"> 'patrol'</span><span style="color:#D73A49"> &#x26;&#x26;</span><span style="color:#24292E"> Math.</span><span style="color:#6F42C1">random</span><span style="color:#24292E">() </span><span style="color:#D73A49">&#x3C;</span><span style="color:#005CC5"> 0.02</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#005CC5">            this</span><span style="color:#24292E">.targetDirection </span><span style="color:#D73A49">=</span><span style="color:#24292E"> Math.</span><span style="color:#6F42C1">floor</span><span style="color:#24292E">(Math.</span><span style="color:#6F42C1">random</span><span style="color:#24292E">() </span><span style="color:#D73A49">*</span><span style="color:#005CC5"> 4</span><span style="color:#24292E">);</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1">    getDirectionToPlayer</span><span style="color:#24292E">(</span><span style="color:#E36209">player</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#D73A49">        const</span><span style="color:#005CC5"> dx</span><span style="color:#D73A49"> =</span><span style="color:#24292E"> player.x </span><span style="color:#D73A49">-</span><span style="color:#005CC5"> this</span><span style="color:#24292E">.x;</span></span>
<span class="line"><span style="color:#D73A49">        const</span><span style="color:#005CC5"> dy</span><span style="color:#D73A49"> =</span><span style="color:#24292E"> player.y </span><span style="color:#D73A49">-</span><span style="color:#005CC5"> this</span><span style="color:#24292E">.y;</span></span>
<span class="line"><span style="color:#24292E">        </span></span>
<span class="line"><span style="color:#D73A49">        if</span><span style="color:#24292E"> (Math.</span><span style="color:#6F42C1">abs</span><span style="color:#24292E">(dx) </span><span style="color:#D73A49">></span><span style="color:#24292E"> Math.</span><span style="color:#6F42C1">abs</span><span style="color:#24292E">(dy)) {</span></span>
<span class="line"><span style="color:#D73A49">            return</span><span style="color:#24292E"> dx </span><span style="color:#D73A49">></span><span style="color:#005CC5"> 0</span><span style="color:#D73A49"> ?</span><span style="color:#005CC5"> 1</span><span style="color:#D73A49"> :</span><span style="color:#005CC5"> 3</span><span style="color:#24292E">; </span><span style="color:#6A737D">// 右或左</span></span>
<span class="line"><span style="color:#24292E">        } </span><span style="color:#D73A49">else</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#D73A49">            return</span><span style="color:#24292E"> dy </span><span style="color:#D73A49">></span><span style="color:#005CC5"> 0</span><span style="color:#D73A49"> ?</span><span style="color:#005CC5"> 2</span><span style="color:#D73A49"> :</span><span style="color:#005CC5"> 0</span><span style="color:#24292E">; </span><span style="color:#6A737D">// 下或上</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1">    executeMovement</span><span style="color:#24292E">(</span><span style="color:#E36209">deltaTime</span><span style="color:#24292E">, </span><span style="color:#E36209">obstacles</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#D73A49">        if</span><span style="color:#24292E"> (</span><span style="color:#D73A49">!</span><span style="color:#005CC5">this</span><span style="color:#24292E">.</span><span style="color:#6F42C1">move</span><span style="color:#24292E">(</span><span style="color:#005CC5">this</span><span style="color:#24292E">.targetDirection, deltaTime, obstacles)) {</span></span>
<span class="line"><span style="color:#6A737D">            // 撞墙了，改变方向</span></span>
<span class="line"><span style="color:#005CC5">            this</span><span style="color:#24292E">.targetDirection </span><span style="color:#D73A49">=</span><span style="color:#24292E"> Math.</span><span style="color:#6F42C1">floor</span><span style="color:#24292E">(Math.</span><span style="color:#6F42C1">random</span><span style="color:#24292E">() </span><span style="color:#D73A49">*</span><span style="color:#005CC5"> 4</span><span style="color:#24292E">);</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1">    handleFiring</span><span style="color:#24292E">(</span><span style="color:#E36209">currentTime</span><span style="color:#24292E">, </span><span style="color:#E36209">player</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#D73A49">        if</span><span style="color:#24292E"> (</span><span style="color:#005CC5">this</span><span style="color:#24292E">.aiState </span><span style="color:#D73A49">===</span><span style="color:#032F62"> 'attack'</span><span style="color:#D73A49"> &#x26;&#x26;</span><span style="color:#24292E"> </span></span>
<span class="line"><span style="color:#24292E">            currentTime </span><span style="color:#D73A49">-</span><span style="color:#005CC5"> this</span><span style="color:#24292E">.lastFireTime </span><span style="color:#D73A49">></span><span style="color:#005CC5"> this</span><span style="color:#24292E">.fireInterval) {</span></span>
<span class="line"><span style="color:#24292E">            </span></span>
<span class="line"><span style="color:#6A737D">            // 检查是否可以射击到玩家（简单的射线检测）</span></span>
<span class="line"><span style="color:#D73A49">            if</span><span style="color:#24292E"> (</span><span style="color:#005CC5">this</span><span style="color:#24292E">.</span><span style="color:#6F42C1">canShootPlayer</span><span style="color:#24292E">(player)) {</span></span>
<span class="line"><span style="color:#D73A49">                const</span><span style="color:#005CC5"> bullet</span><span style="color:#D73A49"> =</span><span style="color:#005CC5"> this</span><span style="color:#24292E">.</span><span style="color:#6F42C1">fire</span><span style="color:#24292E">(currentTime);</span></span>
<span class="line"><span style="color:#D73A49">                if</span><span style="color:#24292E"> (bullet) {</span></span>
<span class="line"><span style="color:#24292E">                    game.bullets.</span><span style="color:#6F42C1">push</span><span style="color:#24292E">(bullet);</span></span>
<span class="line"><span style="color:#24292E">                }</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1">    canShootPlayer</span><span style="color:#24292E">(</span><span style="color:#E36209">player</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#6A737D">        // 简化的射线检测</span></span>
<span class="line"><span style="color:#D73A49">        const</span><span style="color:#005CC5"> dx</span><span style="color:#D73A49"> =</span><span style="color:#24292E"> player.x </span><span style="color:#D73A49">-</span><span style="color:#005CC5"> this</span><span style="color:#24292E">.x;</span></span>
<span class="line"><span style="color:#D73A49">        const</span><span style="color:#005CC5"> dy</span><span style="color:#D73A49"> =</span><span style="color:#24292E"> player.y </span><span style="color:#D73A49">-</span><span style="color:#005CC5"> this</span><span style="color:#24292E">.y;</span></span>
<span class="line"><span style="color:#24292E">        </span></span>
<span class="line"><span style="color:#6A737D">        // 检查玩家是否在射击方向上</span></span>
<span class="line"><span style="color:#D73A49">        switch</span><span style="color:#24292E">(</span><span style="color:#005CC5">this</span><span style="color:#24292E">.direction) {</span></span>
<span class="line"><span style="color:#D73A49">            case</span><span style="color:#005CC5"> 0</span><span style="color:#24292E">: </span><span style="color:#D73A49">return</span><span style="color:#24292E"> dy </span><span style="color:#D73A49">&#x3C;</span><span style="color:#005CC5"> 0</span><span style="color:#D73A49"> &#x26;&#x26;</span><span style="color:#24292E"> Math.</span><span style="color:#6F42C1">abs</span><span style="color:#24292E">(dx) </span><span style="color:#D73A49">&#x3C;</span><span style="color:#005CC5"> 50</span><span style="color:#24292E">; </span><span style="color:#6A737D">// 上</span></span>
<span class="line"><span style="color:#D73A49">            case</span><span style="color:#005CC5"> 1</span><span style="color:#24292E">: </span><span style="color:#D73A49">return</span><span style="color:#24292E"> dx </span><span style="color:#D73A49">></span><span style="color:#005CC5"> 0</span><span style="color:#D73A49"> &#x26;&#x26;</span><span style="color:#24292E"> Math.</span><span style="color:#6F42C1">abs</span><span style="color:#24292E">(dy) </span><span style="color:#D73A49">&#x3C;</span><span style="color:#005CC5"> 50</span><span style="color:#24292E">; </span><span style="color:#6A737D">// 右</span></span>
<span class="line"><span style="color:#D73A49">            case</span><span style="color:#005CC5"> 2</span><span style="color:#24292E">: </span><span style="color:#D73A49">return</span><span style="color:#24292E"> dy </span><span style="color:#D73A49">></span><span style="color:#005CC5"> 0</span><span style="color:#D73A49"> &#x26;&#x26;</span><span style="color:#24292E"> Math.</span><span style="color:#6F42C1">abs</span><span style="color:#24292E">(dx) </span><span style="color:#D73A49">&#x3C;</span><span style="color:#005CC5"> 50</span><span style="color:#24292E">; </span><span style="color:#6A737D">// 下</span></span>
<span class="line"><span style="color:#D73A49">            case</span><span style="color:#005CC5"> 3</span><span style="color:#24292E">: </span><span style="color:#D73A49">return</span><span style="color:#24292E"> dx </span><span style="color:#D73A49">&#x3C;</span><span style="color:#005CC5"> 0</span><span style="color:#D73A49"> &#x26;&#x26;</span><span style="color:#24292E"> Math.</span><span style="color:#6F42C1">abs</span><span style="color:#24292E">(dy) </span><span style="color:#D73A49">&#x3C;</span><span style="color:#005CC5"> 50</span><span style="color:#24292E">; </span><span style="color:#6A737D">// 左</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#D73A49">        return</span><span style="color:#005CC5"> false</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">}</span></span></code></pre>
<h3 id="子弹系统"><a aria-hidden="true" tabindex="-1" href="#子弹系统"><span class="icon icon-link"></span></a>子弹系统</h3>
<pre class="astro-code github-light" style="background-color:#fff;color:#24292e; overflow-x: auto;" tabindex="0" data-language="javascript"><code><span class="line"><span style="color:#D73A49">class</span><span style="color:#6F42C1"> Bullet</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#D73A49">    constructor</span><span style="color:#24292E">(</span><span style="color:#E36209">x</span><span style="color:#24292E">, </span><span style="color:#E36209">y</span><span style="color:#24292E">, </span><span style="color:#E36209">direction</span><span style="color:#24292E">, </span><span style="color:#E36209">owner</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#005CC5">        this</span><span style="color:#24292E">.x </span><span style="color:#D73A49">=</span><span style="color:#24292E"> x;</span></span>
<span class="line"><span style="color:#005CC5">        this</span><span style="color:#24292E">.y </span><span style="color:#D73A49">=</span><span style="color:#24292E"> y;</span></span>
<span class="line"><span style="color:#005CC5">        this</span><span style="color:#24292E">.width </span><span style="color:#D73A49">=</span><span style="color:#005CC5"> 4</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#005CC5">        this</span><span style="color:#24292E">.height </span><span style="color:#D73A49">=</span><span style="color:#005CC5"> 4</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#005CC5">        this</span><span style="color:#24292E">.speed </span><span style="color:#D73A49">=</span><span style="color:#005CC5"> 300</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#005CC5">        this</span><span style="color:#24292E">.direction </span><span style="color:#D73A49">=</span><span style="color:#24292E"> direction;</span></span>
<span class="line"><span style="color:#005CC5">        this</span><span style="color:#24292E">.owner </span><span style="color:#D73A49">=</span><span style="color:#24292E"> owner;</span></span>
<span class="line"><span style="color:#005CC5">        this</span><span style="color:#24292E">.active </span><span style="color:#D73A49">=</span><span style="color:#005CC5"> true</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1">    update</span><span style="color:#24292E">(</span><span style="color:#E36209">deltaTime</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#D73A49">        if</span><span style="color:#24292E"> (</span><span style="color:#D73A49">!</span><span style="color:#005CC5">this</span><span style="color:#24292E">.active) </span><span style="color:#D73A49">return</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#24292E">        </span></span>
<span class="line"><span style="color:#D73A49">        const</span><span style="color:#005CC5"> speed</span><span style="color:#D73A49"> =</span><span style="color:#005CC5"> this</span><span style="color:#24292E">.speed </span><span style="color:#D73A49">*</span><span style="color:#24292E"> (deltaTime </span><span style="color:#D73A49">/</span><span style="color:#005CC5"> 1000</span><span style="color:#24292E">);</span></span>
<span class="line"><span style="color:#24292E">        </span></span>
<span class="line"><span style="color:#6A737D">        // 根据方向移动</span></span>
<span class="line"><span style="color:#D73A49">        switch</span><span style="color:#24292E">(</span><span style="color:#005CC5">this</span><span style="color:#24292E">.direction) {</span></span>
<span class="line"><span style="color:#D73A49">            case</span><span style="color:#005CC5"> 0</span><span style="color:#24292E">: </span><span style="color:#005CC5">this</span><span style="color:#24292E">.y </span><span style="color:#D73A49">-=</span><span style="color:#24292E"> speed; </span><span style="color:#D73A49">break</span><span style="color:#24292E">; </span><span style="color:#6A737D">// 上</span></span>
<span class="line"><span style="color:#D73A49">            case</span><span style="color:#005CC5"> 1</span><span style="color:#24292E">: </span><span style="color:#005CC5">this</span><span style="color:#24292E">.x </span><span style="color:#D73A49">+=</span><span style="color:#24292E"> speed; </span><span style="color:#D73A49">break</span><span style="color:#24292E">; </span><span style="color:#6A737D">// 右</span></span>
<span class="line"><span style="color:#D73A49">            case</span><span style="color:#005CC5"> 2</span><span style="color:#24292E">: </span><span style="color:#005CC5">this</span><span style="color:#24292E">.y </span><span style="color:#D73A49">+=</span><span style="color:#24292E"> speed; </span><span style="color:#D73A49">break</span><span style="color:#24292E">; </span><span style="color:#6A737D">// 下</span></span>
<span class="line"><span style="color:#D73A49">            case</span><span style="color:#005CC5"> 3</span><span style="color:#24292E">: </span><span style="color:#005CC5">this</span><span style="color:#24292E">.x </span><span style="color:#D73A49">-=</span><span style="color:#24292E"> speed; </span><span style="color:#D73A49">break</span><span style="color:#24292E">; </span><span style="color:#6A737D">// 左</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">        </span></span>
<span class="line"><span style="color:#6A737D">        // 边界检查</span></span>
<span class="line"><span style="color:#D73A49">        if</span><span style="color:#24292E"> (</span><span style="color:#005CC5">this</span><span style="color:#24292E">.x </span><span style="color:#D73A49">&#x3C;</span><span style="color:#005CC5"> 0</span><span style="color:#D73A49"> ||</span><span style="color:#005CC5"> this</span><span style="color:#24292E">.x </span><span style="color:#D73A49">></span><span style="color:#005CC5"> 800</span><span style="color:#D73A49"> ||</span><span style="color:#005CC5"> this</span><span style="color:#24292E">.y </span><span style="color:#D73A49">&#x3C;</span><span style="color:#005CC5"> 0</span><span style="color:#D73A49"> ||</span><span style="color:#005CC5"> this</span><span style="color:#24292E">.y </span><span style="color:#D73A49">></span><span style="color:#005CC5"> 600</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#005CC5">            this</span><span style="color:#24292E">.active </span><span style="color:#D73A49">=</span><span style="color:#005CC5"> false</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1">    render</span><span style="color:#24292E">(</span><span style="color:#E36209">ctx</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#D73A49">        if</span><span style="color:#24292E"> (</span><span style="color:#D73A49">!</span><span style="color:#005CC5">this</span><span style="color:#24292E">.active) </span><span style="color:#D73A49">return</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#24292E">        </span></span>
<span class="line"><span style="color:#24292E">        ctx.fillStyle </span><span style="color:#D73A49">=</span><span style="color:#032F62"> '#FFFF00'</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#24292E">        ctx.</span><span style="color:#6F42C1">fillRect</span><span style="color:#24292E">(</span><span style="color:#005CC5">this</span><span style="color:#24292E">.x </span><span style="color:#D73A49">-</span><span style="color:#005CC5"> this</span><span style="color:#24292E">.width</span><span style="color:#D73A49">/</span><span style="color:#005CC5">2</span><span style="color:#24292E">, </span><span style="color:#005CC5">this</span><span style="color:#24292E">.y </span><span style="color:#D73A49">-</span><span style="color:#005CC5"> this</span><span style="color:#24292E">.height</span><span style="color:#D73A49">/</span><span style="color:#005CC5">2</span><span style="color:#24292E">, </span></span>
<span class="line"><span style="color:#005CC5">                    this</span><span style="color:#24292E">.width, </span><span style="color:#005CC5">this</span><span style="color:#24292E">.height);</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1">    checkCollision</span><span style="color:#24292E">(</span><span style="color:#E36209">target</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#D73A49">        if</span><span style="color:#24292E"> (</span><span style="color:#D73A49">!</span><span style="color:#005CC5">this</span><span style="color:#24292E">.active </span><span style="color:#D73A49">||</span><span style="color:#005CC5"> this</span><span style="color:#24292E">.owner </span><span style="color:#D73A49">===</span><span style="color:#24292E"> target) </span><span style="color:#D73A49">return</span><span style="color:#005CC5"> false</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#24292E">        </span></span>
<span class="line"><span style="color:#D73A49">        return</span><span style="color:#005CC5"> this</span><span style="color:#24292E">.x </span><span style="color:#D73A49">&#x3C;</span><span style="color:#24292E"> target.x </span><span style="color:#D73A49">+</span><span style="color:#24292E"> target.width </span><span style="color:#D73A49">&#x26;&#x26;</span></span>
<span class="line"><span style="color:#005CC5">               this</span><span style="color:#24292E">.x </span><span style="color:#D73A49">+</span><span style="color:#005CC5"> this</span><span style="color:#24292E">.width </span><span style="color:#D73A49">></span><span style="color:#24292E"> target.x </span><span style="color:#D73A49">&#x26;&#x26;</span></span>
<span class="line"><span style="color:#005CC5">               this</span><span style="color:#24292E">.y </span><span style="color:#D73A49">&#x3C;</span><span style="color:#24292E"> target.y </span><span style="color:#D73A49">+</span><span style="color:#24292E"> target.height </span><span style="color:#D73A49">&#x26;&#x26;</span></span>
<span class="line"><span style="color:#005CC5">               this</span><span style="color:#24292E">.y </span><span style="color:#D73A49">+</span><span style="color:#005CC5"> this</span><span style="color:#24292E">.height </span><span style="color:#D73A49">></span><span style="color:#24292E"> target.y;</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">}</span></span></code></pre>
<h2 id="游戏机制实现"><a aria-hidden="true" tabindex="-1" href="#游戏机制实现"><span class="icon icon-link"></span></a>游戏机制实现</h2>
<h3 id="碰撞检测系统"><a aria-hidden="true" tabindex="-1" href="#碰撞检测系统"><span class="icon icon-link"></span></a>碰撞检测系统</h3>
<pre class="astro-code github-light" style="background-color:#fff;color:#24292e; overflow-x: auto;" tabindex="0" data-language="javascript"><code><span class="line"><span style="color:#D73A49">class</span><span style="color:#6F42C1"> CollisionManager</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#D73A49">    static</span><span style="color:#6F42C1"> handleBulletCollisions</span><span style="color:#24292E">(</span><span style="color:#E36209">bullets</span><span style="color:#24292E">, </span><span style="color:#E36209">targets</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">        bullets.</span><span style="color:#6F42C1">forEach</span><span style="color:#24292E">(</span><span style="color:#E36209">bullet</span><span style="color:#D73A49"> =></span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#D73A49">            if</span><span style="color:#24292E"> (</span><span style="color:#D73A49">!</span><span style="color:#24292E">bullet.active) </span><span style="color:#D73A49">return</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#24292E">            </span></span>
<span class="line"><span style="color:#6A737D">            // 检查与障碍物的碰撞</span></span>
<span class="line"><span style="color:#24292E">            game.obstacles.</span><span style="color:#6F42C1">forEach</span><span style="color:#24292E">(</span><span style="color:#E36209">obstacle</span><span style="color:#D73A49"> =></span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#D73A49">                if</span><span style="color:#24292E"> (bullet.</span><span style="color:#6F42C1">checkCollision</span><span style="color:#24292E">(obstacle)) {</span></span>
<span class="line"><span style="color:#24292E">                    bullet.active </span><span style="color:#D73A49">=</span><span style="color:#005CC5"> false</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#6A737D">                    // 可以添加爆炸效果</span></span>
<span class="line"><span style="color:#005CC5">                    this</span><span style="color:#24292E">.</span><span style="color:#6F42C1">createExplosion</span><span style="color:#24292E">(bullet.x, bullet.y);</span></span>
<span class="line"><span style="color:#24292E">                }</span></span>
<span class="line"><span style="color:#24292E">            });</span></span>
<span class="line"><span style="color:#24292E">            </span></span>
<span class="line"><span style="color:#6A737D">            // 检查与坦克的碰撞</span></span>
<span class="line"><span style="color:#24292E">            targets.</span><span style="color:#6F42C1">forEach</span><span style="color:#24292E">(</span><span style="color:#E36209">target</span><span style="color:#D73A49"> =></span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#D73A49">                if</span><span style="color:#24292E"> (bullet.</span><span style="color:#6F42C1">checkCollision</span><span style="color:#24292E">(target)) {</span></span>
<span class="line"><span style="color:#24292E">                    bullet.active </span><span style="color:#D73A49">=</span><span style="color:#005CC5"> false</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#24292E">                    target.health</span><span style="color:#D73A49">--</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#24292E">                    </span></span>
<span class="line"><span style="color:#6A737D">                    // 创建击中效果</span></span>
<span class="line"><span style="color:#005CC5">                    this</span><span style="color:#24292E">.</span><span style="color:#6F42C1">createHitEffect</span><span style="color:#24292E">(target.x, target.y);</span></span>
<span class="line"><span style="color:#24292E">                    </span></span>
<span class="line"><span style="color:#6A737D">                    // 检查目标是否被摧毁</span></span>
<span class="line"><span style="color:#D73A49">                    if</span><span style="color:#24292E"> (target.health </span><span style="color:#D73A49">&#x3C;=</span><span style="color:#005CC5"> 0</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#005CC5">                        this</span><span style="color:#24292E">.</span><span style="color:#6F42C1">destroyTarget</span><span style="color:#24292E">(target);</span></span>
<span class="line"><span style="color:#24292E">                    }</span></span>
<span class="line"><span style="color:#24292E">                }</span></span>
<span class="line"><span style="color:#24292E">            });</span></span>
<span class="line"><span style="color:#24292E">        });</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">    static</span><span style="color:#6F42C1"> createExplosion</span><span style="color:#24292E">(</span><span style="color:#E36209">x</span><span style="color:#24292E">, </span><span style="color:#E36209">y</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#6A737D">        // 简单的爆炸效果</span></span>
<span class="line"><span style="color:#D73A49">        const</span><span style="color:#005CC5"> explosion</span><span style="color:#D73A49"> =</span><span style="color:#D73A49"> new</span><span style="color:#6F42C1"> ParticleEffect</span><span style="color:#24292E">(x, y, </span><span style="color:#032F62">'explosion'</span><span style="color:#24292E">);</span></span>
<span class="line"><span style="color:#24292E">        game.effects.</span><span style="color:#6F42C1">push</span><span style="color:#24292E">(explosion);</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">    static</span><span style="color:#6F42C1"> createHitEffect</span><span style="color:#24292E">(</span><span style="color:#E36209">x</span><span style="color:#24292E">, </span><span style="color:#E36209">y</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#6A737D">        // 击中效果</span></span>
<span class="line"><span style="color:#D73A49">        const</span><span style="color:#005CC5"> hitEffect</span><span style="color:#D73A49"> =</span><span style="color:#D73A49"> new</span><span style="color:#6F42C1"> ParticleEffect</span><span style="color:#24292E">(x, y, </span><span style="color:#032F62">'hit'</span><span style="color:#24292E">);</span></span>
<span class="line"><span style="color:#24292E">        game.effects.</span><span style="color:#6F42C1">push</span><span style="color:#24292E">(hitEffect);</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">    static</span><span style="color:#6F42C1"> destroyTarget</span><span style="color:#24292E">(</span><span style="color:#E36209">target</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#D73A49">        if</span><span style="color:#24292E"> (target </span><span style="color:#D73A49">instanceof</span><span style="color:#6F42C1"> EnemyTank</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#6A737D">            // 敌方坦克被摧毁</span></span>
<span class="line"><span style="color:#24292E">            game.score </span><span style="color:#D73A49">+=</span><span style="color:#005CC5"> 100</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#24292E">            game.enemiesRemaining</span><span style="color:#D73A49">--</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#24292E">            </span></span>
<span class="line"><span style="color:#6A737D">            // 从数组中移除</span></span>
<span class="line"><span style="color:#D73A49">            const</span><span style="color:#005CC5"> index</span><span style="color:#D73A49"> =</span><span style="color:#24292E"> game.enemies.</span><span style="color:#6F42C1">indexOf</span><span style="color:#24292E">(target);</span></span>
<span class="line"><span style="color:#D73A49">            if</span><span style="color:#24292E"> (index </span><span style="color:#D73A49">></span><span style="color:#D73A49"> -</span><span style="color:#005CC5">1</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">                game.enemies.</span><span style="color:#6F42C1">splice</span><span style="color:#24292E">(index, </span><span style="color:#005CC5">1</span><span style="color:#24292E">);</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">            </span></span>
<span class="line"><span style="color:#6A737D">            // 创建爆炸效果</span></span>
<span class="line"><span style="color:#005CC5">            this</span><span style="color:#24292E">.</span><span style="color:#6F42C1">createExplosion</span><span style="color:#24292E">(target.x, target.y);</span></span>
<span class="line"><span style="color:#24292E">            </span></span>
<span class="line"><span style="color:#24292E">        } </span><span style="color:#D73A49">else</span><span style="color:#D73A49"> if</span><span style="color:#24292E"> (target </span><span style="color:#D73A49">instanceof</span><span style="color:#6F42C1"> PlayerTank</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#6A737D">            // 玩家坦克被摧毁</span></span>
<span class="line"><span style="color:#24292E">            target.lives</span><span style="color:#D73A49">--</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#24292E">            target.health </span><span style="color:#D73A49">=</span><span style="color:#24292E"> target.maxHealth;</span></span>
<span class="line"><span style="color:#24292E">            </span></span>
<span class="line"><span style="color:#D73A49">            if</span><span style="color:#24292E"> (target.lives </span><span style="color:#D73A49">&#x3C;=</span><span style="color:#005CC5"> 0</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">                game.gameState </span><span style="color:#D73A49">=</span><span style="color:#032F62"> 'gameOver'</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#24292E">            } </span><span style="color:#D73A49">else</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#6A737D">                // 重置玩家位置</span></span>
<span class="line"><span style="color:#24292E">                target.x </span><span style="color:#D73A49">=</span><span style="color:#005CC5"> 100</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#24292E">                target.y </span><span style="color:#D73A49">=</span><span style="color:#005CC5"> 500</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">}</span></span></code></pre>
<h3 id="关卡系统"><a aria-hidden="true" tabindex="-1" href="#关卡系统"><span class="icon icon-link"></span></a>关卡系统</h3>
<pre class="astro-code github-light" style="background-color:#fff;color:#24292e; overflow-x: auto;" tabindex="0" data-language="javascript"><code><span class="line"><span style="color:#D73A49">class</span><span style="color:#6F42C1"> LevelManager</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#D73A49">    static</span><span style="color:#E36209"> levels</span><span style="color:#D73A49"> =</span><span style="color:#24292E"> [</span></span>
<span class="line"><span style="color:#24292E">        { enemies: </span><span style="color:#005CC5">5</span><span style="color:#24292E">, speed: </span><span style="color:#005CC5">1.0</span><span style="color:#24292E">, fireRate: </span><span style="color:#005CC5">1.0</span><span style="color:#24292E"> },</span></span>
<span class="line"><span style="color:#24292E">        { enemies: </span><span style="color:#005CC5">8</span><span style="color:#24292E">, speed: </span><span style="color:#005CC5">1.2</span><span style="color:#24292E">, fireRate: </span><span style="color:#005CC5">1.2</span><span style="color:#24292E"> },</span></span>
<span class="line"><span style="color:#24292E">        { enemies: </span><span style="color:#005CC5">12</span><span style="color:#24292E">, speed: </span><span style="color:#005CC5">1.4</span><span style="color:#24292E">, fireRate: </span><span style="color:#005CC5">1.4</span><span style="color:#24292E"> },</span></span>
<span class="line"><span style="color:#24292E">        { enemies: </span><span style="color:#005CC5">16</span><span style="color:#24292E">, speed: </span><span style="color:#005CC5">1.6</span><span style="color:#24292E">, fireRate: </span><span style="color:#005CC5">1.6</span><span style="color:#24292E"> },</span></span>
<span class="line"><span style="color:#24292E">        { enemies: </span><span style="color:#005CC5">20</span><span style="color:#24292E">, speed: </span><span style="color:#005CC5">1.8</span><span style="color:#24292E">, fireRate: </span><span style="color:#005CC5">1.8</span><span style="color:#24292E"> }</span></span>
<span class="line"><span style="color:#24292E">    ];</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">    static</span><span style="color:#6F42C1"> loadLevel</span><span style="color:#24292E">(</span><span style="color:#E36209">levelNumber</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#D73A49">        const</span><span style="color:#005CC5"> level</span><span style="color:#D73A49"> =</span><span style="color:#005CC5"> this</span><span style="color:#24292E">.levels[levelNumber </span><span style="color:#D73A49">-</span><span style="color:#005CC5"> 1</span><span style="color:#24292E">] </span><span style="color:#D73A49">||</span><span style="color:#005CC5"> this</span><span style="color:#24292E">.levels[</span><span style="color:#005CC5">this</span><span style="color:#24292E">.levels.</span><span style="color:#005CC5">length</span><span style="color:#D73A49"> -</span><span style="color:#005CC5"> 1</span><span style="color:#24292E">];</span></span>
<span class="line"><span style="color:#24292E">        </span></span>
<span class="line"><span style="color:#6A737D">        // 清除现有敌人</span></span>
<span class="line"><span style="color:#24292E">        game.enemies </span><span style="color:#D73A49">=</span><span style="color:#24292E"> [];</span></span>
<span class="line"><span style="color:#24292E">        game.bullets </span><span style="color:#D73A49">=</span><span style="color:#24292E"> [];</span></span>
<span class="line"><span style="color:#24292E">        </span></span>
<span class="line"><span style="color:#6A737D">        // 设置关卡参数</span></span>
<span class="line"><span style="color:#24292E">        game.enemiesRemaining </span><span style="color:#D73A49">=</span><span style="color:#24292E"> level.enemies;</span></span>
<span class="line"><span style="color:#24292E">        game.level </span><span style="color:#D73A49">=</span><span style="color:#24292E"> levelNumber;</span></span>
<span class="line"><span style="color:#24292E">        </span></span>
<span class="line"><span style="color:#6A737D">        // 生成敌人</span></span>
<span class="line"><span style="color:#005CC5">        this</span><span style="color:#24292E">.</span><span style="color:#6F42C1">spawnEnemies</span><span style="color:#24292E">(level);</span></span>
<span class="line"><span style="color:#24292E">        </span></span>
<span class="line"><span style="color:#6A737D">        // 重置玩家</span></span>
<span class="line"><span style="color:#24292E">        game.player.x </span><span style="color:#D73A49">=</span><span style="color:#005CC5"> 100</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#24292E">        game.player.y </span><span style="color:#D73A49">=</span><span style="color:#005CC5"> 500</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#24292E">        game.player.health </span><span style="color:#D73A49">=</span><span style="color:#24292E"> game.player.maxHealth;</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">    static</span><span style="color:#6F42C1"> spawnEnemies</span><span style="color:#24292E">(</span><span style="color:#E36209">levelConfig</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#D73A49">        const</span><span style="color:#005CC5"> spawnPositions</span><span style="color:#D73A49"> =</span><span style="color:#24292E"> [</span></span>
<span class="line"><span style="color:#24292E">            { x: </span><span style="color:#005CC5">50</span><span style="color:#24292E">, y: </span><span style="color:#005CC5">50</span><span style="color:#24292E"> },</span></span>
<span class="line"><span style="color:#24292E">            { x: </span><span style="color:#005CC5">400</span><span style="color:#24292E">, y: </span><span style="color:#005CC5">50</span><span style="color:#24292E"> },</span></span>
<span class="line"><span style="color:#24292E">            { x: </span><span style="color:#005CC5">750</span><span style="color:#24292E">, y: </span><span style="color:#005CC5">50</span><span style="color:#24292E"> },</span></span>
<span class="line"><span style="color:#24292E">            { x: </span><span style="color:#005CC5">750</span><span style="color:#24292E">, y: </span><span style="color:#005CC5">300</span><span style="color:#24292E"> },</span></span>
<span class="line"><span style="color:#24292E">            { x: </span><span style="color:#005CC5">400</span><span style="color:#24292E">, y: </span><span style="color:#005CC5">300</span><span style="color:#24292E"> }</span></span>
<span class="line"><span style="color:#24292E">        ];</span></span>
<span class="line"><span style="color:#24292E">        </span></span>
<span class="line"><span style="color:#D73A49">        for</span><span style="color:#24292E"> (</span><span style="color:#D73A49">let</span><span style="color:#24292E"> i </span><span style="color:#D73A49">=</span><span style="color:#005CC5"> 0</span><span style="color:#24292E">; i </span><span style="color:#D73A49">&#x3C;</span><span style="color:#24292E"> Math.</span><span style="color:#6F42C1">min</span><span style="color:#24292E">(</span><span style="color:#005CC5">5</span><span style="color:#24292E">, levelConfig.enemies); i</span><span style="color:#D73A49">++</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#D73A49">            const</span><span style="color:#005CC5"> pos</span><span style="color:#D73A49"> =</span><span style="color:#24292E"> spawnPositions[i];</span></span>
<span class="line"><span style="color:#D73A49">            const</span><span style="color:#005CC5"> enemy</span><span style="color:#D73A49"> =</span><span style="color:#D73A49"> new</span><span style="color:#6F42C1"> EnemyTank</span><span style="color:#24292E">(pos.x, pos.y);</span></span>
<span class="line"><span style="color:#24292E">            </span></span>
<span class="line"><span style="color:#6A737D">            // 应用关卡难度</span></span>
<span class="line"><span style="color:#24292E">            enemy.speed </span><span style="color:#D73A49">*=</span><span style="color:#24292E"> levelConfig.speed;</span></span>
<span class="line"><span style="color:#24292E">            enemy.fireInterval </span><span style="color:#D73A49">/=</span><span style="color:#24292E"> levelConfig.fireRate;</span></span>
<span class="line"><span style="color:#24292E">            </span></span>
<span class="line"><span style="color:#24292E">            game.enemies.</span><span style="color:#6F42C1">push</span><span style="color:#24292E">(enemy);</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">        </span></span>
<span class="line"><span style="color:#6A737D">        // 设置剩余敌人计数</span></span>
<span class="line"><span style="color:#24292E">        game.enemiesToSpawn </span><span style="color:#D73A49">=</span><span style="color:#24292E"> levelConfig.enemies </span><span style="color:#D73A49">-</span><span style="color:#24292E"> game.enemies.</span><span style="color:#005CC5">length</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">    static</span><span style="color:#6F42C1"> checkLevelComplete</span><span style="color:#24292E">() {</span></span>
<span class="line"><span style="color:#D73A49">        if</span><span style="color:#24292E"> (game.enemies.</span><span style="color:#005CC5">length</span><span style="color:#D73A49"> ===</span><span style="color:#005CC5"> 0</span><span style="color:#D73A49"> &#x26;&#x26;</span><span style="color:#24292E"> game.enemiesToSpawn </span><span style="color:#D73A49">===</span><span style="color:#005CC5"> 0</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#6A737D">            // 关卡完成</span></span>
<span class="line"><span style="color:#24292E">            game.level</span><span style="color:#D73A49">++</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#6F42C1">            setTimeout</span><span style="color:#24292E">(() </span><span style="color:#D73A49">=></span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#005CC5">                this</span><span style="color:#24292E">.</span><span style="color:#6F42C1">loadLevel</span><span style="color:#24292E">(game.level);</span></span>
<span class="line"><span style="color:#24292E">            }, </span><span style="color:#005CC5">2000</span><span style="color:#24292E">);</span></span>
<span class="line"><span style="color:#24292E">            </span></span>
<span class="line"><span style="color:#D73A49">            return</span><span style="color:#005CC5"> true</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#D73A49">        return</span><span style="color:#005CC5"> false</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">}</span></span></code></pre>
<h2 id="ui系统与游戏状态"><a aria-hidden="true" tabindex="-1" href="#ui系统与游戏状态"><span class="icon icon-link"></span></a>UI系统与游戏状态</h2>
<h3 id="用户界面渲染"><a aria-hidden="true" tabindex="-1" href="#用户界面渲染"><span class="icon icon-link"></span></a>用户界面渲染</h3>
<pre class="astro-code github-light" style="background-color:#fff;color:#24292e; overflow-x: auto;" tabindex="0" data-language="javascript"><code><span class="line"><span style="color:#D73A49">class</span><span style="color:#6F42C1"> UIRenderer</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#D73A49">    static</span><span style="color:#6F42C1"> render</span><span style="color:#24292E">(</span><span style="color:#E36209">ctx</span><span style="color:#24292E">, </span><span style="color:#E36209">game</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#6A737D">        // 设置字体</span></span>
<span class="line"><span style="color:#24292E">        ctx.font </span><span style="color:#D73A49">=</span><span style="color:#032F62"> '16px Arial'</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#24292E">        ctx.fillStyle </span><span style="color:#D73A49">=</span><span style="color:#032F62"> '#FFFFFF'</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#24292E">        </span></span>
<span class="line"><span style="color:#6A737D">        // 渲染分数</span></span>
<span class="line"><span style="color:#24292E">        ctx.</span><span style="color:#6F42C1">fillText</span><span style="color:#24292E">(</span><span style="color:#032F62">`Score: ${</span><span style="color:#24292E">game</span><span style="color:#032F62">.</span><span style="color:#24292E">score</span><span style="color:#032F62">}`</span><span style="color:#24292E">, </span><span style="color:#005CC5">10</span><span style="color:#24292E">, </span><span style="color:#005CC5">25</span><span style="color:#24292E">);</span></span>
<span class="line"><span style="color:#24292E">        </span></span>
<span class="line"><span style="color:#6A737D">        // 渲染关卡</span></span>
<span class="line"><span style="color:#24292E">        ctx.</span><span style="color:#6F42C1">fillText</span><span style="color:#24292E">(</span><span style="color:#032F62">`Level: ${</span><span style="color:#24292E">game</span><span style="color:#032F62">.</span><span style="color:#24292E">level</span><span style="color:#032F62">}`</span><span style="color:#24292E">, </span><span style="color:#005CC5">10</span><span style="color:#24292E">, </span><span style="color:#005CC5">45</span><span style="color:#24292E">);</span></span>
<span class="line"><span style="color:#24292E">        </span></span>
<span class="line"><span style="color:#6A737D">        // 渲染生命值</span></span>
<span class="line"><span style="color:#24292E">        ctx.</span><span style="color:#6F42C1">fillText</span><span style="color:#24292E">(</span><span style="color:#032F62">`Lives: ${</span><span style="color:#24292E">game</span><span style="color:#032F62">.</span><span style="color:#24292E">player</span><span style="color:#032F62">.</span><span style="color:#24292E">lives</span><span style="color:#032F62">}`</span><span style="color:#24292E">, </span><span style="color:#005CC5">10</span><span style="color:#24292E">, </span><span style="color:#005CC5">65</span><span style="color:#24292E">);</span></span>
<span class="line"><span style="color:#24292E">        </span></span>
<span class="line"><span style="color:#6A737D">        // 渲染剩余敌人</span></span>
<span class="line"><span style="color:#24292E">        ctx.</span><span style="color:#6F42C1">fillText</span><span style="color:#24292E">(</span><span style="color:#032F62">`Enemies: ${</span><span style="color:#24292E">game</span><span style="color:#032F62">.</span><span style="color:#24292E">enemiesRemaining</span><span style="color:#032F62">}`</span><span style="color:#24292E">, </span><span style="color:#005CC5">10</span><span style="color:#24292E">, </span><span style="color:#005CC5">85</span><span style="color:#24292E">);</span></span>
<span class="line"><span style="color:#24292E">        </span></span>
<span class="line"><span style="color:#6A737D">        // 渲染游戏状态信息</span></span>
<span class="line"><span style="color:#D73A49">        if</span><span style="color:#24292E"> (game.gameState </span><span style="color:#D73A49">===</span><span style="color:#032F62"> 'paused'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#005CC5">            this</span><span style="color:#24292E">.</span><span style="color:#6F42C1">renderPauseScreen</span><span style="color:#24292E">(ctx);</span></span>
<span class="line"><span style="color:#24292E">        } </span><span style="color:#D73A49">else</span><span style="color:#D73A49"> if</span><span style="color:#24292E"> (game.gameState </span><span style="color:#D73A49">===</span><span style="color:#032F62"> 'gameOver'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#005CC5">            this</span><span style="color:#24292E">.</span><span style="color:#6F42C1">renderGameOverScreen</span><span style="color:#24292E">(ctx);</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">    static</span><span style="color:#6F42C1"> renderPauseScreen</span><span style="color:#24292E">(</span><span style="color:#E36209">ctx</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#6A737D">        // 半透明背景</span></span>
<span class="line"><span style="color:#24292E">        ctx.fillStyle </span><span style="color:#D73A49">=</span><span style="color:#032F62"> 'rgba(0, 0, 0, 0.7)'</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#24292E">        ctx.</span><span style="color:#6F42C1">fillRect</span><span style="color:#24292E">(</span><span style="color:#005CC5">0</span><span style="color:#24292E">, </span><span style="color:#005CC5">0</span><span style="color:#24292E">, </span><span style="color:#005CC5">800</span><span style="color:#24292E">, </span><span style="color:#005CC5">600</span><span style="color:#24292E">);</span></span>
<span class="line"><span style="color:#24292E">        </span></span>
<span class="line"><span style="color:#6A737D">        // 暂停文字</span></span>
<span class="line"><span style="color:#24292E">        ctx.font </span><span style="color:#D73A49">=</span><span style="color:#032F62"> '48px Arial'</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#24292E">        ctx.fillStyle </span><span style="color:#D73A49">=</span><span style="color:#032F62"> '#FFFFFF'</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#24292E">        ctx.textAlign </span><span style="color:#D73A49">=</span><span style="color:#032F62"> 'center'</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#24292E">        ctx.</span><span style="color:#6F42C1">fillText</span><span style="color:#24292E">(</span><span style="color:#032F62">'PAUSED'</span><span style="color:#24292E">, </span><span style="color:#005CC5">400</span><span style="color:#24292E">, </span><span style="color:#005CC5">300</span><span style="color:#24292E">);</span></span>
<span class="line"><span style="color:#24292E">        </span></span>
<span class="line"><span style="color:#24292E">        ctx.font </span><span style="color:#D73A49">=</span><span style="color:#032F62"> '24px Arial'</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#24292E">        ctx.</span><span style="color:#6F42C1">fillText</span><span style="color:#24292E">(</span><span style="color:#032F62">'Press P to continue'</span><span style="color:#24292E">, </span><span style="color:#005CC5">400</span><span style="color:#24292E">, </span><span style="color:#005CC5">350</span><span style="color:#24292E">);</span></span>
<span class="line"><span style="color:#24292E">        ctx.textAlign </span><span style="color:#D73A49">=</span><span style="color:#032F62"> 'left'</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">    static</span><span style="color:#6F42C1"> renderGameOverScreen</span><span style="color:#24292E">(</span><span style="color:#E36209">ctx</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#6A737D">        // 半透明背景</span></span>
<span class="line"><span style="color:#24292E">        ctx.fillStyle </span><span style="color:#D73A49">=</span><span style="color:#032F62"> 'rgba(0, 0, 0, 0.8)'</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#24292E">        ctx.</span><span style="color:#6F42C1">fillRect</span><span style="color:#24292E">(</span><span style="color:#005CC5">0</span><span style="color:#24292E">, </span><span style="color:#005CC5">0</span><span style="color:#24292E">, </span><span style="color:#005CC5">800</span><span style="color:#24292E">, </span><span style="color:#005CC5">600</span><span style="color:#24292E">);</span></span>
<span class="line"><span style="color:#24292E">        </span></span>
<span class="line"><span style="color:#6A737D">        // 游戏结束文字</span></span>
<span class="line"><span style="color:#24292E">        ctx.font </span><span style="color:#D73A49">=</span><span style="color:#032F62"> '48px Arial'</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#24292E">        ctx.fillStyle </span><span style="color:#D73A49">=</span><span style="color:#032F62"> '#FF0000'</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#24292E">        ctx.textAlign </span><span style="color:#D73A49">=</span><span style="color:#032F62"> 'center'</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#24292E">        ctx.</span><span style="color:#6F42C1">fillText</span><span style="color:#24292E">(</span><span style="color:#032F62">'GAME OVER'</span><span style="color:#24292E">, </span><span style="color:#005CC5">400</span><span style="color:#24292E">, </span><span style="color:#005CC5">250</span><span style="color:#24292E">);</span></span>
<span class="line"><span style="color:#24292E">        </span></span>
<span class="line"><span style="color:#24292E">        ctx.font </span><span style="color:#D73A49">=</span><span style="color:#032F62"> '24px Arial'</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#24292E">        ctx.fillStyle </span><span style="color:#D73A49">=</span><span style="color:#032F62"> '#FFFFFF'</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#24292E">        ctx.</span><span style="color:#6F42C1">fillText</span><span style="color:#24292E">(</span><span style="color:#032F62">`Final Score: ${</span><span style="color:#24292E">game</span><span style="color:#032F62">.</span><span style="color:#24292E">score</span><span style="color:#032F62">}`</span><span style="color:#24292E">, </span><span style="color:#005CC5">400</span><span style="color:#24292E">, </span><span style="color:#005CC5">300</span><span style="color:#24292E">);</span></span>
<span class="line"><span style="color:#24292E">        ctx.</span><span style="color:#6F42C1">fillText</span><span style="color:#24292E">(</span><span style="color:#032F62">'Press R to restart'</span><span style="color:#24292E">, </span><span style="color:#005CC5">400</span><span style="color:#24292E">, </span><span style="color:#005CC5">350</span><span style="color:#24292E">);</span></span>
<span class="line"><span style="color:#24292E">        ctx.textAlign </span><span style="color:#D73A49">=</span><span style="color:#032F62"> 'left'</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">}</span></span></code></pre>
<h2 id="性能优化策略"><a aria-hidden="true" tabindex="-1" href="#性能优化策略"><span class="icon icon-link"></span></a>性能优化策略</h2>
<h3 id="1-对象池模式"><a aria-hidden="true" tabindex="-1" href="#1-对象池模式"><span class="icon icon-link"></span></a>1. 对象池模式</h3>
<pre class="astro-code github-light" style="background-color:#fff;color:#24292e; overflow-x: auto;" tabindex="0" data-language="javascript"><code><span class="line"><span style="color:#D73A49">class</span><span style="color:#6F42C1"> ObjectPool</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#D73A49">    constructor</span><span style="color:#24292E">(</span><span style="color:#E36209">createFn</span><span style="color:#24292E">, </span><span style="color:#E36209">resetFn</span><span style="color:#24292E">, </span><span style="color:#E36209">initialSize</span><span style="color:#D73A49"> =</span><span style="color:#005CC5"> 10</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#005CC5">        this</span><span style="color:#24292E">.createFn </span><span style="color:#D73A49">=</span><span style="color:#24292E"> createFn;</span></span>
<span class="line"><span style="color:#005CC5">        this</span><span style="color:#24292E">.resetFn </span><span style="color:#D73A49">=</span><span style="color:#24292E"> resetFn;</span></span>
<span class="line"><span style="color:#005CC5">        this</span><span style="color:#24292E">.pool </span><span style="color:#D73A49">=</span><span style="color:#24292E"> [];</span></span>
<span class="line"><span style="color:#24292E">        </span></span>
<span class="line"><span style="color:#6A737D">        // 预创建对象</span></span>
<span class="line"><span style="color:#D73A49">        for</span><span style="color:#24292E"> (</span><span style="color:#D73A49">let</span><span style="color:#24292E"> i </span><span style="color:#D73A49">=</span><span style="color:#005CC5"> 0</span><span style="color:#24292E">; i </span><span style="color:#D73A49">&#x3C;</span><span style="color:#24292E"> initialSize; i</span><span style="color:#D73A49">++</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#005CC5">            this</span><span style="color:#24292E">.pool.</span><span style="color:#6F42C1">push</span><span style="color:#24292E">(</span><span style="color:#005CC5">this</span><span style="color:#24292E">.</span><span style="color:#6F42C1">createFn</span><span style="color:#24292E">());</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1">    get</span><span style="color:#24292E">() {</span></span>
<span class="line"><span style="color:#D73A49">        if</span><span style="color:#24292E"> (</span><span style="color:#005CC5">this</span><span style="color:#24292E">.pool.</span><span style="color:#005CC5">length</span><span style="color:#D73A49"> ></span><span style="color:#005CC5"> 0</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#D73A49">            return</span><span style="color:#005CC5"> this</span><span style="color:#24292E">.pool.</span><span style="color:#6F42C1">pop</span><span style="color:#24292E">();</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#D73A49">        return</span><span style="color:#005CC5"> this</span><span style="color:#24292E">.</span><span style="color:#6F42C1">createFn</span><span style="color:#24292E">();</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1">    release</span><span style="color:#24292E">(</span><span style="color:#E36209">obj</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#005CC5">        this</span><span style="color:#24292E">.</span><span style="color:#6F42C1">resetFn</span><span style="color:#24292E">(obj);</span></span>
<span class="line"><span style="color:#005CC5">        this</span><span style="color:#24292E">.pool.</span><span style="color:#6F42C1">push</span><span style="color:#24292E">(obj);</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">// 使用示例</span></span>
<span class="line"><span style="color:#D73A49">const</span><span style="color:#005CC5"> bulletPool</span><span style="color:#D73A49"> =</span><span style="color:#D73A49"> new</span><span style="color:#6F42C1"> ObjectPool</span><span style="color:#24292E">(</span></span>
<span class="line"><span style="color:#24292E">    () </span><span style="color:#D73A49">=></span><span style="color:#D73A49"> new</span><span style="color:#6F42C1"> Bullet</span><span style="color:#24292E">(</span><span style="color:#005CC5">0</span><span style="color:#24292E">, </span><span style="color:#005CC5">0</span><span style="color:#24292E">, </span><span style="color:#005CC5">0</span><span style="color:#24292E">, </span><span style="color:#005CC5">null</span><span style="color:#24292E">),</span></span>
<span class="line"><span style="color:#24292E">    (</span><span style="color:#E36209">bullet</span><span style="color:#24292E">) </span><span style="color:#D73A49">=></span><span style="color:#24292E"> { bullet.active </span><span style="color:#D73A49">=</span><span style="color:#005CC5"> false</span><span style="color:#24292E">; },</span></span>
<span class="line"><span style="color:#005CC5">    20</span></span>
<span class="line"><span style="color:#24292E">);</span></span></code></pre>
<h3 id="2-渲染优化"><a aria-hidden="true" tabindex="-1" href="#2-渲染优化"><span class="icon icon-link"></span></a>2. 渲染优化</h3>
<pre class="astro-code github-light" style="background-color:#fff;color:#24292e; overflow-x: auto;" tabindex="0" data-language="javascript"><code><span class="line"><span style="color:#D73A49">class</span><span style="color:#6F42C1"> RenderOptimizer</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#D73A49">    static</span><span style="color:#E36209"> dirtyRectangles</span><span style="color:#D73A49"> =</span><span style="color:#24292E"> [];</span></span>
<span class="line"><span style="color:#24292E">    </span></span>
<span class="line"><span style="color:#D73A49">    static</span><span style="color:#6F42C1"> addDirtyRect</span><span style="color:#24292E">(</span><span style="color:#E36209">x</span><span style="color:#24292E">, </span><span style="color:#E36209">y</span><span style="color:#24292E">, </span><span style="color:#E36209">width</span><span style="color:#24292E">, </span><span style="color:#E36209">height</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#005CC5">        this</span><span style="color:#24292E">.dirtyRectangles.</span><span style="color:#6F42C1">push</span><span style="color:#24292E">({ x, y, width, height });</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">    </span></span>
<span class="line"><span style="color:#D73A49">    static</span><span style="color:#6F42C1"> clearDirtyRects</span><span style="color:#24292E">(</span><span style="color:#E36209">ctx</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#005CC5">        this</span><span style="color:#24292E">.dirtyRectangles.</span><span style="color:#6F42C1">forEach</span><span style="color:#24292E">(</span><span style="color:#E36209">rect</span><span style="color:#D73A49"> =></span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#24292E">            ctx.</span><span style="color:#6F42C1">clearRect</span><span style="color:#24292E">(rect.x, rect.y, rect.width, rect.height);</span></span>
<span class="line"><span style="color:#24292E">        });</span></span>
<span class="line"><span style="color:#005CC5">        this</span><span style="color:#24292E">.dirtyRectangles </span><span style="color:#D73A49">=</span><span style="color:#24292E"> [];</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">    </span></span>
<span class="line"><span style="color:#D73A49">    static</span><span style="color:#6F42C1"> isInViewport</span><span style="color:#24292E">(</span><span style="color:#E36209">obj</span><span style="color:#24292E">, </span><span style="color:#E36209">viewX</span><span style="color:#24292E">, </span><span style="color:#E36209">viewY</span><span style="color:#24292E">, </span><span style="color:#E36209">viewWidth</span><span style="color:#24292E">, </span><span style="color:#E36209">viewHeight</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#D73A49">        return</span><span style="color:#24292E"> obj.x </span><span style="color:#D73A49">+</span><span style="color:#24292E"> obj.width </span><span style="color:#D73A49">>=</span><span style="color:#24292E"> viewX </span><span style="color:#D73A49">&#x26;&#x26;</span></span>
<span class="line"><span style="color:#24292E">               obj.x </span><span style="color:#D73A49">&#x3C;=</span><span style="color:#24292E"> viewX </span><span style="color:#D73A49">+</span><span style="color:#24292E"> viewWidth </span><span style="color:#D73A49">&#x26;&#x26;</span></span>
<span class="line"><span style="color:#24292E">               obj.y </span><span style="color:#D73A49">+</span><span style="color:#24292E"> obj.height </span><span style="color:#D73A49">>=</span><span style="color:#24292E"> viewY </span><span style="color:#D73A49">&#x26;&#x26;</span></span>
<span class="line"><span style="color:#24292E">               obj.y </span><span style="color:#D73A49">&#x3C;=</span><span style="color:#24292E"> viewY </span><span style="color:#D73A49">+</span><span style="color:#24292E"> viewHeight;</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">}</span></span></code></pre>
<h2 id="项目特色"><a aria-hidden="true" tabindex="-1" href="#项目特色"><span class="icon icon-link"></span></a>项目特色</h2>
<h3 id="1-单文件架构优势"><a aria-hidden="true" tabindex="-1" href="#1-单文件架构优势"><span class="icon icon-link"></span></a>1. 单文件架构优势</h3>
<ul>
<li><strong>简单部署</strong>: 只需一个HTML文件即可运行</li>
<li><strong>零依赖</strong>: 无需任何外部库或框架</li>
<li><strong>易于分享</strong>: 方便代码阅读和学习</li>
<li><strong>快速加载</strong>: 减少HTTP请求</li>
</ul>
<h3 id="2-经典游戏机制"><a aria-hidden="true" tabindex="-1" href="#2-经典游戏机制"><span class="icon icon-link"></span></a>2. 经典游戏机制</h3>
<ul>
<li><strong>即时响应</strong>: 流畅的实时控制体验</li>
<li><strong>智能AI</strong>: 敌方坦克具备基本战术AI</li>
<li><strong>渐进难度</strong>: 多关卡难度递增设计</li>
<li><strong>视觉反馈</strong>: 丰富的击中和爆炸效果</li>
</ul>
<h3 id="3-可扩展设计"><a aria-hidden="true" tabindex="-1" href="#3-可扩展设计"><span class="icon icon-link"></span></a>3. 可扩展设计</h3>
<ul>
<li><strong>模块化代码</strong>: 清晰的类结构便于扩展</li>
<li><strong>事件系统</strong>: 支持自定义游戏事件</li>
<li><strong>配置驱动</strong>: 关卡数据与逻辑分离</li>
</ul>
<h2 id="技术收获"><a aria-hidden="true" tabindex="-1" href="#技术收获"><span class="icon icon-link"></span></a>技术收获</h2>
<h3 id="canvas-2d编程"><a aria-hidden="true" tabindex="-1" href="#canvas-2d编程"><span class="icon icon-link"></span></a>Canvas 2D编程</h3>
<ul>
<li>掌握了Canvas绘图API的高级用法</li>
<li>理解了游戏渲染循环的优化策略</li>
<li>学会了图形变换和动画实现</li>
</ul>
<h3 id="游戏开发基础"><a aria-hidden="true" tabindex="-1" href="#游戏开发基础"><span class="icon icon-link"></span></a>游戏开发基础</h3>
<ul>
<li>实现了完整的游戏循环架构</li>
<li>设计了高效的碰撞检测系统</li>
<li>构建了状态管理和AI决策系统</li>
</ul>
<h3 id="性能优化实践"><a aria-hidden="true" tabindex="-1" href="#性能优化实践"><span class="icon icon-link"></span></a>性能优化实践</h3>
<ul>
<li>应用了对象池等内存管理技术</li>
<li>实施了脏矩形等渲染优化策略</li>
<li>平衡了功能复杂度与运行效率</li>
</ul>
<h2 id="未来扩展方向"><a aria-hidden="true" tabindex="-1" href="#未来扩展方向"><span class="icon icon-link"></span></a>未来扩展方向</h2>
<ol>
<li><strong>多人模式</strong>: 本地双人对战</li>
<li><strong>关卡编辑器</strong>: 自定义地图功能</li>
<li><strong>道具系统</strong>: 武器升级和特殊道具</li>
<li><strong>存档功能</strong>: LocalStorage保存游戏进度</li>
<li><strong>移动适配</strong>: 触屏控制和响应式设计</li>
</ol>
<h2 id="总结"><a aria-hidden="true" tabindex="-1" href="#总结"><span class="icon icon-link"></span></a>总结</h2>
<p>这个HTML5 Canvas坦克大战项目成功展示了使用原生Web技术开发完整游戏的可行性。通过精心设计的架构和高效的实现策略，在保持代码简洁的同时实现了丰富的游戏功能。</p>
<p>项目不仅是对经典游戏的致敬，更是现代Web游戏开发技术的实践应用，为轻量级游戏开发提供了完整的解决方案参考。</p> <html lang="en" data-astro-cid-uffxixac> <head><!-- Global Metadata --><meta charset="utf-8"><!--<meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">--><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.css"><link rel="shortcut icon" href="/favicon.png" type="image/png"><link rel="sitemap" href="/sitemap-index.xml"><link rel="alternate" type="application/rss+xml" title="Ge Yuxu • AI &#38; Engineering" href="https://geyuxu.com/rss.xml"><meta name="generator" content="Astro v5.5.6"><!-- Font preloads --><link rel="preload" href="/fonts/atkinson-regular.woff" as="font" type="font/woff" crossorigin><link rel="preload" href="/fonts/atkinson-bold.woff" as="font" type="font/woff" crossorigin><!-- Canonical URL --><link rel="canonical" href="https://geyuxu.com/blog/notes/html5-canvas%E7%BB%8F%E5%85%B8%E5%9D%A6%E5%85%8B%E5%A4%A7%E6%88%98%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E5%8D%95%E6%96%87%E4%BB%B6%E6%B8%B8%E6%88%8F%E6%9E%B6%E6%9E%84%E5%AE%9E%E8%B7%B5/"><!-- Primary Meta Tags --><title>Ge Yuxu • AI &amp; Engineering</title><meta name="title" content="Ge Yuxu • AI &#38; Engineering"><meta name="description" content="Welcome to my blog!"><!-- Open Graph / Facebook --><meta property="og:type" content="website"><meta property="og:url" content="https://geyuxu.com/blog/notes/html5-canvas%E7%BB%8F%E5%85%B8%E5%9D%A6%E5%85%8B%E5%A4%A7%E6%88%98%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E5%8D%95%E6%96%87%E4%BB%B6%E6%B8%B8%E6%88%8F%E6%9E%B6%E6%9E%84%E5%AE%9E%E8%B7%B5/"><meta property="og:title" content="Ge Yuxu • AI &#38; Engineering"><meta property="og:description" content="Welcome to my blog!"><meta property="og:image" content="https://geyuxu.com/blog-placeholder-1.jpg"><!-- Twitter --><meta property="twitter:card" content="summary_large_image"><meta property="twitter:url" content="https://geyuxu.com/blog/notes/html5-canvas%E7%BB%8F%E5%85%B8%E5%9D%A6%E5%85%8B%E5%A4%A7%E6%88%98%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E5%8D%95%E6%96%87%E4%BB%B6%E6%B8%B8%E6%88%8F%E6%9E%B6%E6%9E%84%E5%AE%9E%E8%B7%B5/"><meta property="twitter:title" content="Ge Yuxu • AI &#38; Engineering"><meta property="twitter:description" content="Welcome to my blog!"><meta property="twitter:image" content="https://geyuxu.com/blog-placeholder-1.jpg"><script src="/js/jquery-3.7.1.min.js"></script><script src="/js/copy-code-button.js" defer></script><!-- Dify Chatbot Configuration --><script>
 window.difyChatbotConfig = {
  token: 'VgrjCAto93bjE0MW',
  systemVariables: {
    // user_id: 'YOU CAN DEFINE USER ID HERE',
    // conversation_id: 'YOU CAN DEFINE CONVERSATION ID HERE, IT MUST BE A VALID UUID',
  },
  userVariables: {
    // avatar_url: 'YOU CAN DEFINE USER AVATAR URL HERE',
    // name: 'YOU CAN DEFINE USER NAME HERE',
  },
 }
</script><!-- Dify Chatbot Script --><script src="https://udify.app/embed.min.js" id="VgrjCAto93bjE0MW" defer>
</script><!-- Dify Chatbot Custom Styles --></head> <body data-astro-cid-uffxixac>  <div class="statement" data-astro-cid-uffxixac> <blockquote data-astro-cid-uffxixac> <p data-astro-cid-uffxixac><strong data-astro-cid-uffxixac>脱敏说明</strong>：本文所有出现的表名、字段名、接口地址、变量名、IP地址及示例数据等均非真实，仅用于阐述技术思路与实现步骤，示例代码亦非公司真实代码。示例方案亦非公司真实完整方案，仅为本人记忆总结，用于技术学习探讨。<br data-astro-cid-uffxixac>
&nbsp;&nbsp;&nbsp;&nbsp;•&nbsp;文中所示任何标识符并不对应实际生产环境中的名称或编号。<br data-astro-cid-uffxixac>
&nbsp;&nbsp;&nbsp;&nbsp;•&nbsp;示例&nbsp;SQL、脚本、代码及数据等均为演示用途，不含真实业务数据，也不具备直接运行或复现的完整上下文。<br data-astro-cid-uffxixac>
&nbsp;&nbsp;&nbsp;&nbsp;•&nbsp;读者若需在实际项目中参考本文方案，请结合自身业务场景及数据安全规范，使用符合内部命名和权限控制的配置。</p> <p data-astro-cid-uffxixac><strong data-astro-cid-uffxixac>Data Desensitization Notice</strong>: All table names, field names, API endpoints, variable names, IP addresses, and sample data appearing in this article are fictitious and intended solely to illustrate technical concepts and implementation steps. The sample code is not actual company code. The proposed solutions are not complete or actual company solutions but are summarized from the author's memory for technical learning and discussion.<br data-astro-cid-uffxixac>
&nbsp;&nbsp;&nbsp;&nbsp;•&nbsp;Any identifiers shown in the text do not correspond to names or numbers in any actual production environment.<br data-astro-cid-uffxixac>
&nbsp;&nbsp;&nbsp;&nbsp;•&nbsp;Sample SQL, scripts, code, and data are for demonstration purposes only, do not contain real business data, and lack the full context required for direct execution or reproduction.<br data-astro-cid-uffxixac>
&nbsp;&nbsp;&nbsp;&nbsp;•&nbsp;Readers who wish to reference the solutions in this article for actual projects should adapt them to their own business scenarios and data security standards, using configurations that comply with internal naming and access control policies.</p> <p data-astro-cid-uffxixac><strong data-astro-cid-uffxixac>版权声明</strong>：本文版权归原作者所有，未经作者事先书面许可，任何单位或个人不得以任何方式复制、转载、摘编或用于商业用途。<br data-astro-cid-uffxixac>
&nbsp;&nbsp;&nbsp;&nbsp;•&nbsp;若需非商业性引用或转载本文内容，请务必注明出处并保持内容完整。<br data-astro-cid-uffxixac>
&nbsp;&nbsp;&nbsp;&nbsp;•&nbsp;对因商业使用、篡改或不当引用本文内容所产生的法律纠纷，作者保留追究法律责任的权利。</p> <p data-astro-cid-uffxixac><strong data-astro-cid-uffxixac>Copyright Notice</strong>: The copyright of this article belongs to the original author. Without prior written permission from the author, no entity or individual may copy, reproduce, excerpt, or use it for commercial purposes in any way.<br data-astro-cid-uffxixac>
&nbsp;&nbsp;&nbsp;&nbsp;•&nbsp;For non-commercial citation or reproduction of this content, attribution must be given, and the integrity of the content must be maintained.<br data-astro-cid-uffxixac>
&nbsp;&nbsp;&nbsp;&nbsp;•&nbsp;The author reserves the right to pursue legal action against any legal disputes arising from the commercial use, alteration, or improper citation of this article's content.</p> <p data-astro-cid-uffxixac><em data-astro-cid-uffxixac>Copyright&nbsp;©&nbsp;1989–Present&nbsp;Ge&nbsp;Yuxu.&nbsp;All&nbsp;Rights&nbsp;Reserved.</em></p> </blockquote> </div></body></html>  </article> </div> </main> <footer data-astro-cid-sz7xmlte>
&copy; 2025 All rights reserved.
</footer>  </body></html>