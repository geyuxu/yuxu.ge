<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åŸºäº Cassandraã€SolrCloudã€Zookeeperã€Kafka å’Œ Python å¾®æœåŠ¡çš„æœç´¢ç³»ç»Ÿæ­å»ºå®è·µ | Yuxu Ge</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1/themes/prism-tomorrow.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    <style>
        :root {
            --black: #111;
            --dark-grey: #444;
            --off-white: #f4f4f4;
            --vermilion: #C41E3A;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            font-size: 16px;
            scroll-behavior: smooth;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            line-height: 1.6;
            color: var(--black);
            background-color: var(--off-white);
        }

        a {
            color: var(--vermilion);
            text-decoration: none;
        }

        a:hover {
            opacity: 0.75;
        }

        .layout {
            min-height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            position: fixed;
            top: 0;
            left: 0;
            width: 320px;
            height: 100vh;
            background: var(--black);
            color: var(--off-white);
            padding: 3rem 2rem;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .sidebar-top {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
        }

        .avatar {
            display: block;
            width: 120px;
            height: 120px;
            border-radius: 50%;
            border: 3px solid var(--vermilion);
            margin-bottom: 1.5rem;
            overflow: hidden;
            transition: transform 0.2s ease;
        }

        .avatar:hover {
            opacity: 1;
            transform: scale(1.05);
        }

        .avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .name-block {
            margin-bottom: 0.5rem;
        }

        h1 {
            font-size: 1.8rem;
            font-weight: 700;
            letter-spacing: 1px;
            color: var(--off-white);
        }

        .title-role {
            font-size: 0.9rem;
            color: #888;
            margin-top: 0.25rem;
            font-weight: 400;
        }

        .contact-block {
            margin-top: 2.5rem;
            width: 100%;
        }

        .social-links {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.75rem;
        }

        .social-links a {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            width: 160px;
            color: var(--off-white);
            opacity: 0.7;
            padding: 0.5rem 0.75rem;
            border-radius: 4px;
            font-size: 0.9rem;
            transition: all 0.2s;
        }

        .social-links a:hover {
            color: var(--vermilion);
            opacity: 1;
            background: rgba(255, 255, 255, 0.05);
        }

        .social-links svg {
            width: 20px;
            height: 20px;
            flex-shrink: 0;
        }

        .social-links .orcid-link {
            font-size: 0.68rem;
            gap: 0.5rem;
            white-space: nowrap;
        }

        .sidebar-footer {
            text-align: center;
            font-size: 0.75rem;
            color: #555;
        }

        /* Content */
        .content {
            margin-left: 320px;
            padding: 3rem 4rem;
            max-width: calc(100vw - 320px - 8rem);
        }

        .back-link {
            display: inline-block;
            font-size: 0.85rem;
            margin-bottom: 2rem;
            color: var(--dark-grey);
        }

        .back-link:hover {
            color: var(--vermilion);
        }

        /* Article */
        article h1 {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 1.5rem;
            line-height: 1.3;
            color: var(--black);
        }

        article h2 {
            font-size: 1.4rem;
            font-weight: 600;
            margin: 2rem 0 1rem;
            color: var(--black);
        }

        article h3 {
            font-size: 1.1rem;
            font-weight: 600;
            margin: 1.5rem 0 0.75rem;
            color: var(--black);
        }

        article p {
            margin-bottom: 1rem;
            color: var(--dark-grey);
        }

        article ul,
        article ol {
            margin: 1rem 0 1rem 1.5rem;
            color: var(--dark-grey);
        }

        article li {
            margin-bottom: 0.5rem;
        }

        article strong {
            color: var(--black);
        }

        article code {
            font-family: "SF Mono", Monaco, monospace;
            font-size: 0.9em;
            background: #e8e8e8;
            padding: 0.15em 0.4em;
            border-radius: 3px;
        }

        article pre {
            margin: 1rem 0;
            border-radius: 6px;
            overflow-x: auto;
            background: #2d2d2d;
            padding: 1rem;
        }

        article pre code {
            background: none;
            padding: 0;
            font-size: 0.75em;
            white-space: pre !important;
            counter-reset: line;
            display: block;
            color: #ccc;
        }

        article pre code .line {
            counter-increment: line;
        }

        article pre code .line::before {
            content: counter(line);
            display: inline-block;
            width: 2.5em;
            margin-right: 1em;
            text-align: right;
            color: #666;
            user-select: none;
        }

        .code-toolbar {
            display: flex;
            justify-content: flex-start;
            padding: 0.35rem 0.5rem;
            background: #3a3a3a;
            border-radius: 6px 6px 0 0;
        }

        .code-toolbar+pre {
            margin-top: 0;
            border-radius: 0 0 6px 6px;
        }

        .copy-btn {
            padding: 0.2rem 0.5rem;
            font-size: 0.7rem;
            background: #555;
            color: #fff;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .copy-btn:hover,
        .copy-btn:active {
            background: #777;
        }

        .copy-btn.copied {
            background: #2a2;
        }

        article blockquote {
            border-left: 3px solid var(--vermilion);
            padding-left: 1rem;
            margin: 1rem 0;
            color: #666;
            font-style: italic;
        }

        article hr {
            border: none;
            border-top: 1px solid #ddd;
            margin: 2rem 0;
        }

        article table {
            width: 100%;
            border-collapse: collapse;
            margin: 1rem 0;
            font-size: 0.9rem;
        }

        article th,
        article td {
            border: 1px solid #ddd;
            padding: 0.5rem 0.75rem;
            text-align: left;
        }

        article th {
            background: #e8e8e8;
            font-weight: 600;
        }

        article img {
            max-width: 100%;
            height: auto;
            display: block;
            margin: 1.5rem 0;
            border-radius: 6px;
        }

        .loading {
            text-align: center;
            padding: 3rem;
            color: #888;
        }

        .error {
            color: var(--vermilion);
        }

        /* Language Selector */
        .lang-selector {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
            padding: 0.75rem 1rem;
            background: #fff;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            font-size: 0.85rem;
        }

        .lang-selector-label {
            color: #666;
            display: flex;
            align-items: center;
            gap: 0.35rem;
        }

        .lang-selector-label svg {
            width: 16px;
            height: 16px;
        }

        .lang-select {
            padding: 0.4rem 0.75rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            background: white;
            font-size: 0.85rem;
            cursor: pointer;
            min-width: 140px;
        }

        .lang-select:focus {
            outline: none;
            border-color: var(--vermilion);
        }

        .lang-status {
            font-size: 0.8rem;
            color: #888;
            margin-left: auto;
        }

        .lang-status.translating {
            color: var(--vermilion);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .lang-status.translating::before {
            content: '';
            width: 14px;
            height: 14px;
            border: 2px solid #f0f0f0;
            border-top-color: var(--vermilion);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .lang-status.cached {
            color: #4CAF50;
        }

        .lang-original-btn {
            padding: 0.35rem 0.6rem;
            font-size: 0.75rem;
            background: #f0f0f0;
            border: 1px solid #ddd;
            border-radius: 4px;
            cursor: pointer;
            color: #666;
            transition: all 0.2s;
        }

        .lang-original-btn:hover {
            background: #e0e0e0;
            color: #333;
        }

        @media (max-width: 600px) {
            .lang-selector {
                flex-wrap: wrap;
            }
            .lang-status {
                width: 100%;
                margin-left: 0;
                margin-top: 0.5rem;
            }
        }

        /* KaTeX math styles */
        .katex-display {
            overflow-x: auto;
            overflow-y: hidden;
            padding: 0.5rem 0;
        }

        .katex {
            font-size: 1.1em;
        }

        /* Jupyter Notebook Styles */
        .notebook-container {
            margin-top: 1rem;
        }

        .notebook-download {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            margin-bottom: 1.5rem;
            background: var(--black);
            color: var(--off-white);
            border-radius: 4px;
            font-size: 0.85rem;
            transition: opacity 0.2s;
        }

        .notebook-download:hover {
            opacity: 0.8;
            color: var(--off-white);
        }

        .notebook-download svg {
            width: 16px;
            height: 16px;
        }

        .nb-cell {
            margin-bottom: 1.5rem;
        }

        .nb-cell-code .nb-source {
            background: #2d2d2d;
            border-radius: 6px;
            overflow-x: auto;
        }

        .nb-cell-code .nb-source pre {
            margin: 0;
            padding: 1rem;
            color: #ccc;
            font-family: "SF Mono", Monaco, monospace;
            font-size: 0.85em;
        }

        .nb-cell-code .nb-source code {
            background: none;
            padding: 0;
        }

        .nb-output {
            background: #fff;
            border: 1px solid #ddd;
            border-radius: 6px;
            padding: 0.75rem;
            margin-top: 0.5rem;
        }

        .nb-output pre {
            margin: 0;
            padding: 0;
            background: transparent;
            white-space: pre-wrap;
            word-wrap: break-word;
            font-family: "SF Mono", Monaco, monospace;
            font-size: 0.85em;
            color: #222;
        }

        .nb-output img {
            max-width: 100%;
            height: auto;
            display: block;
            margin: 0.5rem 0;
        }

        .nb-output table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9rem;
        }

        .nb-output th,
        .nb-output td {
            border: 1px solid #ddd;
            padding: 0.5rem;
            text-align: left;
        }

        .nb-output th {
            background: #e8e8e8;
            font-weight: 600;
        }

        .nb-cell-markdown {
            padding: 0;
        }

        .nb-cell-markdown h1:first-child {
            margin-top: 0;
        }

        /* Document Download Button */
        .doc-download {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            margin-bottom: 1.5rem;
            background: var(--black);
            color: var(--off-white);
            border-radius: 4px;
            font-size: 0.85rem;
            transition: opacity 0.2s;
        }

        .doc-download:hover {
            opacity: 0.8;
            color: var(--off-white);
        }

        .doc-download svg {
            width: 16px;
            height: 16px;
        }

        /* PDF Viewer */
        .pdf-container {
            margin-top: 1rem;
        }

        .pdf-viewer {
            width: 100%;
            height: 80vh;
            border: 1px solid #ddd;
            border-radius: 6px;
            background: #f5f5f5;
        }

        /* Text File Display */
        .text-container {
            margin-top: 1rem;
        }

        .text-content {
            background: #fff;
            border: 1px solid #ddd;
            border-radius: 6px;
            padding: 1.5rem;
            font-family: "SF Mono", Monaco, monospace;
            font-size: 0.9em;
            line-height: 1.6;
            white-space: pre-wrap;
            word-wrap: break-word;
            color: var(--dark-grey);
            max-height: 80vh;
            overflow-y: auto;
        }

        /* Word Document Display */
        .word-container {
            margin-top: 1rem;
        }

        .word-content {
            background: #fff;
            border: 1px solid #ddd;
            border-radius: 6px;
            padding: 2rem;
            line-height: 1.8;
            color: var(--dark-grey);
        }

        .word-content p {
            margin-bottom: 1rem;
        }

        .word-content h1,
        .word-content h2,
        .word-content h3 {
            color: var(--black);
            margin: 1.5rem 0 1rem;
        }

        .word-content table {
            width: 100%;
            border-collapse: collapse;
            margin: 1rem 0;
        }

        .word-content th,
        .word-content td {
            border: 1px solid #ddd;
            padding: 0.5rem;
        }

        .word-content img {
            max-width: 100%;
            height: auto;
        }

        /* Excel Display */
        .excel-container {
            margin-top: 1rem;
        }

        .excel-tabs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }

        .excel-tab {
            padding: 0.5rem 1rem;
            background: #e8e8e8;
            border: none;
            border-radius: 4px 4px 0 0;
            cursor: pointer;
            font-size: 0.85rem;
        }

        .excel-tab.active {
            background: #4CAF50;
            color: white;
        }

        .excel-content {
            background: #fff;
            border: 1px solid #ddd;
            border-radius: 6px;
            overflow-x: auto;
            max-height: 70vh;
            overflow-y: auto;
        }

        .excel-content table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.85rem;
        }

        .excel-content th,
        .excel-content td {
            border: 1px solid #ddd;
            padding: 0.4rem 0.6rem;
            text-align: left;
            white-space: nowrap;
        }

        .excel-content th {
            background: #f5f5f5;
            font-weight: 600;
            position: sticky;
            top: 0;
        }

        .excel-content tr:nth-child(even) {
            background: #fafafa;
        }

        /* PowerPoint Display */
        .ppt-container {
            margin-top: 1rem;
        }

        .ppt-viewer {
            width: 100%;
            height: 80vh;
            border: 1px solid #ddd;
            border-radius: 6px;
            background: #f5f5f5;
        }

        /* CSV Display (uses excel styles) */
        .csv-container {
            margin-top: 1rem;
        }

        /* Responsive */
        @media (max-width: 900px) {
            .sidebar {
                position: relative;
                width: 100%;
                height: auto;
                padding: 2rem 1.5rem 1rem;
            }

            .social-links {
                flex-direction: row;
                flex-wrap: wrap;
                justify-content: center;
            }

            .social-links a,
            .social-links .orcid-link {
                width: auto;
                padding: 0.5rem;
                font-size: 0;
                gap: 0;
            }

            .social-links svg {
                width: 24px;
                height: 24px;
            }

            .social-links .hide-mobile {
                display: none;
            }

            .sidebar-footer {
                margin-top: 1rem;
            }

            .content {
                margin-left: 0;
                padding: 2rem 1rem;
                max-width: 100%;
            }
        }

        @media (max-width: 480px) {
            .sidebar {
                padding: 1.5rem 1rem 1rem;
            }

            .avatar {
                width: 80px;
                height: 80px;
            }

            h1 {
                font-size: 1.4rem;
            }

            article h1 {
                font-size: 1.5rem;
            }
        }
    </style>
</head>

<body>

    <div class="layout">
        <aside class="sidebar" id="sidebar-content"></aside>
        <script src="/components/sidebar.js?v=20260128"></script>

        <main class="content">
            <a href="/blog/" class="back-link">â† Back to Blog</a>

            <!-- Language Selector -->
            <div class="lang-selector" id="lang-selector" style="display: none;">
                <span class="lang-selector-label">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5h12M9 3v2m1.048 9.5A18.022 18.022 0 016.412 9m6.088 9h7M11 21l5-10 5 10M12.751 5C11.783 10.77 8.07 15.61 3 18.129" />
                    </svg>
                    Language
                </span>
                <select class="lang-select" id="lang-select">
                    <option value="en">ğŸ‡ºğŸ‡¸ English</option>
                    <option value="zh">ğŸ‡¨ğŸ‡³ ä¸­æ–‡</option>
                    <option value="ja">ğŸ‡¯ğŸ‡µ æ—¥æœ¬èª</option>
                    <option value="ko">ğŸ‡°ğŸ‡· í•œêµ­ì–´</option>
                    <option value="es">ğŸ‡ªğŸ‡¸ EspaÃ±ol</option>
                    <option value="fr">ğŸ‡«ğŸ‡· FranÃ§ais</option>
                    <option value="de">ğŸ‡©ğŸ‡ª Deutsch</option>
                    <option value="pt">ğŸ‡µğŸ‡¹ PortuguÃªs</option>
                    <option value="ru">ğŸ‡·ğŸ‡º Ğ ÑƒÑÑĞºĞ¸Ğ¹</option>
                    <option value="ar">ğŸ‡¸ğŸ‡¦ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option>
                </select>
                <button class="lang-original-btn" id="lang-original-btn" style="display: none;">Show Original</button>
                <span class="lang-status" id="lang-status"></span>
            </div>

            <article>
<hr>
<h2>date: 2022-02-14
tags: [search]
legacy: true</h2>
<h1>åŸºäº Cassandraã€SolrCloudã€Zookeeperã€Kafka å’Œ Python å¾®æœåŠ¡çš„æœç´¢ç³»ç»Ÿæ­å»ºå®è·µ</h1>
<p>åœ¨å¼€å§‹æ­å»ºä¹‹å‰ï¼Œéœ€è¦å‡†å¤‡å¥½åŸºç¡€è¿è¡Œç¯å¢ƒå’Œç¡¬ä»¶èµ„æºã€‚æœ¬æ–¹æ¡ˆå‡è®¾ä½¿ç”¨ Linux æœåŠ¡å™¨ï¼ˆä¾‹å¦‚ CentOS æˆ– Ubuntuï¼‰ï¼Œå¹¶å·²å®‰è£…åˆé€‚ç‰ˆæœ¬çš„ Java JDKï¼ˆå› ä¸º Cassandraã€Solrã€Kafka éƒ½ä¾èµ– Java è¿è¡Œï¼‰ã€‚åŒæ—¶ï¼Œå‡†å¤‡å¤šå°æœåŠ¡å™¨ä»¥æ­å»ºé›†ç¾¤ï¼š</p>
<ul>
<li><p><code>Zookeeper é›†ç¾¤ï¼š3 å°èŠ‚ç‚¹ï¼Œç”¨äºåè°ƒ Kafka å’Œ SolrCloudï¼ˆå‡å®š IP ä¸º 10.201.X.X ä¸‰å°ä¸åŒæœºå™¨ï¼Œå®¢æˆ·ç«¯ç«¯å£ 2181ï¼‰ã€‚</code></p></li>
<li><p><code>Kafka é›†ç¾¤ï¼šè‹¥å¹²èŠ‚ç‚¹ï¼ˆå‡è®¾ 3 å°æˆ–ä»¥ä¸Šï¼‰ï¼Œä½¿ç”¨ä¸Šè¿° Zookeeper é›†ç¾¤è¿›è¡Œåè°ƒã€‚Kafka è´Ÿè´£æ¥æ”¶å’Œä¼ é€’äº§å“æ•°æ®æ›´æ–°çš„æ¶ˆæ¯ã€‚</code></p></li>
<li><p><code>Cassandra èŠ‚ç‚¹ï¼š1 å°æˆ–å¤šå°ï¼ˆæ ¹æ®æ•°æ®é‡å’Œå®¹é”™éœ€è¦ï¼Œå¯éƒ¨ç½²ä¸ºé›†ç¾¤ï¼‰ï¼Œç”¨äºå­˜å‚¨äº§å“æ•°æ®ï¼Œå‡å®šå•èŠ‚ç‚¹ IP ä¸º 10.201.X.Xã€‚</code></p></li>
<li><p><code>SolrCloud é›†ç¾¤ï¼š3 å° Solr èŠ‚ç‚¹ï¼Œç»„æˆæœç´¢ç´¢å¼•é›†ç¾¤ï¼Œæ¯å°éƒ¨ç½² SolrCloud å®ä¾‹ï¼ˆå‡å®š IP åˆ†åˆ«ä¸º 10.201.X.X ä¸‰å°ï¼‰ã€‚</code></p></li>
<li><p><code>Python å¾®æœåŠ¡ï¼šè‡³å°‘åŒ…å«ä¸¤ä¸ªæœåŠ¡ç¤ºä¾‹ï¼š</code></p></li>
<li><p><code>æ•°æ®åŒæ­¥æœåŠ¡ï¼šæ¶ˆè´¹ Kafka æ¶ˆæ¯ï¼Œå°†æ–°äº§å“æ•°æ®å†™å…¥ Cassandraï¼Œå¹¶æ›´æ–° Solr ç´¢å¼•ã€‚</code></p></li>
<li><p><code>æœç´¢ API æœåŠ¡ï¼šæä¾› REST æ¥å£ä¾›å‰ç«¯æŸ¥è¯¢ï¼Œé€šè¿‡ Solr æä¾›æœç´¢ç»“æœï¼ˆä¹Ÿå¯ç›´æ¥ç”±å‰ç«¯æŸ¥è¯¢ Solrï¼Œä½†åŠ å…¥å¾®æœåŠ¡å¯æ–¹ä¾¿åšæƒé™æ§åˆ¶å’Œèšåˆï¼‰ã€‚</code></p></li>
</ul>
<p>å„ç»„ä»¶é€šè¿‡å†…éƒ¨ç½‘ç»œé€šä¿¡ï¼Œç¡®ä¿å„ç«¯å£äº’é€šï¼ˆä¾‹å¦‚ï¼šCassandra é»˜è®¤ 9042ï¼ŒSolr 8983ï¼ŒZookeeper 2181ï¼ŒKafka 9092ï¼Œå¾®æœåŠ¡æ ¹æ®é…ç½®è‡ªå®šç«¯å£ï¼‰ã€‚åœ¨å®é™…é…ç½®ä¸­ï¼Œè¯·å°†æ–‡ä¸­å‡ºç°çš„ IPã€åŸŸåã€è´¦æˆ·å¯†ç ç­‰æ›¿æ¢ä¸ºæ‚¨è‡ªå·±ç¯å¢ƒçš„å®é™…ä¿¡æ¯ï¼ˆæœ¬æ–‡ä¸­å·²ä½¿ç”¨å ä½ç¬¦å¦‚ 10.201.X.X è¿›è¡Œè„±æ•å¤„ç†ï¼‰ã€‚</p>
<h2>å®‰è£…ä¸é…ç½® Cassandra</h2>
<h3>å®‰è£… Cassandra</h3>
<p>åˆ° Apache å®˜æ–¹ç«™ç‚¹ä¸‹è½½é€‚ç”¨äºæ‚¨æ“ä½œç³»ç»Ÿçš„ Cassandra äºŒè¿›åˆ¶å‘è¡Œç‰ˆï¼ˆæœ¬æ–‡ä»¥ Cassandra 3.11.12 ä¸ºä¾‹ï¼‰ã€‚å°†å®‰è£…åŒ…ä¸Šä¼ åˆ°ç›®æ ‡æœåŠ¡å™¨ 10.201.X.X å¹¶è§£å‹ï¼Œä¾‹å¦‚ï¼š</p>
<blockquote><code>$ wget https://downloads.apache.org/cassandra/3.11.12/apache-cassandra-3.11.12-bin.tar.gz</code><br>
<code>$ tar -zxvf apache-cassandra-3.11.12-bin.tar.gz</code><br>
<code>$ cd apache-cassandra-3.11.12</code></blockquote><p>Cassandra è§£å‹åå³å¯ä½¿ç”¨ï¼Œæ— éœ€é¢å¤–ç¼–è¯‘ã€‚è¿›å…¥ Cassandra ç›®å½•ï¼Œå¯ä»¥ç›´æ¥é€šè¿‡ bin/cassandra å‘½ä»¤å¯åŠ¨èŠ‚ç‚¹ã€‚ç¬¬ä¸€æ¬¡å¯åŠ¨å‰ï¼Œæˆ‘ä»¬éœ€è¦ä¿®æ”¹é…ç½®æ–‡ä»¶ç¡®ä¿èŠ‚ç‚¹é€šä¿¡æ­£å¸¸ã€‚</p>
<h3>é…ç½® Cassandra èŠ‚ç‚¹</h3>
<p>æ‰“å¼€ conf/cassandra.yaml é…ç½®æ–‡ä»¶ï¼ŒæŒ‰ç…§å®é™…ç½‘ç»œç¯å¢ƒè¿›è¡Œè°ƒæ•´ï¼š</p>
<ul>
<li>cluster_nameï¼šé›†ç¾¤åç§°ï¼Œå¯è‡ªå®šä¹‰ã€‚ä¾‹å¦‚ cluster_name: &quot;SearchCluster&quot;ã€‚</li>
<li>listen_addressï¼šç›‘å¬åœ°å€ï¼Œè®¾ç½®ä¸ºæœ¬æœºå†…ç½‘ IPï¼Œä¾‹å¦‚ï¼šlisten_address: 10.201.X.Xã€‚</li>
<li>rpc_addressï¼šRPC åœ°å€ï¼ˆThriftï¼Œä»…åœ¨ä½¿ç”¨è€å®¢æˆ·ç«¯æ—¶éœ€è¦ï¼‰å’Œ native_transport_addressï¼ˆCQL ä½¿ç”¨çš„åœ°å€ï¼‰ã€‚å¯ä»¥è®¾ç½®ä¸ºæœ¬æœº IPï¼Œå¦‚ï¼šrpc_address: 10.201.X.X ï¼ˆåœ¨ Cassandra 3.x ä¸­ rpc_address æ§åˆ¶ CQL æœåŠ¡ç»‘å®šï¼‰ã€‚</li>
<li>seed_providerï¼šç§å­èŠ‚ç‚¹åˆ—è¡¨ã€‚å¦‚æœæ˜¯å•èŠ‚ç‚¹æµ‹è¯•ï¼Œå¯å°†å…¶è®¾ä¸ºæœ¬æœº IPï¼›å¦‚æ˜¯å¤šèŠ‚ç‚¹é›†ç¾¤ï¼Œå¡«å…¥åˆå§‹å¼•å¯¼çš„ç§å­èŠ‚ç‚¹ IP åˆ—è¡¨ã€‚ä¾‹ï¼š</li>
</ul>
<blockquote><code>seed_provider:</code><br>
<code>    - class_name: org.apache.cassandra.locator.SimpleSeedProvider</code><br>
<code>      parameters:</code><br>
<code>          - seeds: &quot;10.201.X.X,10.201.X.X&quot;</code></blockquote><p>ç¡®ä¿è‡³å°‘åŒ…å«é›†ç¾¤ä¸­çš„ä¸€ä¸ªèŠ‚ç‚¹ IP ä½œä¸ºç§å­ã€‚</p>
<ul>
<li>å…¶ä»–å‚æ•°ï¼šæ ¹æ®éœ€è¦è°ƒæ•´å†…å­˜å’Œåƒåœ¾å›æ”¶ç­‰è®¾ç½®ï¼ˆé»˜è®¤é…ç½®ä¸€èˆ¬å¯ç”¨ï¼Œç”Ÿäº§ç¯å¢ƒè§†å†…å­˜å¤§å°è°ƒæ•´ -Xmx ç­‰ï¼‰ã€‚</li>
</ul>
<p>å®Œæˆé…ç½®åï¼Œå¯åŠ¨ Cassandra æœåŠ¡ï¼š</p>
<p><code>$ bin/cassandra -R   # åå°å¯åŠ¨ Cassandra (-R å¯å»é™¤è¶…çº§ç”¨æˆ·æ¨¡å¼é™åˆ¶)</code></p><p>åˆæ¬¡å¯åŠ¨å¯èƒ½éœ€è¦ç­‰å¾…ç‰‡åˆ»è®© Cassandra å®Œæˆåˆå§‹åŒ–ã€‚ä½¿ç”¨è‡ªå¸¦çš„ CQL Shell éªŒè¯è¿æ¥ï¼š</p>
<blockquote><code>$ bin/cqlsh 10.201.X.X 9042   # è¿æ¥åˆ°æœ¬æœºçš„ Cassandra CQL æœåŠ¡</code><br>
<code>Connected to SearchCluster at 10.201.X.X:9042.</code><br>
<code>cqlsh&gt;</code></blockquote><p>è¿æ¥æˆåŠŸåï¼Œå³å¯åˆ›å»º Keyspace å’Œè¡¨ã€‚ä¾‹å¦‚ï¼Œåˆ›å»ºå…³é”®ç©ºé—´ searchï¼š</p>
<blockquote><code>CREATE KEYSPACE search </code><br>
<code>WITH replication = {&#039;class&#039;: &#039;SimpleStrategy&#039;, &#039;replication_factor&#039;: &#039;1&#039;} </code><br>
<code>AND durable_writes = true;</code></blockquote><p><strong>æ³¨æ„ï¼š</strong> ä»¥ä¸Šä½¿ç”¨äº†ç®€å•ç­–ç•¥å’Œå‰¯æœ¬å› å­1ï¼Œé€‚ç”¨äºæµ‹è¯•ç¯å¢ƒã€‚ç”Ÿäº§é›†ç¾¤åº”æ ¹æ®æœºæˆ¿åˆ†å¸ƒé‡‡ç”¨ NetworkTopologyStrategy å¹¶è®¾å®šåˆé€‚çš„å‰¯æœ¬æ•°ã€‚</p>
<p>è®¾è®¡ Cassandra è¡¨ï¼š é’ˆå¯¹æœç´¢ç³»ç»Ÿçš„éœ€æ±‚ï¼Œæˆ‘ä»¬è®¾è®¡ Cassandra æ•°æ®æ¨¡å‹æ¥å­˜å‚¨å•†å“åŠç›¸å…³å±æ€§ä¿¡æ¯ã€‚åŸåˆ™ä¸Š Cassandra é€‚åˆå­˜å‚¨å®½è¡¨ç»“æ„çš„æ•°æ®ï¼Œæ¯ä¸ªè¡¨ä»¥æŸ¥è¯¢éœ€æ±‚ä¸ºå¯¼å‘è®¾è®¡ä¸»é”®ã€‚æˆ‘ä»¬åœ¨ search keyspace ä¸‹å»ºç«‹å¤šå¼ è¡¨æ¥åˆ†åˆ«å­˜å‚¨ä¸åŒç±»å‹çš„ä¿¡æ¯ã€‚ä¾‹å¦‚ï¼š</p>
<ul>
<li>äº§å“ä¸»è¡¨ (goods)ï¼šå­˜å‚¨å•†å“çš„ä¸»è¦å­—æ®µï¼Œä»¥å•†å“ID (id)ä¸ºä¸»é”®ï¼ŒåŒ…å«å•†å“åç§°ã€æè¿°ã€ä¸»åˆ†ç±»ç­‰ã€‚</li>
<li>å±æ€§è¡¨ (attr ç­‰)ï¼šæŒ‰å±æ€§ç±»å‹æ‹†åˆ†æˆå¤šå¼ è¡¨ï¼Œä¸»é”®ä¹Ÿæ˜¯å•†å“IDï¼Œæ¯å¼ è¡¨å­˜å‚¨å•†å“çš„ç‰¹å®šå±æ€§é›†åˆï¼ˆå¦‚è§„æ ¼å‚æ•°ã€è¥é”€æ ‡ç­¾ç­‰ï¼‰ï¼ŒåŒ…å«ç‰ˆæœ¬å·å­—æ®µç”¨äºè®°å½•æ›´æ–°ç‰ˆæœ¬ã€‚</li>
<li>å…¶ä»–ç»´åº¦è¡¨ (category ç­‰)ï¼šæ ¹æ®ä¸šåŠ¡éœ€è¦å»ºç«‹ï¼Œä¾‹å¦‚æŒ‰ç±»ç›®ã€å“ç‰Œã€ä¿ƒé”€ç­‰ç»´åº¦ç»„ç»‡çš„æ•°æ®è¡¨ï¼Œç”¨äºæ”¯æŒç‰¹å®šæŸ¥è¯¢æˆ–ç»Ÿè®¡ã€‚</li>
</ul>
<p>æ¯ä¸ªå•†å“åœ¨ Cassandra ä¸­ä¼šæœ‰ä¸€ç³»åˆ—å…³è”è®°å½•ã€‚ä¾‹å¦‚å•†å“åŸºæœ¬ä¿¡æ¯åœ¨ä¸»è¡¨ä¸€è¡Œï¼Œå±æ€§ä¿¡æ¯åœ¨å±æ€§è¡¨ä¸­ä¸€è¡Œï¼Œç­‰ç­‰ã€‚è¿™ç§è®¾è®¡ä¾¿äºé€šè¿‡å•†å“IDå¿«é€Ÿè·å–å®Œæ•´ä¿¡æ¯ã€‚ç”±äºæœç´¢æŸ¥è¯¢ä¸»è¦ç”± Solr æ‰§è¡Œï¼ŒCassandra çš„ä½œç”¨æ˜¯æŒä¹…åŒ–å­˜å‚¨å’Œæä¾›æ•°æ®æºï¼ŒæŸ¥è¯¢æ—¶é€šå¸¸å¹¶ä¸ä¼šç›´æ¥è®¿é—® Cassandraï¼Œè€Œæ˜¯ç”±ç´¢å¼•æœåŠ¡é¢„å…ˆå°†æ•°æ®å¯¼å…¥ Solrã€‚</p>
<h2>å®‰è£…ä¸é…ç½® Zookeeper</h2>
<p>Zookeeper åœ¨æœ¬æ–¹æ¡ˆä¸­å……å½“ä¸¤ä¸ªè§’è‰²ï¼šKafka çš„åè°ƒæœåŠ¡å’Œ SolrCloud çš„é…ç½®ç®¡ç†ã€‚æˆ‘ä»¬æ­å»ºä¸€ä¸ªç”± 3 å°èŠ‚ç‚¹ç»„æˆçš„ Zookeeper é›†ç¾¤ï¼Œä»¥ä¿è¯é«˜å¯ç”¨ã€‚</p>
<h3>å®‰è£… Zookeeper</h3>
<p>ä¸‹è½½ Zookeeperï¼ˆäºŒè¿›åˆ¶å‘è¡Œç‰ˆï¼‰ï¼Œä¾‹å¦‚ä½¿ç”¨ 3.7.0 ç‰ˆæœ¬ï¼š</p>
<blockquote><code>$ wget https://downloads.apache.org/zookeeper/zookeeper-3.7.0/apache-zookeeper-3.7.0-bin.tar.gz</code><br>
<code>$ tar -zxvf apache-zookeeper-3.7.0-bin.tar.gz</code><br>
<code>$ mv apache-zookeeper-3.7.0-bin /opt/app/zookeeper</code></blockquote><p>åœ¨æ¯å° Zookeeper æœåŠ¡å™¨ä¸Šéƒ½æ‰§è¡Œä¸Šè¿°ä¸‹è½½è§£å‹ã€‚å‡å®šä¸‰å° ZK æœåŠ¡å™¨çš„ IP åˆ†åˆ«ä¸º 10.201.X.Xã€10.201.X.Xã€10.201.X.Xã€‚</p>
<h3>é…ç½® Zookeeper</h3>
<p>åœ¨æ¯å°èŠ‚ç‚¹çš„ conf ç›®å½•ä¸‹å¤åˆ¶ä¸€ä»½æ¨¡æ¿ï¼š</p>
<p><code>$ cp conf/zoo_sample.cfg conf/zoo.cfg</code></p><p>ç¼–è¾‘ zoo.cfgï¼Œä¸»è¦å…³æ³¨ä»¥ä¸‹é…ç½®ï¼š</p>
<ul>
<li><p><code>dataDir=/path/to/zookeeper/dataï¼šæŒ‡å®šæ•°æ®å­˜å‚¨ç›®å½•ï¼Œæ¯”å¦‚ /opt/app/zookeeper/dataï¼Œç¡®ä¿è¯¥ç›®å½•å­˜åœ¨å¹¶æœ‰è¯»å†™æƒé™ã€‚</code></p></li>
<li><p><code>clientPort=2181ï¼šå®¢æˆ·ç«¯è¿æ¥ç«¯å£ï¼Œé»˜è®¤2181ï¼Œä¸€èˆ¬ä¿æŒä¸å˜ã€‚</code></p></li>
<li><p><code>é›†ç¾¤ç›¸å…³é…ç½®ï¼Œåœ¨æ–‡ä»¶æœ«å°¾æ·»åŠ :</code></p></li>
</ul>
<blockquote><code>server.1=10.201.X.X:2888:3888</code><br>
<code>server.2=10.201.X.X:2888:3888</code><br>
<code>server.3=10.201.X.X:2888:3888</code></blockquote><p>è¿™é‡Œ server.N çš„ N å¯¹åº”æ¯å°æœåŠ¡å™¨çš„å”¯ä¸€ç¼–å·ã€‚2888 æ˜¯é›†ç¾¤é€šè®¯ç«¯å£ï¼Œ3888 ä¸ºé€‰ä¸¾ç«¯å£ã€‚</p>
<ul>
<li>åœ¨æ¯å°èŠ‚ç‚¹ä¸Šåˆ›å»ºä¸€ä¸ªåä¸º myid çš„æ–‡ä»¶æ”¾å…¥ dataDirï¼Œæ–‡ä»¶å†…å®¹ä¸ºè¯¥èŠ‚ç‚¹çš„ç¼–å·ï¼Œä¾‹å¦‚èŠ‚ç‚¹1å†™å…¥1ï¼ŒèŠ‚ç‚¹2å†™å…¥2ï¼ŒèŠ‚ç‚¹3å†™å…¥3ã€‚</li>
</ul>
<h3>å¯åŠ¨ Zookeeper é›†ç¾¤</h3>
<p>åœ¨æ¯å°æœåŠ¡å™¨ä¸Šæ‰§è¡Œ:</p>
<p><code>$ ./bin/zkServer.sh start</code></p><p>å¯åŠ¨åï¼Œå¯é€šè¿‡ zkServer.sh status æ£€æŸ¥çŠ¶æ€ï¼Œåº”çœ‹åˆ°å…¶ä¸­ä¸€å°ä¸º leaderï¼Œå…¶ä»–ä¸º followerã€‚å¦‚æœéœ€è¦éªŒè¯ ZK é›†ç¾¤å¯ç”¨æ€§ï¼Œä½¿ç”¨ zkCli è¿æ¥ä»»æ„èŠ‚ç‚¹:</p>
<p><code>$ ./bin/zkCli.sh -server 10.201.X.X:2181</code></p><p>å¯ä»¥å°è¯•åˆ›å»ºèŠ‚ç‚¹æµ‹è¯•ï¼Œå¦‚ï¼š</p>
<p><code>[zk: 10.201.X.X:2181(CONNECTED) 0] create /solr_demo &quot;test&quot;</code></p><p>æˆåŠŸåˆ›å»ºåˆ™è¯´æ˜ ZK æ­£å¸¸å·¥ä½œã€‚æˆ‘ä»¬ç¨åä¼šåœ¨ ZK ä¸Šä½¿ç”¨è·¯å¾„ /solr_demo æ¥å­˜å‚¨ SolrCloud çš„é…ç½®æ•°æ®ï¼ˆå³è®¾ç½®ä¸€ä¸ªchrootè·¯å¾„ï¼‰ã€‚</p>
<h2>å®‰è£…ä¸é…ç½® Kafka</h2>
<h3>å®‰è£… Kafka</h3>
<p>Kafka å¯ä»¥åœ¨ Kafka å®˜ç½‘æˆ– Apache å­˜æ¡£ä¸‹è½½ã€‚è¿™é‡Œä»¥ Kafka 2.x ä¸ºä¾‹ï¼š</p>
<blockquote><code>$ wget https://downloads.apache.org/kafka/2.7.0/kafka_2.12-2.7.0.tgz</code><br>
<code>$ tar -zxvf kafka_2.12-2.7.0.tgz</code><br>
<code>$ mv kafka_2.12-2.7.0 /opt/app/kafka</code></blockquote><p>åœ¨æ¯å° Kafka æœåŠ¡å™¨ä¸Šè§£å‹å®‰è£…åŒ…ã€‚Kafka ä¹Ÿä¾èµ– Java ç¯å¢ƒï¼Œç¡®ä¿å·²ç»å®‰è£… JDK 1.8+ã€‚</p>
<h3>é…ç½® Kafka Broker</h3>
<p>ç¼–è¾‘ Kafka çš„é…ç½®æ–‡ä»¶ config/server.propertiesï¼š</p>
<ul>
<li>broker.idï¼šé›†ç¾¤ä¸­æ¯ä¸ªèŠ‚ç‚¹éœ€è¦å”¯ä¸€çš„ broker.idï¼ˆæ•´æ•°ï¼‰ã€‚å¦‚ç¬¬ä¸€å°è®¾ä¸º0ï¼Œç¬¬äºŒå°1ï¼Œç¬¬ä¸‰å°2ç­‰ã€‚</li>
<li>listeners å’Œ advertised.listenersï¼šé…ç½®ç›‘å¬åœ°å€å’Œå¯¹å¤–é€šå‘Šåœ°å€ã€‚ä¾‹å¦‚å•æœºå¯ç”¨é»˜è®¤ PLAINTEXT://:9092 ç›‘å¬æ‰€æœ‰ç½‘å¡ã€‚å¦‚æœæœ‰å¤šç½‘å¡æˆ– Docker ç¯å¢ƒéœ€è®¾ç½® advertised.listeners ä¸ºå®é™…å¯è®¿é—®åœ°å€ï¼Œæ¯”å¦‚ PLAINTEXT://10.201.X.X:9092ã€‚</li>
<li>zookeeper.connectï¼šè®¾ç½®è¿æ¥çš„ Zookeeper é›†ç¾¤åœ°å€åˆ—è¡¨ã€‚ä¾‹å¦‚ï¼š</li>
</ul>
<p><code>zookeeper.connect=10.201.X.X:2181,10.201.X.X:2181,10.201.X.X:2181</code></p><p>å¦‚æœ SolrCloud ä½¿ç”¨äº† ZK çš„ /solr_demo å­è·¯å¾„ï¼ŒKafka å¯ä»¥ä¸ä½¿ç”¨è¯¥å­è·¯å¾„ï¼Œç›´æ¥è¿æ ¹ç›®å½•ï¼ˆKafka ä¼šåœ¨ ZK ä¸Šåˆ›å»º /brokers ç­‰è·¯å¾„ï¼‰ã€‚</p>
<ul>
<li>log.dirsï¼šKafka å­˜å‚¨æ¶ˆæ¯çš„æ—¥å¿—ç›®å½•ï¼ŒæŒ‡å®šä¸€ä¸ªå®é™…å­˜åœ¨çš„ç£ç›˜è·¯å¾„ï¼Œå¦‚ /opt/app/kafka/logs.</li>
</ul>
<p>æ ¹æ®éœ€è¦ä¹Ÿå¯è°ƒæ•´ Kafka å†…å­˜åŠå…¶ä»–å‚æ•°ï¼Œä½†é»˜è®¤é…ç½®é€‚åˆåˆå§‹æµ‹è¯•ã€‚</p>
<h3>å¯åŠ¨ Kafka</h3>
<p>ä¾æ¬¡åœ¨æ¯å° Kafka èŠ‚ç‚¹ä¸Šå¯åŠ¨ brokerï¼š</p>
<p><code>$ ./bin/kafka-server-start.sh -daemon config/server.properties</code></p><p>ä½¿ç”¨ -daemon å‚æ•°å¯ä»¥åå°è¿è¡Œã€‚å¯åŠ¨åï¼ŒKafka ä¼šè¿æ¥ Zookeeper æ³¨å†Œè‡ªå·±ã€‚å¯ä»¥é€šè¿‡ Zookeeper å®¢æˆ·ç«¯æŸ¥çœ‹ /brokers/ids èŠ‚ç‚¹ä¸‹æ˜¯å¦æœ‰å¯¹åº”çš„ broker ID å‡ºç°ã€‚</p>
<h3>åˆ›å»ºä¸»é¢˜ (Topic)</h3>
<p> æ ¹æ®ä¸šåŠ¡éœ€è¦åˆ›å»º Kafka ä¸»é¢˜ï¼Œç”¨äºä¼ é€’äº§å“æ•°æ®æ›´æ–°ã€‚ä¾‹å¦‚åˆ›å»ºä¸€ä¸ªåä¸º product_update çš„ä¸»é¢˜ï¼Œå‰¯æœ¬å› å­ä¸º2ï¼Œåˆ†åŒºæ•°ä¸º3ï¼š</p>
<p><code>$ ./bin/kafka-topics.sh --create --topic product_update --partitions 3 --replication-factor 2 --bootstrap-server 10.201.X.X:9092</code></p><p>ï¼ˆ--bootstrap-server æŒ‡å®šä»»æ„ä¸€ä¸ªKafkaèŠ‚ç‚¹çš„åœ°å€ï¼‰ã€‚ç¡®ä¿ä¸»é¢˜åˆ›å»ºæˆåŠŸï¼Œå¯ä»¥åˆ—å‡ºå½“å‰ä¸»é¢˜éªŒè¯ï¼š</p>
<p><code>$ ./bin/kafka-topics.sh --list --bootstrap-server 10.201.X.X:9092</code></p><p>Kafka é›†ç¾¤è‡³æ­¤å‡†å¤‡å°±ç»ªã€‚</p>
<h2>å®‰è£…ä¸é…ç½® SolrCloud</h2>
<p>Solr æ˜¯æ„å»ºæœç´¢ç´¢å¼•çš„æ ¸å¿ƒç»„ä»¶ã€‚æˆ‘ä»¬ä½¿ç”¨ SolrCloud æ¨¡å¼ éƒ¨ç½²ï¼Œä»¥æ”¯æŒåˆ†ç‰‡å’Œé«˜å¯ç”¨ã€‚è¿™é‡Œä»¥ Solr 7.7.3 ä¸ºä¾‹ã€‚</p>
<h3>å®‰è£… Solr</h3>
<p>ä» Solr å®˜æ–¹ä¸‹è½½å¯¹åº”ç‰ˆæœ¬å‹ç¼©åŒ…ï¼ˆzip æˆ– tgzï¼‰ï¼Œç„¶ååœ¨æ¯å° Solr èŠ‚ç‚¹ä¸Šè§£å‹ã€‚ä¾‹å¦‚ï¼š</p>
<blockquote><code>$ wget https://archive.apache.org/dist/lucene/solr/7.7.3/solr-7.7.3.tgz</code><br>
<code>$ tar -zxvf solr-7.7.3.tgz</code><br>
<code>$ mv solr-7.7.3 /opt/app/solr</code></blockquote><h3>å‡†å¤‡ SolrCloud é…ç½®</h3>
<p>åœ¨é¦–æ¬¡å¯åŠ¨ SolrCloud ä¹‹å‰ï¼Œéœ€è¦å°† Solr æ ¸å¿ƒé…ç½® ä¸Šä¼ åˆ° Zookeeperï¼Œæˆ–è€…åœ¨å¯åŠ¨æ—¶æŒ‡å®šè®© Solrè‡ªåŠ¨ä¸Šä¼ ã€‚æœ¬é¡¹ç›®çš„ Solr æ¨¡å—åŒ…å«ä¸€ä¸ªåä¸º â€œproductâ€ çš„ collectionï¼ˆç´¢å¼•é›†åˆï¼‰ã€‚å¼€å‘äººå‘˜å·²ç»å‡†å¤‡å¥½ Solr çš„ schema é…ç½®å’Œ DIH(Data Import Handler)é…ç½®ã€‚åœ¨æˆ‘ä»¬çš„éƒ¨ç½²ä¸­ï¼Œé‡‡å–å¦‚ä¸‹æ­¥éª¤ï¼š</p>
<ul>
<li>é…ç½® ZK_HOSTï¼š ç¼–è¾‘ solr-7.7.3/bin/solr.in.sh æ–‡ä»¶ï¼Œæ‰¾åˆ° ZK_HOST è®¾ç½®ï¼Œå°†å…¶æŒ‡å‘æˆ‘ä»¬çš„ Zookeeper é›†ç¾¤åœ°å€å’ŒSolré…ç½®çš„è·¯å¾„ã€‚ä¾‹å¦‚ï¼š</li>
</ul>
<p><code>ZK_HOST=&quot;10.201.X.X:2181,10.201.X.X:2181,10.201.X.X:2181/solr_demo&quot;</code></p><p>è¿™é‡Œæ·»åŠ äº† /solr_demoï¼Œæ„å‘³ç€ SolrCloud å°†åœ¨ ZK ä¸Šçš„è¯¥è·¯å¾„ä¸‹å­˜å‚¨é…ç½®æ•°æ®ã€‚ç¡®ä¿è¯¥è·¯å¾„å·²å­˜åœ¨ï¼ˆä¹‹å‰é€šè¿‡ zkCli åˆ›å»ºè¿‡ /solr_demo èŠ‚ç‚¹ï¼‰ã€‚</p>
<ul>
<li><p>é›†ç¾¤å…¶ä»–é…ç½®ï¼š å¦‚æœéœ€è¦ï¼Œå¯ä»¥åœ¨ solr.in.sh ä¸­è°ƒæ•´ JVM å†…å­˜å¤§å°ï¼ˆSOLR_HEAPï¼‰ä»¥åŠ GC ç­–ç•¥ç­‰ã€‚é»˜è®¤æƒ…å†µä¸‹ Solr 7 ä¼šç»™å‡ºåˆç†çš„ JVM å‚æ•°ï¼Œæˆ‘ä»¬æ ¹æ®èŠ‚ç‚¹å†…å­˜å¤§å°è°ƒæ•´ï¼Œä¾‹å¦‚è®¾ç½® SOLR_HEAP=&quot;1g&quot;ã€‚</p>
</li>
<li><p>DataImportHandler (DIH) é…ç½®ï¼š å¦‚æœé‡‡ç”¨ DIH ä» Cassandra å¯¼å…¥æ•°æ®ï¼Œéœ€è¦åœ¨ Solr ä¸­åŠ å…¥ DIH çš„æ’ä»¶ã€‚Solr 7.7.3 å·²ç»æä¾› solr-dataimporthandler jar åŒ…ï¼Œä½†é»˜è®¤æœªåŒ…æ‹¬åœ¨ solr-webapp ä¸­ã€‚å°†ä»¥ä¸‹jarå¤åˆ¶åˆ° Solr çš„ solr-webapp/webapp/WEB-INF/lib/ ç›®å½•ï¼š</p>
<ul>
<li>dist/solr-dataimporthandler-7.7.3.jar</li>
<li>dist/solr-dataimporthandler-extras-7.7.3.jar</li>
<li>ï¼ˆå¦‚æœæœ‰è‡ªå®šä¹‰çš„ DIH Handler æ’ä»¶ï¼Œä¾‹å¦‚æœ¬é¡¹ç›®æä¾›çš„ solr-support-7.7.0-1.0.jarï¼Œä¹Ÿå¤åˆ¶åˆ°è¯¥ç›®å½•ï¼‰</li>
</ul>
</li>
</ul>
<p>è¿™äº›æ“ä½œå¯ä»¥åœ¨ä¸€å°æœºå™¨ä¸Šå®Œæˆ Solr é…ç½®å‡†å¤‡ï¼Œç„¶åæ‰“åŒ…æ•´ä¸ª solr ç›®å½•ä¾›æ‰€æœ‰èŠ‚ç‚¹ä½¿ç”¨ã€‚ä¾‹å¦‚ï¼Œå°†é…ç½®å¥½çš„ /opt/app/solr å‹ç¼©æˆ solr.zipï¼Œç„¶åä¼ åˆ°æ¯å° Solr æœåŠ¡å™¨è§£å‹ï¼Œä»¥ç¡®ä¿é…ç½®ä¸€è‡´ã€‚</p>
<h3>ä¸Šä¼  Solr é…ç½®å¹¶å¯åŠ¨ SolrCloud</h3>
<p>å‡è®¾å¼€å‘æä¾›äº† Solr core çš„é…ç½®æ–‡ä»¶é›†åˆï¼ˆåŒ…å« schema.xml, solrconfig.xml åŠ DIH é…ç½® data-config.xml ç­‰ï¼‰ä¿å­˜åœ¨ <code>/home/netty/solr_core_config/product</code> ç›®å½•ã€‚å°†æ­¤é…ç½®ä¸Šä¼ åˆ° Zookeeperï¼š</p>
<blockquote><code>$ cd /opt/app/solr</code><br>
<code>$ ./bin/solr zk upconfig -z 10.201.X.X:2181,10.201.X.X:2181,10.201.X.X:2181/solr_demo \</code><br>
<code>    -n product -d /home/netty/solr_core_config/product</code></blockquote><p>ä»¥ä¸Šå‘½ä»¤å°†æœ¬åœ°çš„ product é…ç½®ç›®å½•ä¸Šä¼ åˆ° ZKï¼Œå‘½åä¸º config set â€œproductâ€ã€‚ï¼ˆå¦‚æœéœ€è¦æŸ¥çœ‹å·²ç»å­˜åœ¨çš„ configï¼Œå¯ç”¨ downconfig ä¸‹è½½ï¼Œå¦‚ ./bin/solr zk downconfig -n product -d ./downloaded_conf -z ...ï¼‰ã€‚</p>
<h3>å¯åŠ¨ Solr èŠ‚ç‚¹</h3>
<p>åœ¨æ¯å° Solr æœåŠ¡å™¨ä¸Šï¼Œä»¥ SolrCloud æ¨¡å¼å¯åŠ¨ Solrï¼Œå¹¶è®©å…¶åŠ å…¥é›†ç¾¤ï¼š</p>
<p><code>$ ./bin/solr start -c -m 1g -z 10.201.X.X:2181,10.201.X.X:2181,10.201.X.X:2181/solr_demo -p 8983 -d /opt/app/solr/solr_data</code></p><p>å‚æ•°è¯´æ˜ï¼š-c è¡¨ç¤ºä»¥Cloudæ¨¡å¼å¯åŠ¨ï¼Œ-m 1gè®¾ç½®æœ€å¤§å †1GBï¼Œ-zæŒ‡å®šZKåœ°å€åˆ—è¡¨å’Œè·¯å¾„ï¼Œ-p 8983æŒ‡å®šç«¯å£ï¼ˆé»˜è®¤8983ï¼‰ï¼Œ-d /opt/app/solr/solr_data æŒ‡å®šSolrå®ä¾‹çš„æ•°æ®ç›®å½•ï¼ˆè¿™é‡Œæˆ‘ä»¬å°†Solrè‡ªå¸¦çš„example/serverå†…å®¹å¤åˆ¶åˆ°äº†solr_dataä»¥ç‹¬ç«‹é…ç½®ï¼‰ã€‚</p>
<p>å¯åŠ¨æ‰€æœ‰ Solr èŠ‚ç‚¹åï¼Œå®ƒä»¬ä¼šè‡ªåŠ¨åœ¨Zookeeperä¸Šæ³¨å†Œå¹¶å½¢æˆä¸€ä¸ªSolrCloudé›†ç¾¤ã€‚æ¥ä¸‹æ¥é€šè¿‡ Solr API åˆ›å»ºé›†åˆï¼ˆcollectionï¼‰ã€‚å¯ä»¥ä½¿ç”¨ bin/solr è„šæœ¬åˆ›å»ºï¼Œä¹Ÿå¯ä»¥é€šè¿‡ Solr Admin UI æ‰§è¡Œã€‚ä½¿ç”¨è„šæœ¬ä¸ºä¾‹ï¼š</p>
<p><code>$ ./bin/solr create -c product -n product -shards 2 -replicationFactor 2 -p 8983</code></p><p>è¿™å°†åˆ›å»ºåç§°ä¸º product çš„é›†åˆï¼Œä½¿ç”¨æˆ‘ä»¬ä¸Šä¼ çš„åä¸º product çš„é…ç½®é›†ï¼Œè®¾ç½®2ä¸ªåˆ†ç‰‡ï¼Œæ¯ç‰‡2ä¸ªå‰¯æœ¬ã€‚å¦‚æœå·²åœ¨ solr.in.sh è®¾ç½® ZK_HOSTï¼Œè„šæœ¬ä¼šåœ¨é›†ç¾¤ä¸Šåˆ›å»ºcollectionï¼Œå¹¶åœ¨å„èŠ‚ç‚¹é—´åˆ†é… coresã€‚æˆåŠŸåï¼ŒSolrCloud å¼€å§‹å¯¹å¤–æä¾›æœç´¢æœåŠ¡ã€‚å¯ä»¥åœ¨æµè§ˆå™¨è®¿é—®ä»»ä½•ä¸€å° Solr çš„ç®¡ç†ç•Œé¢ï¼ˆä¾‹å¦‚ <a href="http://10.201.X.X:8983/solr%EF%BC%89%EF%BC%8C%E6%9F%A5%E7%9C%8B%E9%9B%86%E7%BE%A4%E7%8A%B6%E6%80%81%E3%80%81collection">http://10.201.X.X:8983/solrï¼‰ï¼ŒæŸ¥çœ‹é›†ç¾¤çŠ¶æ€ã€collection</a> åˆ—è¡¨ç­‰ã€‚</p>
<p><strong>æ³¨æ„ï¼š</strong> SolrCloud ä½¿ç”¨ Zookeeper å­˜å‚¨é…ç½®å’Œé›†ç¾¤çŠ¶æ€ï¼ŒåŠ¡å¿…ä¿è¯ ZK é›†ç¾¤ç¨³å®šã€‚åœ¨é…ç½®å’Œå¯åŠ¨ Solr æ—¶ï¼Œå¦‚æœ ZK ä¿¡æ¯æœ‰è¯¯ï¼ˆå¦‚åœ°å€æˆ–è·¯å¾„é”™è¯¯ï¼‰ï¼ŒSolr å°†æ— æ³•æ­£å¸¸å¯åŠ¨ã€‚</p>
<h2>Python å¾®æœåŠ¡å¼€å‘ä¸éƒ¨ç½²</h2>
<p>æœ‰äº†ä¸Šè¿°æ•°æ®å­˜å‚¨å’Œç´¢å¼•ç»„ä»¶åï¼Œæˆ‘ä»¬ä½¿ç”¨ Python å®ç°å¾®æœåŠ¡æ¥è¿æ¥å®ƒä»¬ã€‚åŸé¡¹ç›®ä¸­åŸºäº Java/Spring Boot çš„æ¨¡å—æ‰¿æ‹…äº†æ•°æ®åŒæ­¥ã€æœç´¢ç­‰åŠŸèƒ½ã€‚æˆ‘ä»¬ä»¥ Python é‡å†™è¿™äº›æ¨¡å—ï¼Œå¹¶æä¾›ç¤ºä¾‹è¯´æ˜å¦‚ä½•å¯åŠ¨å’Œç®¡ç†ã€‚</p>
<p>å¾®æœåŠ¡åŠŸèƒ½åˆ’åˆ†</p>
<ol>
<li><p>   æ•°æ®åŒæ­¥æœåŠ¡ï¼ˆKafka æ¶ˆè´¹è€…ï¼‰ï¼šæŒç»­æ¶ˆè´¹ Kafka product_update ä¸»é¢˜æ¶ˆæ¯ã€‚æ¯å½“æœ‰å•†å“æ•°æ®æ›´æ–°æ¶ˆæ¯æ—¶ï¼Œä½¿ç”¨ Cassandra é©±åŠ¨å°†æ–°æ•°æ®å†™å…¥ Cassandra å¯¹åº”è¡¨ï¼›ç„¶åè§¦å‘ Solr ç´¢å¼•æ›´æ–°ã€‚ç´¢å¼•æ›´æ–°å¯ä»¥é€šè¿‡Solræä¾›çš„HTTPæ¥å£æäº¤å¢é‡æ–‡æ¡£æˆ–è°ƒç”¨DIHå…¨é‡å¯¼å…¥ï¼ˆå–å†³äºå®ç°ç­–ç•¥ï¼‰ã€‚åœ¨ Python ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ kafka-python æˆ– confluent-kafka åº“æ¶ˆè´¹æ¶ˆæ¯ï¼Œç”¨ DataStax æä¾›çš„ cassandra-driver è¿æ¥ Cassandraï¼Œä½¿ç”¨ requests æˆ– pysolr è°ƒç”¨ Solr çš„ APIã€‚</p>
</li>
<li><p>   æœç´¢ API æœåŠ¡ï¼šå¯¹å¤–æä¾›æœç´¢æ¥å£ï¼ˆREST APIï¼‰ã€‚å®¢æˆ·ç«¯çš„æœç´¢è¯·æ±‚ç”±æ­¤æœåŠ¡æ¥æ”¶ï¼Œå¹¶è½¬å‘æŸ¥è¯¢ç»™ SolrCloudï¼Œæ•´ç†ç»“æœåè¿”å›ã€‚å¯ä»¥åŸºäº Flask æˆ– FastAPI æ¡†æ¶å®ç°ã€‚æœåŠ¡å†…éƒ¨ä½¿ç”¨ SolrJ å®¢æˆ·ç«¯çš„æ›¿ä»£æ–¹æ¡ˆï¼ˆPython å¯ä½¿ç”¨ pysolr åº“ï¼‰æŸ¥è¯¢ Solr é›†ç¾¤ï¼Œæˆ–ç›´æ¥æ„é€  HTTP è¯·æ±‚æŸ¥è¯¢ï¼Œå¹¶å°†ç»“æœè½¬æ¢ä¸ºJSONè¾“å‡ºã€‚è¿™ä¸ªæœåŠ¡ç›¸å½“äºåŸ Java æ¨¡å—ä¸­çš„æœç´¢æŸ¥è¯¢æ¨¡å—ï¼Œå®ƒä¹Ÿå¯ä» Cassandra è·å–éƒ¨åˆ†ä¿¡æ¯åšè¡¥å……ã€‚ä¾‹å¦‚æŸ¥è¯¢è¿”å›çš„å•†å“IDåˆ—è¡¨ï¼Œå†ä» Cassandra æŸ¥è¯¢æœ€æ–°åº“å­˜ç­‰ï¼ˆå¦‚æœè¿™äº›ä¿¡æ¯æœªåœ¨ç´¢å¼•ä¸­ï¼‰ã€‚</p>
</li>
<li><p>   å…¶ä»–è¾…åŠ©æœåŠ¡ï¼šæ¯”å¦‚æ–‡ä»¶æ‰¹é‡å¯¼å…¥æœåŠ¡ï¼ˆç›¸å½“äº product-uploadï¼‰æˆ–å®šæ—¶ä»»åŠ¡è§¦å‘æœåŠ¡ï¼ˆç›¸å½“äº job-triggerï¼‰ï¼Œä¹Ÿéƒ½å¯ä»¥ç”¨ Python å®ç°ã€‚å¦‚æœä½¿ç”¨è°ƒåº¦æ¡†æ¶ï¼ˆå¦‚ xxl-jobï¼‰éœ€è¦å…¼å®¹ï¼Œå¯é€šè¿‡ Python è°ƒç”¨å…¶ HTTP æ¥å£æˆ–æŒ‰ç…§åè®®å®ç°æ‰§è¡Œå™¨ã€‚è¿™é‡Œä¸å±•å¼€ç»†èŠ‚ã€‚</p>
</li>
</ol>
<p>å¾®æœåŠ¡ä»£ç ä¸å¯åŠ¨è„šæœ¬ç¤ºä¾‹</p>
<p>æˆ‘ä»¬ä»¥ FastAPI æ„å»ºæœç´¢ API æœåŠ¡ä¸ºä¾‹ï¼Œå¹¶ç¤ºèŒƒå¦‚ä½•ç¼–å†™ Python å¯åŠ¨è„šæœ¬æ¥ç®¡ç†æœåŠ¡çš„å¯åŠ¨å’Œåœæ­¢ã€‚å‡è®¾æœç´¢æœåŠ¡ä»£ç ä¸º app.pyï¼Œå†…å®¹å¦‚ä¸‹ï¼ˆç®€åŒ–ç¤ºä¾‹ï¼‰ï¼š</p>
<blockquote><code># app.py (FastAPI ç®€æ˜“ç¤ºä¾‹)</code><br>
<code>from fastapi import FastAPI</code><br>
<code>import pysolr</code><br>
<code></code><br>
<code>solr = pysolr.Solr(&#039;http://10.201.X.X:8983/solr/product&#039;, timeout=10)  # Solr åœ°å€</code><br>
<code></code><br>
<code>app = FastAPI()</code><br>
<code></code><br>
<code>@app.get(&quot;/search&quot;)</code><br>
<code>def search(q: str):</code><br>
<code>    # åœ¨ Solr ä¸­æŸ¥è¯¢</code><br>
<code>    results = solr.search(q)</code><br>
<code>    # æå–éœ€è¦çš„å­—æ®µè¿”å›</code><br>
<code>    docs = [doc for doc in results]</code><br>
<code>    return {&quot;query&quot;: q, &quot;results&quot;: docs}</code></blockquote><p>åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œå¯èƒ½ä¼šæœ‰æ›´å¤æ‚çš„æŸ¥è¯¢æ„é€ å’Œç»“æœå¤„ç†ï¼Œè¿™é‡Œä»ç®€ã€‚æ¥ä¸‹æ¥ç¼–å†™ä¸€ä¸ªç®¡ç†è„šæœ¬ service_control.pyï¼Œç”¨äºå¯åŠ¨æˆ–åœæ­¢è¯¥ FastAPI æœåŠ¡ã€‚æˆ‘ä»¬ä½¿ç”¨ subprocess è°ƒç”¨ Uvicorn æ¥è¿è¡Œ FastAPI åº”ç”¨ï¼Œä»¥æ¨¡æ‹Ÿä¼ ç»Ÿ Shell è„šæœ¬ä¸­ java -jar ... &amp; çš„åšæ³•ï¼š</p>
<blockquote><code>#!/usr/bin/env python3</code><br>
<code># service_control.py</code><br>
<code>import subprocess, sys, os, signal</code><br>
<code></code><br>
<code>APP_COMMAND = [&quot;uvicorn&quot;, &quot;app:app&quot;, &quot;--host&quot;, &quot;0.0.0.0&quot;, &quot;--port&quot;, &quot;7220&quot;]</code><br>
<code></code><br>
<code>def start():</code><br>
<code>    &quot;&quot;&quot;å¯åŠ¨æœåŠ¡&quot;&quot;&quot;</code><br>
<code># ... (40 more lines)</code></blockquote>
<p><em>Full code available in the <a href="https://github.com/geyuxu">GitHub repository</a>.</em></p><p>ä¸Šè¿°è„šæœ¬æ¨¡æ‹Ÿäº† Java æœåŠ¡çš„å¯åŠ¨è„šæœ¬é€»è¾‘ï¼š</p>
<ul>
<li><p><code>ä½¿ç”¨ uvicorn æ¥è¿è¡Œ FastAPI åº”ç”¨ï¼ˆç›‘å¬åœ¨ 7220 ç«¯å£ï¼Œæ¨¡æ‹ŸåŸ Java æœåŠ¡ç«¯å£ï¼‰ã€‚</code></p></li>
<li><p><code>start() ä½¿ç”¨ subprocess.Popen å¯åŠ¨å­è¿›ç¨‹ï¼Œå¹¶å°†å…¶ç½®äºç‹¬ç«‹è¿›ç¨‹ç»„ä»¥è„±ç¦»çˆ¶è¿›ç¨‹ï¼ˆç›¸å½“äº nohupï¼‰ã€‚æ—¥å¿—è¾“å‡ºå®šå‘åˆ° service.logã€‚</code></p></li>
<li><p><code>stop() ä½¿ç”¨ç³»ç»Ÿå‘½ä»¤ pgrep æŸ¥æ‰¾åŒ¹é… uvicorn å’Œç«¯å£å·çš„è¿›ç¨‹ï¼Œç„¶åå‘é€ SIGTERM ä¿¡å·å…³é—­ï¼ˆä¹Ÿå¯ç›´æ¥ç”¨ process.pid æ–‡ä»¶è®°å½•çš„æ–¹æ³•ï¼Œæˆ–ä½¿ç”¨æ›´ä¾¿æ·çš„ psutil åº“æŸ¥æ‰¾è¿›ç¨‹ï¼‰ã€‚</code></p></li>
<li><p><code>restart() åˆ™é¡ºåºè°ƒç”¨ stop å† startã€‚</code></p></li>
</ul>
<p>å°† service_control.py æ”¾åœ¨æœåŠ¡å™¨ä¸Šå¹¶èµ‹äºˆå¯æ‰§è¡Œæƒé™ï¼Œå°±å¯ä»¥é€šè¿‡ ./service_control.py start æ¥å¯åŠ¨ Python å¾®æœåŠ¡ï¼Œ./service_control.py stop æ¥åœæ­¢æœåŠ¡äº†ã€‚å¯¹äºæ•°æ®åŒæ­¥æœåŠ¡ï¼ˆKafka æ¶ˆè´¹è€…ï¼‰ï¼Œå¯ä»¥é‡‡ç”¨ç±»ä¼¼æ–¹å¼å¯åŠ¨ã€‚æ¯”å¦‚ç¼–å†™ä¸€ä¸ª consumer.py è„šæœ¬å¯åŠ¨ Kafka æ¶ˆè´¹å¾ªç¯ï¼Œå¹¶åŒæ ·ç”¨ä¸€ä¸ªæ§åˆ¶è„šæœ¬ç®¡ç†ã€‚<strong>æ³¨æ„ï¼š</strong> ç”Ÿäº§ç¯å¢ƒä¸‹å»ºè®®ä½¿ç”¨æ›´å¥å£®çš„æ–¹å¼æ‰˜ç®¡å¾®æœåŠ¡ï¼ˆå¦‚ Supervisorã€systemd æˆ–å®¹å™¨ç¼–æ’ç­‰ï¼‰ï¼Œæ­¤å¤„çš„è„šæœ¬ä»…ä½œä¸ºç¤ºèŒƒã€‚</p>
<h2>é›†ç¾¤éƒ¨ç½²æ³¨æ„äº‹é¡¹</h2>
<p>åœ¨å°†ä¸Šè¿°æ‰€æœ‰ç»„ä»¶éƒ¨ç½²å®Œæˆåï¼Œè¿˜éœ€å…³æ³¨ä¸€äº›é›†ç¾¤æ­å»ºçš„ç»†èŠ‚å’Œæœ€ä½³å®è·µï¼š</p>
<ul>
<li>é…ç½®ç®¡ç†ä¸åŒæ­¥ï¼š é›†ç¾¤ç¯å¢ƒé…ç½®ç¹å¤šï¼Œå»ºè®®ä½¿ç”¨é…ç½®ç®¡ç†å·¥å…·ï¼ˆå¦‚ Ansibleã€Chefï¼‰æˆ–è‡³å°‘ä½¿ç”¨è„šæœ¬ç¡®ä¿æ¯å°æœºå™¨é…ç½®ä¸€è‡´ã€‚ä¾‹å¦‚ Solr çš„ solr.in.shã€Cassandra çš„ cassandra.yaml ç­‰åœ¨ä¸åŒèŠ‚ç‚¹ä¸Šéœ€ä¿æŒä¸€è‡´çš„å‚æ•°åº”ç»Ÿä¸€ä¿®æ”¹ã€‚å¯¹äºè‡ªå®šä¹‰é…ç½®æ–‡ä»¶ï¼ˆå¦‚ Solr schemaï¼‰ï¼Œç¡®ä¿ç‰ˆæœ¬æ­£ç¡®ä¸Šä¼ åˆ° Zookeeper å¹¶åœ¨æ‰€æœ‰ Solr èŠ‚ç‚¹ç”Ÿæ•ˆã€‚</li>
<li>èµ„æºåˆ†é…ï¼š Cassandraã€Solrã€Kafka éƒ½æ˜¯å¯¹å†…å­˜å’ŒIOè¾ƒæ•æ„Ÿçš„åº”ç”¨ã€‚æ ¹æ®æœºå™¨è§„æ ¼è°ƒæ•´å®ƒä»¬çš„ JVM å†…å­˜å‚æ•°ï¼š<ul>
<li>Cassandra é»˜è®¤ä½¿ç”¨ä¸€åŠç‰©ç†å†…å­˜ä½œä¸ºå †ï¼Œç”Ÿäº§å¯æŒ‰æ•°æ®è§„æ¨¡è°ƒæ•´ä½†é¿å…è¿‡å¤§ï¼ˆä»¥å…é•¿ GC åœé¡¿ï¼‰ã€‚</li>
<li>Solr æ ¹æ®ç´¢å¼•æ•°æ®å¤§å°è®¾ç½®å †å†…å­˜ï¼Œä¿è¯èƒ½å®¹çº³å¸¸ç”¨æŸ¥è¯¢çš„å·¥ä½œé›†ã€‚å¦‚æœä½¿ç”¨æ’åº/èšåˆåŠŸèƒ½ï¼Œä¹Ÿè¦è€ƒè™‘å¢åŠ å †å†…å­˜ã€‚Solr ç´¢å¼•æ”¾ç½®åœ¨æœ¬åœ°ç£ç›˜æ—¶ï¼Œæ³¨æ„ç£ç›˜ç©ºé—´å……è¶³ä¸”IOæ€§èƒ½è‰¯å¥½ã€‚</li>
<li>Kafka å¯¹æ–‡ä»¶ç³»ç»Ÿé¡ºåºå†™è¾ƒå‹å¥½ï¼Œä½†è¦ç¡®ä¿æ—¥å¿—ç›®å½•æœ‰è¶³å¤Ÿç©ºé—´ï¼ŒåŒæ—¶ä¸º JVM å †å’Œæ“ä½œç³»ç»Ÿé¡µé¢ç¼“å­˜é¢„ç•™å†…å­˜ã€‚é€šå¸¸ Kafka æœ¬èº«å †ä¸å®œè¿‡å¤§ï¼ˆå‡ GBå³å¯ï¼‰ï¼Œæ›´å¤šä¾èµ–æ“ä½œç³»ç»Ÿç¼“å­˜åŠ é€Ÿç£ç›˜IOã€‚</li>
</ul>
</li>
<li>ç½‘ç»œä¸ç«¯å£ï¼š åœ¨éƒ¨ç½²å¤šèŠ‚ç‚¹é›†ç¾¤æ—¶ï¼Œç¡®ä¿é˜²ç«å¢™æ”¾è¡Œå¿…è¦ç«¯å£ï¼š<ul>
<li>Cassandra é»˜è®¤ 9042 (CQL), 7000/7001 (é›†ç¾¤é€šä¿¡), 7199 (JMX)ã€‚</li>
<li>Zookeeper 2181 å®¢æˆ·ç«¯ç«¯å£ï¼Œ2888/3888 é›†ç¾¤å†…éƒ¨ç«¯å£éœ€å†…ç½‘äº’é€šã€‚</li>
<li>Kafka 9092 (æˆ–è‡ªå®šä¹‰ listeners ç«¯å£)éœ€è¦æ¶ˆè´¹è€…/ç”Ÿäº§è€…è®¿é—®ï¼›è‹¥è·¨æœºæˆ¿æˆ–å®¹å™¨ç¯å¢ƒï¼Œé…ç½®advertised.listenersä¸ºå¯è¾¾åœ°å€ã€‚</li>
<li>Solr 8983 (é»˜è®¤)ï¼Œä»¥åŠ Solr å†…éƒ¨èŠ‚ç‚¹é—´é€šä¿¡ç«¯å£ã€‚å¦‚æœ SolrCloud åœ¨é˜²ç«å¢™éš”ç¦»ç¯å¢ƒï¼Œéœ€è¦å¼€æ”¾ Solr å¯¹å¤–æŸ¥è¯¢ç«¯å£å’Œ Zookeeper ç«¯å£ã€‚</li>
</ul>
</li>
<li>æ•°æ®å¯¼å…¥ä¸ä¸€è‡´æ€§ï¼š é¦–æ¬¡éƒ¨ç½²æ—¶ï¼Œéœ€è¦å°†å·²æœ‰çš„å•†å“æ•°æ®å¯¼å…¥ Cassandra å’Œ Solrã€‚å¯ä»¥é€šè¿‡ç¼–å†™æ‰¹å¤„ç†è„šæœ¬è¯»å–åŸå§‹æ•°æ®æºï¼ˆå¦‚CSV/æ•°æ®åº“ï¼‰å†™å…¥ Cassandraï¼Œç„¶ååˆ©ç”¨ Solr DIH å…¨é‡å¯¼å…¥ï¼Œæˆ–ç›´æ¥ä½¿ç”¨ Solr API æ‰¹é‡ç´¢å¼•ã€‚ä»æ­¤ä¹‹åï¼Œå¢é‡æ•°æ®èµ° Kafka -&gt; æ¶ˆè´¹è€…æœåŠ¡æµç¨‹è‡ªåŠ¨æ›´æ–°ã€‚è¦ç¡®ä¿ Kafka æ¶ˆè´¹ä¸ Cassandra å†™å…¥ã€Solr æ›´æ–°ä¸‰è€…çš„äº‹åŠ¡ä¸€è‡´æ€§ï¼šå¯è€ƒè™‘å…ˆå†™ Cassandraï¼Œå†å†™ Solrï¼Œå¦‚æœ Solr æ›´æ–°å¤±è´¥å¯ä»¥æœ‰è¡¥å¿æœºåˆ¶ï¼ˆä¾‹å¦‚å®šæœŸå…¨é‡åŒæ­¥ä¿®å¤ï¼‰ã€‚ç”±äº Cassandra æœ¬èº«æ˜¯æœ€ç»ˆä¸€è‡´æ€§æ¨¡å‹ï¼Œå†™å…¥æˆåŠŸå³ç®—å®Œæˆï¼Œä¸æä¾›äº‹åŠ¡å›æ»šï¼Œæ‰€ä»¥åº”ç”¨å±‚è¦åšå¥½å¤±è´¥é‡è¯•ã€‚</li>
<li>ç›‘æ§å’Œæ—¥å¿—ï¼š éƒ¨ç½²å®Œæˆåï¼Œæ¨èä¸ºå„ç»„ä»¶å»ºç«‹ç›‘æ§ï¼š<ul>
<li>Cassandra å¯ç›‘æ§èŠ‚ç‚¹å»¶è¿Ÿã€è¯»å†™ååã€Compaction çŠ¶æ€ç­‰ï¼ŒåŠæ—¶æ‰©å®¹æˆ–è°ƒæ•´å‚æ•°ã€‚</li>
<li>Solr å¯ç›‘æ§æŸ¥è¯¢QPSã€ç´¢å¼•å¤§å°ã€ç¼“å­˜å‘½ä¸­ç‡ç­‰ï¼Œé€šè¿‡æ¥å£æˆ– JMX è·å–æŒ‡æ ‡ã€‚</li>
<li>Kafka éœ€ç›‘æ§æ¶ˆæ¯å †ç§¯æƒ…å†µï¼ˆLagï¼‰ã€æ¶ˆè´¹è€…ç»„çŠ¶æ€ã€ç£ç›˜ä½¿ç”¨ç­‰ã€‚</li>
<li>Python å¾®æœåŠ¡åº”è®°å½•å…³é”®æ“ä½œæ—¥å¿—ï¼ˆå¦‚æ¶ˆè´¹äº†å¤šå°‘æ¶ˆæ¯ã€æŸ¥è¯¢è€—æ—¶å¤šå°‘ï¼‰ï¼Œå¹¶é…ç½®å®ˆæŠ¤è¿›ç¨‹ç¡®ä¿å¼‚å¸¸é€€å‡ºæ—¶è‡ªåŠ¨é‡å¯ã€‚å¯å°†å¾®æœåŠ¡æ³¨å†Œåˆ° Supervisor æˆ– systemd ä»¥å¢å¼ºç¨³å®šæ€§ã€‚</li>
</ul>
</li>
<li>æ•…éšœæ¼”ç»ƒï¼š åœ¨ç”Ÿäº§å‰åº”æµ‹è¯•å„éƒ¨åˆ†çš„å®¹é”™æ€§ã€‚ä¾‹å¦‚åœæ­¢ä¸€ä¸ª Cassandra èŠ‚ç‚¹çœ‹æŸ¥è¯¢æ˜¯å¦å—å½±å“ï¼ˆéœ€åœ¨åº”ç”¨å±‚è€ƒè™‘ä¸€è‡´æ€§çº§åˆ«ï¼‰ï¼Œåœæ­¢ä¸€ä¸ª Solr èŠ‚ç‚¹æ£€æŸ¥æŸ¥è¯¢æ˜¯å¦è‡ªåŠ¨åˆ‡æ¢åˆ°å‰¯æœ¬ï¼Œä»¥åŠKafkaä»»ä¸€ broker æŒ‚æ‰åæ¶ˆæ¯æ˜¯å¦ä»å¯æ­£å¸¸å‘é€å’Œæ¶ˆè´¹ã€‚ä¸€æ—¦éªŒè¯é€šè¿‡ï¼Œå†æ­£å¼ä¸Šçº¿è¿è¡Œã€‚</li>
</ul>
<h2>æ€»ç»“ä¸ç»éªŒæ•™è®­</h2>
<p>é€šè¿‡ä¸Šè¿°å®è·µï¼Œæˆ‘ä»¬æˆåŠŸæ­å»ºäº†ä¸€ä¸ªåŸºäº Cassandraã€SolrCloudã€Zookeeperã€Kafka å’Œ Python å¾®æœåŠ¡çš„åˆ†å¸ƒå¼æœç´¢ç³»ç»Ÿã€‚ç›¸æ¯”ä¼ ç»Ÿå•ä½“æœç´¢åº”ç”¨ï¼Œè¿™ç§æ¶æ„å…·æœ‰è‰¯å¥½çš„æ‰©å±•æ€§å’Œè§£è€¦æ€§ï¼šCassandra æä¾›é«˜å†™å…¥æ€§èƒ½å’Œæ°´å¹³æ‰©å±•èƒ½åŠ›ï¼ŒSolrCloud æä¾›å¼ºå¤§çš„æœç´¢ç´¢å¼•åŠŸèƒ½ï¼ŒKafka åˆ™ä½œä¸ºå¼‚æ­¥è§£è€¦çš„ç®¡é“ï¼ŒPython å¾®æœåŠ¡è®©ä¸šåŠ¡é€»è¾‘å®ç°æ›´åŠ çµæ´»é«˜æ•ˆã€‚</p>
<p>åœ¨å®æ–½è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å¾—åˆ°ä»¥ä¸‹ç»éªŒæ•™è®­ï¼š</p>
<ul>
<li>åˆç†çš„æ¶æ„è®¾è®¡ï¼šåœ¨å¼•å…¥å¤šç§ç»„ä»¶æ—¶ï¼Œè¦æ˜ç¡®å®ƒä»¬å„è‡ªèŒè´£ï¼Œè®¾è®¡å¥½æ•°æ®æµè½¬è·¯å¾„ã€‚æ¯”å¦‚æœ¬æ¡ˆä¾‹ä¸­é‡‡ç”¨ Kafka è¿›è¡Œæ•°æ®åŒæ­¥è§£è€¦ï¼Œå¦‚æœæ•°æ®å˜åŒ–é¢‘ç‡ä¸é«˜ï¼Œä¹Ÿå¯ä»¥è€ƒè™‘ç›´æ¥ç”±åº”ç”¨è§¦å‘ Solr æ›´æ–°ï¼Œä½†å¼•å…¥æ¶ˆæ¯é˜Ÿåˆ—ä½¿ç³»ç»Ÿæ›´æ¾è€¦åˆã€å¯ä¼¸ç¼©ã€‚</li>
<li>å……åˆ†çš„æµ‹è¯•éªŒè¯ï¼šé›†ç¾¤ç¯å¢ƒçš„é…ç½®ç»†èŠ‚ç¹æ‚ï¼Œéƒ¨ç½²å®Œæˆåéœ€è¦åå¤æµ‹è¯•ã€‚å¦‚æ›¾é‡åˆ° Solr èŠ‚ç‚¹æ— æ³•åŠ å…¥é›†ç¾¤ï¼Œåå‘ç°æ˜¯ ZK è·¯å¾„é…ç½®é”™è¯¯ï¼›Kafka æ¶ˆè´¹å»¶è¿Ÿè¿‡é«˜ï¼Œè¿½æŸ¥æ˜¯å› æ¶ˆè´¹è€…çº¿ç¨‹å¤„ç†è¿‡æ…¢ã€‚é€šè¿‡é€ä¸€å®šä½é—®é¢˜å¹¶è°ƒæ•´ï¼ˆä¾‹å¦‚ä¿®æ”¹é…ç½®æˆ–ä¼˜åŒ–ä»£ç é€»è¾‘ï¼‰ï¼Œæœ€ç»ˆä½¿å„éƒ¨åˆ†åè°ƒå·¥ä½œã€‚</li>
<li>Python æ›¿ä»£ Java çš„æ€è€ƒï¼šä½¿ç”¨ Python é‡æ„å¾®æœåŠ¡æ¨¡å—ï¼Œå¤§å¹…å‡å°‘äº†æ ·æ¿ä»£ç å’Œç¼–è¯‘éƒ¨ç½²æ—¶é—´ï¼Œå¼€å‘æ•ˆç‡æå‡ã€‚ä½†æ˜¯ä¹Ÿè¦æ³¨æ„ Python åœ¨å¤šçº¿ç¨‹ã€å¤šè¿›ç¨‹æ–¹é¢çš„å·®å¼‚ï¼Œå……åˆ†åˆ©ç”¨å¼‚æ­¥IOæˆ–å¤šè¿›ç¨‹æ¥å‘æŒ¥ç¡¬ä»¶æ€§èƒ½ã€‚å¦‚æœå¯¹æ€§èƒ½è¦æ±‚æé«˜çš„åœºæ™¯ï¼Œä»éœ€æ…é‡è¯„ä¼°ä½¿ç”¨ Python çš„æˆæœ¬ï¼ˆå¯ä»¥è€ƒè™‘å…³é”®éƒ¨åˆ†ç”¨ Cython æˆ–è°ƒç”¨JNIç­‰æ–¹å¼ä¼˜åŒ–ï¼‰ã€‚åœ¨æˆ‘ä»¬çš„å®è·µä¸­ï¼ŒPython å®Œå…¨èƒ½å¤Ÿèƒœä»»æ•°æ®æ¶ˆè´¹å’ŒæŸ¥è¯¢APIçš„å·¥ä½œï¼Œå¹¶ä¸”æ˜“äºç»´æŠ¤ã€‚</li>
<li>é…ç½®ä¸ç»´æŠ¤ï¼šé›†ä¸­ç®¡ç†é…ç½®æ˜¯è¿ç»´æˆåŠŸçš„å…³é”®ã€‚å»ºè®®å°†é…ç½®æ–‡ä»¶çº³å…¥ç‰ˆæœ¬æ§åˆ¶ï¼Œå¹¶ä½¿ç”¨é…ç½®ç®¡ç†å·¥å…·æ‰¹é‡éƒ¨ç½²ã€‚å¯¹äºæ•æ„Ÿä¿¡æ¯ï¼ˆå¦‚å¯†ç ã€å¯†é’¥ï¼‰ï¼Œä½¿ç”¨åŠ å¯†æˆ–é…ç½®ä¸­å¿ƒç®¡ç†ã€‚æ•´ä¸ªç³»ç»Ÿä¸Šçº¿åï¼Œè¦æœ‰å®šæœŸçš„ç»´æŠ¤è®¡åˆ’ï¼ŒåŒ…æ‹¬ Cassandra åˆ—å‹ç¼©ã€Solr ç´¢å¼•ä¼˜åŒ–ã€Kafka æ—¥å¿—æ¸…ç†ç­‰ä»»åŠ¡ï¼Œä»¥ä¿è¯ç³»ç»Ÿé•¿æ—¶é—´ç¨³å®šè¿è¡Œã€‚</li>
</ul>
<p>æ€»ä¹‹ï¼Œæœ¬æ¬¡æ­å»ºä¸éƒ¨ç½²å®è·µå±•ç¤ºäº†ä¸€å¥—è¾ƒå®Œæ•´çš„æœç´¢è§£å†³æ–¹æ¡ˆã€‚ä»é›¶å¼€å§‹ç»„å»ºè¿™æ ·ä¸€ä¸ªç³»ç»Ÿéœ€è¦è·¨è¶Šå¤šä¸ªæŠ€æœ¯é¢†åŸŸçš„çŸ¥è¯†ï¼Œé€šè¿‡ä¸€æ­¥æ­¥å®‰è£…é…ç½®å’Œè°ƒä¼˜ï¼Œæˆ‘ä»¬æŒæ¡äº†å„ç»„ä»¶ååŒå·¥ä½œçš„è¦ç‚¹ã€‚åœ¨æœªæ¥çš„æ‰©å±•ä¸­ï¼Œå¯ä»¥è€ƒè™‘å°†æ­¤æ¶æ„å®¹å™¨åŒ–éƒ¨ç½²äº Kubernetesï¼Œå®ç°æ›´åŠ è‡ªåŠ¨åŒ–çš„æ‰©å®¹å’Œè¿ç»´ã€‚å¸Œæœ›è¿™äº›ç»éªŒå¯¹æ­£åœ¨æ„å»ºç±»ä¼¼æœç´¢å¹³å°çš„å·¥ç¨‹å¸ˆæœ‰æ‰€å¸®åŠ©ã€‚</p>

    </article>
    </main>
</div>

<script src="https://cdn.jsdelivr.net/npm/prismjs@1/prism.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/prismjs@1/components/prism-python.min.js"></script>
<script>
Prism.highlightAll();
document.querySelectorAll('article pre').forEach(pre => {
    const code = pre.querySelector('code');
    if (!code) return;
    const toolbar = document.createElement('div');
    toolbar.className = 'code-toolbar';
    const btn = document.createElement('button');
    btn.className = 'copy-btn';
    btn.textContent = 'Copy';
    btn.onclick = () => {
        navigator.clipboard.writeText(code.textContent).then(() => {
            btn.textContent = 'Copied!';
            btn.classList.add('copied');
            setTimeout(() => { btn.textContent = 'Copy'; btn.classList.remove('copied'); }, 2000);
        });
    };
    toolbar.appendChild(btn);
    pre.parentNode.insertBefore(toolbar, pre);
});
</script>
</body>
</html>