<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é¢å‘å†…å®¹æ£€ç´¢å¹³å°çš„é¢„å‘å¸ƒç¯å¢ƒæ­å»º | Yuxu Ge</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1/themes/prism-tomorrow.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    <style>
        :root {
            --black: #111;
            --dark-grey: #444;
            --off-white: #f4f4f4;
            --vermilion: #C41E3A;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            font-size: 16px;
            scroll-behavior: smooth;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            line-height: 1.6;
            color: var(--black);
            background-color: var(--off-white);
        }

        a {
            color: var(--vermilion);
            text-decoration: none;
        }

        a:hover {
            opacity: 0.75;
        }

        .layout {
            min-height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            position: fixed;
            top: 0;
            left: 0;
            width: 320px;
            height: 100vh;
            background: var(--black);
            color: var(--off-white);
            padding: 3rem 2rem;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .sidebar-top {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
        }

        .avatar {
            display: block;
            width: 120px;
            height: 120px;
            border-radius: 50%;
            border: 3px solid var(--vermilion);
            margin-bottom: 1.5rem;
            overflow: hidden;
            transition: transform 0.2s ease;
        }

        .avatar:hover {
            opacity: 1;
            transform: scale(1.05);
        }

        .avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .name-block {
            margin-bottom: 0.5rem;
        }

        h1 {
            font-size: 1.8rem;
            font-weight: 700;
            letter-spacing: 1px;
            color: var(--off-white);
        }

        .title-role {
            font-size: 0.9rem;
            color: #888;
            margin-top: 0.25rem;
            font-weight: 400;
        }

        .contact-block {
            margin-top: 2.5rem;
            width: 100%;
        }

        .social-links {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.75rem;
        }

        .social-links a {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            width: 160px;
            color: var(--off-white);
            opacity: 0.7;
            padding: 0.5rem 0.75rem;
            border-radius: 4px;
            font-size: 0.9rem;
            transition: all 0.2s;
        }

        .social-links a:hover {
            color: var(--vermilion);
            opacity: 1;
            background: rgba(255, 255, 255, 0.05);
        }

        .social-links svg {
            width: 20px;
            height: 20px;
            flex-shrink: 0;
        }

        .social-links .orcid-link {
            font-size: 0.68rem;
            gap: 0.5rem;
            white-space: nowrap;
        }

        .sidebar-footer {
            text-align: center;
            font-size: 0.75rem;
            color: #555;
        }

        /* Content */
        .content {
            margin-left: 320px;
            padding: 3rem 4rem;
            max-width: calc(100vw - 320px - 8rem);
        }

        .back-link {
            display: inline-block;
            font-size: 0.85rem;
            margin-bottom: 2rem;
            color: var(--dark-grey);
        }

        .back-link:hover {
            color: var(--vermilion);
        }

        /* Article */
        article h1 {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 1.5rem;
            line-height: 1.3;
            color: var(--black);
        }

        article h2 {
            font-size: 1.4rem;
            font-weight: 600;
            margin: 2rem 0 1rem;
            color: var(--black);
        }

        article h3 {
            font-size: 1.1rem;
            font-weight: 600;
            margin: 1.5rem 0 0.75rem;
            color: var(--black);
        }

        article p {
            margin-bottom: 1rem;
            color: var(--dark-grey);
        }

        article ul,
        article ol {
            margin: 1rem 0 1rem 1.5rem;
            color: var(--dark-grey);
        }

        article li {
            margin-bottom: 0.5rem;
        }

        article strong {
            color: var(--black);
        }

        article code {
            font-family: "SF Mono", Monaco, monospace;
            font-size: 0.9em;
            background: #e8e8e8;
            padding: 0.15em 0.4em;
            border-radius: 3px;
        }

        article pre {
            margin: 1rem 0;
            border-radius: 6px;
            overflow-x: auto;
            background: #2d2d2d;
            padding: 1rem;
        }

        article pre code {
            background: none;
            padding: 0;
            font-size: 0.75em;
            white-space: pre !important;
            counter-reset: line;
            display: block;
            color: #ccc;
        }

        article pre code .line {
            counter-increment: line;
        }

        article pre code .line::before {
            content: counter(line);
            display: inline-block;
            width: 2.5em;
            margin-right: 1em;
            text-align: right;
            color: #666;
            user-select: none;
        }

        .code-toolbar {
            display: flex;
            justify-content: flex-start;
            padding: 0.35rem 0.5rem;
            background: #3a3a3a;
            border-radius: 6px 6px 0 0;
        }

        .code-toolbar+pre {
            margin-top: 0;
            border-radius: 0 0 6px 6px;
        }

        .copy-btn {
            padding: 0.2rem 0.5rem;
            font-size: 0.7rem;
            background: #555;
            color: #fff;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .copy-btn:hover,
        .copy-btn:active {
            background: #777;
        }

        .copy-btn.copied {
            background: #2a2;
        }

        article blockquote {
            border-left: 3px solid var(--vermilion);
            padding-left: 1rem;
            margin: 1rem 0;
            color: #666;
            font-style: italic;
        }

        article hr {
            border: none;
            border-top: 1px solid #ddd;
            margin: 2rem 0;
        }

        article table {
            width: 100%;
            border-collapse: collapse;
            margin: 1rem 0;
            font-size: 0.9rem;
        }

        article th,
        article td {
            border: 1px solid #ddd;
            padding: 0.5rem 0.75rem;
            text-align: left;
        }

        article th {
            background: #e8e8e8;
            font-weight: 600;
        }

        article img {
            max-width: 100%;
            height: auto;
            display: block;
            margin: 1.5rem 0;
            border-radius: 6px;
        }

        .loading {
            text-align: center;
            padding: 3rem;
            color: #888;
        }

        .error {
            color: var(--vermilion);
        }

        /* Language Selector */
        .lang-selector {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
            padding: 0.75rem 1rem;
            background: #fff;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            font-size: 0.85rem;
        }

        .lang-selector-label {
            color: #666;
            display: flex;
            align-items: center;
            gap: 0.35rem;
        }

        .lang-selector-label svg {
            width: 16px;
            height: 16px;
        }

        .lang-select {
            padding: 0.4rem 0.75rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            background: white;
            font-size: 0.85rem;
            cursor: pointer;
            min-width: 140px;
        }

        .lang-select:focus {
            outline: none;
            border-color: var(--vermilion);
        }

        .lang-status {
            font-size: 0.8rem;
            color: #888;
            margin-left: auto;
        }

        .lang-status.translating {
            color: var(--vermilion);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .lang-status.translating::before {
            content: '';
            width: 14px;
            height: 14px;
            border: 2px solid #f0f0f0;
            border-top-color: var(--vermilion);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .lang-status.cached {
            color: #4CAF50;
        }

        .lang-original-btn {
            padding: 0.35rem 0.6rem;
            font-size: 0.75rem;
            background: #f0f0f0;
            border: 1px solid #ddd;
            border-radius: 4px;
            cursor: pointer;
            color: #666;
            transition: all 0.2s;
        }

        .lang-original-btn:hover {
            background: #e0e0e0;
            color: #333;
        }

        @media (max-width: 600px) {
            .lang-selector {
                flex-wrap: wrap;
            }
            .lang-status {
                width: 100%;
                margin-left: 0;
                margin-top: 0.5rem;
            }
        }

        /* KaTeX math styles */
        .katex-display {
            overflow-x: auto;
            overflow-y: hidden;
            padding: 0.5rem 0;
        }

        .katex {
            font-size: 1.1em;
        }

        /* Jupyter Notebook Styles */
        .notebook-container {
            margin-top: 1rem;
        }

        .notebook-download {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            margin-bottom: 1.5rem;
            background: var(--black);
            color: var(--off-white);
            border-radius: 4px;
            font-size: 0.85rem;
            transition: opacity 0.2s;
        }

        .notebook-download:hover {
            opacity: 0.8;
            color: var(--off-white);
        }

        .notebook-download svg {
            width: 16px;
            height: 16px;
        }

        .nb-cell {
            margin-bottom: 1.5rem;
        }

        .nb-cell-code .nb-source {
            background: #2d2d2d;
            border-radius: 6px;
            overflow-x: auto;
        }

        .nb-cell-code .nb-source pre {
            margin: 0;
            padding: 1rem;
            color: #ccc;
            font-family: "SF Mono", Monaco, monospace;
            font-size: 0.85em;
        }

        .nb-cell-code .nb-source code {
            background: none;
            padding: 0;
        }

        .nb-output {
            background: #fff;
            border: 1px solid #ddd;
            border-radius: 6px;
            padding: 0.75rem;
            margin-top: 0.5rem;
        }

        .nb-output pre {
            margin: 0;
            padding: 0;
            background: transparent;
            white-space: pre-wrap;
            word-wrap: break-word;
            font-family: "SF Mono", Monaco, monospace;
            font-size: 0.85em;
            color: #222;
        }

        .nb-output img {
            max-width: 100%;
            height: auto;
            display: block;
            margin: 0.5rem 0;
        }

        .nb-output table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9rem;
        }

        .nb-output th,
        .nb-output td {
            border: 1px solid #ddd;
            padding: 0.5rem;
            text-align: left;
        }

        .nb-output th {
            background: #e8e8e8;
            font-weight: 600;
        }

        .nb-cell-markdown {
            padding: 0;
        }

        .nb-cell-markdown h1:first-child {
            margin-top: 0;
        }

        /* Document Download Button */
        .doc-download {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            margin-bottom: 1.5rem;
            background: var(--black);
            color: var(--off-white);
            border-radius: 4px;
            font-size: 0.85rem;
            transition: opacity 0.2s;
        }

        .doc-download:hover {
            opacity: 0.8;
            color: var(--off-white);
        }

        .doc-download svg {
            width: 16px;
            height: 16px;
        }

        /* PDF Viewer */
        .pdf-container {
            margin-top: 1rem;
        }

        .pdf-viewer {
            width: 100%;
            height: 80vh;
            border: 1px solid #ddd;
            border-radius: 6px;
            background: #f5f5f5;
        }

        /* Text File Display */
        .text-container {
            margin-top: 1rem;
        }

        .text-content {
            background: #fff;
            border: 1px solid #ddd;
            border-radius: 6px;
            padding: 1.5rem;
            font-family: "SF Mono", Monaco, monospace;
            font-size: 0.9em;
            line-height: 1.6;
            white-space: pre-wrap;
            word-wrap: break-word;
            color: var(--dark-grey);
            max-height: 80vh;
            overflow-y: auto;
        }

        /* Word Document Display */
        .word-container {
            margin-top: 1rem;
        }

        .word-content {
            background: #fff;
            border: 1px solid #ddd;
            border-radius: 6px;
            padding: 2rem;
            line-height: 1.8;
            color: var(--dark-grey);
        }

        .word-content p {
            margin-bottom: 1rem;
        }

        .word-content h1,
        .word-content h2,
        .word-content h3 {
            color: var(--black);
            margin: 1.5rem 0 1rem;
        }

        .word-content table {
            width: 100%;
            border-collapse: collapse;
            margin: 1rem 0;
        }

        .word-content th,
        .word-content td {
            border: 1px solid #ddd;
            padding: 0.5rem;
        }

        .word-content img {
            max-width: 100%;
            height: auto;
        }

        /* Excel Display */
        .excel-container {
            margin-top: 1rem;
        }

        .excel-tabs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }

        .excel-tab {
            padding: 0.5rem 1rem;
            background: #e8e8e8;
            border: none;
            border-radius: 4px 4px 0 0;
            cursor: pointer;
            font-size: 0.85rem;
        }

        .excel-tab.active {
            background: #4CAF50;
            color: white;
        }

        .excel-content {
            background: #fff;
            border: 1px solid #ddd;
            border-radius: 6px;
            overflow-x: auto;
            max-height: 70vh;
            overflow-y: auto;
        }

        .excel-content table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.85rem;
        }

        .excel-content th,
        .excel-content td {
            border: 1px solid #ddd;
            padding: 0.4rem 0.6rem;
            text-align: left;
            white-space: nowrap;
        }

        .excel-content th {
            background: #f5f5f5;
            font-weight: 600;
            position: sticky;
            top: 0;
        }

        .excel-content tr:nth-child(even) {
            background: #fafafa;
        }

        /* PowerPoint Display */
        .ppt-container {
            margin-top: 1rem;
        }

        .ppt-viewer {
            width: 100%;
            height: 80vh;
            border: 1px solid #ddd;
            border-radius: 6px;
            background: #f5f5f5;
        }

        /* CSV Display (uses excel styles) */
        .csv-container {
            margin-top: 1rem;
        }

        /* Responsive */
        @media (max-width: 900px) {
            .sidebar {
                position: relative;
                width: 100%;
                height: auto;
                padding: 2rem 1.5rem 1rem;
            }

            .social-links {
                flex-direction: row;
                flex-wrap: wrap;
                justify-content: center;
            }

            .social-links a,
            .social-links .orcid-link {
                width: auto;
                padding: 0.5rem;
                font-size: 0;
                gap: 0;
            }

            .social-links svg {
                width: 24px;
                height: 24px;
            }

            .social-links .hide-mobile {
                display: none;
            }

            .sidebar-footer {
                margin-top: 1rem;
            }

            .content {
                margin-left: 0;
                padding: 2rem 1rem;
            }
        }

        @media (max-width: 480px) {
            .sidebar {
                padding: 1.5rem 1rem 1rem;
            }

            .avatar {
                width: 80px;
                height: 80px;
            }

            h1 {
                font-size: 1.4rem;
            }

            article h1 {
                font-size: 1.5rem;
            }
        }
    </style>
</head>

<body>

    <div class="layout">
        <aside class="sidebar" id="sidebar-content"></aside>
        <script src="/components/sidebar.js?v=20260128"></script>

        <main class="content">
            <a href="/blog/" class="back-link">â† Back to Blog</a>

            <!-- Language Selector -->
            <div class="lang-selector" id="lang-selector" style="display: none;">
                <span class="lang-selector-label">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5h12M9 3v2m1.048 9.5A18.022 18.022 0 016.412 9m6.088 9h7M11 21l5-10 5 10M12.751 5C11.783 10.77 8.07 15.61 3 18.129" />
                    </svg>
                    Language
                </span>
                <select class="lang-select" id="lang-select">
                    <option value="en">ğŸ‡ºğŸ‡¸ English</option>
                    <option value="zh">ğŸ‡¨ğŸ‡³ ä¸­æ–‡</option>
                    <option value="ja">ğŸ‡¯ğŸ‡µ æ—¥æœ¬èª</option>
                    <option value="ko">ğŸ‡°ğŸ‡· í•œêµ­ì–´</option>
                    <option value="es">ğŸ‡ªğŸ‡¸ EspaÃ±ol</option>
                    <option value="fr">ğŸ‡«ğŸ‡· FranÃ§ais</option>
                    <option value="de">ğŸ‡©ğŸ‡ª Deutsch</option>
                    <option value="pt">ğŸ‡µğŸ‡¹ PortuguÃªs</option>
                    <option value="ru">ğŸ‡·ğŸ‡º Ğ ÑƒÑÑĞºĞ¸Ğ¹</option>
                    <option value="ar">ğŸ‡¸ğŸ‡¦ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option>
                </select>
                <button class="lang-original-btn" id="lang-original-btn" style="display: none;">Show Original</button>
                <span class="lang-status" id="lang-status"></span>
            </div>

            <article>
<hr>
<h2>date: 2022-02-14
tags: [search]
legacy: true</h2>
<h1>é¢å‘å†…å®¹æ£€ç´¢å¹³å°çš„é¢„å‘å¸ƒç¯å¢ƒæ­å»º</h1>
<p>SolrCloud æ˜¯ Solr çš„åˆ†å¸ƒå¼éƒ¨ç½²æ¨¡å¼ï¼Œç”¨äºå¤„ç†å¤§è§„æ¨¡æœç´¢ç´¢å¼•ã€‚SolrCloud å°†ç´¢å¼•æ‹†åˆ†æˆå¤šä¸ª åˆ†ç‰‡ (Shard)ï¼Œæ¯ä¸ªåˆ†ç‰‡åŒ…å«æ•´ä¸ªç´¢å¼•çš„ä¸€éƒ¨åˆ†æ–‡æ¡£é›†åˆ ã€‚é›†åˆ (Collection) æ˜¯ç”¨æˆ·é€»è¾‘ä¸Šçš„ä¸€ä¸ªå®Œæ•´ç´¢å¼•ï¼Œå®ƒå¯èƒ½ç”±ä¸€ä¸ªæˆ–å¤šä¸ªåˆ†ç‰‡ç»„æˆã€‚SolrCloud ä¼šæ ¹æ®æ–‡æ¡£çš„å”¯ä¸€é”®å“ˆå¸Œæˆ–æŒ‡å®šè·¯ç”±ï¼Œå°†æ–‡æ¡£è‡ªåŠ¨åˆ†é…åˆ°å¯¹åº”çš„åˆ†ç‰‡ä¸Šï¼Œä»è€Œå®ç°æ°´å¹³æ‰©å±•ã€‚ä¸ºäº†ä¿è¯æŸ¥è¯¢çš„å®Œæ•´æ€§ï¼ŒSolr æ”¯æŒ åˆ†å¸ƒå¼æŸ¥è¯¢ï¼Œå³ä¸€ä¸ªæŸ¥è¯¢ä¼šç”±æŸ¥è¯¢èŠ‚ç‚¹è½¬å‘åˆ°æ‰€æœ‰åˆ†ç‰‡æ‰§è¡Œï¼Œæ±‡æ€»å„åˆ†ç‰‡ç»“æœåå†è¿”å›ç»™å®¢æˆ·ç«¯ã€‚</p>
<p>æ¯ä¸ªåˆ†ç‰‡ä¸ºäº†é«˜å¯ç”¨èµ·è§å¯ä»¥æœ‰å¤šä¸ª å‰¯æœ¬ (Replica)ã€‚æ‰€æœ‰å‰¯æœ¬çš„æ•°æ®å®Œå…¨ç›¸åŒï¼Œå…¶ä¸­æœ‰ä¸”åªæœ‰ä¸€ä¸ªè¢«é€‰ä¸¾ä¸º Leaderï¼Œè´Ÿè´£è¯¥åˆ†ç‰‡çš„ç´¢å¼•æ›´æ–°åè°ƒ ã€‚å…¶ä½™å‰¯æœ¬ç§°ä¸º Followerï¼ˆä»¥å‰ä¹Ÿå«ä»å±ï¼‰ï¼Œä» Leader åŒæ­¥ç´¢å¼•æ›´æ–°ã€‚SolrCloud æ²¡æœ‰ä¼ ç»Ÿæ„ä¹‰çš„é›†ç¾¤ä¸»ä»æ¶æ„â€”â€”æ•´ä¸ªé›†ç¾¤ä¸å­˜åœ¨å•ä¸€ä¸»èŠ‚ç‚¹ï¼Œæ¯ä¸ªåˆ†ç‰‡å„è‡ªç‹¬ç«‹é€‰ä¸» ã€‚ZooKeeper ä¼šç»´æŠ¤ SolrCloud é›†ç¾¤çš„çŠ¶æ€ä¿¡æ¯ï¼ŒåŒ…æ‹¬å“ªäº›é›†åˆã€åˆ†ç‰‡ã€å‰¯æœ¬ï¼Œä»¥åŠå“ªä¸ªå‰¯æœ¬å½“å‰æ˜¯ Leaderã€‚å½“éœ€è¦æ–°å¢å‰¯æœ¬æˆ–åˆ†è£‚åˆ†ç‰‡æ—¶ï¼Œä¹Ÿé€šè¿‡ Solr çš„ Collections API é€šçŸ¥ ZooKeeper å†ç”±é›†ç¾¤ååŒæ‰§è¡Œã€‚</p>
<p>è¿™æ ·çš„è®¾è®¡å¸¦æ¥äº†é«˜å¯ç”¨å’Œå®¹é”™èƒ½åŠ›ï¼šåŒä¸€åˆ†ç‰‡æœ‰å¤šä»½å‰¯æœ¬æä¾›æœåŠ¡ï¼Œå³ä½¿æŸä¸ªå‰¯æœ¬å®•æœºï¼ŒæŸ¥è¯¢è¯·æ±‚ä¼šè‡ªåŠ¨ç”±å‰©ä½™å‰¯æœ¬å¤„ç†ï¼Œä¸å½±å“æ•´ä½“æœåŠ¡ ã€‚å¦‚æœæŸåˆ†ç‰‡çš„ Leader å®•æœºï¼ŒZooKeeper ä¼šåœ¨å‰©ä½™å‰¯æœ¬ä¸­è‡ªåŠ¨é€‰ä¸¾å‡ºæ–°çš„ Leaderï¼Œç»§ç»­æ‰¿æ‹…ç´¢å¼•å†™å…¥ã€‚ åŒæ—¶ï¼ŒSolrCloud åˆ©ç”¨ ZooKeeper å®ç°é›†ä¸­é…ç½®ç®¡ç†å’Œä»»åŠ¡åè°ƒ ã€‚æ‰€æœ‰ Solr å®ä¾‹å¯åŠ¨æ—¶éƒ½ä¼šä» ZooKeeper è·å–æœ€æ–°çš„é…ç½®ï¼Œå½“é…ç½®å˜æ›´æ—¶å„èŠ‚ç‚¹ä¹Ÿèƒ½åŠæ—¶æ„ŸçŸ¥ã€‚æ­¤å¤–ï¼Œå‘é€ç»™é›†ç¾¤çš„ç´¢å¼•è¯·æ±‚æ— è®ºåˆ°è¾¾å“ªä¸ªèŠ‚ç‚¹ï¼Œéƒ½ä¼šç”± SolrCloud è‡ªåŠ¨è½¬å‘åˆ°æ­£ç¡®çš„åˆ†ç‰‡ Leader å»å¤„ç† ï¼Œè¿™ä¸€åˆ‡éƒ½å¾—ç›Šäº ZooKeeper ä¿å­˜çš„é›†ç¾¤è·¯ç”±ä¿¡æ¯ã€‚é€šè¿‡åˆ†ç‰‡+å‰¯æœ¬+é€‰ä¸»æœºåˆ¶ï¼ŒSolrCloud å®ç°äº†ç´¢å¼•çš„ æ°´å¹³æ‹†åˆ† å’Œ å†—ä½™å¤‡ä»½ã€‚å¯¹äºå†…å®¹æ£€ç´¢å¹³å°è€Œè¨€ï¼Œè¿™æ„å‘³ç€å¯ä»¥è½»æ¾æ‰©å±•ç´¢å¼•è§„æ¨¡ï¼Œå¹¶ä¿è¯åœ¨é¢„å‘å¸ƒç¯å¢ƒä¸­ä¹Ÿèƒ½æ¨¡æ‹ŸæŸ¥è¯¢çš„åˆ†å¸ƒå¼è¿‡ç¨‹å’Œå®¹é”™è¡Œä¸ºã€‚</p>
<h2>ZooKeeper é€‰ä¸»ç®—æ³•è§£æ</h2>
<p>ZooKeeper åœ¨ä¸Šè¿°æ¶æ„ä¸­å……å½“â€œé›†ç¾¤å¤§è„‘â€ï¼Œä¸ºåˆ†å¸ƒå¼ç³»ç»Ÿæä¾›é…ç½®å­˜å‚¨ã€å‘½åæœåŠ¡å’ŒåŒæ­¥åŸè¯­ç­‰åŠŸèƒ½ã€‚å…¶ä¸­æœ€é‡è¦çš„ä¸€ç‚¹æ˜¯å®ƒéœ€è¦ä¿è¯è‡ªå·±çš„æ•°æ®ä¸€è‡´æ€§â€”â€”è¿™é€šè¿‡ é€‰ä¸»ç®—æ³• æ¥å®ç°ã€‚ä¸€ä¸ª ZooKeeper é›†ç¾¤ï¼ˆç§°ä¸º ä»²è£é›†åˆï¼Œensembleï¼‰é€šå¸¸ç”±å¤šä¸ªèŠ‚ç‚¹ç»„æˆï¼Œå…¶ä¸­ä»»ä½•æ—¶åˆ»åªæœ‰ä¸€ä¸ª Leader èŠ‚ç‚¹å¯¹å¤–æä¾›å†™æœåŠ¡ï¼Œå…¶ä½™ä¸º Follower èŠ‚ç‚¹å‚ä¸å¤åˆ¶å’ŒæŠ•ç¥¨ã€‚å¦‚æœ Leader å®•æœºï¼Œå‰©ä½™èŠ‚ç‚¹ä¼šé€šè¿‡é€‰ä¸¾ç®—æ³•é€‰å‡ºæ–°çš„ Leaderã€‚</p>
<p>ZooKeeper çš„é€‰ä¸»ç®—æ³•æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ª å¤šæ•°æŠ•ç¥¨åè®®ã€‚æ¯ä¸ª ZooKeeper èŠ‚ç‚¹æœ‰ä¸€ä¸ªå”¯ä¸€çš„ æœåŠ¡å™¨ID (myid)ï¼Œä»¥åŠè®°å½•è‡ªèº«æ•°æ®çŠ¶æ€çš„ äº‹åŠ¡ID (ZXID) å’Œè½®æ¬¡ç¼–å· Epochã€‚é€‰ä¸¾è¿‡ç¨‹å¦‚ä¸‹ï¼šå½“é›†ç¾¤å¯åŠ¨æˆ–Leaderå¤±æ•ˆæ—¶ï¼Œæ‰€æœ‰èŠ‚ç‚¹è¿›å…¥ LOOKINGï¼ˆé€‰ä¸¾è¿›è¡Œä¸­ï¼‰çŠ¶æ€ï¼Œé¦–å…ˆæ¯ä¸ªèŠ‚ç‚¹æŠ•è‡ªå·±ä¸€ç¥¨ï¼ˆæ¨ä¸¾è‡ªå·±ä¸ºå€™é€‰Leaderï¼‰ã€‚èŠ‚ç‚¹ä¹‹é—´äº¤æ¢æŠ•ç¥¨ï¼Œæ ¹æ®æ—¢å®šè§„åˆ™æ¯”è¾ƒå€™é€‰è€…èµ„æ ¼ï¼š é¦–å…ˆæ¯”å¯¹ Epochï¼ˆè½®æ¬¡è¾ƒå¤§çš„ä¼˜å…ˆï¼Œè¿™æ˜¯ä¸ºäº†é˜²æ­¢è¿‡æœŸçš„æŠ•ç¥¨å¹²æ‰°ï¼‰ï¼›å¦‚æœ Epoch ç›¸åŒï¼Œåˆ™æ¯”è¾ƒ ZXIDï¼ˆæ•°æ®æ›´æ–°è¶Šæ–°çš„èŠ‚ç‚¹ä¼˜å…ˆï¼Œæ„å‘³ç€å®ƒæ‹¥æœ‰â€œæœ€æ–°â€çš„é›†ç¾¤çŠ¶æ€ï¼‰ï¼›å¦‚æœ ZXID ä¹Ÿç›¸åŒï¼Œå†æ¯”è¾ƒ myidï¼ˆIDæ•°å€¼æ›´å¤§çš„èŠ‚ç‚¹ä¼˜å…ˆï¼‰ã€‚ç»è¿‡å¤šè½®æ¯”è¾ƒå’ŒæŠ•ç¥¨äº¤æ¢åï¼Œä¸€æ—¦æŸä¸ªå€™é€‰è€…è·å¾—è¶…è¿‡åŠæ•°èŠ‚ç‚¹çš„è®¤å¯ï¼ˆè¿™å°±æ˜¯ ZooKeeper è¦æ±‚é›†ç¾¤èŠ‚ç‚¹æ•°ä¸ºå¥‡æ•°çš„åŸå› ï¼šè¶…è¿‡åŠæ•°å³ä¸¥æ ¼å¤šæ•°ï¼‰ï¼Œè¯¥å€™é€‰è€…å°±å½“é€‰ä¸º Leader ã€‚é€‰ä¸¾å®Œæˆåï¼Œé›†ç¾¤çŠ¶æ€æ›´æ–°ï¼šèƒœå‡ºèŠ‚ç‚¹åˆ‡æ¢ä¸º LEADING çŠ¶æ€æˆä¸º Leaderï¼Œå…¶ä»–èŠ‚ç‚¹åˆ‡æ¢ä¸º FOLLOWING çŠ¶æ€æˆä¸ºè¿½éšè€…ï¼Œå¼€å§‹ä»æ–°LeaderåŒæ­¥æ•°æ®ã€‚ </p>
<p>é€šè¿‡ä¸Šè¿°è¿‡ç¨‹ï¼ŒZooKeeper ä¿è¯äº†åœ¨ä»»æ„æ—¶åˆ»åªæœ‰ä¸€ä¸ª Leaderï¼Œå¹¶ä¸”è‡³å°‘æœ‰åŠæ•°èŠ‚ç‚¹ä¿å­˜äº†æœ€æ–°çš„æ•°æ®æ—¥å¿—å‰¯æœ¬ã€‚å½“å®¢æˆ·ç«¯å‘èµ·å†™è¯·æ±‚æ—¶ï¼ŒLeader å°†è¯·æ±‚ä»¥äº‹åŠ¡Proposalå½¢å¼å¹¿æ’­ç»™æ‰€æœ‰ Followerï¼Œæ”¶é›†è¿‡åŠç¡®è®¤åæäº¤äº‹åŠ¡ï¼ˆè¿™å°±æ˜¯ Zab åè®®çš„æ ¸å¿ƒæ€æƒ³ï¼‰ã€‚å¦‚æœ Leader å´©æºƒï¼Œåªè¦å¤§å¤šæ•°èŠ‚ç‚¹ä»å¥åœ¨ï¼Œå°±èƒ½é€‰å‡ºæ–° Leader å¹¶ç»§ç»­æä¾›æœåŠ¡ã€‚è¿™ä¹Ÿè§£é‡Šäº†ä¸ºä»€ä¹ˆæˆ‘ä»¬å¸¸è§çš„ ZooKeeper é›†ç¾¤ç”± 3 æˆ– 5 å°æœºå™¨ç»„æˆâ€”â€”3å°å¯å®¹å¿1å°æ•…éšœï¼Œ5å°å¯å®¹å¿2å°æ•…éšœï¼Œè€Œä»æœ‰è¿‡åŠèŠ‚ç‚¹å­˜æ´»ä¿è¯æœåŠ¡ä¸é—´æ–­ã€‚æ€»ä¹‹ï¼ŒZooKeeper çš„é€‰ä¸»ç®—æ³•ä¸ºåˆ†å¸ƒå¼ç³»ç»Ÿæä¾›äº†å¼ºä¸€è‡´æ€§çš„åŸºç¡€ï¼Œåœ¨é¢„å‘å¸ƒç¯å¢ƒä¸­éƒ¨ç½² ZooKeeper é›†ç¾¤èƒ½çœŸå®æ¨¡æ‹Ÿç”Ÿäº§ä¸­çš„æ•…éšœåˆ‡æ¢è¡Œä¸ºï¼Œç¡®ä¿å†…å®¹æ£€ç´¢å¹³å°å„ç»„ä»¶çš„åè°ƒæœºåˆ¶åœ¨å‘å¸ƒå‰å¾—åˆ°å……åˆ†éªŒè¯ã€‚</p>
<h2>Python æ‰¹é‡å†™å…¥ Cassandra ç¤ºä¾‹</h2>
<p>é¢„å‘å¸ƒç¯å¢ƒé€šå¸¸éœ€è¦æ„é€ æµ‹è¯•æ•°æ®ã€‚ä¸‹é¢é€šè¿‡ Python å’Œ Cassandra é©±åŠ¨å®ç°å‘ Cassandra æ‰¹é‡å†™å…¥æ•°æ®çš„ç¤ºä¾‹ã€‚æˆ‘ä»¬å‡è®¾ Cassandra å·²æœ‰åä¸º test_keyspace çš„é”®ç©ºé—´å’Œé€‚å½“çš„è¡¨ç»“æ„ï¼ˆå¦‚æœæ²¡æœ‰ï¼Œå¯å…ˆåˆ›å»ºè¡¨ï¼‰ã€‚ä»£ç ä½¿ç”¨ DataStax Cassandra Python Driver æ‰§è¡Œæ‰¹é‡æ’å…¥æ“ä½œï¼š</p>
<blockquote><code>from cassandra.cluster import Cluster</code><br>
<code>from cassandra.query import BatchStatement, ConsistencyLevel</code><br>
<code></code><br>
<code># è¿æ¥ Cassandra é›†ç¾¤ï¼ˆé¢„å‘å¸ƒç¯å¢ƒé€šå¸¸åœ¨æœ¬åœ°æˆ–å†…ç½‘ï¼‰</code><br>
<code>cluster = Cluster([&#039;127.0.0.1&#039;])</code><br>
<code>session = cluster.connect(&#039;test_keyspace&#039;)</code><br>
<code></code><br>
<code># å¦‚æœç›®æ ‡è¡¨ä¸å­˜åœ¨ï¼Œå¯ä»¥å…ˆåˆ›å»º</code><br>
<code># ... (26 more lines)</code></blockquote>
<p><em>Full code available in the <a href="https://github.com/geyuxu">GitHub repository</a>.</em></p><p>ä¸Šè¿°è„šæœ¬é¦–å…ˆè¿æ¥åˆ° Cassandraï¼ˆå‡å®šåœ¨æœ¬æœº 9042 ç«¯å£ï¼‰ï¼Œç„¶åé€šè¿‡ BatchStatement å°†å¤šæ¡æ’å…¥è¯­å¥æ‰“åŒ…åœ¨ä¸€èµ·å‘é€ï¼Œæé«˜æ’å…¥æ•ˆç‡ã€‚æˆ‘ä»¬è®¾ç½®äº†ä¸€è‡´æ€§çº§åˆ«ä¸º QUORUMï¼Œè¡¨ç¤ºéœ€è¦å¤šæ•°å‰¯æœ¬ç¡®è®¤å†™å…¥ã€‚è¿™åœ¨é¢„å‘å¸ƒç¯å¢ƒå¯ä»¥å¸®åŠ©æµ‹è¯•ä¸åŒä¸€è‡´æ€§çº§åˆ«ä¸‹çš„æ€§èƒ½å’Œè¡Œä¸ºã€‚æ‰§è¡ŒæˆåŠŸåï¼ŒCassandra ä¸­å°†æ‰¹é‡å†™å…¥ä¸‰æ¡è®°å½•ã€‚åœ¨å®é™…åº”ç”¨ä¸­ï¼Œå¦‚æµ‹è¯•æ•°æ®è¾ƒå¤šï¼Œä¹Ÿå¯ä»¥è€ƒè™‘ä½¿ç”¨ å¼‚æ­¥æ’å…¥ æˆ–å®˜æ–¹æä¾›çš„ cqlsh COPYã€DSBulk å·¥å…·æ¥å¯¼å…¥å¤§è§„æ¨¡æ•°æ® ã€‚</p>
<h2>Python æ‰¹é‡æ›´æ–° Solr ç¤ºä¾‹</h2>
<p>æœ‰äº†æ•°æ®å­˜å‚¨ï¼Œä¸‹ä¸€æ­¥é€šå¸¸éœ€è¦å°†æ•°æ®ç´¢å¼•åˆ° SolrCloud ä»¥ä¾›æ£€ç´¢ã€‚ä¸‹é¢æä¾›ä¸€ä¸ª Python è„šæœ¬ç¤ºä¾‹ï¼Œé€šè¿‡ Solr çš„ HTTP æ¥å£å®ç° æ‰¹é‡æ›´æ–°ç´¢å¼•ï¼ˆæ·»åŠ æ–‡æ¡£ï¼‰ã€‚è¿™é‡Œä½¿ç”¨ Python çš„ requests åº“ç›´æ¥å‘ Solr æäº¤ JSON æ–‡æ¡£ï¼š</p>
<blockquote><code>import requests, json</code><br>
<code></code><br>
<code># å¾…ç´¢å¼•çš„æ–‡æ¡£åˆ—è¡¨ï¼Œæ¯ä¸ªæ–‡æ¡£æ˜¯ä¸€ä¸ªå­—å…¸</code><br>
<code>docs = [</code><br>
<code>    {&quot;id&quot;: &quot;1&quot;, &quot;title&quot;: &quot;Hello&quot;, &quot;content&quot;: &quot;ä¸–ç•Œä½ å¥½&quot;},</code><br>
<code>    {&quot;id&quot;: &quot;2&quot;, &quot;title&quot;: &quot;Foo&quot;, &quot;content&quot;: &quot;Bar å†…å®¹&quot;}</code><br>
<code>]</code><br>
<code></code><br>
<code># Solr æ›´æ–°æ¥å£URLï¼Œå‡è®¾é›†åˆåç§°ä¸º my_collection</code><br>
<code>solr_url = &quot;http://localhost:8983/solr/my_collection/update?commit=true&quot;</code><br>
<code>headers = {&quot;Content-Type&quot;: &quot;application/json&quot;}</code><br>
<code></code><br>
<code># å‘é€ POST è¯·æ±‚æ‰¹é‡æäº¤æ–‡æ¡£</code><br>
<code>response = requests.post(solr_url, data=json.dumps(docs), headers=headers)</code><br>
<code>print(&quot;Response:&quot;, response.status_code, response.text)</code></blockquote><p>åœ¨è¿è¡Œæ­¤è„šæœ¬ä¹‹å‰ï¼Œéœ€è¦ç¡®ä¿ SolrCloud é›†ç¾¤ä¸­å·²ç»åˆ›å»ºäº†åä¸º my_collection çš„é›†åˆï¼ˆcollectionï¼‰ï¼Œå¹¶ä¸”å…·æœ‰ç›¸åº”çš„å­—æ®µæ¨¡å¼ä»¥æ¥å— title å’Œ content ç­‰å­—æ®µã€‚å¦‚æœé›†åˆå°šæœªåˆ›å»ºï¼Œå¯ä»¥é€šè¿‡ Solr æä¾›çš„å‘½ä»¤å¿«é€Ÿåˆ›å»ºä¸€ä¸ªï¼Œä¾‹å¦‚åœ¨å®¹å™¨ä¸­æ‰§è¡Œï¼š</p>
<p><code>docker exec -it solr1 solr create -c my_collection -n data_driven_schema_configs</code></p><p>ä¸Šè¿°å‘½ä»¤å°†åœ¨ ZooKeeper åè°ƒä¸‹åˆ›å»ºä¸€ä¸ªåä¸º â€œmy_collectionâ€çš„æ–°é›†åˆï¼Œä½¿ç”¨å†…ç½®çš„ data_driven_schema_configs é»˜è®¤é…ç½®ã€‚åˆ›å»ºå®Œæˆåï¼Œè¿è¡Œ Python è„šæœ¬å³å¯å°† docs åˆ—è¡¨ä¸­çš„æ–‡æ¡£æ‰¹é‡æäº¤ç»™ Solr ç´¢å¼•ã€‚æˆ‘ä»¬åœ¨è¯·æ±‚URLä¸­é™„åŠ äº† commit=trueï¼Œè®©Solråœ¨æ›´æ–°åç«‹å³æäº¤ï¼Œä½¿æ–‡æ¡£å¯æœç´¢ã€‚æäº¤æˆåŠŸåï¼ŒSolr è¿”å›çŠ¶æ€ç ä»¥åŠç®€è¦ç»“æœä¿¡æ¯ï¼ˆé€šå¸¸ä¸ºç©ºæˆ–åŒ…å«æ›´æ–°çš„æ–‡æ¡£æ•°é‡ï¼‰ã€‚æ‰¹é‡æ›´æ–°æ¥å£ä¸€æ¬¡å¯ä»¥æäº¤å¤šä¸ªæ–‡æ¡£ï¼ŒSolr ä¼šå°†è¿™äº›æ–‡æ¡£è·¯ç”±åˆ°å„è‡ªæ‰€å±çš„åˆ†ç‰‡å¹¶å»ºç«‹ç´¢å¼• ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæˆ‘ä»¬èƒ½å¤Ÿåœ¨é¢„å‘å¸ƒç¯å¢ƒæ‰¹é‡æ„å»ºç´¢å¼•æ•°æ®ï¼Œä»¥æ¨¡æ‹ŸçœŸå®æœç´¢åœºæ™¯ã€‚</p>
<h2>Python ç®€æ˜“å¥åº·æ£€æŸ¥è„šæœ¬</h2>
<p>é¢„å‘å¸ƒç¯å¢ƒéƒ¨ç½²å®Œæˆåï¼Œè¿›è¡Œå¥åº·æ£€æŸ¥éå¸¸é‡è¦ã€‚ä»¥ä¸‹æä¾›ä¸€ä¸ª Python ç¼–å†™çš„ç®€å•å¥åº·æ£€æŸ¥è„šæœ¬ï¼Œå®ƒä¾æ¬¡æ£€æµ‹ Cassandraã€Solr å’Œ ZooKeeper ä¸‰ä¸ªæœåŠ¡æ˜¯å¦æ­£å¸¸å“åº”ï¼š</p>
<blockquote><code>import socket</code><br>
<code></code><br>
<code>services = {</code><br>
<code>    &quot;Cassandra&quot;: (&quot;localhost&quot;, 9042),</code><br>
<code>    &quot;Solr&quot;:      (&quot;localhost&quot;, 8983),</code><br>
<code>    &quot;ZooKeeper&quot;: (&quot;localhost&quot;, 2181)</code><br>
<code>}</code><br>
<code></code><br>
<code># ... (19 more lines)</code></blockquote>
<p><em>Full code available in the <a href="https://github.com/geyuxu">GitHub repository</a>.</em></p><p>è¿™ä¸ªè„šæœ¬é€šè¿‡å°è¯•å»ºç«‹ TCP è¿æ¥æ¥åˆ¤æ–­æœåŠ¡ç«¯å£æ˜¯å¦å¼€æ”¾ã€‚å…¶ä¸­å¯¹ ZooKeeperï¼Œæˆ‘ä»¬å‘é€äº†ç‰¹æ®Šçš„å››å­—å‘½ä»¤ â€œruokâ€ï¼ˆæ„ä¸ºâ€œAre you okâ€ï¼‰å¹¶æœŸæœ›æ”¶åˆ° â€œimokâ€ å“åº”ï¼Œè¡¨æ˜ ZooKeeper è¿è½¬æ­£å¸¸ã€‚å¦‚æœ ZooKeeper æ²¡æœ‰å¯ç”¨å››å­—å‘½ä»¤ï¼Œå¯èƒ½ä¸ä¼šè¿”å›ä»»ä½•æ•°æ®ï¼ˆåœ¨æ–°ç‰ˆæœ¬ä¸­éœ€é…ç½® ZOO_4LW_COMMANDS_WHITELIST æ¥å¼€æ”¾è¯¥å‘½ä»¤ï¼‰ã€‚å¯¹äº Cassandra å’Œ Solrï¼Œæˆ‘ä»¬ä»…æµ‹è¯•ç«¯å£è¿é€šæ€§ï¼šèƒ½è¿æ¥åˆ° 9042 åˆ™è®¤ä¸º Cassandra å­˜æ´»ï¼Œèƒ½è¿æ¥åˆ° 8983 åˆ™è®¤ä¸º Solr æœåŠ¡æ­£å¸¸ã€‚å®é™…ç”Ÿäº§ä¸­å¯ä»¥è¿›ä¸€æ­¥é€šè¿‡æ‰§è¡ŒæŸ¥è¯¢æˆ–è¯·æ±‚ API æ¥éªŒè¯æ·±å±‚åŠŸèƒ½ï¼Œä¾‹å¦‚å¯¹ Cassandra æ‰§è¡Œä¸€ä¸ªç®€å•çš„ SELECTï¼Œå¯¹ Solr å‘ä¸€ä¸ªæŸ¥è¯¢è¯·æ±‚ç­‰ã€‚</p>
<p>è¿è¡Œä¸Šè¿°å¥åº·æ£€æŸ¥è„šæœ¬ï¼Œå¯å¿«é€Ÿå®šä½é¢„å‘å¸ƒç¯å¢ƒä¸­å“ªä¸ªç»„ä»¶å‡ºç°æ•…éšœã€‚ä¾‹å¦‚è¾“å‡º Solr check failed: [Errno 111] Connection refused åˆ™è¯´æ˜ Solr æ²¡æœ‰å¯åŠ¨æˆ–ç«¯å£æœªå¼€æ”¾ï¼›è‹¥ ZooKeeper è¿”å›éâ€œimokâ€åˆ™éœ€æ£€æŸ¥å…¶æ˜¯å¦è¿›å…¥æ­£ç¡®çŠ¶æ€ã€‚é€šè¿‡è¿™æ ·çš„è„šæœ¬ï¼Œè¿ç»´äººå‘˜å¯ä»¥å®šæœŸæ£€æµ‹é¢„å‘å¸ƒé›†ç¾¤çŠ¶æ€ï¼Œåœ¨é—®é¢˜æ‰©å¤§å‰åŠæ—¶å¹²é¢„ã€‚</p>
<h2>Docker Compose é›†ç¾¤éƒ¨ç½²ç¤ºä¾‹</h2>
<p>æœ‰äº†å¯¹åŸç†çš„ç†è§£ï¼Œæˆ‘ä»¬å¯ä»¥ç€æ‰‹åœ¨é¢„å‘å¸ƒç¯å¢ƒéƒ¨ç½²ä¸€ä¸ªè¿·ä½ ç‰ˆçš„å†…å®¹æ£€ç´¢å¹³å°é›†ç¾¤ã€‚è¿™é‡Œä½¿ç”¨ Docker Compose ä¸€é”®å¯åŠ¨ ZooKeeper + SolrCloud + Cassandra é›†ç¾¤ï¼Œä»¥æ¨¡æ‹Ÿç”Ÿäº§ç¯å¢ƒçš„åˆ†å¸ƒå¼æ¶æ„ã€‚ä¸‹é¢æ˜¯å®Œæ•´çš„ docker-compose.yml ç¤ºä¾‹ï¼š</p>
<blockquote><code>version: &#039;3&#039;</code><br>
<code>services:</code><br>
<code>  # ZooKeeper é›†ç¾¤ï¼ˆ3ä¸ªèŠ‚ç‚¹ï¼‰</code><br>
<code>  zoo1:</code><br>
<code>    image: zookeeper:3.8</code><br>
<code>    container_name: zoo1</code><br>
<code>    hostname: zoo1</code><br>
<code>    ports:</code><br>
<code># ... (88 more lines)</code></blockquote>
<p><em>Full code available in the <a href="https://github.com/geyuxu">GitHub repository</a>.</em></p><p>ä¸Šè¿° Compose æ–‡ä»¶å®šä¹‰äº†ä¸‰ä¸ª ZooKeeper å®¹å™¨ï¼ˆzoo1ã€zoo2ã€zoo3ï¼‰ã€ä¸‰ä¸ª Solr å®¹å™¨ï¼ˆç»„æˆä¸€ä¸ª SolrCloud é›†ç¾¤ï¼‰ï¼Œä»¥åŠä¸‰ä¸ª Cassandra å®¹å™¨ï¼ˆç»„æˆä¸€ä¸ª Cassandra é›†ç¾¤ï¼‰ã€‚å…³é”®é…ç½®è¯´æ˜ï¼š</p>
<ul>
<li>ZooKeeperï¼šé€šè¿‡ ZOO_MY_ID å’Œ ZOO_SERVERS ç¯å¢ƒå˜é‡é…ç½®é›†ç¾¤ã€‚è¿™é‡Œå°†æ¯ä¸ªèŠ‚ç‚¹çš„ ID åˆ†åˆ«è®¾ä¸º1ã€2ã€3ï¼Œå¹¶å‘Šè¯‰æ¯ä¸ªå®¹å™¨é›†ç¾¤å†…æ‰€æœ‰ ZooKeeper çš„åœ°å€å’Œç«¯å£ã€‚è¿™æ ·ä¸‰ä¸ªå®¹å™¨å¯åŠ¨åä¼šç›¸äº’å‘ç°å¹¶é€‰ä¸¾å‡º Leaderã€‚æˆ‘ä»¬æ˜ å°„äº† zoo1 çš„ 2181 ç«¯å£åˆ°ä¸»æœºï¼Œä»¥ä¾¿å¤–éƒ¨å·¥å…·ï¼ˆä¾‹å¦‚ zkCli.sh æˆ–å¥åº·æ£€æŸ¥è„šæœ¬ï¼‰å¯ä»¥è¿æ¥ ZooKeeper é›†ç¾¤ã€‚depends_on ç¡®ä¿ zoo2,zoo3 åœ¨ zoo1 ä¹‹åå¯åŠ¨ï¼ˆä½†æ³¨æ„è¿™å¹¶ä¸ä¿è¯å¯åŠ¨é¡ºåºå®Œå…¨æŒ‰é¢„æœŸæˆ– ZooKeeper å·²ç»å‡†å¤‡å°±ç»ªï¼Œå¿…è¦æ—¶å¯åŠ å…¥å¥åº·æ£€æŸ¥æœºåˆ¶ï¼‰ã€‚</li>
<li>SolrCloudï¼šæ¯ä¸ª Solr å®ä¾‹å¯åŠ¨æ—¶é€šè¿‡ ZK_HOST æŒ‡å®š ZooKeeper é›†ç¾¤åœ°å€åˆ—è¡¨ï¼Œä½¿å…¶åŠ å…¥ SolrCloudã€‚æˆ‘ä»¬å¼€æ”¾äº† solr1 çš„ 8983 ç«¯å£ä»¥è®¿é—® Web ç®¡ç†ç•Œé¢ï¼Œå…¶ä½™ Solr å®ä¾‹ä¸æ˜ å°„ç«¯å£ä½†ä»åœ¨å†…éƒ¨ç½‘ç»œä¸­ä¸ solr1 äº’é€šã€‚ä½¿ç”¨ depends_on ç¡®ä¿åœ¨å¯åŠ¨ Solr å®¹å™¨å‰ ZooKeeper å®¹å™¨å·²å¯åŠ¨ã€‚Solr é•œåƒé»˜è®¤ä¼šä»¥ Cloud æ¨¡å¼ (-c) è¿è¡Œï¼Œå› ä¸ºæä¾›äº† ZK_HOSTã€‚å½“æ‰€æœ‰ Solr èŠ‚ç‚¹å¯åŠ¨åï¼Œå®ƒä»¬ä¼šå…±åŒç»„æˆä¸€ä¸ª SolrCloud é›†ç¾¤ã€‚æ­¤æ—¶å¯ä»¥é€šè¿‡è®¿é—® <a href="http://localhost:8983/solr/">http://localhost:8983/solr/</a> æ‰“å¼€ Solr ç®¡ç†ç•Œé¢ï¼ŒæŸ¥çœ‹é›†ç¾¤çŠ¶æ€ã€åˆ›å»ºé›†åˆç­‰ã€‚</li>
<li>Cassandraï¼šé‡‡ç”¨å®˜æ–¹ Cassandra é•œåƒæ¥å¯åŠ¨ä¸‰ä¸ªèŠ‚ç‚¹ã€‚é€šè¿‡ CASSANDRA_SEEDS æˆ‘ä»¬æŒ‡å®šç§å­èŠ‚ç‚¹åœ°å€ä¸º cassandra1ï¼ˆç¬¬ä¸€ä¸ªèŠ‚ç‚¹è‡ªå·±ä½œä¸ºç§å­ï¼‰ï¼Œè¿™æ ·å…¶ä»–èŠ‚ç‚¹èƒ½å¤Ÿå‘ç°å¹¶åŠ å…¥é›†ç¾¤  ã€‚æ‰€æœ‰èŠ‚ç‚¹è®¾ç½®ç›¸åŒçš„ CASSANDRA_CLUSTER_NAME ç¡®ä¿å±äºåŒä¸€é›†ç¾¤ã€‚è¿™é‡Œä½¿ç”¨ GossipingPropertyFileSnitchï¼ˆé»˜è®¤ï¼‰ä½¿æ‰€æœ‰èŠ‚ç‚¹è§†ä¸ºåŒä¸€æ•°æ®ä¸­å¿ƒã€‚å¦‚æœéœ€è¦å¤šæ•°æ®ä¸­å¿ƒæ¨¡æ‹Ÿï¼Œå¯è°ƒæ•´å¯¹åº”çš„ DC åç§°å’Œç­–ç•¥ã€‚depends_on ç¡®ä¿åä¸¤ä¸ªèŠ‚ç‚¹åœ¨ç§å­èŠ‚ç‚¹å¯åŠ¨åå†å¯åŠ¨ï¼Œä»¥é¿å…åŒæ—¶åˆå§‹åŒ–å¯¼è‡´çš„ token å†²çªé—®é¢˜ ã€‚å¯åŠ¨åå‡ åˆ†é’Ÿå†…ï¼ŒCassandra é›†ç¾¤ä¼šå®Œæˆè‡ªåŠ¨å‘ç°ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ docker exec -it cassandra1 nodetool status å‘½ä»¤æŸ¥çœ‹é›†ç¾¤çŠ¶æ€ï¼Œæ¯ä¸ªèŠ‚ç‚¹åº”æ˜¾ç¤ºä¸º UN (Up/Normal) ä¸”æ¡æœ‰å‡åŒ€çš„ Token Rangeã€‚</li>
</ul>
<p>å®Œæˆ Compose æ–‡ä»¶åï¼Œè¿è¡Œ docker-compose up -d å³å¯åœ¨åå°å¯åŠ¨æ•´ä¸ªé¢„å‘å¸ƒé›†ç¾¤ã€‚è¯·è€å¿ƒç­‰å¾…æ‰€æœ‰å®¹å™¨å®Œæˆå¯åŠ¨ï¼šå¯ä»¥é€šè¿‡ docker-compose logs -f åŠ¨æ€è·Ÿè¸ªæ—¥å¿—ã€‚å½“ Solr æ—¥å¿—å‡ºç° â€œStarted Solr serverâ€ å­—æ ·ï¼ŒCassandra æ—¥å¿—å‡ºç° â€œStartup completeâ€ï¼ŒZooKeeper æ—¥å¿—å‡ºç° â€œNode is leaderâ€ æˆ– â€œNode is followerâ€ æ—¶ï¼Œè¯´æ˜å„æœåŠ¡å‡å·²å°±ç»ªã€‚</p>
<h2>å¸¸è§é”™è¯¯åŠæ’æŸ¥</h2>
<p>åœ¨é¢„å‘å¸ƒç¯å¢ƒæ­å»ºè¿‡ç¨‹ä¸­ï¼Œå¯èƒ½ä¼šé‡åˆ°ä¸€äº›å¸¸è§é—®é¢˜ã€‚ä»¥ä¸‹åˆ—å‡ºå…¸å‹é”™è¯¯åœºæ™¯ï¼Œå¹¶æä¾›è¯¦ç»†çš„æ’æŸ¥æ­¥éª¤ï¼š</p>
<ul>
<li>Solr æ— æ³•è¿æ¥ ZooKeeperï¼šå¦‚æœåœ¨ Solr æ—¥å¿—ä¸­çœ‹åˆ°æŠ¥é”™ Could not connect to ZooKeeper ... within ... msï¼Œè¯´æ˜ Solr åœ¨æŒ‡å®šæ—¶é—´å†…æ— æ³•è¿ä¸Š ZooKeeper  ã€‚è¿™å¯èƒ½æ˜¯ ZooKeeper å°šæœªå¯åŠ¨å®Œæˆæˆ– ZK_HOST é…ç½®ä¸æ­£ç¡®ã€‚æ’æŸ¥ï¼šé¦–å…ˆæ‰§è¡Œ docker-compose logs -f zoo1 æ£€æŸ¥ ZooKeeper æ—¥å¿—æ˜¯å¦æ­£å¸¸ï¼ˆåº”æœ‰ Leader é€‰ä¸¾ç»“æœå’Œ ç»‘å®šç«¯å£2181 ç­‰ä¿¡æ¯ï¼‰ã€‚ç„¶åç¡®è®¤åœ¨ Solr å®¹å™¨å†…èƒ½è§£æåˆ° zoo1,zoo2,zoo3 ä¸»æœºåï¼ˆä¾‹å¦‚ docker exec solr1 ping zoo1ï¼‰ã€‚è‹¥åç§°è§£ææœ‰é—®é¢˜ï¼Œå¯åœ¨ Compose ä¸­æ˜¾å¼æŒ‡å®š networks æˆ–ä½¿ç”¨ linksã€‚å¦‚æœåªæ˜¯å¯åŠ¨é¡ºåºå¯¼è‡´ï¼Œå¯ä»¥å°è¯•é‡å¯ Solr å®¹å™¨ï¼šdocker-compose restart solr1 solr2 solr3ã€‚è¿˜å¯ä»¥åœ¨ Compose æ–‡ä»¶ä¸­ä¸º ZooKeeper å¢åŠ å¥åº·æ£€æŸ¥ï¼Œç¡®ä¿å…¶å®Œå…¨å°±ç»ªåå†å¯åŠ¨ Solrï¼ˆé€šè¿‡ depends_on çš„ condition: service_healthy è®¾ç½®ï¼‰ã€‚æ­£å¸¸æƒ…å†µä¸‹ï¼ŒSolr Admin UI æ‰“å¼€åï¼Œåœ¨ â€œCloud -&gt; Graphâ€ èƒ½çœ‹åˆ° ZooKeeper çŠ¶æ€åŠé›†ç¾¤æ‹“æ‰‘ã€‚</li>
<li>Solr é›†ç¾¤æ²¡æœ‰ Leaderï¼šåˆ›å»º collection æ—¶æç¤º â€œno active leaderâ€ æˆ–æŸ¥è¯¢è¿”å›éƒ¨åˆ†åˆ†ç‰‡æ— ç»“æœã€‚è¿™é€šå¸¸ç”±äº SolrCloud å°šæœªé€‰ä¸¾å®Œå„åˆ†ç‰‡çš„ leader å‰¯æœ¬ã€‚æ’æŸ¥ï¼šé€šè¿‡ Solr ç®¡ç†ç•Œé¢çš„ â€œCloud -&gt; Treeâ€ æˆ–è°ƒç”¨ Collections API çš„ CLUSTERSTATUS æŸ¥çœ‹é›†åˆçŠ¶æ€ï¼Œç¡®è®¤æ¯ä¸ª shard ä¸‹éƒ½æœ‰ä¸€ä¸ª &quot;leader&quot;:true çš„å‰¯æœ¬ã€‚å¦‚æœæ²¡æœ‰ï¼Œæ£€æŸ¥ ZooKeeper é›†ç¾¤çŠ¶æ€å’Œ Solr æ—¥å¿—ä¸­çš„é€‰ä¸»è¿‡ç¨‹ã€‚å¦‚æœ ZooKeeper é›†ç¾¤æœ¬èº«ä¸ç¨³å®šï¼ˆä¾‹å¦‚å°‘äºè¿‡åŠèŠ‚ç‚¹å­˜æ´»ï¼‰ï¼Œä¼šå¯¼è‡´ Solr æ— æ³•å®Œæˆå†…éƒ¨é€‰ä¸»ã€‚æ­¤æ—¶éœ€ç¡®ä¿ ZooKeeper è‡³å°‘æœ‰è¿‡åŠèŠ‚ç‚¹è¿è¡Œï¼Œå¹¶é‡å¯å¤±è”çš„ Solr å‰¯æœ¬ã€‚é€šå¸¸åœ¨é¢„å‘å¸ƒç¯å¢ƒï¼Œé‡å¯ SolrCloud æˆ–ç­‰å¾…æ•°ç§’éƒ½èƒ½é‡æ–°é€‰å‡º leaderã€‚</li>
<li>Cassandra èŠ‚ç‚¹æœªæˆåŠŸåŠ å…¥é›†ç¾¤ï¼šè¿è¡Œ nodetool status å‘ç°æ¯å° Cassandra åªæ˜¾ç¤ºè‡ªèº«ï¼Œæ²¡å‘ç°å…¶ä»–èŠ‚ç‚¹ï¼Œæˆ–è€…æ—¥å¿—å‡ºç°é›†ç¾¤åç§°ä¸åŒ¹é…çš„é”™è¯¯ã€‚æ’æŸ¥ï¼šé¦–å…ˆç¡®ä¿æ‰€æœ‰ Cassandra å®¹å™¨ä½¿ç”¨ç›¸åŒçš„ CASSANDRA_CLUSTER_NAMEï¼ˆå¦‚ä¸ä¸€è‡´ï¼Œä¼šæ‹’ç»è¿æ¥ï¼‰ã€‚å…¶æ¬¡ï¼Œæ£€æŸ¥ CASSANDRA_SEEDS é…ç½®ï¼šåº”è®©è‡³å°‘ä¸€ä¸ªèŠ‚ç‚¹ï¼ˆé€šå¸¸ç¬¬ä¸€ä¸ªï¼‰ä½œä¸ºç§å­ï¼Œå…¶ä»–èŠ‚ç‚¹é…ç½®ç§å­åˆ—è¡¨åŒ…å«å®ƒã€‚å¦‚æœç§å­é…ç½®æ­£ç¡®ä½†ä»æœªäº’è”ï¼Œå¯èƒ½æ˜¯ç”±äº Compose åŒæ—¶å¯åŠ¨å¤šä¸ª Cassandra å¯¼è‡´åˆå§‹ token å†²çª ã€‚è§£å†³æ–¹æ³•ï¼šç¡®ä¿ç¬¬ä¸€ä¸ªèŠ‚ç‚¹å®Œå…¨å¯åŠ¨åå†å¯åŠ¨å…¶ä½™èŠ‚ç‚¹ï¼ˆCompose ä¸­å·²ç”¨ depends_onï¼Œä½†é¦–æ¬¡å¹¶è¡Œå¯åŠ¨æ—¶ä»å¯èƒ½ç«äº‰ï¼Œå¿…è¦æ—¶æ‰‹åŠ¨åˆ†ä¸¤æ­¥å¯åŠ¨ï¼‰ã€‚ä¹Ÿå¯ä»¥æ˜¾å¼æŒ‡å®šæ¯ä¸ªèŠ‚ç‚¹çš„åˆå§‹ token æ¥é¿å…å†²çªã€‚æ£€æŸ¥å®¹å™¨æ—¥å¿—ä¸­æœ‰æ²¡æœ‰ Unable to gossip with any seeds ç­‰æ¶ˆæ¯ã€‚å¦‚æœæœ‰ï¼Œé‡å¯å‡ºç°é—®é¢˜çš„èŠ‚ç‚¹å®¹å™¨ã€‚æœ€åï¼Œä½¿ç”¨ docker exec -it cassandra1 cqlsh è¿æ¥Cassandraï¼Œæ‰§è¡Œ SELECT peer, rpc_address FROM system.peers; æŸ¥çœ‹ç§å­èŠ‚ç‚¹çœ¼ä¸­å·²å‘ç°çš„é›†ç¾¤åŒä¼´åˆ—è¡¨ï¼Œç¡®è®¤æ‰€æœ‰èŠ‚ç‚¹äº’ç›¸å¯è§ã€‚</li>
<li>ZooKeeper é›†ç¾¤æ— æ³•é€‰ä¸¾ï¼šå¦‚æœ ZooKeeper æ—¥å¿—åå¤å‡ºç°é€‰ä¸¾å‘èµ·ä½†æ— æ³•æˆåŠŸï¼ˆä¾‹å¦‚ä¸åœè¾“å‡º LOOKING çŠ¶æ€ï¼‰ï¼Œå¤šæ•°æ˜¯å› ä¸º é›†ç¾¤èŠ‚ç‚¹æ•°ä¸è¶³å¤šæ•° å¯¼è‡´æ— æ³•å½¢æˆ quorumã€‚æ¯”å¦‚å¯åŠ¨äº†2ä¸ªèŠ‚ç‚¹å°±å°è¯•æä¾›æœåŠ¡ï¼Œä¼šå‘ç°æ²¡æœ‰è¿‡åŠç¥¨é€‰ä¸¾ä¸å‡º Leaderã€‚æ’æŸ¥ï¼šç¡®ä¿ ZooKeeper èŠ‚ç‚¹æ•°æ˜¯å¥‡æ•°ä¸”å…¨éƒ¨æ­£ç¡®å¯åŠ¨ã€‚å¦‚æœ‰èŠ‚ç‚¹å¯åŠ¨å¤±è´¥ï¼ˆæ£€æŸ¥å…¶æ—¥å¿—ï¼Œæœ‰æ— ç«¯å£å†²çªæˆ–é…ç½®é”™è¯¯ï¼‰ï¼Œå°½å¿«ä¿®å¤å¯åŠ¨ã€‚ä½¿ç”¨ ZooKeeper è‡ªå¸¦å‘½ä»¤è¡Œï¼šdocker exec -it zoo1 zkServer.sh status åˆ†åˆ«æŸ¥çœ‹å„èŠ‚ç‚¹çŠ¶æ€ï¼šæ­£å¸¸æƒ…å†µä¸‹åº”æœ‰ä¸€å°æ˜¾ç¤º leaderï¼Œå…¶ä½™æ˜¾ç¤º followerã€‚å¦‚æœéƒ½æ˜¾ç¤º standalone æˆ– lookingï¼Œåˆ™è¯´æ˜æ²¡é€‰å‡º Leaderã€‚æ­¤æ—¶æ ¸å¯¹ ZOO_MY_ID å’Œ ZOO_SERVERS é…ç½®æ˜¯å¦å¯¹åº”æ­£ç¡®â€”â€”æ¯ä¸ªå®¹å™¨çš„ myid å€¼å¿…é¡»å’Œåœ¨ ZOO_SERVERSåˆ—è¡¨ä¸­çš„ç¼–å·ä¸€è‡´ ã€‚å¦å¤–ï¼Œæ£€æŸ¥ç½‘ç»œäº’é€šï¼Œç¡®ä¿å®¹å™¨é—´çš„ 2888ã€3888 ç«¯å£å¯è¾¾ï¼ˆè¿™äº›æ˜¯é€‰ä¸¾é€šä¿¡ç«¯å£ï¼‰ã€‚çº æ­£é…ç½®æˆ–ç½‘ç»œé—®é¢˜åï¼Œé‡å¯ ZooKeeper å®¹å™¨è®©å®ƒä»¬é‡æ–°å‘èµ·é€‰ä¸¾ã€‚å¾…å…¶ä¸­ä¸€å°æ—¥å¿—å‡ºç° LEADING å¹¶æ‰“å° ZooKeeperå¯åŠ¨å®Œæˆçš„ä¿¡æ¯ï¼Œå³å‘Šé€‰ä¸»æˆåŠŸã€‚</li>
<li>æ•°æ®æ— æ³•æŒä¹…åŒ–ï¼ˆéæŠ¥é”™ä½†éœ€è¦æ³¨æ„ï¼‰ï¼šé»˜è®¤æƒ…å†µä¸‹ï¼Œä¸Šè¿° Docker Compose æœªå¯¹ Cassandra å’Œ Solr çš„æ•°æ®ç›®å½•åšæŒä¹…åŒ–æŒ‚è½½ï¼Œè¿™æ„å‘³ç€å®¹å™¨åˆ é™¤æˆ–é‡å»ºåæ•°æ®ä¼šä¸¢å¤±ï¼ˆZooKeeper çš„çŠ¶æ€ä¹Ÿä¼šé‡ç½®ï¼‰ã€‚åœ¨é¢„å‘å¸ƒç¯å¢ƒï¼Œç»å¸¸éœ€è¦åå¤é‡ç½®æ•°æ®å€’æ— å¦¨ï¼Œä½†å¦‚æœå¸Œæœ›æŒä¹…åŒ–æ•°æ®ä»¥è¿›è¡ŒæŒç»­æµ‹è¯•ï¼Œå»ºè®®ä¸ºå®ƒä»¬æŒ‚è½½å·ã€‚ä¾‹å¦‚åœ¨ cassandra1 æœåŠ¡ä¸‹æ·»åŠ  volumes: - ./data/cassandra1:/var/lib/cassandraï¼Œåœ¨ solr1 ä¸‹æ·»åŠ  volumes: - ./data/solr1:/var/solr. è¿™æ ·å®¹å™¨é‡å¯åæ•°æ®ä¾ç„¶ä¿ç•™ã€‚ä¸è¿‡ä¹Ÿè¦æ³¨æ„æŒ‚è½½å¯èƒ½å¼•å…¥çš„æƒé™é—®é¢˜ï¼Œå¯ä»¥åœ¨å¯åŠ¨å‰é¢„å…ˆè°ƒæ•´å®¿ä¸»æœºç›®å½•æƒé™æˆ–UID/GIDã€‚</li>
</ul>
<p>ä»¥ä¸Šæ’æŸ¥åœºæ™¯åŸºæœ¬è¦†ç›–äº†é¢„å‘å¸ƒç¯å¢ƒæ­å»ºä¸­å¸¸è§çš„é—®é¢˜ã€‚æ€»ç»“æ¥è¯´ï¼Œé‡åˆ°å¼‚å¸¸ä¸è¦æ…Œï¼Œå……åˆ†åˆ©ç”¨æ—¥å¿—å’Œå†…ç½®ç®¡ç†å·¥å…·ï¼Œé€ä¸€æ£€æŸ¥å„ç»„ä»¶çš„é…ç½®å’ŒçŠ¶æ€ï¼Œå†ç»“åˆå¯¹åŸç†çš„ç†è§£ï¼Œå³å¯å®šä½å¹¶è§£å†³é—®é¢˜ã€‚</p>
<h2>ç»éªŒæ€»ç»“</h2>
<p>æœ€åï¼Œæ ¹æ®å®è·µç»éªŒï¼Œæˆ‘ä»¬å¯¹é¢å‘å†…å®¹æ£€ç´¢å¹³å°çš„é¢„å‘å¸ƒç¯å¢ƒæ­å»ºç»™å‡ºä»¥ä¸‹æœ€ä½³å®è·µå’Œæ³¨æ„äº‹é¡¹ï¼š</p>
<ul>
<li>é…ç½®å°½é‡è´´è¿‘ç”Ÿäº§ï¼šé¢„å‘å¸ƒç¯å¢ƒåº”ä½¿ç”¨ä¸ç”Ÿäº§ç›¸åŒçš„è½¯ä»¶ç‰ˆæœ¬å’Œé…ç½®å‚æ•°ï¼ˆZooKeeper èŠ‚ç‚¹æ•°ã€Solråˆ†ç‰‡å‰¯æœ¬æ•°ã€Cassandraå¤åˆ¶å› å­ç­‰ï¼‰ã€‚åªæœ‰ç¯å¢ƒä¸€è‡´ï¼Œæµ‹è¯•ç»“æœæ‰æœ‰å‚è€ƒä»·å€¼ ã€‚ä¾‹å¦‚ç”Ÿäº§ Cassandra å‰¯æœ¬å› å­ä¸º3ï¼Œé¢„å‘å°½é‡ä¹Ÿéƒ¨ç½²3ä¸ªèŠ‚ç‚¹ä¿æŒ RF=3ï¼Œå¦åˆ™æŸäº›ä¸€è‡´æ€§çº§åˆ«åœ¨é¢„å‘ç¯å¢ƒæ— æ³•æ¨¡æ‹Ÿï¼ˆå¦‚ QUORUM åœ¨2èŠ‚ç‚¹é›†ç¾¤å°±é€€åŒ–æˆ ALLï¼‰ã€‚</li>
<li>åˆç†ç¼©å‡è§„æ¨¡ï¼šè™½è¦é…ç½®ä¸€è‡´ï¼Œä½†è§„æ¨¡å¯æ¯”ç”Ÿäº§å°ã€‚ ä¸€èˆ¬ä¸€ä¸ªæœºæ¶ä¸Šçš„æœ€å°é›†ç¾¤è§„æ¨¡å³å¯ï¼Œå¦‚ç”Ÿäº§ Solr æœ‰6å°12ä¸ªåˆ†ç‰‡ï¼Œé¢„å‘å¯ç”¨3å°å‡åŠåˆ†ç‰‡ï¼Œåœ¨ä¿è¯æ ¸å¿ƒæœºåˆ¶ï¼ˆåˆ†ç‰‡ã€å‰¯æœ¬ã€å®¹é”™ï¼‰æ¨¡æ‹Ÿåˆ°çš„åŒæ—¶èŠ‚çº¦èµ„æºã€‚åˆ‡å¿Œä¸ºäº†çœäº‹ç”¨å•èŠ‚ç‚¹å‡é›†ç¾¤ï¼Œé‚£æ ·å¾ˆå¤šåˆ†å¸ƒå¼é—®é¢˜ï¼ˆé€‰ä¸»ã€ç½‘ç»œåˆ†åŒºç­‰ï¼‰å°±æµ‹ä¸å‡ºæ¥äº†ã€‚</li>
<li>è‡ªåŠ¨åŒ–ä¸åŸºç¡€è®¾æ–½å³ä»£ç ï¼šä½¿ç”¨ Docker Composeã€Kubernetes æˆ– Terraform ç­‰å·¥å…·æ¥å®šä¹‰å’Œéƒ¨ç½²é¢„å‘å¸ƒç¯å¢ƒã€‚ä¸€é”®éƒ¨ç½²å‡å°‘äººä¸ºå¤±è¯¯ï¼Œä¹Ÿæ–¹ä¾¿ç¯å¢ƒçš„åå¤é”€æ¯é‡å»ºã€‚Compose æ–‡ä»¶ã€K8s YAMLç­‰æœ€å¥½ä¸ä»£ç ä»“åº“ä¸€èµ·ç®¡ç†ç‰ˆæœ¬ï¼Œç¡®ä¿å›¢é˜Ÿæˆå‘˜æ­å»ºå‡ºçš„ç¯å¢ƒä¸€è‡´ã€‚</li>
<li>æ•°æ®å‡†å¤‡ï¼šå°½å¯èƒ½ä½¿ç”¨è´´è¿‘çœŸå®çš„æ•°æ®è¿›è¡Œæµ‹è¯•ã€‚å¯ä»¥ä»çº¿ä¸Šè„±æ•æŠ½å–ä¸€éƒ¨åˆ†æ•°æ®å¯¼å…¥é¢„å‘ï¼Œä»¥ä¾¿åœ¨ç´¢å¼•é‡ã€æŸ¥è¯¢è´Ÿè½½ä¸Šå‘ç°æ½œåœ¨æ€§èƒ½é—®é¢˜ã€‚è‹¥æ— æ³•ä½¿ç”¨çœŸå®æ•°æ®ï¼Œä¹Ÿåº”æ„é€ è¾¹ç•Œæƒ…å†µçš„æ•°æ®ï¼ˆå¦‚è¶…é•¿æ–‡æœ¬ã€ç‰¹æ®Šå­—ç¬¦ï¼‰ä»¥æµ‹è¯•ç³»ç»Ÿå…¼å®¹æ€§ã€‚</li>
<li>å…³æ³¨ç³»ç»Ÿæ—¥å¿—ï¼šé¢„å‘å¸ƒç¯å¢ƒæ˜¯å‘ç°é—®é¢˜çš„æœ€ä½³æ—¶æœºï¼Œåº”å¯†åˆ‡å…³æ³¨å„ç»„ä»¶æ—¥å¿—ã€‚ç‰¹åˆ«æ˜¯ ZooKeeper æ—¥å¿—ï¼ˆè§‚å¯Ÿä¼šè¯æ–­è¿ã€é€‰ä¸¾å˜åŒ–ï¼‰ã€Solr æ—¥å¿—ï¼ˆç´¢å¼•æäº¤é”™è¯¯ã€GCè­¦å‘Šï¼‰ã€Cassandra æ—¥å¿—ï¼ˆhintå¤ªå¤šã€è¯»ä¿®å¤é¢‘ç¹ï¼‰ç­‰ã€‚å¦‚æœé¢„å‘ç¯å¢ƒæ—¥å¿—ä¸­å·²æœ‰å¼‚å¸¸æˆ–è­¦å‘Šï¼Œåœ¨ç”Ÿäº§ç¯å¢ƒå¾€å¾€ä¼šè¢«æ”¾å¤§ï¼Œéœ€åœ¨å‘å¸ƒå‰ä¿®å¤ã€‚</li>
<li>å®šæœŸæ¼”ç»ƒæ•…éšœï¼šåœ¨é¢„å‘ç¯å¢ƒå¯ä»¥ä¸»åŠ¨æ¼”ç»ƒä¸€äº›æ•…éšœï¼Œä»¥éªŒè¯ç³»ç»Ÿçš„è‡ªåŠ¨æ¢å¤èƒ½åŠ›ã€‚ä¾‹å¦‚æ€æ‰ä¸€ä¸ª Cassandra èŠ‚ç‚¹è§‚å¯Ÿè¯»å†™æ˜¯å¦æ­£å¸¸ï¼ˆæ ¹æ®ä¸€è‡´æ€§è®¾ç½®å¯èƒ½æœ‰çŸ­æš‚å¤±è´¥ï¼Œä½†åº”è¯¥åœ¨èŠ‚ç‚¹é‡å¯åè‡ªåŠ¨æ¢å¤å¹¶è¿›è¡Œ Hint Handoffï¼‰ï¼›åœæ­¢ Solr çš„ Leader å‰¯æœ¬çœ‹æŸ¥è¯¢æ˜¯å¦æ— æ„ŸçŸ¥åˆ‡æ¢åˆ°å‰¯æœ¬ã€æ–°Leaderé€‰ä¸¾æ˜¯å¦å¿«é€Ÿå®Œæˆï¼›æ¨¡æ‹Ÿç½‘ç»œåˆ†åŒºæµ‹è¯• ZooKeeper çš„è¡Œä¸ºï¼ˆå¯é€šè¿‡iptablesä¸´æ—¶é˜»æ–­éƒ¨åˆ†èŠ‚ç‚¹é€šä¿¡ï¼‰ã€‚é€šè¿‡æ¼”ç»ƒï¼Œè¿™äº›ç»„ä»¶åœ¨æ•…éšœåœºæ™¯ä¸‹çš„è¡¨ç°å’Œæ½œåœ¨å‘ç‚¹å°±èƒ½åœ¨é¢„å‘ä¸­äº†è§£åˆ°ï¼Œé¿å…ä¸Šçº¿åæªæ‰‹ä¸åŠã€‚</li>
<li>ç¡®ä¿å®‰å…¨éš”ç¦»ï¼šé¢„å‘å¸ƒç¯å¢ƒé€šå¸¸å¯¹æ ‡ç”Ÿäº§ï¼Œä½†ç»å¯¹ä¸èƒ½å½±å“ç”Ÿäº§ã€‚å› æ­¤åšå¥½éš”ç¦»å·¥ä½œï¼Œä¾‹å¦‚ä½¿ç”¨ä¸åŒçš„ç½‘ç»œ/VPCï¼Œé¿å…é¢„å‘çš„ ZooKeeper æˆ– Cassandra æ„å¤–åŠ å…¥ç”Ÿäº§é›†ç¾¤ã€‚æ•°æ®ä¸Šå¦‚æœå…±äº«äº†éƒ¨åˆ†ç”Ÿäº§æ•°æ®ï¼Œä¸€å®šè¦ä¸¥æ ¼æ§åˆ¶é¢„å‘ç¯å¢ƒå¯¹ç”Ÿäº§æ•°æ®çš„ä¿®æ”¹æƒé™ï¼ˆç†æƒ³æƒ…å†µä¸‹é¢„å‘åªè¯»ç”Ÿäº§å¿«ç…§ï¼‰ã€‚æ­¤å¤–ï¼Œä¸ºé˜²æ­¢è¯¯æ“ä½œï¼Œé¢„å‘å¸ƒå’Œç”Ÿäº§çš„è®¿é—®å…¥å£ã€ç®¡ç†è´¦å·åº”æœ‰æ˜æ˜¾åŒºåˆ†ã€‚</li>
<li>èµ„æºç›‘æ§ï¼šä¸è¦å› ä¸ºæ˜¯é¢„å‘å¸ƒå°±å¿½è§†ç›‘æ§ã€‚å»ºè®®éƒ¨ç½²åŸºæœ¬çš„ç›‘æ§å’Œå‘Šè­¦ï¼Œå¦‚èŠ‚ç‚¹CPU/å†…å­˜ã€Cassandra çš„ compaction å»¶è¿Ÿã€Solr JVM å†…å­˜ä½¿ç”¨ã€ZooKeeper å»¶æ—¶ç­‰ã€‚åœ¨é¢„å‘å¸ƒè§‚å¯Ÿè¿™äº›æŒ‡æ ‡çš„å˜åŒ–ï¼Œæœ‰åŠ©äºæå‰å‘ç°èµ„æºç“¶é¢ˆå¹¶è°ƒæ•´å‚æ•°ã€‚ä¾‹å¦‚é€šè¿‡é¢„å‘å‹æµ‹å‘ç° Solr Heap ä¸è¶³å¯¼è‡´é¢‘ç¹ GCï¼Œé‚£ä¹ˆä¸Šçº¿å‰å°±å¯è€ƒè™‘è°ƒå¤§å†…å­˜ã€‚</li>
</ul>
<p>é€šè¿‡ä»¥ä¸Šè¿™äº›å®è·µï¼Œé¢„å‘å¸ƒç¯å¢ƒå¯ä»¥æ›´å¥½åœ°å‘æŒ¥â€œç”Ÿäº§ç¯å¢ƒè¯•é‡‘çŸ³â€çš„ä½œç”¨ ï¼šæ—¢æ•è·åŠŸèƒ½å’Œæ€§èƒ½é—®é¢˜ï¼ŒåˆéªŒè¯ç³»ç»Ÿåœ¨å¼‚å¸¸æƒ…å†µçš„è¡¨ç°ï¼Œä¸ºæœ€ç»ˆä¸Šçº¿ä¿é©¾æŠ¤èˆªã€‚åœ¨æ­å»ºå’Œä½¿ç”¨é¢„å‘å¸ƒç¯å¢ƒçš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä¸æ–­ç§¯ç´¯ç»éªŒï¼Œå°†å…¶æ²‰æ·€ä¸ºæ–‡æ¡£å’Œè‡ªåŠ¨åŒ–è„šæœ¬ï¼Œä»è€Œè®©å›¢é˜Ÿåœ¨æœªæ¥çš„è¿­ä»£ä¸­æ›´é«˜æ•ˆã€æ›´å®‰å¿ƒåœ°äº¤ä»˜å†…å®¹æ£€ç´¢å¹³å°çš„æ–°åŠŸèƒ½ã€‚æ¯ä¸€æ¬¡åœ¨é¢„å‘å¸ƒç¯å¢ƒä¸­å‘ç°å¹¶è§£å†³çš„é—®é¢˜ï¼Œéƒ½æ˜¯åœ¨ç”Ÿäº§ç¯å¢ƒé¿å…ä¸€æ¬¡æ•…éšœçš„å®è´µæ”¶ç›Šã€‚å¸Œæœ›æœ¬æŒ‡å—èƒ½å¸®åŠ©ä½ é¡ºåˆ©æ­å»ºè‡ªå·±çš„é¢„å‘å¸ƒç¯å¢ƒï¼Œåœ¨å®æˆ˜ä¸­ä¸æ–­å®Œå–„ï¼Œæ‰“é€ å‡ºç¨³å¥å¯ä¾èµ–çš„å†…å®¹æ£€ç´¢å¹³å°ï¼</p>
<h2>å‚è€ƒèµ„æ–™ï¼š</h2>
<ul>
<li>Cassandra å®˜æ–¹æ–‡æ¡£ - Architecture - Dynamo-style Replication  </li>
<li>Apigee Docs - About Cassandra Replication Factor </li>
<li>Apache Solr Reference Guide - Shards and Indexing Data in SolrCloud  </li>
<li>CSDN åšå®¢ - SolrCloud è‡ªåŠ¨å®¹é”™æœºåˆ¶ </li>
<li>ZooKeeper èµ„æ–™ - Leader é€‰ä¸¾åŸç† </li>
<li>Stack Overflow è®¨è®º - Solr could not connect to ZooKeeper error</li>
</ul>

    </article>
    </main>
</div>

<script src="https://cdn.jsdelivr.net/npm/prismjs@1/prism.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/prismjs@1/components/prism-python.min.js"></script>
<script>
Prism.highlightAll();
document.querySelectorAll('article pre').forEach(pre => {
    const code = pre.querySelector('code');
    if (!code) return;
    const toolbar = document.createElement('div');
    toolbar.className = 'code-toolbar';
    const btn = document.createElement('button');
    btn.className = 'copy-btn';
    btn.textContent = 'Copy';
    btn.onclick = () => {
        navigator.clipboard.writeText(code.textContent).then(() => {
            btn.textContent = 'Copied!';
            btn.classList.add('copied');
            setTimeout(() => { btn.textContent = 'Copy'; btn.classList.remove('copied'); }, 2000);
        });
    };
    toolbar.appendChild(btn);
    pre.parentNode.insertBefore(toolbar, pre);
});
</script>
</body>
</html>