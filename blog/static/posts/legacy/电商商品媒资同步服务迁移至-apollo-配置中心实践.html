<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç”µå•†å•†å“åª’èµ„åŒæ­¥æœåŠ¡è¿ç§»è‡³ Apollo é…ç½®ä¸­å¿ƒå®è·µ | Yuxu Ge</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1/themes/prism-tomorrow.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    <style>
        :root {
            --black: #111;
            --dark-grey: #444;
            --off-white: #f4f4f4;
            --vermilion: #C41E3A;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            font-size: 16px;
            scroll-behavior: smooth;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            line-height: 1.6;
            color: var(--black);
            background-color: var(--off-white);
        }

        a {
            color: var(--vermilion);
            text-decoration: none;
        }

        a:hover {
            opacity: 0.75;
        }

        .layout {
            min-height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            position: fixed;
            top: 0;
            left: 0;
            width: 320px;
            height: 100vh;
            background: var(--black);
            color: var(--off-white);
            padding: 3rem 2rem;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .sidebar-top {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
        }

        .avatar {
            display: block;
            width: 120px;
            height: 120px;
            border-radius: 50%;
            border: 3px solid var(--vermilion);
            margin-bottom: 1.5rem;
            overflow: hidden;
            transition: transform 0.2s ease;
        }

        .avatar:hover {
            opacity: 1;
            transform: scale(1.05);
        }

        .avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .name-block {
            margin-bottom: 0.5rem;
        }

        h1 {
            font-size: 1.8rem;
            font-weight: 700;
            letter-spacing: 1px;
            color: var(--off-white);
        }

        .title-role {
            font-size: 0.9rem;
            color: #888;
            margin-top: 0.25rem;
            font-weight: 400;
        }

        .contact-block {
            margin-top: 2.5rem;
            width: 100%;
        }

        .social-links {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.75rem;
        }

        .social-links a {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            width: 160px;
            color: var(--off-white);
            opacity: 0.7;
            padding: 0.5rem 0.75rem;
            border-radius: 4px;
            font-size: 0.9rem;
            transition: all 0.2s;
        }

        .social-links a:hover {
            color: var(--vermilion);
            opacity: 1;
            background: rgba(255, 255, 255, 0.05);
        }

        .social-links svg {
            width: 20px;
            height: 20px;
            flex-shrink: 0;
        }

        .social-links .orcid-link {
            font-size: 0.68rem;
            gap: 0.5rem;
            white-space: nowrap;
        }

        .sidebar-footer {
            text-align: center;
            font-size: 0.75rem;
            color: #555;
        }

        /* Content */
        .content {
            margin-left: 320px;
            padding: 3rem 4rem;
            max-width: calc(100vw - 320px - 8rem);
        }

        .back-link {
            display: inline-block;
            font-size: 0.85rem;
            margin-bottom: 2rem;
            color: var(--dark-grey);
        }

        .back-link:hover {
            color: var(--vermilion);
        }

        /* Article */
        article h1 {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 1.5rem;
            line-height: 1.3;
            color: var(--black);
        }

        article h2 {
            font-size: 1.4rem;
            font-weight: 600;
            margin: 2rem 0 1rem;
            color: var(--black);
        }

        article h3 {
            font-size: 1.1rem;
            font-weight: 600;
            margin: 1.5rem 0 0.75rem;
            color: var(--black);
        }

        article p {
            margin-bottom: 1rem;
            color: var(--dark-grey);
        }

        article ul,
        article ol {
            margin: 1rem 0 1rem 1.5rem;
            color: var(--dark-grey);
        }

        article li {
            margin-bottom: 0.5rem;
        }

        article strong {
            color: var(--black);
        }

        article code {
            font-family: "SF Mono", Monaco, monospace;
            font-size: 0.9em;
            background: #e8e8e8;
            padding: 0.15em 0.4em;
            border-radius: 3px;
        }

        article pre {
            margin: 1rem 0;
            border-radius: 6px;
            overflow-x: auto;
            background: #2d2d2d;
            padding: 1rem;
        }

        article pre code {
            background: none;
            padding: 0;
            font-size: 0.75em;
            white-space: pre !important;
            counter-reset: line;
            display: block;
            color: #ccc;
        }

        article pre code .line {
            counter-increment: line;
        }

        article pre code .line::before {
            content: counter(line);
            display: inline-block;
            width: 2.5em;
            margin-right: 1em;
            text-align: right;
            color: #666;
            user-select: none;
        }

        .code-toolbar {
            display: flex;
            justify-content: flex-start;
            padding: 0.35rem 0.5rem;
            background: #3a3a3a;
            border-radius: 6px 6px 0 0;
        }

        .code-toolbar+pre {
            margin-top: 0;
            border-radius: 0 0 6px 6px;
        }

        .copy-btn {
            padding: 0.2rem 0.5rem;
            font-size: 0.7rem;
            background: #555;
            color: #fff;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .copy-btn:hover,
        .copy-btn:active {
            background: #777;
        }

        .copy-btn.copied {
            background: #2a2;
        }

        article blockquote {
            border-left: 3px solid var(--vermilion);
            padding-left: 1rem;
            margin: 1rem 0;
            color: #666;
            font-style: italic;
        }

        article hr {
            border: none;
            border-top: 1px solid #ddd;
            margin: 2rem 0;
        }

        article table {
            width: 100%;
            border-collapse: collapse;
            margin: 1rem 0;
            font-size: 0.9rem;
        }

        article th,
        article td {
            border: 1px solid #ddd;
            padding: 0.5rem 0.75rem;
            text-align: left;
        }

        article th {
            background: #e8e8e8;
            font-weight: 600;
        }

        article img {
            max-width: 100%;
            height: auto;
            display: block;
            margin: 1.5rem 0;
            border-radius: 6px;
        }

        .loading {
            text-align: center;
            padding: 3rem;
            color: #888;
        }

        .error {
            color: var(--vermilion);
        }

        /* Language Selector */
        .lang-selector {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
            padding: 0.75rem 1rem;
            background: #fff;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            font-size: 0.85rem;
        }

        .lang-selector-label {
            color: #666;
            display: flex;
            align-items: center;
            gap: 0.35rem;
        }

        .lang-selector-label svg {
            width: 16px;
            height: 16px;
        }

        .lang-select {
            padding: 0.4rem 0.75rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            background: white;
            font-size: 0.85rem;
            cursor: pointer;
            min-width: 140px;
        }

        .lang-select:focus {
            outline: none;
            border-color: var(--vermilion);
        }

        .lang-status {
            font-size: 0.8rem;
            color: #888;
            margin-left: auto;
        }

        .lang-status.translating {
            color: var(--vermilion);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .lang-status.translating::before {
            content: '';
            width: 14px;
            height: 14px;
            border: 2px solid #f0f0f0;
            border-top-color: var(--vermilion);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .lang-status.cached {
            color: #4CAF50;
        }

        .lang-original-btn {
            padding: 0.35rem 0.6rem;
            font-size: 0.75rem;
            background: #f0f0f0;
            border: 1px solid #ddd;
            border-radius: 4px;
            cursor: pointer;
            color: #666;
            transition: all 0.2s;
        }

        .lang-original-btn:hover {
            background: #e0e0e0;
            color: #333;
        }

        @media (max-width: 600px) {
            .lang-selector {
                flex-wrap: wrap;
            }
            .lang-status {
                width: 100%;
                margin-left: 0;
                margin-top: 0.5rem;
            }
        }

        /* KaTeX math styles */
        .katex-display {
            overflow-x: auto;
            overflow-y: hidden;
            padding: 0.5rem 0;
        }

        .katex {
            font-size: 1.1em;
        }

        /* Jupyter Notebook Styles */
        .notebook-container {
            margin-top: 1rem;
        }

        .notebook-download {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            margin-bottom: 1.5rem;
            background: var(--black);
            color: var(--off-white);
            border-radius: 4px;
            font-size: 0.85rem;
            transition: opacity 0.2s;
        }

        .notebook-download:hover {
            opacity: 0.8;
            color: var(--off-white);
        }

        .notebook-download svg {
            width: 16px;
            height: 16px;
        }

        .nb-cell {
            margin-bottom: 1.5rem;
        }

        .nb-cell-code .nb-source {
            background: #2d2d2d;
            border-radius: 6px;
            overflow-x: auto;
        }

        .nb-cell-code .nb-source pre {
            margin: 0;
            padding: 1rem;
            color: #ccc;
            font-family: "SF Mono", Monaco, monospace;
            font-size: 0.85em;
        }

        .nb-cell-code .nb-source code {
            background: none;
            padding: 0;
        }

        .nb-output {
            background: #fff;
            border: 1px solid #ddd;
            border-radius: 6px;
            padding: 0.75rem;
            margin-top: 0.5rem;
        }

        .nb-output pre {
            margin: 0;
            padding: 0;
            background: transparent;
            white-space: pre-wrap;
            word-wrap: break-word;
            font-family: "SF Mono", Monaco, monospace;
            font-size: 0.85em;
            color: #222;
        }

        .nb-output img {
            max-width: 100%;
            height: auto;
            display: block;
            margin: 0.5rem 0;
        }

        .nb-output table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9rem;
        }

        .nb-output th,
        .nb-output td {
            border: 1px solid #ddd;
            padding: 0.5rem;
            text-align: left;
        }

        .nb-output th {
            background: #e8e8e8;
            font-weight: 600;
        }

        .nb-cell-markdown {
            padding: 0;
        }

        .nb-cell-markdown h1:first-child {
            margin-top: 0;
        }

        /* Document Download Button */
        .doc-download {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            margin-bottom: 1.5rem;
            background: var(--black);
            color: var(--off-white);
            border-radius: 4px;
            font-size: 0.85rem;
            transition: opacity 0.2s;
        }

        .doc-download:hover {
            opacity: 0.8;
            color: var(--off-white);
        }

        .doc-download svg {
            width: 16px;
            height: 16px;
        }

        /* PDF Viewer */
        .pdf-container {
            margin-top: 1rem;
        }

        .pdf-viewer {
            width: 100%;
            height: 80vh;
            border: 1px solid #ddd;
            border-radius: 6px;
            background: #f5f5f5;
        }

        /* Text File Display */
        .text-container {
            margin-top: 1rem;
        }

        .text-content {
            background: #fff;
            border: 1px solid #ddd;
            border-radius: 6px;
            padding: 1.5rem;
            font-family: "SF Mono", Monaco, monospace;
            font-size: 0.9em;
            line-height: 1.6;
            white-space: pre-wrap;
            word-wrap: break-word;
            color: var(--dark-grey);
            max-height: 80vh;
            overflow-y: auto;
        }

        /* Word Document Display */
        .word-container {
            margin-top: 1rem;
        }

        .word-content {
            background: #fff;
            border: 1px solid #ddd;
            border-radius: 6px;
            padding: 2rem;
            line-height: 1.8;
            color: var(--dark-grey);
        }

        .word-content p {
            margin-bottom: 1rem;
        }

        .word-content h1,
        .word-content h2,
        .word-content h3 {
            color: var(--black);
            margin: 1.5rem 0 1rem;
        }

        .word-content table {
            width: 100%;
            border-collapse: collapse;
            margin: 1rem 0;
        }

        .word-content th,
        .word-content td {
            border: 1px solid #ddd;
            padding: 0.5rem;
        }

        .word-content img {
            max-width: 100%;
            height: auto;
        }

        /* Excel Display */
        .excel-container {
            margin-top: 1rem;
        }

        .excel-tabs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }

        .excel-tab {
            padding: 0.5rem 1rem;
            background: #e8e8e8;
            border: none;
            border-radius: 4px 4px 0 0;
            cursor: pointer;
            font-size: 0.85rem;
        }

        .excel-tab.active {
            background: #4CAF50;
            color: white;
        }

        .excel-content {
            background: #fff;
            border: 1px solid #ddd;
            border-radius: 6px;
            overflow-x: auto;
            max-height: 70vh;
            overflow-y: auto;
        }

        .excel-content table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.85rem;
        }

        .excel-content th,
        .excel-content td {
            border: 1px solid #ddd;
            padding: 0.4rem 0.6rem;
            text-align: left;
            white-space: nowrap;
        }

        .excel-content th {
            background: #f5f5f5;
            font-weight: 600;
            position: sticky;
            top: 0;
        }

        .excel-content tr:nth-child(even) {
            background: #fafafa;
        }

        /* PowerPoint Display */
        .ppt-container {
            margin-top: 1rem;
        }

        .ppt-viewer {
            width: 100%;
            height: 80vh;
            border: 1px solid #ddd;
            border-radius: 6px;
            background: #f5f5f5;
        }

        /* CSV Display (uses excel styles) */
        .csv-container {
            margin-top: 1rem;
        }

        /* Responsive */
        @media (max-width: 900px) {
            .sidebar {
                position: relative;
                width: 100%;
                height: auto;
                padding: 2rem 1.5rem 1rem;
            }

            .social-links {
                flex-direction: row;
                flex-wrap: wrap;
                justify-content: center;
            }

            .social-links a,
            .social-links .orcid-link {
                width: auto;
                padding: 0.5rem;
                font-size: 0;
                gap: 0;
            }

            .social-links svg {
                width: 24px;
                height: 24px;
            }

            .social-links .hide-mobile {
                display: none;
            }

            .sidebar-footer {
                margin-top: 1rem;
            }

            .content {
                margin-left: 0;
                padding: 2rem 1rem;
                max-width: 100%;
            }
        }

        @media (max-width: 480px) {
            .sidebar {
                padding: 1.5rem 1rem 1rem;
            }

            .avatar {
                width: 80px;
                height: 80px;
            }

            h1 {
                font-size: 1.4rem;
            }

            article h1 {
                font-size: 1.5rem;
            }
        }
    </style>
</head>

<body>

    <div class="layout">
        <aside class="sidebar" id="sidebar-content"></aside>
        <script src="/components/sidebar.js?v=20260128"></script>

        <main class="content">
            <a href="/blog/" class="back-link">â† Back to Blog</a>

            <!-- Language Selector -->
            <div class="lang-selector" id="lang-selector" style="display: none;">
                <span class="lang-selector-label">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5h12M9 3v2m1.048 9.5A18.022 18.022 0 016.412 9m6.088 9h7M11 21l5-10 5 10M12.751 5C11.783 10.77 8.07 15.61 3 18.129" />
                    </svg>
                    Language
                </span>
                <select class="lang-select" id="lang-select">
                    <option value="en">ğŸ‡ºğŸ‡¸ English</option>
                    <option value="zh">ğŸ‡¨ğŸ‡³ ä¸­æ–‡</option>
                    <option value="ja">ğŸ‡¯ğŸ‡µ æ—¥æœ¬èª</option>
                    <option value="ko">ğŸ‡°ğŸ‡· í•œêµ­ì–´</option>
                    <option value="es">ğŸ‡ªğŸ‡¸ EspaÃ±ol</option>
                    <option value="fr">ğŸ‡«ğŸ‡· FranÃ§ais</option>
                    <option value="de">ğŸ‡©ğŸ‡ª Deutsch</option>
                    <option value="pt">ğŸ‡µğŸ‡¹ PortuguÃªs</option>
                    <option value="ru">ğŸ‡·ğŸ‡º Ğ ÑƒÑÑĞºĞ¸Ğ¹</option>
                    <option value="ar">ğŸ‡¸ğŸ‡¦ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option>
                </select>
                <button class="lang-original-btn" id="lang-original-btn" style="display: none;">Show Original</button>
                <span class="lang-status" id="lang-status"></span>
            </div>

            <article>
<hr>
<h2>date: 2021-11-12
tags: [service_governance]
legacy: true</h2>
<h1>ç”µå•†å•†å“åª’èµ„åŒæ­¥æœåŠ¡è¿ç§»è‡³ Apollo é…ç½®ä¸­å¿ƒå®è·µ</h1>
<h2>1Â |Â ç°çŠ¶æ‰«æï¼šYaml çš„ç—›ç‚¹</h2>
<ul>
<li><strong>ç¯å¢ƒç¢ç‰‡åŒ–</strong>  <ul>
<li><em>dev</em>ã€<em>test</em>ã€<em>gray</em>ã€<em>prod</em> èµ·æ­¥ï¼ŒåŒåä¸€å†æ¥ä¸€å¥— *saleâ€‘9.9.ï¼Œå¹´åº•æ¸…ä»“è¿˜æœ‰ <em>clearance</em>ã€‚  </li>
<li>æ¯ä¸ªç¯å¢ƒé‡Œéƒ½æœ‰ä¸åŒçš„ OSS åŸŸåã€CDN åŸŸåã€é™æµé˜ˆå€¼ã€‚</li>
</ul>
</li>
<li><strong>å‘å¸ƒæµç¨‹æ¼«é•¿</strong>  <ul>
<li>æ”¹ä¸€è¡Œé…ç½®ï¼Œéœ€è¦èµ°ï¼šPR â†’ å®¡æ ¸ â†’ Build é•œåƒ â†’ æ¨åˆ° K8sã€‚  </li>
<li>å³ä¾¿å…¨é“¾è·¯è‡ªåŠ¨åŒ–ï¼Œä¹Ÿè¦ 15 åˆ†é’Ÿã€‚é‡åˆ°ç›´æ’­é—´å›¾ç‰‡éæ³•ï¼Œéœ€è¦å¿«ä¿®æ—¶æ ¹æœ¬æ¥ä¸åŠã€‚</li>
</ul>
</li>
<li><strong>å›æ»šå›°éš¾</strong>  <ul>
<li>æƒ³æ‰¾ã€Œä¸‰åˆ†é’Ÿå‰é‚£ä¸ªæ­£ç¡®ç‰ˆæœ¬ã€ï¼Ÿåªèƒ½ç¿» Git å†å²è‡ªå·±å¯¹ diffã€‚  </li>
<li>è¿ç»´åŒå­¦åŠå¤œåœ¨è·³æ¿æœºé‡Œç”¨ <code>vi</code> æ‰‹æ”¹ yaml çš„æ•…äº‹ç›¸ä¿¡ä½ ä¹Ÿå¬è¿‡ã€‚</li>
</ul>
</li>
<li><strong>æƒé™æ··ä¹±</strong>  <ul>
<li>è¿è¥è¦è°ƒâ€œçˆ†æ¬¾â€ CD æ ‡è¯†ï¼Œå½•å…¥ <code>is_premium_banner: true</code>ï¼›  </li>
<li>ç»“æœæŠŠ <code>oss.secret_key</code> ä¹Ÿä¸å°å¿ƒæ”¹äº†ï¼Œç”Ÿäº§ç›´æ¥ä¸Šä¼ å¤±è´¥ã€‚</li>
</ul>
</li>
</ul>
<p><strong>é…ç½®ä¸­å¿ƒ</strong> çœ‹ä¼¼åªæ˜¯æŠ€æœ¯å‡çº§ï¼Œå®é™…ä¸Šæ˜¯æ²»ç†å›¢é˜Ÿåä½œæ–¹å¼ã€‚<br>Apollo æˆç†Ÿã€æ˜“éƒ¨ç½²ã€æƒé™æ¨¡å‹å®Œå¤‡ï¼Œäºæ˜¯æ’é™¤ä¸‡éš¾ï¼Œæ‹‰å®ƒä¸Šè½¦ã€‚</p>
<h2>2Â |Â Apollo æç®€ç§‘æ™®</h2>
<p>ä¸¤å¥è¯æ¦‚æ‹¬ Apolloï¼š  </p>
<ul>
<li><em>æœåŠ¡ç«¯</em> æä¾› <strong>Portal + ConfigService + AdminService</strong>ï¼Œå­˜å‚¨åœ¨ MySQLã€‚  </li>
<li><em>å®¢æˆ·ç«¯</em> é•¿è½®è¯¢æ‹¿æœ€æ–° Releaseï¼Œæˆ–è€…é€šè¿‡ REST è°ƒ <code>/configs</code> æ‹‰å– JSONã€‚</li>
</ul>
<blockquote>
<p>æˆ‘ä»¬åªç”¨ä¸‹åˆ—ä¸‰ä¸ªæ¥å£ï¼š</p>
<ul>
<li><code>GET /configs/{appId}/{cluster}/{namespace}</code> â€”â€” æ‹‰å–æ•´ä¸ªå‘½åç©ºé—´å¿«ç…§  </li>
<li><code>GET /notifications/v2</code> â€”â€” é•¿è½®è¯¢ï¼Œå¾—åˆ° Release Key å˜æ›´  </li>
<li><code>PUT /configs</code> â€”â€” ç®¡ç†ç«¯è„šæœ¬é‡Œåšç°åº¦å‘å¸ƒ</li>
</ul>
</blockquote>
<h2>3Â |Â è®¾è®¡åŸåˆ™</h2>
<ul>
<li><em>é…ç½®å³ä»£ç ï¼Œä½†ä¸æ··ä»£ç ä»“åº“</em> â€”â€” Apollo ç»´æŠ¤è¿è¡Œæ—¶é…ç½®ï¼ŒGit åªå­˜é»˜è®¤å€¼ã€‚  </li>
<li><em>ä¸€è¡Œé…ç½®å°±æ˜¯ä¸€æ¬¡å‘å¸ƒå•</em> â€”â€” é€šè¿‡ Apollo Release åšå®¡è®¡ï¼Œæ‹’ç»è·³æ¿æœºæ‰‹åŠ¨æ”¹è¡¨ã€‚  </li>
<li><em>è¿ç»´è°ƒåŸºç¡€ã€è¿è¥è°ƒä¸šåŠ¡</em> â€”â€” ç”¨ Namespace éš”ç¦»è¯»å†™æƒé™ã€‚  </li>
<li><em>æ”¹é…ç½®ä¸é‡å¯</em> â€”â€” 90% é…ç½®é€šè¿‡çƒ­æ›´æ–°ç”Ÿæ•ˆã€‚  </li>
<li><em>å¯ç°åº¦å¯å›æ»š</em> â€”â€” æ¯ä¸€ä¸ª Release Key å¤©ç”Ÿå¯å›æ»šï¼Œç°åº¦ 1% Pod éªŒè¯ã€‚</li>
</ul>
<h2>4Â |Â è½åœ°æ­¥éª¤</h2>
<h3>4.1 æ‹†åˆ†å‘½åç©ºé—´</h3>
<p>åŸ <code>config.yml</code> è¶…è¿‡ä¸‰åƒè¡Œï¼Œå…ˆæŒ‰ <strong>é¢†åŸŸ</strong> åˆ‡å—ï¼š</p>
<ul>
<li><code>storage.oss</code> â€”â€” endpoint / ak / sk  </li>
<li><code>storage.cdn</code> â€”â€” åŸŸåã€ç¼“å­˜ TTL  </li>
<li><code>feature_flag</code> â€”â€” æ˜¯å¦å¼€å¯æ™ºèƒ½å‹ç¼©ã€æ˜¯å¦å¯ç”¨ AVIF  </li>
<li><code>rate_limit</code> â€”â€” ä¸Šä¼ å¹¶å‘ã€ç£ç›˜ IOPS é˜ˆå€¼  </li>
<li><code>promotion</code> â€”â€” æ˜¯å¦å±•ç¤ºåŒåä¸€å¾½ç« </li>
</ul>
<blockquote>
<p>åˆ’åˆ†åŸåˆ™ï¼š  </p>
<ul>
<li>è¯»å†™äººç¾¤ä¸åŒçš„ï¼Œå¿…é¡»æ‹†ï¼›  </li>
<li>ç”Ÿå‘½å‘¨æœŸä¸åŒçš„ï¼Œå¿…é¡»æ‹†ï¼›  </li>
<li>å˜æ›´é¢‘ç‡ä¸åŒçš„ï¼Œæœ€å¥½æ‹†ã€‚</li>
</ul>
</blockquote>
<h3>4.2 å†™ä¸€ä¸ªæç®€ Python SDK</h3>
<p>å›¢é˜Ÿä¸æƒ³å¼•å…¥é‡å‹åº“ï¼Œäºæ˜¯ 9. è¡Œä»£ç æå®š Apollo å®¢æˆ·ç«¯ï¼š</p>
<blockquote><code># apollo_client.py</code><br>
<code>import requests, time, json, threading</code><br>
<code></code><br>
<code>class Apollo:</code><br>
<code>    def __init__(self, host, app_id, cluster, namespaces, timeout=60):</code><br>
<code>        self.host, self.app_id, self.cluster = host, app_id, cluster</code><br>
<code>        self.namespaces = namespaces</code><br>
<code>        self.timeout = timeout</code><br>
<code># ... (49 more lines)</code></blockquote>
<p><em>Full code available in the <a href="https://github.com/geyuxu">GitHub repository</a>.</em></p><ul>
<li><strong>åˆå§‹åŒ–</strong> åŒæ­¥æ‰€æœ‰å‘½åç©ºé—´  </li>
<li><strong>é•¿è½®è¯¢</strong> æ¥å£è¶…æ—¶ 60sï¼Œå¯è‡ªå®šä¹‰  </li>
<li><strong>on_change å›è°ƒ</strong> ç”±ä¸šåŠ¡å±‚å†³å®šå¦‚ä½•çƒ­æ›´æ–°</li>
</ul>
<h3>4.3 æ¥å…¥ä¸šåŠ¡</h3>
<blockquote><code>from apollo_client import Apollo</code><br>
<code>import asyncio</code><br>
<code></code><br>
<code>apollo = Apollo(</code><br>
<code>    host=&quot;https://apollo.shop.com&quot;,</code><br>
<code>    app_id=&quot;shop-asset-sync&quot;,</code><br>
<code>    cluster=&quot;default&quot;,</code><br>
<code>    namespaces=[</code><br>
<code># ... (20 more lines)</code></blockquote>
<p><em>Full code available in the <a href="https://github.com/geyuxu">GitHub repository</a>.</em></p><p>5 è¡Œå°±æŠŠ Apollo æ‹‰èµ·ï¼Œå‰©ä¸‹å°±æ˜¯ä¸šåŠ¡å›è°ƒé€»è¾‘ã€‚<br>åˆ°è¿™é‡Œï¼Œ<strong>ä» YAML åˆ° Apollo çš„è¯»å–é“¾å·²ç»è·‘é€š</strong>ã€‚</p>
<h3>4.4 å†™å‘å¸ƒè„šæœ¬ï¼ˆè¿ç»´ &amp; CI ç”¨ï¼‰</h3>
<p>è¿è¥åŒå­¦ä¸ä¼šè¿› Portal ç‚¹é¼ æ ‡ï¼Œäºæ˜¯ç»™ä»–ä»¬ä¸€ä¸ª <code>publish.py</code>ï¼š</p>
<blockquote><code>import requests, sys, json</code><br>
<code></code><br>
<code>HOST = &quot;https://apollo.shop.com&quot;</code><br>
<code>TOKEN = &quot;api-token-here&quot;</code><br>
<code></code><br>
<code>def publish(ns, kv, comment=&quot;auto publish&quot;):</code><br>
<code>    url = f&quot;{HOST}/openapi/v1/envs/prod/apps/shop-asset-sync/clusters/default/namespaces/{ns}/items&quot;</code><br>
<code>    headers = {&quot;Authorization&quot;: f&quot;Bearer {TOKEN}&quot;}</code><br>
<code># ... (11 more lines)</code></blockquote>
<p><em>Full code available in the <a href="https://github.com/geyuxu">GitHub repository</a>.</em></p><p>CI Example:</p>
<blockquote><code>image: python:3.11</code><br>
<code>stages: [publish]</code><br>
<code></code><br>
<code>publish_flag:</code><br>
<code>  stage: publish</code><br>
<code>  script:</code><br>
<code>    - python publish.py feature_flag &#039;{&quot;enable_avif&quot;:&quot;true&quot;}&#039; &quot;double 9.switch&quot;</code><br>
<code>  only:</code><br>
<code>    - schedules</code></blockquote><p>æ¯å¤©å‡Œæ™¨å®šæ—¶è·‘ä»»åŠ¡ï¼ŒæŒ‰è¿è¥è¡¨æ ¼åˆ‡æ¢æ´»åŠ¨å¹¿å‘Šæ ‡è¯†ã€‚</p>
<h3>4.5 ç°åº¦ä¸å›æ»š</h3>
<ul>
<li><strong>ç°åº¦</strong>  <ul>
<li>ä½¿ç”¨ Apollo Portal â€œç°åº¦å‘å¸ƒâ€åŠŸèƒ½ï¼Œé€‰æ‹© 5% IP Hashï¼ŒPod çº§åˆ«è¦†ç›–ã€‚  </li>
<li>Pod é€šè¿‡ <code>HOST_IP</code> æ³¨å†Œåˆ°ç›‘æ§ï¼Œè‡ªå¸¦æ ‡ç­¾ <code>apollo.releaseKey</code>ã€‚  </li>
<li>ç›‘æ§ç»´åº¦ï¼šä¸Šä¼ æˆåŠŸç‡ã€å¹³å‡ä¸Šä¼ è€—æ—¶ã€é”™è¯¯ç åˆ†å¸ƒã€‚</li>
</ul>
</li>
<li><strong>å›æ»š</strong>  <ul>
<li>Portal ä¸€é”® Rollbackã€‚  </li>
<li>å®¢æˆ·ç«¯é•¿è½®è¯¢ä¼šè‡ªåŠ¨æ‹‰åˆ°æ—§ Releaseï¼Œå›è°ƒ <code>apply_config</code>ã€‚  </li>
<li>30 ç§’ä¹‹å†…å³å¯å®Œæˆå…¨é‡å›æ»šï¼Œæ— éœ€æ»šåŠ¨é‡å¯ã€‚</li>
</ul>
</li>
</ul>
<p>å®é™…æ¼”ç»ƒï¼šæˆ‘ä»¬æŠŠ <code>rate_limit.concurrent_upload</code> ä» 9. è°ƒåˆ° 9.çº¿ä¸Šæ˜æ˜¾ç§¯å‹ã€‚<br>ç‚¹å‡» Rollbackï¼Œä¸Šä¼ é˜Ÿåˆ— 9.ç§’æ¢å¤æ­£å¸¸ï¼Œè¯æ˜é“¾è·¯å¯é ã€‚</p>
<h2>5Â |Â è¸©å‘åˆé›†</h2>
<ul>
<li><strong>è¶…æ—¶æ—¶é—´ä¼ é”™</strong>  <ul>
<li>Apollo REST <code>/notifications/v2</code> è¶…æ—¶è¦ <strong>&gt;60s</strong>ï¼Œå¦åˆ™ 502ã€‚  </li>
<li>Python <code>requests</code> è¦æŠŠ <code>timeout=(connect, read)</code> åˆ†å¼€å†™ã€‚</li>
</ul>
</li>
<li><strong>æ–‡æœ¬å€¼è‡ªåŠ¨å»ç©ºæ ¼</strong>  <ul>
<li>Apollo Portal ä¼šæŠŠé…ç½®å€¼å·¦å³ç©ºæ ¼å‰ªæ‰ã€‚  </li>
<li>æˆ‘ä»¬çš„ CDN åŸŸååˆ—è¡¨å·®ç‚¹å¤šå†™ä¸€æ¡ç©ºæ ¼ï¼Œå¹¸äº UT é˜»æ–­ã€‚</li>
</ul>
</li>
<li><strong>Namespace UTFâ€‘8 Header</strong>  <ul>
<li>è‹¥ Namespace åå¸¦ä¸­æ–‡ï¼Œå¿…é¡»åœ¨ URL æ‰“ <code>encodeURIComponent</code>ï¼Œå¦åˆ™ 404ã€‚</li>
</ul>
</li>
<li><strong>ReleaseKey ç¼“å­˜å·®å¼‚</strong>  <ul>
<li><code>GET /configs</code> è¿”å›çš„ <code>releaseKey</code> ä¸ <code>/notifications</code> é‡Œæœªå¿…ä¸€è‡´ã€‚  </li>
<li>ä»¥ <code>notificationId</code> ä¸ºå‡†ï¼Œæ‹‰å–åå†æ›´æ–°æœ¬åœ°ç¼“å­˜ã€‚</li>
</ul>
</li>
<li><strong>æ‰¹é‡å‘å¸ƒæ¥å£æ²¡æœ‰å¹‚ç­‰</strong>  <ul>
<li>è°ƒ OpenAPI å‘å¸ƒåŒä¸€ä¸ª key å¤šæ¬¡ä¼šå åŠ å†å²ç‰ˆæœ¬ï¼Œå›æ»š list ä¼šå¾ˆé•¿ã€‚  </li>
<li>è§£å†³ï¼šè„šæœ¬é‡Œå…ˆ <code>GET</code> åˆ¤æ–­å€¼æ˜¯å¦ä¸€è‡´ã€‚</li>
</ul>
</li>
</ul>
<h2>6Â |Â è¿ç§»æ•ˆæœ</h2>
<p><img src="__TABLE_-554780a__" alt="Table"></p><h2>7Â |Â æœ€ä½³å®è·µæ¸…å•</h2>
<ul>
<li><strong>Namespace ç²’åº¦</strong>  <ul>
<li>æŒ‰ä¸šåŠ¡åŠŸèƒ½æ‹†åˆ†ï¼Œæœ€æ€•â€œä¸€ä¸ªå‘½åç©ºé—´è£…å¤©ä¸‹â€ã€‚</li>
</ul>
</li>
<li><strong>æƒé™æœ€å°åŒ–</strong>  <ul>
<li>è¿ç»´åªæŒåŸºç¡€è®¾æ–½ Namespaceï¼Œè¿è¥åªæŒæ¨å¹¿å¼€å…³ Namespaceã€‚</li>
</ul>
</li>
<li><strong>è‡ªåŠ¨å›æ»šå‰§æœ¬</strong>  <ul>
<li>é¢„å…ˆå†™å¥½è„šæœ¬ï¼šç›‘æ§æŠ¥è­¦è§¦å‘ â†’ è°ƒç”¨ Apollo Rollback â†’ Slack é€šçŸ¥ã€‚</li>
</ul>
</li>
<li><strong>å¼ºåˆ¶ UT æ ¡éªŒé…ç½®</strong>  <ul>
<li>CI é˜¶æ®µè·‘ <code>jsonschema</code> æ£€æŸ¥ï¼Œéæ³•å­—æ®µé˜»æ–­å‘å¸ƒã€‚</li>
</ul>
</li>
<li><strong>ç°åº¦å…ˆè¡Œæ–‡åŒ–</strong>  <ul>
<li>â€œæ²¡æœ‰ 1% ç°åº¦å°±æ²¡æœ‰ 100% æ­£å¼â€â€”â€”å†™è¿›å›¢é˜Ÿ Checklistã€‚</li>
</ul>
</li>
</ul>
<h2>8Â |Â æ€§èƒ½å‹æµ‹</h2>
<p>å…‰çœ‹åŠŸèƒ½æ²¡ç”¨ï¼ŒåŒåä¸€å‡Œæ™¨ 0 ç‚¹ 00 åˆ† 01 ç§’ï¼Œæ‰€æœ‰åº—é“ºåŒæ—¶åˆ·æ–°å•†å“å›¾ï¼Œ<strong>å³°å€¼ QPS 5w+</strong>ã€‚<br>é…ç½®ä¸­å¿ƒè‹¥æ‹‰èƒ¯ï¼Œé•¿è½®è¯¢æš´å¢ï¼ŒConfigService åæ ¸ã€‚</p>
<p>å‹æµ‹è„šæœ¬ï¼ˆç®€åŒ–ï¼‰ï¼š</p>
<blockquote><code>from concurrent.futures import ThreadPoolExecutor</code><br>
<code>import requests, random, json, time</code><br>
<code></code><br>
<code>def worker(i):</code><br>
<code>    ns = random.choice([&quot;feature_flag&quot;, &quot;promotion&quot;, &quot;rate_limit&quot;])</code><br>
<code>    r = requests.get(f&quot;https://apollo.shop.com/configs/shop-asset-sync/default/{ns}&quot;)</code><br>
<code>    assert r.status_code == 9.</code><br>
<code>    return len(json.dumps(r.json()))</code><br>
<code></code><br>
<code>start = time.time()</code><br>
<code>with ThreadPoolExecutor(max_workers=800) as ex:</code><br>
<code>    sizes = list(ex.map(worker, range(9.00)))</code><br>
<code>print(&quot;Total MB fetched:&quot;, sum(sizes)/1024/1024)</code><br>
<code>print(&quot;Elapsed:&quot;, time.time() - start)</code></blockquote><p>ç»“æœï¼š</p>
<ul>
<li><strong>P99Â Latency</strong>ï¼š45Â ms  </li>
<li><strong>åå</strong>ï¼š9.Â req / 18â€¯s â‰ˆ 9.0Â req/s ï¼ˆå•å®ä¾‹ï¼‰  </li>
<li>CPU å ç”¨ &lt;Â 0.6Â Coreï¼Œå†…å­˜æ³¢åŠ¨ &lt;Â 50â€¯MB</li>
</ul>
<p><strong>ç»“è®º</strong>ï¼šåŒå®ä¾‹æ— å‹ï¼Œæ°´å¹³æ‰©å®¹åˆ° 4 ä»½è¶³ä»¥æ’‘ä½ç™¾ä¸‡åœ¨çº¿ã€‚</p>
<h2>9Â |Â OpenAPI é›†æˆç»†èŠ‚</h2>
<p>çœŸæ­£ DevOps åœºæ™¯ï¼Œå¤§éƒ¨åˆ†é…ç½®å˜æ›´æ¥è‡ªè‡ªåŠ¨åŒ–è„šæœ¬ã€‚<br>Apollo æä¾›çš„ <strong>OpenAPI</strong> è¶³å¤Ÿå¼ºå¤§ï¼Œä½†æ–‡æ¡£ç•¥ç®€ï¼Œä¸‹é¢åˆ†äº«è‹¥å¹²è¸©å‘ã€‚</p>
<h3>9.1 Token ç®¡ç†</h3>
<ul>
<li>ä½¿ç”¨ <code>apollo.portal.access.key.token</code> åˆ›å»ºï¼Œåªèƒ½ Portal Admin æ“ä½œã€‚  </li>
<li>Token é»˜è®¤ 7 å¤©è¿‡æœŸï¼ŒCI ç¯å¢ƒè¦ä¹ˆå®šæ—¶åˆ·æ–°ï¼Œè¦ä¹ˆç›´æ¥è®¾ç½® <code>expires = 0</code>ï¼ˆæ°¸ä¸è¿‡æœŸï¼‰ã€‚  </li>
<li>GitLab Secret é‡Œä¿å­˜ <code>APOLLO_OPENAPI_TOKEN</code>ï¼Œ<strong>åˆ‡å‹¿</strong>æ‰“å°åœ¨æ—¥å¿—ã€‚</li>
</ul>
<h3>9.2 æ‰¹é‡å‘å¸ƒ</h3>
<p>OpenAPI æ²¡æœ‰ã€Œä¸€æ¬¡å‘å¸ƒå¤šä¸ª Namespaceã€çš„æ¥å£ï¼Œæˆ‘ä»¬å†™äº†æµæ°´çº¿ï¼š</p>
<ol>
<li>å¾ªç¯è°ƒç”¨ <code>PUT /items</code> æŠŠæ‰€æœ‰é”®å†™å…¥ä¸´æ—¶ <code>draft</code>  </li>
<li>æœ€åè°ƒç”¨ <code>POST /releases</code> ä¸€æ¬¡æ€§å‘å¸ƒ  </li>
<li>è¿”å› <code>releaseId</code>ï¼Œå­˜åˆ° Artefactï¼Œåç»­å›æ»šã€ç°åº¦éƒ½é å®ƒ</li>
</ol>
<blockquote><code>def batch_publish(env, cluster, ns_data: dict, title):</code><br>
<code>    for ns, kvs in ns_data.items():</code><br>
<code>        for k, v in kvs.items():</code><br>
<code>            create_item(env, cluster, ns, k, v)</code><br>
<code>        do_release(env, cluster, ns, title)</code></blockquote><h3>9.3 ç°åº¦è§„åˆ™</h3>
<p><code>POST /gray-deliveries</code> æ¥å£æ”¯æŒä¸‰ç§ç»´åº¦ï¼šIPã€AppIdã€ClientLabelã€‚<br>æˆ‘ä»¬ä½¿ç”¨ <strong>K8s Downward API</strong> æš´éœ² <code>HOST_IP</code> ç»™åº”ç”¨ï¼Œä¿è¯ä¸€ Pod ä¸€ä¸ª IPï¼Œæ“ä½œç¤ºä¾‹ï¼š</p>
<blockquote><code>curl -XPOST &quot;$HOST/gray-deliveries&quot;   -H &quot;Authorization: Bearer $TOKEN&quot;   -d &#039;{&quot;rules&quot;: [</code><br>
<code>        {&quot;clientAppId&quot;:&quot;shop-asset-sync&quot;,&quot;ip&quot;:&quot;10.1.2.3&quot;},</code><br>
<code>        {&quot;clientAppId&quot;:&quot;shop-asset-sync&quot;,&quot;ip&quot;:&quot;10.1.2.4&quot;}</code><br>
<code>      ]}&#039;</code></blockquote><p>ç°åº¦ç»“æŸåè®°å¾— <code>DELETE</code>ï¼Œå¦åˆ™å†å²è§„åˆ™ä¼šå¹²æ‰°æ–°å‘å¸ƒã€‚</p>
<h3>9.4 Release å›æ»š</h3>
<p>OpenAPI å›æ»šåªèƒ½æŒ‰ <code>releaseId</code>ï¼Œæ‰€ä»¥åœ¨å‘å¸ƒæ—¶<strong>å¿…é¡»</strong>è®°å½•è¯¥ idã€‚<br>æˆ‘ä»¬åœ¨ <code>commit-msg</code> é‡ŒåŠ è„šæœ¬ï¼ŒæŠŠ <code>releaseId</code> å†™å› MR Descriptionï¼Œæ–¹ä¾¿ SRE å¤åˆ¶ç²˜è´´ã€‚</p>
<blockquote><code>def rollback(ns, release_id):</code><br>
<code>    url = f&quot;{HOST}/openapi/v1/envs/prod/apps/{APP}/clusters/default/namespaces/{ns}/releases/{release_id}/rollback&quot;</code><br>
<code>    requests.put(url, headers=HEADERS).raise_for_status()</code></blockquote><p>åŠ¡å¿…æ³¨æ„å¹‚ç­‰â€”â€”åŒä¸€ä¸ª release å›æ»šä¸¤æ¬¡ä¼šæŠ› 400ï¼Œéœ€è¦ä»£ç å…œåº•ã€‚</p>
<h2>10Â |Â é«˜çº§ Feature Flagï¼šæŒ‰ç±»ç›®åŠ¨æ€å¼€å…³</h2>
<p>è¿è¥ç»å¸¸é—®ï¼šâ€œèƒ½ä¸èƒ½åªç»™â€˜æœé¥°â€™ç±»ç›®å¼€å¯åŠ¨æ€å›¾å‹ç¼©ï¼Ÿâ€<br>Apollo Namespace å¤©ç”Ÿæ˜¯å…¨å±€çš„ï¼Œä½†æˆ‘ä»¬å¯ä»¥æŠŠ<strong>ç±»ç›®åˆ—è¡¨</strong>å­˜æˆé…ç½®å€¼ + æœ¬åœ°åˆ¤æ–­ã€‚</p>
<blockquote><code># feature_flag</code><br>
<code>enable_dynamic_gif: true</code><br>
<code>gif_category_whitelist: &quot;æœé¥°,ç®±åŒ…,æ‰‹è¡¨&quot;</code></blockquote><p>ä¸šåŠ¡ä»£ç ï¼š</p>
<blockquote><code>def should_apply_gif(cat, cfg):</code><br>
<code>    if not cfg[&quot;enable_dynamic_gif&quot;]:</code><br>
<code>        return False</code><br>
<code>    cats = [c.strip() for c in cfg[&quot;gif_category_whitelist&quot;].split(&quot;,&quot;)]</code><br>
<code>    return cat in cats</code></blockquote><p>æ›´ç²¾ç»†çš„åšæ³•ï¼š  </p>
<ul>
<li>æŠŠ whitelist å­˜æˆ JSON æ•°ç»„ï¼Œæˆ– Base64 å‹ç¼©åå­˜ï¼›  </li>
<li>ä½¿ç”¨ <code>split_config=true</code> å‚æ•°ï¼Œè®© Apollo æŠŠå¤§å­—æ®µæ‹†å°ï¼ŒPortal å¯ä»¥åˆ†é¡µåŠ è½½ã€‚</li>
</ul>
<p>è¿™æ ·æ— éœ€è°ƒç”¨â€œç°åº¦å‘å¸ƒâ€ï¼Œä¹Ÿèƒ½åšåˆ°æŒ‰ä¸šåŠ¡ Tag å¼€å…³åŠŸèƒ½ã€‚</p>
<h2>11Â |Â åç»­é¡¾è§„åˆ’</h2>
<p>è¿ç§» Apollo å¹¶ä¸æ˜¯ä¸‡çµè¯ã€‚<br><strong>é…ç½®æ²»ç†</strong> çš„æ ¸å¿ƒè¿˜æ˜¯äººï¼š  </p>
<ul>
<li>æŒç»­å®¡è®¡ â€”â€” åˆ é™¤åƒµå°¸å­—æ®µ  </li>
<li>å®¡æ‰¹æµç¨‹ â€”â€” è°æ”¹äº†ä»€ä¹ˆï¼Œä¸€å¼ è¡¨è¯´æ¸…  </li>
<li>ç›‘æ§å‘Šè­¦ â€”â€” è®©é…ç½®å˜æ›´åƒä»£ç å›å½’ä¸€æ ·æœ‰æµ‹è¯•ã€æœ‰æŒ‡æ ‡</li>
</ul>
<p><strong>åç»­è§„åˆ’ï¼š</strong></p>
<ul>
<li><strong>å¤šé›†ç¾¤çƒ­å¤‡</strong> â€”â€” è®¡åˆ’æŠŠ Apollo æŠ½è±¡åˆ° Terraformï¼ŒåŒäº‘éƒ¨ç½²ï¼Œåˆ‡æ¢å»¶è¿Ÿ &lt;Â 5â€¯sã€‚  </li>
<li><strong>åŠ¨æ€ Schema</strong> â€”â€” è®© Namespace è‡ªå¸¦ JSON Schemaï¼ŒPortal å¯è§†åŒ–æ ¡éªŒã€‚  </li>
<li><strong>è‡ªåŠ©å¯è§†åŒ– Diff</strong> â€”â€” è¿è¥ç‚¹å¼€å•†å“è¯¦æƒ…æ—¶ç›´æ¥æ˜¾ç¤ºä¸ç°åº¦é…ç½®å·®å¼‚ã€‚  </li>
<li><strong>PromQL Alert æ”¹é€ </strong> â€”â€” ä»é™æ€é˜ˆå€¼è½¬å‘å¼‚å¸¸æ£€æµ‹ç®—æ³•ï¼Œè‡ªåŠ¨å­¦ä¹  baselineã€‚</li>
</ul>
<p>æ¯ä¸€ä¸ªæ”¹åŠ¨éƒ½æŒ‡å‘åŒä¸€ä¸ªç›®æ ‡ï¼š  </p>
<blockquote>
<p>è®©é…ç½®æˆä¸ºä¸šåŠ¡åŠ¨æ€çš„å®‰å…¨æŠ¤æ ï¼Œè€Œä¸æ˜¯éšè—ç‚¸å¼¹ï¼Œæ„¿ä½ ä¹Ÿæ—©æ—¥æ‘†è„±æ‰‹æ”¹ Yaml çš„â€åˆå¤œæƒŠé­‚â€œï¼</p>
</blockquote>

    </article>
    </main>
</div>

<script src="https://cdn.jsdelivr.net/npm/prismjs@1/prism.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/prismjs@1/components/prism-python.min.js"></script>
<script>
Prism.highlightAll();
document.querySelectorAll('article pre').forEach(pre => {
    const code = pre.querySelector('code');
    if (!code) return;
    const toolbar = document.createElement('div');
    toolbar.className = 'code-toolbar';
    const btn = document.createElement('button');
    btn.className = 'copy-btn';
    btn.textContent = 'Copy';
    btn.onclick = () => {
        navigator.clipboard.writeText(code.textContent).then(() => {
            btn.textContent = 'Copied!';
            btn.classList.add('copied');
            setTimeout(() => { btn.textContent = 'Copy'; btn.classList.remove('copied'); }, 2000);
        });
    };
    toolbar.appendChild(btn);
    pre.parentNode.insertBefore(toolbar, pre);
});
</script>
</body>
</html>