<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä»ç¦»çº¿éƒ¨ç½²åˆ°K8sæµæ°´çº¿å‘å¸ƒï¼šä¸€çº¿å·¥ç¨‹å¸ˆçš„å®æˆ˜æ€»ç»“ | Yuxu Ge</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1/themes/prism-tomorrow.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    <style>
        :root {
            --black: #111;
            --dark-grey: #444;
            --off-white: #f4f4f4;
            --vermilion: #C41E3A;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            font-size: 16px;
            scroll-behavior: smooth;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            line-height: 1.6;
            color: var(--black);
            background-color: var(--off-white);
        }

        a {
            color: var(--vermilion);
            text-decoration: none;
        }

        a:hover {
            opacity: 0.75;
        }

        .layout {
            min-height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            position: fixed;
            top: 0;
            left: 0;
            width: 320px;
            height: 100vh;
            background: var(--black);
            color: var(--off-white);
            padding: 3rem 2rem;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .sidebar-top {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
        }

        .avatar {
            display: block;
            width: 120px;
            height: 120px;
            border-radius: 50%;
            border: 3px solid var(--vermilion);
            margin-bottom: 1.5rem;
            overflow: hidden;
            transition: transform 0.2s ease;
        }

        .avatar:hover {
            opacity: 1;
            transform: scale(1.05);
        }

        .avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .name-block {
            margin-bottom: 0.5rem;
        }

        h1 {
            font-size: 1.8rem;
            font-weight: 700;
            letter-spacing: 1px;
            color: var(--off-white);
        }

        .title-role {
            font-size: 0.9rem;
            color: #888;
            margin-top: 0.25rem;
            font-weight: 400;
        }

        .contact-block {
            margin-top: 2.5rem;
            width: 100%;
        }

        .social-links {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.75rem;
        }

        .social-links a {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            width: 160px;
            color: var(--off-white);
            opacity: 0.7;
            padding: 0.5rem 0.75rem;
            border-radius: 4px;
            font-size: 0.9rem;
            transition: all 0.2s;
        }

        .social-links a:hover {
            color: var(--vermilion);
            opacity: 1;
            background: rgba(255, 255, 255, 0.05);
        }

        .social-links svg {
            width: 20px;
            height: 20px;
            flex-shrink: 0;
        }

        .social-links .orcid-link {
            font-size: 0.68rem;
            gap: 0.5rem;
            white-space: nowrap;
        }

        .sidebar-footer {
            text-align: center;
            font-size: 0.75rem;
            color: #555;
        }

        /* Content */
        .content {
            margin-left: 320px;
            padding: 3rem 4rem;
            max-width: calc(100vw - 320px - 8rem);
        }

        .back-link {
            display: inline-block;
            font-size: 0.85rem;
            margin-bottom: 2rem;
            color: var(--dark-grey);
        }

        .back-link:hover {
            color: var(--vermilion);
        }

        /* Article */
        article h1 {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 1.5rem;
            line-height: 1.3;
            color: var(--black);
        }

        article h2 {
            font-size: 1.4rem;
            font-weight: 600;
            margin: 2rem 0 1rem;
            color: var(--black);
        }

        article h3 {
            font-size: 1.1rem;
            font-weight: 600;
            margin: 1.5rem 0 0.75rem;
            color: var(--black);
        }

        article p {
            margin-bottom: 1rem;
            color: var(--dark-grey);
        }

        article ul,
        article ol {
            margin: 1rem 0 1rem 1.5rem;
            color: var(--dark-grey);
        }

        article li {
            margin-bottom: 0.5rem;
        }

        article strong {
            color: var(--black);
        }

        article code {
            font-family: "SF Mono", Monaco, monospace;
            font-size: 0.9em;
            background: #e8e8e8;
            padding: 0.15em 0.4em;
            border-radius: 3px;
        }

        article pre {
            margin: 1rem 0;
            border-radius: 6px;
            overflow-x: auto;
            background: #2d2d2d;
            padding: 1rem;
        }

        article pre code {
            background: none;
            padding: 0;
            font-size: 0.75em;
            white-space: pre !important;
            counter-reset: line;
            display: block;
            color: #ccc;
        }

        article pre code .line {
            counter-increment: line;
        }

        article pre code .line::before {
            content: counter(line);
            display: inline-block;
            width: 2.5em;
            margin-right: 1em;
            text-align: right;
            color: #666;
            user-select: none;
        }

        .code-toolbar {
            display: flex;
            justify-content: flex-start;
            padding: 0.35rem 0.5rem;
            background: #3a3a3a;
            border-radius: 6px 6px 0 0;
        }

        .code-toolbar+pre {
            margin-top: 0;
            border-radius: 0 0 6px 6px;
        }

        .copy-btn {
            padding: 0.2rem 0.5rem;
            font-size: 0.7rem;
            background: #555;
            color: #fff;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .copy-btn:hover,
        .copy-btn:active {
            background: #777;
        }

        .copy-btn.copied {
            background: #2a2;
        }

        article blockquote {
            border-left: 3px solid var(--vermilion);
            padding-left: 1rem;
            margin: 1rem 0;
            color: #666;
            font-style: italic;
        }

        article hr {
            border: none;
            border-top: 1px solid #ddd;
            margin: 2rem 0;
        }

        article table {
            width: 100%;
            border-collapse: collapse;
            margin: 1rem 0;
            font-size: 0.9rem;
        }

        article th,
        article td {
            border: 1px solid #ddd;
            padding: 0.5rem 0.75rem;
            text-align: left;
        }

        article th {
            background: #e8e8e8;
            font-weight: 600;
        }

        article img {
            max-width: 100%;
            height: auto;
            display: block;
            margin: 1.5rem 0;
            border-radius: 6px;
        }

        .loading {
            text-align: center;
            padding: 3rem;
            color: #888;
        }

        .error {
            color: var(--vermilion);
        }

        /* Language Selector */
        .lang-selector {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
            padding: 0.75rem 1rem;
            background: #fff;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            font-size: 0.85rem;
        }

        .lang-selector-label {
            color: #666;
            display: flex;
            align-items: center;
            gap: 0.35rem;
        }

        .lang-selector-label svg {
            width: 16px;
            height: 16px;
        }

        .lang-select {
            padding: 0.4rem 0.75rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            background: white;
            font-size: 0.85rem;
            cursor: pointer;
            min-width: 140px;
        }

        .lang-select:focus {
            outline: none;
            border-color: var(--vermilion);
        }

        .lang-status {
            font-size: 0.8rem;
            color: #888;
            margin-left: auto;
        }

        .lang-status.translating {
            color: var(--vermilion);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .lang-status.translating::before {
            content: '';
            width: 14px;
            height: 14px;
            border: 2px solid #f0f0f0;
            border-top-color: var(--vermilion);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .lang-status.cached {
            color: #4CAF50;
        }

        .lang-original-btn {
            padding: 0.35rem 0.6rem;
            font-size: 0.75rem;
            background: #f0f0f0;
            border: 1px solid #ddd;
            border-radius: 4px;
            cursor: pointer;
            color: #666;
            transition: all 0.2s;
        }

        .lang-original-btn:hover {
            background: #e0e0e0;
            color: #333;
        }

        @media (max-width: 600px) {
            .lang-selector {
                flex-wrap: wrap;
            }
            .lang-status {
                width: 100%;
                margin-left: 0;
                margin-top: 0.5rem;
            }
        }

        /* KaTeX math styles */
        .katex-display {
            overflow-x: auto;
            overflow-y: hidden;
            padding: 0.5rem 0;
        }

        .katex {
            font-size: 1.1em;
        }

        /* Jupyter Notebook Styles */
        .notebook-container {
            margin-top: 1rem;
        }

        .notebook-download {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            margin-bottom: 1.5rem;
            background: var(--black);
            color: var(--off-white);
            border-radius: 4px;
            font-size: 0.85rem;
            transition: opacity 0.2s;
        }

        .notebook-download:hover {
            opacity: 0.8;
            color: var(--off-white);
        }

        .notebook-download svg {
            width: 16px;
            height: 16px;
        }

        .nb-cell {
            margin-bottom: 1.5rem;
        }

        .nb-cell-code .nb-source {
            background: #2d2d2d;
            border-radius: 6px;
            overflow-x: auto;
        }

        .nb-cell-code .nb-source pre {
            margin: 0;
            padding: 1rem;
            color: #ccc;
            font-family: "SF Mono", Monaco, monospace;
            font-size: 0.85em;
        }

        .nb-cell-code .nb-source code {
            background: none;
            padding: 0;
        }

        .nb-output {
            background: #fff;
            border: 1px solid #ddd;
            border-radius: 6px;
            padding: 0.75rem;
            margin-top: 0.5rem;
        }

        .nb-output pre {
            margin: 0;
            padding: 0;
            background: transparent;
            white-space: pre-wrap;
            word-wrap: break-word;
            font-family: "SF Mono", Monaco, monospace;
            font-size: 0.85em;
            color: #222;
        }

        .nb-output img {
            max-width: 100%;
            height: auto;
            display: block;
            margin: 0.5rem 0;
        }

        .nb-output table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9rem;
        }

        .nb-output th,
        .nb-output td {
            border: 1px solid #ddd;
            padding: 0.5rem;
            text-align: left;
        }

        .nb-output th {
            background: #e8e8e8;
            font-weight: 600;
        }

        .nb-cell-markdown {
            padding: 0;
        }

        .nb-cell-markdown h1:first-child {
            margin-top: 0;
        }

        /* Document Download Button */
        .doc-download {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            margin-bottom: 1.5rem;
            background: var(--black);
            color: var(--off-white);
            border-radius: 4px;
            font-size: 0.85rem;
            transition: opacity 0.2s;
        }

        .doc-download:hover {
            opacity: 0.8;
            color: var(--off-white);
        }

        .doc-download svg {
            width: 16px;
            height: 16px;
        }

        /* PDF Viewer */
        .pdf-container {
            margin-top: 1rem;
        }

        .pdf-viewer {
            width: 100%;
            height: 80vh;
            border: 1px solid #ddd;
            border-radius: 6px;
            background: #f5f5f5;
        }

        /* Text File Display */
        .text-container {
            margin-top: 1rem;
        }

        .text-content {
            background: #fff;
            border: 1px solid #ddd;
            border-radius: 6px;
            padding: 1.5rem;
            font-family: "SF Mono", Monaco, monospace;
            font-size: 0.9em;
            line-height: 1.6;
            white-space: pre-wrap;
            word-wrap: break-word;
            color: var(--dark-grey);
            max-height: 80vh;
            overflow-y: auto;
        }

        /* Word Document Display */
        .word-container {
            margin-top: 1rem;
        }

        .word-content {
            background: #fff;
            border: 1px solid #ddd;
            border-radius: 6px;
            padding: 2rem;
            line-height: 1.8;
            color: var(--dark-grey);
        }

        .word-content p {
            margin-bottom: 1rem;
        }

        .word-content h1,
        .word-content h2,
        .word-content h3 {
            color: var(--black);
            margin: 1.5rem 0 1rem;
        }

        .word-content table {
            width: 100%;
            border-collapse: collapse;
            margin: 1rem 0;
        }

        .word-content th,
        .word-content td {
            border: 1px solid #ddd;
            padding: 0.5rem;
        }

        .word-content img {
            max-width: 100%;
            height: auto;
        }

        /* Excel Display */
        .excel-container {
            margin-top: 1rem;
        }

        .excel-tabs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }

        .excel-tab {
            padding: 0.5rem 1rem;
            background: #e8e8e8;
            border: none;
            border-radius: 4px 4px 0 0;
            cursor: pointer;
            font-size: 0.85rem;
        }

        .excel-tab.active {
            background: #4CAF50;
            color: white;
        }

        .excel-content {
            background: #fff;
            border: 1px solid #ddd;
            border-radius: 6px;
            overflow-x: auto;
            max-height: 70vh;
            overflow-y: auto;
        }

        .excel-content table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.85rem;
        }

        .excel-content th,
        .excel-content td {
            border: 1px solid #ddd;
            padding: 0.4rem 0.6rem;
            text-align: left;
            white-space: nowrap;
        }

        .excel-content th {
            background: #f5f5f5;
            font-weight: 600;
            position: sticky;
            top: 0;
        }

        .excel-content tr:nth-child(even) {
            background: #fafafa;
        }

        /* PowerPoint Display */
        .ppt-container {
            margin-top: 1rem;
        }

        .ppt-viewer {
            width: 100%;
            height: 80vh;
            border: 1px solid #ddd;
            border-radius: 6px;
            background: #f5f5f5;
        }

        /* CSV Display (uses excel styles) */
        .csv-container {
            margin-top: 1rem;
        }

        /* Responsive */
        @media (max-width: 900px) {
            .sidebar {
                position: relative;
                width: 100%;
                height: auto;
                padding: 2rem 1.5rem 1rem;
            }

            .social-links {
                flex-direction: row;
                flex-wrap: wrap;
                justify-content: center;
            }

            .social-links a,
            .social-links .orcid-link {
                width: auto;
                padding: 0.5rem;
                font-size: 0;
                gap: 0;
            }

            .social-links svg {
                width: 24px;
                height: 24px;
            }

            .social-links .hide-mobile {
                display: none;
            }

            .sidebar-footer {
                margin-top: 1rem;
            }

            .content {
                margin-left: 0;
                padding: 2rem 1rem;
            }
        }

        @media (max-width: 480px) {
            .sidebar {
                padding: 1.5rem 1rem 1rem;
            }

            .avatar {
                width: 80px;
                height: 80px;
            }

            h1 {
                font-size: 1.4rem;
            }

            article h1 {
                font-size: 1.5rem;
            }
        }
    </style>
</head>

<body>

    <div class="layout">
        <aside class="sidebar" id="sidebar-content"></aside>
        <script src="/components/sidebar.js?v=20260128"></script>

        <main class="content">
            <a href="/blog/" class="back-link">â† Back to Blog</a>

            <!-- Language Selector -->
            <div class="lang-selector" id="lang-selector" style="display: none;">
                <span class="lang-selector-label">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5h12M9 3v2m1.048 9.5A18.022 18.022 0 016.412 9m6.088 9h7M11 21l5-10 5 10M12.751 5C11.783 10.77 8.07 15.61 3 18.129" />
                    </svg>
                    Language
                </span>
                <select class="lang-select" id="lang-select">
                    <option value="en">ğŸ‡ºğŸ‡¸ English</option>
                    <option value="zh">ğŸ‡¨ğŸ‡³ ä¸­æ–‡</option>
                    <option value="ja">ğŸ‡¯ğŸ‡µ æ—¥æœ¬èª</option>
                    <option value="ko">ğŸ‡°ğŸ‡· í•œêµ­ì–´</option>
                    <option value="es">ğŸ‡ªğŸ‡¸ EspaÃ±ol</option>
                    <option value="fr">ğŸ‡«ğŸ‡· FranÃ§ais</option>
                    <option value="de">ğŸ‡©ğŸ‡ª Deutsch</option>
                    <option value="pt">ğŸ‡µğŸ‡¹ PortuguÃªs</option>
                    <option value="ru">ğŸ‡·ğŸ‡º Ğ ÑƒÑÑĞºĞ¸Ğ¹</option>
                    <option value="ar">ğŸ‡¸ğŸ‡¦ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option>
                </select>
                <button class="lang-original-btn" id="lang-original-btn" style="display: none;">Show Original</button>
                <span class="lang-status" id="lang-status"></span>
            </div>

            <article>
<hr>
<h2>date: 2022-03-10
tags: [devops]
legacy: true</h2>
<h1>ä»ç¦»çº¿éƒ¨ç½²åˆ°K8sæµæ°´çº¿å‘å¸ƒï¼šä¸€çº¿å·¥ç¨‹å¸ˆçš„å®æˆ˜æ€»ç»“</h1>
<p>åœ¨æ²¡æœ‰è”ç½‘çš„ç¯å¢ƒä¸­éƒ¨ç½²åº”ç”¨ï¼Œæˆ‘ä»¬é‡‡å–äº†ä¸€å¥—ç¦»çº¿éƒ¨ç½² Jar åŒ…çš„æ–¹æ¡ˆã€‚ä¸»è¦æ­¥éª¤åŒ…æ‹¬ï¼š</p>
<ul>
<li>å‡†å¤‡å¯æ‰§è¡Œ Jarï¼šé€šè¿‡ CI åœ¨å†…ç½‘æ„å»ºå‡ºå¯æ‰§è¡Œçš„ uber JARï¼ˆå°†ä¾èµ–æ‰“åŒ…ï¼‰ï¼Œæˆ–å°†æ‰€æœ‰ä¾èµ–æ‰‹åŠ¨ä¸‹è½½å¥½ã€‚ç¡®ä¿ç‰ˆæœ¬æ­£ç¡®ä¸”ä¾èµ–å®Œæ•´ï¼Œé¿å…éƒ¨ç½²åå› æ— æ³•è”ç½‘ä¸‹è½½ä¾èµ–è€Œå¤±è´¥ã€‚</li>
<li>ç¦»çº¿ä¼ è¾“åŒ…ï¼šå°† Jar åŒ…ä¼ è¾“è‡³ç›®æ ‡æœåŠ¡å™¨ã€‚ä¼ è¾“å‰åä½¿ç”¨ MD5 æ ¡éªŒä¿è¯æ–‡ä»¶å®Œæ•´æ€§ã€‚ä¾‹å¦‚ï¼Œé€šè¿‡ scp å°†æ–‡ä»¶æ‹·è´åˆ°æœåŠ¡å™¨ï¼š</li>
</ul>
<p><code>scp app-1.0.jar user@192.168.1.10:/opt/deploy/app-1.0.jar</code></p><ul>
<li>é…ç½®è¿è¡Œç¯å¢ƒï¼šåœ¨ç›®æ ‡æœåŠ¡å™¨ä¸Šç¦»çº¿å®‰è£…æ‰€éœ€çš„ JDK ç¯å¢ƒã€‚å¦‚éœ€ç‰¹å®šé…ç½®ï¼ˆä¾‹å¦‚æ•°æ®åº“è¿æ¥ã€ç¼“å­˜åœ°å€ç­‰ï¼‰ï¼Œé€šè¿‡é…ç½®æ–‡ä»¶æˆ–ç¯å¢ƒå˜é‡é¢„å…ˆå‡†å¤‡å¥½ã€‚æˆ‘ä»¬é‡‡ç”¨åœ¨ Jar åŒç›®å½•æ”¾ç½® application.properties æˆ–ä½¿ç”¨å¯åŠ¨å‚æ•°æŒ‡å®šé…ç½®è·¯å¾„çš„æ–¹å¼ã€‚</li>
<li>å¯åŠ¨åº”ç”¨è¿›ç¨‹ï¼šä½¿ç”¨ nohup æˆ– systemd å¯åŠ¨ Jar å¹¶ç¡®ä¿å…¶åœ¨åå°æŒç»­è¿è¡Œï¼š</li>
</ul>
<p><code>nohup java -jar /opt/deploy/app-1.0.jar --spring.config.location=/opt/deploy/config/ &amp;</code></p><p>è¿™æ ·å³ä½¿ç»ˆç«¯å…³é—­ï¼Œåº”ç”¨ä»æŒç»­è¿è¡Œï¼Œæ—¥å¿—è¾“å‡ºé‡å®šå‘åˆ° nohup.out æˆ–æŒ‡å®šçš„æ—¥å¿—æ–‡ä»¶ã€‚</p>
<ul>
<li>éªŒè¯éƒ¨ç½²ç»“æœï¼šæ£€æŸ¥åº”ç”¨æ—¥å¿—å’Œç«¯å£ç›‘å¬ç¡®ä¿å¯åŠ¨æˆåŠŸã€‚ä¾‹å¦‚ï¼Œé€šè¿‡ tail -f nohup.out å®æ—¶æŸ¥çœ‹æ—¥å¿—ç¡®è®¤æ²¡æœ‰æŠ¥é”™ï¼Œä»¥åŠä½¿ç”¨ netstat -tunlp | grep 8080 ç¡®è®¤æœåŠ¡ç«¯å£å·²è¢«ç›‘å¬ã€‚</li>
</ul>
<p>ä»¥ä¸Šæµç¨‹ä¿è¯äº†åœ¨æ— å¤–ç½‘ç¯å¢ƒä¸‹é¡ºåˆ©éƒ¨ç½²åº”ç”¨ã€‚ä½†è¯¥æ‰‹å·¥æ–¹å¼ä¹Ÿå­˜åœ¨æ˜æ˜¾ç¼ºç‚¹ï¼šæ¯æ¬¡æ›´æ–°éƒ½éœ€äººå·¥ä»‹å…¥ï¼Œå¤šå°æœåŠ¡å™¨éƒ¨ç½²å®¹æ˜“å‡ºç°ç‰ˆæœ¬ä¸ä¸€è‡´æˆ–é—æ¼æ­¥éª¤çš„é—®é¢˜ã€‚éšç€å‘å¸ƒé¢‘ç‡æé«˜ï¼Œæˆ‘ä»¬æ„è¯†åˆ°éœ€è¦æ›´åŠ è‡ªåŠ¨åŒ–å’Œæ ‡å‡†åŒ–çš„æ–¹å¼ã€‚</p>
<h2>Cassandra å¤§è¡¨å¯¼å‡º</h2>
<p>é¡¹ç›®è¿è¥è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬æ›¾éœ€è¦å°† Cassandra æ•°æ®åº“ä¸­æŸå¼ åŒ…å«äº¿çº§è®°å½•çš„â€œå¤§è¡¨â€å¯¼å‡ºå¤‡ä»½ã€‚è¿™é¡¹ä»»åŠ¡åœ¨æ²¡æœ‰åˆé€‚å·¥å…·æ—¶éå¸¸æ£˜æ‰‹ï¼š</p>
<ul>
<li>åˆå§‹å°è¯•ä¸é—®é¢˜ï¼šä¸€å¼€å§‹æˆ‘ä»¬å°è¯•ç›´æ¥ç”¨ CQL æŸ¥è¯¢å…¨éƒ¨æ•°æ®å¹¶å†™å…¥æ–‡ä»¶ï¼Œä½†ç”±äºæ•°æ®é‡å¤ªå¤§ï¼Œè¿™ç§æ–¹å¼åœ¨å®¢æˆ·ç«¯ç»å¸¸å¯¼è‡´å†…å­˜æº¢å‡ºæˆ–è¶…æ—¶ã€‚éšåå°è¯•ä½¿ç”¨ cqlsh è‡ªå¸¦çš„ COPY å‘½ä»¤ï¼š</li>
</ul>
<p><code>COPY keyspace_name.table_name TO &#039;export.csv&#039;;</code></p><p>è¯¥å‘½ä»¤å¯ä»¥å°†æŸ¥è¯¢ç»“æœç›´æ¥å¯¼å‡ºä¸º CSV æ–‡ä»¶ã€‚ç„¶è€Œåœ¨é¢å¯¹æ•°äº¿è¡Œæ•°æ®æ—¶ï¼ŒCOPY TO è¿è¡Œéå¸¸ç¼“æ…¢ï¼Œä¸­é€”å®¹æ˜“å› ä¸ºç½‘ç»œæ³¢åŠ¨æˆ–è¶…æ—¶å¤±è´¥ï¼Œæ¢å¤èµ·æ¥ä¹Ÿéº»çƒ¦ã€‚</p>
<ul>
<li>ä¼˜åŒ–æ–¹æ¡ˆï¼šåˆ†ç‰‡æ‰¹é‡å¯¼å‡ºï¼šæˆ‘ä»¬å†³å®šé‡‡ç”¨åˆ†æ‰¹å¯¼å‡ºç­–ç•¥ï¼Œå°†å¤§è¡¨æ‹†åˆ†ä¸ºå°å—ä¾æ¬¡å¯¼å‡ºã€‚å…·ä½“åšæ³•æ˜¯åˆ©ç”¨ä¸»é”®æˆ–æ—¶é—´èŒƒå›´åˆ†æ®µï¼šç¼–å†™è„šæœ¬æŒ‰èŒƒå›´æŸ¥è¯¢æ•°æ®ï¼Œæ¯æ¬¡å¯¼å‡ºå‡ åä¸‡è¡Œè¿½åŠ åˆ°æ–‡ä»¶ã€‚è¿™ç§åˆ†æ®µå¤„ç†é¿å…å•æ¬¡ä¼ è¾“è¿‡å¤šæ•°æ®å¯¼è‡´å‹åŠ›è¿‡å¤§ã€‚åœ¨å¯¼å‡ºè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ç›‘æ§ Cassandra èŠ‚ç‚¹çš„çŠ¶æ€ï¼Œé”™å¼€ä¸šåŠ¡é«˜å³°æ—¶é—´æ‰§è¡Œï¼Œä»¥é™ä½å¯¹çº¿ä¸Šè¯»å†™çš„å½±å“ã€‚</li>
<li>å€ŸåŠ©ä¸“ä¸šå·¥å…·ï¼šåæ¥æˆ‘ä»¬å¼•å…¥äº† DataStax æä¾›çš„ Bulk Loader (DSBulk) å·¥å…·ï¼Œå®ƒä¸“é—¨ç”¨äº Cassandra çš„æ•°æ®æ‰¹é‡å¯¼å…¥å¯¼å‡ºã€‚ä½¿ç”¨ DSBulkï¼Œæˆ‘ä»¬å¯ä»¥ä¸€æ¡å‘½ä»¤å®Œæˆæ•´ä¸ªè¡¨çš„å¯¼å‡ºï¼š</li>
</ul>
<p><code>dsbulk unload -k keyspace_name -t table_name -url export_data/ -maxRetries 5</code></p><p>DSBulk å†…éƒ¨å¯¹è¯»å–è¿›è¡Œäº†ä¼˜åŒ–å’Œå¹¶è¡Œå¤„ç†ï¼Œå¯¼å‡ºæ•ˆç‡è¾ƒé«˜ï¼Œå¹¶æä¾›æ–­ç‚¹ç»­ä¼ ç­‰åŠŸèƒ½ã€‚åœ¨ä¸€æ¬¡æµ‹è¯•ä¸­ï¼Œä½¿ç”¨ DSBulk å°†ä¸€å¼ çº¦5åƒä¸‡è¡Œçš„è¡¨å¯¼å‡ºä¸º CSVï¼Œè€—æ—¶ä»æœ€åˆçš„æ•°å°æ—¶ç¼©çŸ­åˆ°ä¸åˆ°1å°æ—¶ï¼Œå¤§å¤§æå‡äº†æ•ˆç‡ã€‚</p>
<ul>
<li>ç»“æœä¸éªŒè¯ï¼šå¯¼å‡ºå®Œæˆåï¼ŒåŠ¡å¿…éªŒè¯æ•°æ®å®Œæ•´æ€§ã€‚æˆ‘ä»¬é€šè¿‡å¯¹æ¯”å¯¼å‡ºè¡Œæ•°å’Œ Cassandra ä¸­è®°å½•æ•°æ¥æ ¡éªŒæ˜¯å¦æœ‰é—æ¼ï¼Œå¹¶éšæœºæŠ½æ ·å¯¹æ¯”å†…å®¹ã€‚å¯¼å‡ºçš„ CSV åˆ™å‹ç¼©å½’æ¡£ä¿å­˜ï¼Œä»¥ä¾¿æ—¥åå¯èƒ½çš„æ¢å¤æˆ–åˆ†æä½¿ç”¨ã€‚</li>
</ul>
<p>é€šè¿‡ä¸Šè¿°æ–¹æ³•ï¼Œæˆ‘ä»¬æˆåŠŸè§£å†³äº† Cassandra å¤§è¡¨å¯¼å‡ºéš¾é¢˜ã€‚åœ¨æ²¡æœ‰ä¸“ç”¨å·¥å…·æ—¶ï¼Œåˆ†æ®µå¯¼å‡ºæ˜¯å¯è¡Œçš„æŠ˜ä¸­æ–¹æ¡ˆï¼›è€Œå€ŸåŠ©ä¸“ä¸šå·¥å…·åï¼Œå¤§è§„æ¨¡æ•°æ®è¿ç§»çš„å¯é æ€§å’Œæ•ˆç‡éƒ½æ˜¾è‘—æé«˜ã€‚</p>
<h2>å¸¸è§å¯åŠ¨æ•…éšœæ¡ˆä¾‹</h2>
<p>åœ¨åº”ç”¨éƒ¨ç½²å’Œè¿è¡Œè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬è¿˜é‡åˆ°è¿‡Java åº”ç”¨å¯åŠ¨å¤±è´¥çš„æƒ…å†µã€‚å…¶ä¸­ä¸¤ç±»å°è±¡æ·±åˆ»çš„æ•…éšœæ¥è‡ªç¬¬ä¸‰æ–¹ç»„ä»¶ï¼šAtomikos åˆ†å¸ƒå¼äº‹åŠ¡ç®¡ç†å™¨å’Œ Curator Zookeeper å®¢æˆ·ç«¯ã€‚ä¸‹é¢åˆ†åˆ«åˆ†äº«æˆ‘ä»¬æ’æŸ¥å’Œè§£å†³é—®é¢˜çš„ç»è¿‡ã€‚</p>
<h3>Atomikos å¯¼è‡´çš„å¯åŠ¨å¼‚å¸¸</h3>
<p>æˆ‘ä»¬æœ‰ä¸€å¥—æœåŠ¡ä½¿ç”¨ Atomikos ä½œä¸ºåˆ†å¸ƒå¼äº‹åŠ¡ç®¡ç†å™¨ï¼ˆç”¨äºå¤šæ•°æ®æºäº‹åŠ¡ï¼‰ã€‚æŸæ¬¡åœ¨åŒä¸€å°æœåŠ¡å™¨ä¸Šå¯åŠ¨ä¸¤å¥—æœåŠ¡æ—¶ï¼Œåº”ç”¨åœ¨åˆå§‹åŒ– Atomikos äº‹åŠ¡ç®¡ç†å™¨æ—¶æŠ›å‡ºäº†å¼‚å¸¸ï¼Œå¯¼è‡´å¯åŠ¨å¤±è´¥ã€‚æ—¥å¿—ç‰‡æ®µå¦‚ä¸‹ï¼š</p>
<blockquote><code>com.atomikos.icatch.SysException: Error in init: Log already in use? tmlog in ./</code><br>
<code>    at com.atomikos.icatch.impux.TransactionServiceImp &lt;...&gt; </code><br>
<code>Caused by: com.atomikos.recovery.LogException: Log already in use by another process.</code></blockquote><p>ä»é”™è¯¯å¯ä»¥çœ‹å‡ºï¼ŒAtomikos å°è¯•åˆ›å»ºäº‹åŠ¡æ—¥å¿—æ–‡ä»¶æ—¶å‘ç”Ÿå†²çªï¼ˆLog already in useï¼‰ã€‚åŸå› æ˜¯åŒä¸€ç¯å¢ƒä¸­åŒæ—¶è¿è¡Œäº†å¤šä¸ªä½¿ç”¨ Atomikos çš„åº”ç”¨ï¼Œä¸”å®ƒä»¬é»˜è®¤ä½¿ç”¨ç›¸åŒè·¯å¾„çš„äº‹åŠ¡æ—¥å¿—æ–‡ä»¶ï¼Œå¯¼è‡´åå¯åŠ¨çš„è¿›ç¨‹æ— æ³•è·å–æ–‡ä»¶é”ã€‚</p>
<p>è§£å†³è¿‡ç¨‹ï¼šæˆ‘ä»¬ç¡®è®¤å‰ä¸€ä¸ªæœåŠ¡æ­£åœ¨ä½¿ç”¨ Atomikos é»˜è®¤çš„äº‹åŠ¡æ—¥å¿—ï¼ˆé€šå¸¸å­˜æ”¾äºåº”ç”¨è¿è¡Œç›®å½•ä¸‹çš„ transaction-logs æ–‡ä»¶å¤¹ï¼‰ã€‚ä¸ºäº†è§£å†³å†²çªï¼Œæˆ‘ä»¬é‡‡å–äº†ä¸¤ç§æªæ–½ä¹‹ä¸€ï¼š</p>
<ul>
<li>æ–¹æ¡ˆä¸€ï¼šåˆ†éš”äº‹åŠ¡æ—¥å¿—è·¯å¾„ â€“ ä¿®æ”¹æ¯ä¸ªåº”ç”¨çš„ Atomikos æ—¥å¿—é…ç½®ï¼Œä½¿å…¶ä½¿ç”¨ä¸åŒçš„æ—¥å¿—ç›®å½•æˆ–æ–‡ä»¶åç§°ã€‚æ¯”å¦‚åœ¨ Spring Boot é…ç½®ä¸­æŒ‡å®šï¼š</li>
</ul>
<p><code>spring.jta.atomikos.log-dir=./transaction-logs-app2</code></p><p>è¿™æ ·ç¬¬äºŒä¸ªåº”ç”¨çš„äº‹åŠ¡æ—¥å¿—å°†å†™å…¥ç‹¬ç«‹ç›®å½•ï¼Œé¿å…ä¸ç¬¬ä¸€ä¸ªåº”ç”¨äº‰ç”¨åŒä¸€æ–‡ä»¶ã€‚</p>
<ul>
<li>æ–¹æ¡ˆäºŒï¼šé”™å¼€å¯åŠ¨é¡ºåºæˆ–åˆå¹¶åº”ç”¨ â€“ å¦‚ä¸šåŠ¡å…è®¸ï¼Œå°†ç›¸å…³æ¨¡å—åˆå¹¶éƒ¨ç½²åˆ°åŒä¸€ä¸ª JVM å†…ï¼Œé¿å…å¤šä¸ªè¿›ç¨‹äº‰å¤ºèµ„æºï¼›æˆ–è€…ç¡®ä¿åŒæ—¶è¿è¡Œçš„åªæœ‰ä¸€ä¸ª Atomikos å®ä¾‹ã€‚å¦‚æœå¿…é¡»åˆ†å¼€éƒ¨ç½²ï¼Œä¹Ÿå¯ä»¥é€šè¿‡å®¹å™¨åŒ–ç­‰æ–¹å¼éš”ç¦»è¿è¡Œç¯å¢ƒã€‚</li>
</ul>
<p>é‡‡ç”¨äº†ä¿®æ”¹æ—¥å¿—è·¯å¾„çš„æ–¹æ³•åï¼Œæˆ‘ä»¬é‡æ–°å¯åŠ¨åº”ç”¨ï¼ŒAtomikos åˆå§‹åŒ–æˆåŠŸï¼Œå†²çªä¸å†å‘ç”Ÿã€‚è¿™ä¸ªæ¡ˆä¾‹æé†’æˆ‘ä»¬ï¼šä¸­é—´ä»¶çš„é»˜è®¤é…ç½®ä¸ä¸€å®šé€‚ç”¨äºç‰¹æ®Šåœºæ™¯ï¼Œéœ€æ ¹æ®éƒ¨ç½²æƒ…å†µåšé€‚å½“è°ƒæ•´ã€‚ä¾‹å¦‚ï¼Œå¯¹äºéœ€è¦åœ¨åŒä¸€ä¸»æœºéƒ¨ç½²å¤šå®ä¾‹çš„ç»„ä»¶ï¼Œè¦æ£€æŸ¥æ˜¯å¦æœ‰å…±äº«èµ„æºï¼ˆæ–‡ä»¶ã€ç«¯å£ç­‰ï¼‰å†²çªï¼Œå¹¶é€šè¿‡é…ç½®åŠ ä»¥åŒºåˆ†ã€‚</p>
<h3>Curator å¯¼è‡´çš„å¯åŠ¨å¡é¡¿</h3>
<p>å¦ä¸€é—®é¢˜æ¥è‡ªäº Apache Curatorï¼Œä¸€ä¸ªå¸¸ç”¨çš„ ZooKeeper å®¢æˆ·ç«¯æ¡†æ¶ã€‚æŸå¾®æœåŠ¡åœ¨å¯åŠ¨æ—¶ä½¿ç”¨ Curator è¿æ¥ ZooKeeper åšæœåŠ¡æ³¨å†Œï¼Œä½†æˆ‘ä»¬å‘ç°åœ¨æŸç¯å¢ƒä¸‹å¯åŠ¨è¿‡ç¨‹é•¿æ—¶é—´å¡ä½ï¼Œæ—¥å¿—ä¸æ–­æ‰“å°å¼‚å¸¸ï¼š</p>
<blockquote><code>org.apache.curator.CuratorConnectionLossException: KeeperErrorCode = ConnectionLoss</code><br>
<code>	at org.apache.curator.ConnectionState.getZooKeeper(ConnectionState.java:123)</code><br>
<code>	... </code></blockquote><p>æ—¥å¿—æç¤º Curator è¿æ¥ä¸¢å¤±ï¼Œä¸€ç›´åœ¨é‡è¯• (ConnectionLoss è¡¨æ˜æ— æ³•è¿æ¥ ZooKeeper é›†ç¾¤)ã€‚è¿™ç§æƒ…å†µå¯¼è‡´åº”ç”¨é˜»å¡åœ¨å¯åŠ¨é˜¶æ®µã€‚ç»è¿‡æ’æŸ¥ï¼Œæˆ‘ä»¬æ‰¾åˆ°ä»¥ä¸‹åŸå› ï¼š</p>
<ul>
<li>ZooKeeper æœåŠ¡æœªå¯åŠ¨ï¼šé¦–å…ˆæ€€ç–‘ ZooKeeper æœ¬èº«ä¸å¯ç”¨ã€‚æˆ‘ä»¬ç™»é™†åˆ° ZooKeeper æ‰€åœ¨æœåŠ¡å™¨ï¼Œè¿è¡Œ zkServer.sh status å‘ç°æœåŠ¡ç¡®å®æ²¡æœ‰å¯åŠ¨ã€‚åœ¨è¿™ä¸ªæµ‹è¯•ç¯å¢ƒä¸­ï¼ŒZooKeeper è¢«æ„å¤–å…³é—­è€Œæˆ‘ä»¬æ²¡æœ‰æ³¨æ„ã€‚</li>
<li>é˜²ç«å¢™æˆ–ç½‘ç»œé—®é¢˜ï¼šåœ¨ç¡®è®¤å¯åŠ¨ ZooKeeper æœåŠ¡åï¼Œä¾ç„¶å‡ºç°è¿æ¥å¤±è´¥ã€‚è¿™è®©æˆ‘ä»¬æ£€æŸ¥æœåŠ¡å™¨é˜²ç«å¢™è®¾ç½®ï¼Œç»“æœå‘ç° ZooKeeper é»˜è®¤ç«¯å£è¢«é˜²ç«å¢™æ‹¦æˆªã€‚å…³é—­æˆ–å¼€æ”¾é˜²ç«å¢™ç›¸å…³ç«¯å£åï¼ŒCurator å®¢æˆ·ç«¯æ‰æˆåŠŸè¿ä¸Š ZooKeeperã€‚</li>
<li>é”™è¯¯çš„è¿æ¥é…ç½®ï¼šå¦ä¸€ç§å¸¸è§åŸå› æ˜¯é…ç½®çš„è¿æ¥å­—ç¬¦ä¸²ä¸æ­£ç¡®ã€‚ä¾‹å¦‚å†™é”™äº† ZooKeeper é›†ç¾¤çš„ IP åœ°å€æˆ–ç«¯å£ï¼Œæˆ–è€… DNS æ— æ³•è§£æã€‚åœ¨æœ¬æ¬¡äº‹ä»¶ä¸­è™½æœªå‡ºç°è¿™ç§é”™è¯¯ï¼Œä½†æˆ‘ä»¬åœ¨è‡ªæŸ¥è¿‡ç¨‹ä¸­ä¹ŸéªŒè¯äº†é…ç½®é¡¹ä»¥æ’é™¤è¿™ç±»å› ç´ ã€‚</li>
</ul>
<p>è§£å†³æ–¹æ¡ˆï¼šé’ˆå¯¹ä¸Šè¿°åŸå› é‡‡å–äº†ç›¸åº”æªæ–½â€”â€”å¯åŠ¨ ZooKeeper æœåŠ¡è¿›ç¨‹ï¼Œå¹¶è°ƒæ•´é˜²ç«å¢™ç­–ç•¥å…è®¸è®¿é—® ZooKeeper çš„ç«¯å£ï¼ˆä¾‹å¦‚2181ï¼‰ã€‚éšåé‡å¯å¾®æœåŠ¡ï¼ŒCurator æˆåŠŸå»ºç«‹è¿æ¥ï¼Œåº”ç”¨é¡ºåˆ©å¯åŠ¨ã€‚ä¸ºé˜²æ­¢æ­¤ç±»é—®é¢˜å†æ¬¡å‘ç”Ÿï¼Œæˆ‘ä»¬è¿˜å®Œå–„äº†å¯åŠ¨è„šæœ¬ï¼šåœ¨éƒ¨ç½²åº”ç”¨å‰å¢åŠ å¯¹ä¾èµ–æœåŠ¡çš„å¥åº·æ£€æŸ¥ï¼Œå¦‚è‡ªåŠ¨æ£€æµ‹ ZooKeeper çš„çŠ¶æ€ï¼Œå¦‚æœæœªå°±ç»ªåˆ™ç»™äºˆæç¤ºæˆ–å»¶è¿Ÿå¯åŠ¨ã€‚åŒæ—¶ï¼Œå°† Curator å®¢æˆ·ç«¯çš„è¶…æ—¶å’Œé‡è¯•å‚æ•°è°ƒå¾—æ›´åŠ åˆç†ï¼Œä½¿å…¶åœ¨è¿æ¥å¼‚å¸¸æ—¶èƒ½åŠæ—©æŠ›å‡ºé”™è¯¯è€Œéæ— é™å¡é¡¿ã€‚</p>
<p>é€šè¿‡ä»¥ä¸Šä¸¤ä¸ªæ¡ˆä¾‹ï¼Œæˆ‘ä»¬æ·±åˆ»ä½“ä¼šåˆ°å¯åŠ¨æ•…éšœæ’æŸ¥éœ€è¦ç»“åˆæ—¥å¿—è¿…é€Ÿå®šä½ï¼Œå¹¶å…³æ³¨ä¾èµ–ç»„ä»¶çš„é…ç½®ä¸è¿è¡Œç¯å¢ƒã€‚æ— è®ºæ˜¯äº‹åŠ¡ç®¡ç†å™¨è¿˜æ˜¯æ³¨å†Œä¸­å¿ƒå®¢æˆ·ç«¯ï¼Œç†è§£å…¶å·¥ä½œæœºåˆ¶å’Œé…ç½®é¡¹ï¼Œæœ‰åŠ©äºå¿«é€Ÿæ‰¾åˆ°é—®é¢˜æ ¹æºå¹¶åŠ ä»¥è§£å†³ã€‚</p>
<h2>Kubernetes æ ‡å‡†å‘å¸ƒæµç¨‹</h2>
<p>åœ¨è§£å†³äº†åˆæ­¥çš„éƒ¨ç½²å’Œè¿è¡Œé—®é¢˜åï¼Œæˆ‘ä»¬ç€æ‰‹å¼•å…¥ Kubernetes (K8s) æ¥é‡æ„å‘å¸ƒæµç¨‹ã€‚ç›®æ ‡æ˜¯å®ç°ä»æ„å»ºã€éƒ¨ç½²åˆ°å‘å¸ƒçš„æµæ°´çº¿è‡ªåŠ¨åŒ–ï¼Œå°†è¿‡å»ç¹ççš„æ‰‹å·¥æ­¥éª¤æ ‡å‡†åŒ–ã€‚ä¸‹é¢ä»‹ç»æˆ‘ä»¬è½åœ° K8s æ ‡å‡†å‘å¸ƒçš„å®è·µè¿‡ç¨‹ï¼š</p>
<ul>
<li>å®¹å™¨åŒ–åº”ç”¨ï¼šé¦–å…ˆï¼Œæˆ‘ä»¬ä¸ºåº”ç”¨åˆ›å»ºäº† Docker é•œåƒã€‚ç¼–å†™äº†ç®€æ´çš„ Dockerfileï¼Œå°†å¯æ‰§è¡Œ Jar åŒ…æ‰“å…¥é•œåƒã€‚ä¾‹å¦‚ï¼š</li>
</ul>
<blockquote><code>FROM openjdk:8-jre-slim</code><br>
<code>COPY app-1.0.jar /app/app.jar</code><br>
<code>CMD [&quot;java&quot;, &quot;-jar&quot;, &quot;/app/app.jar&quot;, &quot;--spring.config.location=/app/config/&quot;]</code></blockquote><p>æˆ‘ä»¬å°†åº”ç”¨è¿è¡Œæ‰€éœ€çš„é…ç½®æ–‡ä»¶ä¹Ÿæ‰“åŒ…è¿›é•œåƒçš„ /app/config/ ç›®å½•ï¼ˆæˆ–æŒ‚è½½ ConfigMapï¼Œè§åç»­ï¼‰ï¼Œä»¥ç¡®ä¿å®¹å™¨å¯åŠ¨æ—¶èƒ½æ‰¾åˆ°æ­£ç¡®é…ç½®ã€‚å®Œæˆ Dockerfile åï¼Œé€šè¿‡å†…ç½‘çš„ CI å·¥å…·æ„å»ºé•œåƒå¹¶æ¨é€åˆ°ç§æœ‰é•œåƒä»“åº“ï¼ˆå¦‚ registry.example.com/myteam/app:1.0ï¼‰ã€‚</p>
<ul>
<li>ç¼–å†™ K8s éƒ¨ç½²æ¸…å•ï¼šæ¥ç€ï¼Œæˆ‘ä»¬ç¼–å†™ Kubernetes æ¸…å•æ–‡ä»¶ï¼ŒåŒ…æ‹¬ Deploymentã€Service ç­‰èµ„æºã€‚ç¤ºä¾‹ Deployment æ¸…å•ç‰‡æ®µï¼š</li>
</ul>
<blockquote><code>apiVersion: apps/v1</code><br>
<code>kind: Deployment</code><br>
<code>metadata:</code><br>
<code>  name: myapp-deployment</code><br>
<code>spec:</code><br>
<code>  replicas: 2</code><br>
<code>  selector:</code><br>
<code>    matchLabels:</code><br>
<code># ... (26 more lines)</code></blockquote>
<p><em>Full code available in the <a href="https://github.com/geyuxu">GitHub repository</a>.</em></p><p>ä¸Šè¿°æ¸…å•å®šä¹‰äº†ä¸¤ä¸ªå‰¯æœ¬çš„éƒ¨ç½²ï¼Œå¹¶é…ç½®äº†åº”ç”¨å®¹å™¨ä½¿ç”¨æˆ‘ä»¬æ„å»ºçš„é•œåƒã€‚åŒæ—¶è®¾ç½®äº† å°±ç»ªæ¢é’ˆ (Readiness Probe) å’Œ å­˜æ´»æ¢é’ˆ (Liveness Probe)ï¼Œå®šæœŸè®¿é—®åº”ç”¨çš„å¥åº·æ£€æŸ¥æ¥å£ /healthã€‚è¿™äº›æ¢é’ˆç¡®ä¿åº”ç”¨åªæœ‰åœ¨å¥åº·æ—¶æ‰æ¥å—æµé‡ï¼Œå¹¶åœ¨å¼‚å¸¸æ—¶è‡ªåŠ¨é‡å¯å®¹å™¨ï¼Œæé«˜å‘å¸ƒè¿‡ç¨‹çš„å¯é æ€§ã€‚</p>
<ul>
<li>é…ç½®ç®¡ç†ï¼šå¯¹äºåº”ç”¨éœ€è¦çš„é…ç½®å’Œæ•æ„Ÿä¿¡æ¯ï¼Œæˆ‘ä»¬é¿å…ç¡¬ç¼–ç è¿›é•œåƒï¼Œè€Œæ˜¯ä½¿ç”¨ ConfigMap å’Œ Secret æ¥æä¾›ã€‚åœ¨ Deployment æ¸…å•ä¸­é€šè¿‡æŒ‚è½½æ–¹å¼æˆ–ç¯å¢ƒå˜é‡å¼•ç”¨è¿™äº›é…ç½®ã€‚ä¾‹å¦‚æ•°æ®åº“è¿æ¥å­—ç¬¦ä¸²ç”¨ Secret å­˜å‚¨ï¼Œå¯åŠ¨æ—¶é€šè¿‡ç¯å¢ƒå˜é‡æ³¨å…¥ã€‚è¿™æ ·åœ¨ä¸åŒç¯å¢ƒä¸‹ï¼ˆæµ‹è¯•ã€ç”Ÿäº§ï¼‰å¯ä»¥ä½¿ç”¨ä¸åŒçš„é…ç½®è€Œä¸éœ€æ›´æ”¹é•œåƒã€‚</li>
<li>CI/CD æµæ°´çº¿ï¼šæˆ‘ä»¬å°†æ„å»ºå’Œéƒ¨ç½²æ­¥éª¤é›†æˆåˆ° CI/CD å·¥å…·ï¼ˆå¦‚ Jenkins æˆ– GitLab CIï¼‰çš„æµæ°´çº¿ä¸­ã€‚å½“ä»£ç åˆå¹¶åˆ°ä¸»å¹²åˆ†æ”¯æ—¶ï¼Œæµæ°´çº¿è‡ªåŠ¨æ‰§è¡Œï¼šç¼–è¯‘æµ‹è¯• -&gt; æ„å»ºDockeré•œåƒ -&gt; æ¨é€é•œåƒ -&gt; éƒ¨ç½²åˆ° K8s é›†ç¾¤ã€‚éƒ¨ç½²é˜¶æ®µé€šè¿‡ kubectl apply -f æˆ– Helmsman ç­‰å·¥å…·å°†é¢„å…ˆç¼–å†™çš„ K8s æ¸…å•åº”ç”¨åˆ°é›†ç¾¤ã€‚é…åˆ Deployment æ§åˆ¶å™¨çš„æ»šåŠ¨æ›´æ–°ç­–ç•¥ï¼Œå‘å¸ƒæ–°ç‰ˆæœ¬æ—¶æ—§å®¹å™¨é€æ­¥æ›¿æ¢ä¸ºæ–°å®¹å™¨ï¼Œå®ç°é›¶åœæœºå‘å¸ƒæˆ–æœ€å°åŒ–æœåŠ¡ä¸­æ–­ã€‚</li>
<li>å‘å¸ƒè§„èŒƒå’Œå®¡æ ¸ï¼šä¸ºäº†ä¿éšœæ¯æ¬¡å‘å¸ƒè´¨é‡ï¼Œæˆ‘ä»¬åˆ¶å®šäº†å‘å¸ƒå‰çš„æ£€æŸ¥æ¸…å•ï¼Œä¾‹å¦‚ï¼š<ul>
<li>ç¡®è®¤æ–°ç‰ˆæœ¬åœ¨æµ‹è¯•ç¯å¢ƒé€šè¿‡å®Œæ•´å›å½’æµ‹è¯•ï¼›</li>
<li>é•œåƒæ‰«ææ— é«˜å±æ¼æ´ï¼›</li>
<li>YAML æ¸…å•éµå¾ªå…¬å¸å†…éƒ¨è§„èŒƒï¼ˆå¦‚æ ‡ç­¾ã€èµ„æºé…é¢Requests/Limitsè®¾ç½®é½å…¨ç­‰ï¼‰ï¼›</li>
<li>ç°åº¦å‘å¸ƒç­–ç•¥ï¼šå¯¹äºé‡å¤§ç‰ˆæœ¬é‡‡ç”¨åˆ†æ‰¹å‘å¸ƒï¼Œå…ˆåœ¨ä¸€å°éƒ¨åˆ†å®ä¾‹ä¸Šéƒ¨ç½²è§‚å¯Ÿè¿è¡ŒçŠ¶å†µï¼Œå†é€æ­¥æ‰©è‡³å…¨é‡ã€‚</li>
</ul>
</li>
</ul>
<p>é€šè¿‡ Kubernetes çš„æ ‡å‡†åŒ–éƒ¨ç½²ï¼Œæˆ‘ä»¬çš„åº”ç”¨å‘å¸ƒä»æ­¤è¿›å…¥æµæ°´çº¿ä½œä¸šï¼Œå®ç°äº†ä¸€é”®éƒ¨ç½²å’Œå›æ»šï¼Œå‡å°‘äº†äººä¸ºå¤±è¯¯ã€‚æ¯æ¬¡éƒ¨ç½²éƒ½æœ‰è®°å½•å’Œç›‘æ§ï¼Œä½¿å¾—é—®é¢˜è¿½æº¯å’Œå¿«é€Ÿæ¢å¤æ›´åŠ æ–¹ä¾¿ã€‚</p>
<h2>æ—¥å¿—ç›‘æ§ä½“ç³»æ­å»º</h2>
<p>éšç€ç³»ç»Ÿé€æ­¥èµ°å‘å®¹å™¨åŒ–å’Œåˆ†å¸ƒå¼ï¼Œæˆ‘ä»¬åŒæ­¥å»ºç«‹äº†å®Œå–„çš„æ—¥å¿—å’Œç›‘æ§ä½“ç³»ï¼Œç”¨äºè¿ç»´è¿‡ç¨‹ä¸­çš„æ•…éšœè¯Šæ–­å’Œæ€§èƒ½è°ƒä¼˜ã€‚</p>
<ul>
<li>é›†ä¸­å¼æ—¥å¿—ç³»ç»Ÿï¼šè¿‡å»æ—¥å¿—åˆ†æ•£åœ¨å„å°æœåŠ¡å™¨ï¼Œå‡ºé—®é¢˜æ—¶éœ€è¦é€å°ç™»å½•æ£€ç´¢ã€‚æˆ‘ä»¬å¼•å…¥äº† ELK/EFK æ—¥å¿—ç³»ç»Ÿï¼Œå°†å®¹å™¨æ—¥å¿—é›†ä¸­æ”¶é›†ã€‚å…·ä½“åšæ³•æ˜¯åœ¨ Kubernetes é›†ç¾¤éƒ¨ç½² Filebeat/Fluentd æ—¥å¿—æ”¶é›†å™¨ï¼Œä»å„å®¹å™¨çš„ stdout å’Œ stderr è·å–æ—¥å¿—æµï¼Œå‘é€åˆ°é›†ä¸­å­˜å‚¨ï¼ˆElasticsearch æ—¥å¿—åº“ï¼‰ã€‚åœ¨åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ç»Ÿä¸€çš„æ—¥å¿—æ ¼å¼ï¼ˆä¾‹å¦‚ JSON æ ¼å¼æ—¥å¿—ï¼‰ï¼ŒåŒ…å«æ—¶é—´æˆ³ã€çº§åˆ«ã€çº¿ç¨‹ã€è¯·æ±‚IDç­‰å­—æ®µï¼Œæ–¹ä¾¿åœ¨ Kibana ä¸­æ£€ç´¢å’Œè¿‡æ»¤ã€‚ç°åœ¨ï¼Œå½“æŸæœåŠ¡å‘ç”Ÿé”™è¯¯ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ Kibana ä¸€å¤„æŸ¥çœ‹è¯¥æœåŠ¡æ‰€æœ‰å®ä¾‹çš„æ—¥å¿—ï¼ŒæŒ‰ç…§æ—¶é—´çº¿è¿½è¸ªé—®é¢˜ï¼Œå¤§å¤§æå‡æ’æŸ¥æ•ˆç‡ã€‚</li>
<li>æ€§èƒ½æŒ‡æ ‡ç›‘æ§ï¼šæˆ‘ä»¬æ­å»ºäº†åŸºäº Prometheus + Grafana çš„ç›‘æ§ç³»ç»Ÿã€‚Prometheus å®šæ—¶æŠ“å–å„æœåŠ¡çš„æŒ‡æ ‡æ•°æ®ï¼ˆåŒ…æ‹¬åŸºç¡€èµ„æºå¦‚CPUã€å†…å­˜ï¼ŒåŠåº”ç”¨è‡ªå®šä¹‰æŒ‡æ ‡å¦‚è¯·æ±‚æ¬¡æ•°ã€é”™è¯¯ç‡ï¼‰ï¼ŒGrafana åˆ™ç”¨æ¥å¯è§†åŒ–å±•ç¤ºã€‚æˆ‘ä»¬åœ¨åº”ç”¨ä¸­é›†æˆäº† Micrometer åº“ï¼Œå°†ä¸šåŠ¡æŒ‡æ ‡æš´éœ²ç»™ Prometheusã€‚é€šè¿‡å®šåˆ¶ä»ªè¡¨ç›˜ï¼Œå¯ä»¥å®æ—¶çœ‹åˆ°ç³»ç»Ÿçš„ QPSã€å“åº”æ—¶é—´åˆ†å¸ƒã€æ•°æ®åº“è¿æ¥æ•°ç­‰å…³é”®æŒ‡æ ‡ã€‚é…åˆ Alertmanager è®¾ç½®å‘Šè­¦è§„åˆ™ï¼Œä¸€æ—¦æŸæŒ‡æ ‡è¶…è¿‡é˜ˆå€¼ï¼ˆå¦‚ CPU é•¿æ—¶é—´è¿‡é«˜ã€é”™è¯¯ç‡çªå¢ï¼‰ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨é€šè¿‡çŸ­ä¿¡æˆ–é’‰é’‰æœºå™¨äººé€šçŸ¥ç›¸å…³äººå‘˜åŠæ—¶å“åº”ã€‚</li>
<li>é“¾è·¯è¿½è¸ªå’Œåˆ†æï¼šé™¤äº†æ—¥å¿—å’ŒæŒ‡æ ‡ï¼Œæˆ‘ä»¬è¿˜è¯„ä¼°äº†é“¾è·¯è¿½è¸ªå·¥å…·ï¼ˆå¦‚ SkyWalkingã€Jaegerï¼‰ç”¨äºåˆ†å¸ƒå¼è°ƒç”¨è·Ÿè¸ªã€‚åœ¨å¤æ‚çš„å¾®æœåŠ¡ç¯å¢ƒä¸­ï¼Œè¿™ç±»å·¥å…·å¯ä»¥å¸®åŠ©æˆ‘ä»¬è¿½è¸ªä¸€æ¬¡ç”¨æˆ·è¯·æ±‚ç»è¿‡çš„å¤šä¸ªæœåŠ¡ï¼Œå®šä½åœ¨å“ªä¸€ç¯èŠ‚å‡ºç°ç“¶é¢ˆæˆ–é”™è¯¯ã€‚ä¸è¿‡ç”±äºéƒ¨ç½²å’Œä½¿ç”¨æˆæœ¬è¾ƒé«˜ï¼Œæˆ‘ä»¬å›¢é˜Ÿæ ¹æ®å®é™…éœ€è¦é€‰æ‹©äº†é€æ­¥è¯•ç‚¹éƒ¨åˆ†æ ¸å¿ƒé“¾è·¯çš„è¿½è¸ªï¼Œè€Œæ—¥å¿—å’ŒæŒ‡æ ‡ç›‘æ§ä»æ˜¯ä¸»è¦çš„è¿ç»´æ‰‹æ®µã€‚</li>
</ul>
<p>é€šè¿‡æ—¥å¿—å’Œç›‘æ§ä½“ç³»çš„æ­å»ºï¼Œæˆ‘ä»¬å®ç°äº†å¯¹ç³»ç»Ÿ <strong>å¯è§‚å¯Ÿæ€§ï¼ˆObservabilityï¼‰</strong> çš„æå¤§æå‡ã€‚ä»ä»¥å‰å‡ºæ•…éšœâ€œç›²äººæ‘¸è±¡â€å¼çš„çŒœæµ‹ï¼Œè½¬å˜ä¸ºç°åœ¨æœ‰æ•°æ®æ”¯æ’‘çš„ç²¾å‡†åˆ†æã€‚ä¸ä»…æ•…éšœæ¢å¤æ—¶é—´ï¼ˆMTTRï¼‰é™ä½äº†ï¼Œæ—¥å¸¸æ€§èƒ½è°ƒä¼˜ä¹Ÿæœ‰æ®å¯ä¾ï¼Œæ•´ä½“è¿è¡Œç»´æŠ¤æ›´åŠ ä»å®¹ã€‚</p>
<h2>æ•ˆæœè¯„ä¼°ï¼ˆä¼˜åŒ–å‰åå¯¹æ¯”ï¼‰</h2>
<p>é€šè¿‡ä¸Šè¿°ä¸€ç³»åˆ—æ”¹è¿›ï¼Œæˆ‘ä»¬å¯¹æ¯”äº†ä¼˜åŒ–å‰åçš„æ•ˆæœï¼š</p>
<p><img src="__TABLE_-c2b0438__" alt="Table"></p><p>ï¼ˆè¡¨ï¼šç³»ç»Ÿåœ¨éƒ¨ç½²å’Œè¿ç»´æ–¹é¢ä¼˜åŒ–å‰åçš„å¯¹æ¯”ï¼‰</p>
<p>ä»ä¸Šè¡¨å¯ä»¥çœ‹å‡ºï¼Œç³»ç»Ÿç»è¿‡æ”¹é€ ååœ¨å‘å¸ƒæ•ˆç‡ã€å¯é æ€§å’Œå¯ç»´æŠ¤æ€§æ–¹é¢éƒ½æœ‰äº†æ˜¾è‘—æå‡ã€‚ä¾‹å¦‚å‘å¸ƒæ•ˆç‡æ–¹é¢ï¼Œç”±åŸæ¥çš„æ¯æ¬¡å‘å¸ƒè€—æ—¶åŠå°æ—¶ã€éœ€å¤šäººé…åˆï¼Œä¼˜åŒ–ä¸ºæµæ°´çº¿åé€šå¸¸å‡ åˆ†é’Ÿå³å¯å®Œæˆï¼Œä¸”åŸºæœ¬é›¶äººå·¥å¹²é¢„ã€‚å†å¦‚æ•…éšœæ’æŸ¥ï¼Œä»¥å‰å¯èƒ½éœ€è¦1-2å°æ—¶é›†ä¸­åˆ†ææ—¥å¿—æ‰èƒ½æ‰¾åˆ°é—®é¢˜ï¼Œç°åœ¨å€ŸåŠ©é›†ä¸­æ—¥å¿—å’Œç›‘æ§æŠ¥è­¦ï¼Œå¾ˆå¤šé—®é¢˜åœ¨å‡ åˆ†é’Ÿå†…å°±èƒ½æ£€æµ‹å¹¶é€šçŸ¥ç›¸å…³äººå‘˜ã€‚æ€»ä½“è€Œè¨€ï¼Œè¿™äº›å®è·µä¼˜åŒ–äº†å›¢é˜Ÿçš„ DevOps å·¥ä½œæ¨¡å¼ï¼Œä¸ºä¸šåŠ¡å¿«é€Ÿè¿­ä»£æä¾›äº†åšå®ä¿éšœã€‚</p>
<h2>æ€»ç»“æå‡</h2>
<p>é€šè¿‡è¿™æ¬¡ä»ç¦»çº¿éƒ¨ç½²åˆ° K8s æµæ°´çº¿å‘å¸ƒçš„å®è·µï¼Œæˆ‘ä»¬å›¢é˜Ÿæ”¶è·äº†å®è´µçš„ç»éªŒæ•™è®­ï¼Œä¹ŸéªŒè¯äº†æ–°æŠ€æœ¯åœ¨ç”Ÿäº§ç¯å¢ƒä¸­çš„ä»·å€¼ã€‚åœ¨æ€»ç»“å‡ ç‚¹ä½“ä¼šçš„åŒæ—¶ï¼Œæˆ‘ä»¬ä¹Ÿå±•æœ›æœªæ¥çš„æ”¹è¿›æ–¹å‘ï¼š</p>
<ul>
<li>å®è·µä½“ä¼šï¼š<ol>
<li>åŸºç¡€è®¾æ–½å³ä»£ç çš„é‡è¦æ€§ï¼šæ— è®ºæ˜¯éƒ¨ç½²è„šæœ¬ã€K8s æ¸…å•è¿˜æ˜¯ç›‘æ§å‘Šè­¦é…ç½®ï¼Œéƒ½åº”çº³å…¥ç‰ˆæœ¬ç®¡ç†ï¼Œé€šè¿‡ä»£ç å®¡é˜…å’Œæµæ°´çº¿æ‰§è¡Œç¡®ä¿ä¸€è‡´æ€§ã€‚</li>
<li>å·¥å…·é€‰å‹éœ€ç»“åˆå®é™…ï¼šä¾‹å¦‚åœ¨å¤§æ•°æ®å¯¼å‡ºæ—¶ï¼Œé€‰æ‹©ä¸“ä¸šå·¥å…·å¤§å¹…æé«˜æ•ˆç‡ï¼›åœ¨ç›‘æ§æ–¹é¢ï¼Œä¸ç›²ç›®è¿½æ–°ï¼Œè€Œæ˜¯æ ¹æ®å›¢é˜Ÿèƒ½åŠ›å¾ªåºæ¸è¿›åœ°å¼•å…¥é€‚åˆçš„ç»„ä»¶ã€‚</li>
<li>æ•…éšœæ¼”ç»ƒå’Œé¢„æ¡ˆï¼šåœ¨å®ç°äº†è‡ªåŠ¨åŒ–å’Œç›‘æ§åï¼Œæ›´åº”å®šæœŸæ¼”ç»ƒæ•…éšœåœºæ™¯ï¼ˆå¦‚å•ç‚¹æ•…éšœã€å‘å¸ƒå¤±è´¥å›æ»šç­‰ï¼‰ï¼Œç¡®ä¿å›¢é˜Ÿå¯¹æ–°ä½“ç³»ä¸‹çš„å¼‚å¸¸å¤„ç†ç†Ÿç»ƒæœ‰ç´ ã€‚</li>
</ol>
</li>
<li>æœªæ¥æ”¹è¿›ï¼šæˆ‘ä»¬è®¡åˆ’è¿›ä¸€æ­¥å®Œå–„æŒç»­äº¤ä»˜ï¼Œå®ç°ä¸€é”®éƒ¨ç½²åˆ°å¤šç¯å¢ƒå’Œè“ç»¿å‘å¸ƒ/é‡‘ä¸é›€å‘å¸ƒç­‰é«˜çº§ç­–ç•¥ã€‚åŒæ—¶ï¼Œåœ¨ Observability æ–¹é¢å¼•å…¥åˆ†å¸ƒå¼è¿½è¸ªå…¨é¢ç›‘æ§è¯·æ±‚é“¾è·¯ï¼Œå¹¶è¯„ä¼°æœåŠ¡ç½‘æ ¼(Service Mesh)ç­‰æŠ€æœ¯æ¥å¢å¼ºæµé‡æ§åˆ¶å’Œå®‰å…¨æ²»ç†ã€‚è¿™äº›å°†æˆä¸ºä¸‹ä¸€æ­¥æå‡çš„æ–¹å‘ã€‚</li>
</ul>
<p>æœ€åï¼Œå¸Œæœ›æœ¬æ¬¡å®æˆ˜æ€»ç»“å¯¹å„ä½è¯»è€…æœ‰æ‰€å¯å‘ã€‚æŠ€æœ¯æ”¹è¿›æ˜¯ä¸€ä¸ªæ¸è¿›çš„è¿‡ç¨‹ï¼Œä»ç¦»çº¿éƒ¨ç½²çš„æ‘¸ç´¢åˆ°äº‘åŸç”Ÿå®è·µçš„è½åœ°ï¼Œæ¯ä¸€æ­¥éƒ½ä¼´éšç€æŒ‘æˆ˜å’Œæ”¶è·ã€‚ä½œä¸ºä¸€çº¿å·¥ç¨‹å¸ˆï¼Œæˆ‘ä»¬åº”å½“æ‹¥æŠ±æ–°æŠ€æœ¯å¸¦æ¥çš„å˜é©ï¼ŒåŒæ—¶ä¿æŒå¯¹ç»†èŠ‚é—®é¢˜çš„æ•æ„Ÿï¼Œç§¯ç´¯ç»éªŒï¼Œä¸æ–­ä¼˜åŒ–ç³»ç»Ÿçš„ç¨³å®šæ€§å’Œäº¤ä»˜æ•ˆç‡ã€‚åœ¨æœªæ¥çš„é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬å°†ç»§ç»­æ²‰æ·€æ›´å¤šå®è·µæ¡ˆä¾‹ï¼Œä¸å¤§å®¶åˆ†äº«äº¤æµï¼</p>

    </article>
    </main>
</div>

<script src="https://cdn.jsdelivr.net/npm/prismjs@1/prism.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/prismjs@1/components/prism-python.min.js"></script>
<script>
Prism.highlightAll();
document.querySelectorAll('article pre').forEach(pre => {
    const code = pre.querySelector('code');
    if (!code) return;
    const toolbar = document.createElement('div');
    toolbar.className = 'code-toolbar';
    const btn = document.createElement('button');
    btn.className = 'copy-btn';
    btn.textContent = 'Copy';
    btn.onclick = () => {
        navigator.clipboard.writeText(code.textContent).then(() => {
            btn.textContent = 'Copied!';
            btn.classList.add('copied');
            setTimeout(() => { btn.textContent = 'Copy'; btn.classList.remove('copied'); }, 2000);
        });
    };
    toolbar.appendChild(btn);
    pre.parentNode.insertBefore(toolbar, pre);
});
</script>
</body>
</html>